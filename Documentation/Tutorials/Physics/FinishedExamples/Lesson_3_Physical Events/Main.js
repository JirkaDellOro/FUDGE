"use strict";
//Reference Fudge, getting code completion ready and creating a shortcut f to write FudgeCode more comfortably
var Tutorials_FUDGEPhysics_Lesson1;
//Reference Fudge, getting code completion ready and creating a shortcut f to write FudgeCode more comfortably
(function (Tutorials_FUDGEPhysics_Lesson1) {
    var f = FudgeCore;
    //Goal: Learn how to create and use physics based events (Collision/Trigger) to control nodes in the app.
    //Fudge Basic Variables
    window.addEventListener("load", init);
    const app = document.querySelector("canvas"); // The html element where the scene is drawn to
    let viewPort; // The scene visualization
    let hierarchy; // You're object scene tree
    //Physical Objects
    let bodies = new Array(); // Array of all physical objects in the scene to have a quick reference
    let playerBody; // Transform of a body that interacts with physics but can be moved by normal FudgeTransform
    //Setting Variables
    let force = 0.5; //The amount of movement with each keypress
    let playerDefaultMat = new f.Material("Cube", f.ShaderFlat, new f.CoatRemissive(new f.Color(0, 0, 1, 1)));
    let playerTriggeredMat = new f.Material("CubeTriggered", f.ShaderFlat, new f.CoatRemissive(new f.Color(0.9, 0.1, 0.1, 1)));
    //Function to initialize the Fudge Scene with a camera, light, viewport and PHYSCIAL Objects
    function init(_event) {
        hierarchy = new f.Node("Scene"); //create the root Node where every object is parented to. Should never be changed
        //#region PHYSICS
        //PHYSICS - Step 2: Create some physical Nodes to play with 
        //Creating a physically static ground plane for our physics playground. A simple scaled cube but with physics type set to static
        bodies[0] = createCompleteNode("Ground", new f.Material("Ground", f.ShaderFlat, new f.CoatRemissive(new f.Color(0.2, 0.2, 0.2, 1))), new f.MeshCube(), 0, f.BODY_TYPE.STATIC);
        bodies[0].mtxLocal.scale(new f.Vector3(14, 0.3, 14)); //Scale the body with it's standard ComponentTransform
        bodies[0].mtxLocal.rotateX(4, true); //Give it a slight rotation so the physical objects are sliding, always from left when it's after a scaling
        hierarchy.appendChild(bodies[0]); //Add the node to the scene by adding it to the scene-root
        //Step 1 - Creating a the player cube - to interact to trigger, COLLIDERS and TRIGGERS 
        bodies[1] = createCompleteNode("Player", playerDefaultMat, new f.MeshCube(), 1, f.BODY_TYPE.DYNAMIC);
        playerBody = bodies[1]; //Reference this node specifically so we can access it for input more easily
        playerBody.mtxLocal.translate(new f.Vector3(0, 1, 0));
        hierarchy.appendChild(bodies[1]);
        playerBody.getComponent(f.ComponentRigidbody).effectRotation = new f.Vector3(0, 0, 0); //make rotation fixed the player does not rotate
        playerBody.getComponent(f.ComponentRigidbody).friction = 1;
        //Step 2 - Create bodies - one used as a button when it collides it will an action will happen - one as a trigger, when it's overlapping it will trigger an action
        //The Collision Event is happening on a collision so a normal body can receive it
        //A use case for a collision event is for example when the player is hitting the ground to play a sound
        bodies[2] = createCompleteNode("Collider_Button", new f.Material("Collider_Button", f.ShaderFlat, new f.CoatRemissive(new f.Color(0.3, 0.3, 0.4, 1))), new f.MeshCube(), 1, f.BODY_TYPE.STATIC);
        bodies[2].mtxLocal.translate(new f.Vector3(-3, 1, 0));
        hierarchy.appendChild(bodies[2]);
        //The Trigger Event is happening when bodies overlap, so we need a special body that does not collide but overlap
        //So it must be flagged as trigger, and normally in games it's invisble, so it has no mesh component or is fully transparent.
        //A use case is something like spawning enemies when a player enters a room.
        bodies[3] = createCompleteNode("Trigger_Button", new f.Material("Trigger_Button", f.ShaderFlat, new f.CoatRemissive(new f.Color(0.5, 0.3, 0.2, 0.3))), new f.MeshCube(), 1, f.BODY_TYPE.STATIC, f.COLLISION_GROUP.DEFAULT);
        bodies[3].mtxLocal.translate(new f.Vector3(3, 1, 0));
        bodies[3].getComponent(f.ComponentRigidbody).isTrigger = true;
        hierarchy.appendChild(bodies[3]);
        //Trigger when player is falling of the plane
        bodies[4] = createCompleteNode("Trigger_Reset", new f.Material("Trigger_Reset", f.ShaderFlat, new f.CoatRemissive(new f.Color(0.5, 0.3, 0.2, 0.3))), new f.MeshCube(), 1, f.BODY_TYPE.STATIC, f.COLLISION_GROUP.DEFAULT);
        bodies[4].getComponent(f.ComponentRigidbody).isTrigger = true;
        bodies[4].removeComponent(bodies[4].getComponent(f.ComponentMesh)); //removing the mesh to have invisible trigger - standard practice
        bodies[4].mtxLocal.translate(new f.Vector3(0, -4, 0));
        bodies[4].mtxLocal.scale(new f.Vector3(30, 1, 30)); //Make it big enough so the player should hit it
        hierarchy.appendChild(bodies[4]);
        //Step 3 - After creating our Physic Event Bodies, we tell them to listen to the specific event happening
        //These events are happening on the physic component not on the node. So be sure to add them to the component not to the node
        //A body can receive a enter/exit event, and it's only happening once. If a body is staying on a collision or in a trigger it needs to be handled manually
        bodies[2].getComponent(f.ComponentRigidbody).addEventListener("ColliderEnteredCollision" /* COLLISION_ENTER */, hndCollisionEventEnter);
        bodies[2].getComponent(f.ComponentRigidbody).addEventListener("ColliderLeftCollision" /* COLLISION_EXIT */, hndCollisionEventExit);
        /*Hint: The Collision Event is only happening if the object is hitting it physically,
          So KINEMATIC vs. STATIC does not receive a collision Event. Only DYNAMIC vs. DYNAMIC/STATIC/KINEMATIC, neither do two Kinematic hit each other nor do Kinematic/Static.
          If you really need a kinematic hitting a static object and still have a action, use trigger, or make the object not static but dynamic but unmoving by having a ridiculously high weight.
          Thats why we use a dynamic player cube instead of a kinematic like we did in Lesson 1.
        */
        //Same as for collision a trigger is also listening on a event type in form of f.EVENT_PHYSICS and a function that will be called
        bodies[3].getComponent(f.ComponentRigidbody).addEventListener("TriggerEnteredCollision" /* TRIGGER_ENTER */, hndTriggerEventEnter);
        bodies[3].getComponent(f.ComponentRigidbody).addEventListener("TriggerLeftCollision" /* TRIGGER_EXIT */, hndTriggerEventExit);
        //Setting up our reset
        bodies[4].getComponent(f.ComponentRigidbody).addEventListener("TriggerEnteredCollision" /* TRIGGER_ENTER */, hndResetTrigger);
        //#endregion PHYSICS
        //Standard Fudge Scene Initialization - Creating a directional light, a camera and initialize the viewport
        let cmpLight = new f.ComponentLight(new f.LightDirectional(f.Color.CSS("WHITE")));
        cmpLight.mtxPivot.lookAt(new f.Vector3(0.5, -1, -0.8)); //Set light direction
        hierarchy.addComponent(cmpLight);
        let cmpCamera = new f.ComponentCamera();
        cmpCamera.clrBackground = f.Color.CSS("GREY");
        cmpCamera.mtxPivot.translate(new f.Vector3(2, 3.5, 17)); //Move camera far back so the whole scene is visible
        cmpCamera.mtxPivot.lookAt(f.Vector3.ZERO()); //Set the camera matrix so that it looks at the center of the scene
        viewPort = new f.Viewport(); //Creating a viewport that is rendered onto the html canvas element
        viewPort.initialize("Viewport", hierarchy, cmpCamera, app); //initialize the viewport with the root node, camera and canvas
        document.addEventListener("keypress", hndKey); //Adding a listener for keypress handling
        //PHYSICS - Start using physics by telling the physics the scene root object. Physics will recalculate every transform and initialize
        f.Physics.adjustTransforms(hierarchy);
        //Important start the game loop after starting physics, so physics can use the current transform before it's first iteration
        f.Loop.addEventListener("loopFrame" /* LOOP_FRAME */, update); //Tell the game loop to call the update function on each frame
        f.Loop.start(); //Stard the game loop
    }
    //Function to animate/update the Fudge scene, commonly known as gameloop
    function update() {
        f.Physics.simulate(); //PHYSICS - Simulate physical changes each frame, parameter to set time between frames
        viewPort.draw(); // Draw the current Fudge Scene to the canvas
    }
    // Function to quickly create a node with multiple needed FudgeComponents, including a physics component
    function createCompleteNode(_name, _material, _mesh, _mass, _physicsType, _group = f.COLLISION_GROUP.DEFAULT, _colType = f.COLLIDER_TYPE.CUBE) {
        let node = new f.Node(_name); //Creating the node
        let cmpMesh = new f.ComponentMesh(_mesh); //Creating a mesh for the node
        let cmpMaterial = new f.ComponentMaterial(_material); //Creating a material for the node
        let cmpTransform = new f.ComponentTransform(); //Transform holding position/rotation/scaling of the node
        let cmpRigidbody = new f.ComponentRigidbody(_mass, _physicsType, _colType, _group); //<-- adding the group when using triggers, since a trigger should not collide with anything else
        node.addComponent(cmpMesh);
        node.addComponent(cmpMaterial);
        node.addComponent(cmpTransform);
        node.addComponent(cmpRigidbody); // <-- best practice to add physics component last
        return node; //return the full created node
    }
    // Event Function handling keyboard input - similar to Lesson 1 but a little different, since it's pushing the player by force
    function hndKey(_event) {
        let horizontal = 0; //left/right
        let vertical = 0; //front/back
        let height = 0; //upwards/downwards
        //Check keyboard input from Event
        if (_event.code == f.KEYBOARD_CODE.A) {
            horizontal -= force;
        }
        if (_event.code == f.KEYBOARD_CODE.D) {
            horizontal += force;
        }
        if (_event.code == f.KEYBOARD_CODE.W) {
            vertical -= force;
        }
        if (_event.code == f.KEYBOARD_CODE.S) {
            vertical += force;
        }
        if (_event.code == f.KEYBOARD_CODE.SPACE) { //Jump
            height += force * 10;
        }
        playerBody.getComponent(f.ComponentRigidbody).applyLinearImpulse(new f.Vector3(horizontal, height, vertical));
    }
    //Step 4 - Receiving and handling the events
    //Event function handling collision - A EVENT_PHYSICS is receiving a f.EventPhysics with infos about the event
    function hndCollisionEventEnter(_event) {
        //_event. keeps a plethora of informations about the event the most interesting are things like 
        /*
          _event.cmpRigidbody -> to identify the body involved in the event, with node.name you get the actual name of the node involved
          _event.normalImpulse -> intensity of the collision good to play a sound that is only as heavy as the collision
          _event.collisionPoint -> the point in the world where the collision is happening to maybe spawn things like particles
          _event.collisionNormal -> the direction the collision is happening often used to correctly rotate spawned things on the colliding surface
        */
        if (_event.cmpRigidbody.node.name == "Player") { //Our Event is happening with the body NODE called "Player"
            f.Debug.log("Player hit me - Collider");
            //We let this collider act like a bumper through this event. We take the event normal and shoot the player away from the bumper on the contact point.
            playerBody.getComponent(f.ComponentRigidbody).applyForceAtPoint(new f.Vector3(_event.collisionNormal.x * 500, _event.collisionNormal.y * 500, _event.collisionNormal.z * 500), _event.collisionPoint);
        }
    }
    function hndCollisionEventExit(_event) {
        if (_event.cmpRigidbody.node.name == "Player") {
            f.Debug.log("Player left me - Collider");
        }
    }
    //Event function handling triggering
    function hndTriggerEventEnter(_event) {
        if (_event.cmpRigidbody.node.name == "Player") {
            f.Debug.log("Player entered me - Trigger");
            playerBody.getComponent(f.ComponentMaterial).material = playerTriggeredMat;
        }
    }
    function hndTriggerEventExit(_event) {
        if (_event.cmpRigidbody.node.name == "Player") {
            f.Debug.log("Player left me - Trigger");
            playerBody.getComponent(f.ComponentMaterial).material = playerDefaultMat;
        }
    }
    //Since the player could fall of we will reset him back with a trigger when he falls down from the plane
    function hndResetTrigger(_event) {
        if (_event.cmpRigidbody.node.name == "Player") {
            playerBody.getComponent(f.ComponentRigidbody).setPosition(new f.Vector3(0, 3, 0)); //Since it's a physics body we have to set position through physics not transform
        }
    }
})(Tutorials_FUDGEPhysics_Lesson1 || (Tutorials_FUDGEPhysics_Lesson1 = {}));
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiTWFpbi5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIk1haW4udHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBLDhHQUE4RztBQUU5RyxJQUFVLDhCQUE4QixDQTJNdkM7QUE3TUQsOEdBQThHO0FBRTlHLFdBQVUsOEJBQThCO0lBQ3BDLElBQU8sQ0FBQyxHQUFHLFNBQVMsQ0FBQztJQUVyQix5R0FBeUc7SUFFekcsdUJBQXVCO0lBQ3ZCLE1BQU0sQ0FBQyxnQkFBZ0IsQ0FBQyxNQUFNLEVBQUUsSUFBSSxDQUFDLENBQUM7SUFDdEMsTUFBTSxHQUFHLEdBQXNCLFFBQVEsQ0FBQyxhQUFhLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQywrQ0FBK0M7SUFDaEgsSUFBSSxRQUFvQixDQUFDLENBQUMsMEJBQTBCO0lBQ3BELElBQUksU0FBaUIsQ0FBQyxDQUFDLDJCQUEyQjtJQUdsRCxrQkFBa0I7SUFDbEIsSUFBSSxNQUFNLEdBQWEsSUFBSSxLQUFLLEVBQUUsQ0FBQyxDQUFDLHVFQUF1RTtJQUMzRyxJQUFJLFVBQWtCLENBQUMsQ0FBQyw0RkFBNEY7SUFHcEgsbUJBQW1CO0lBQ25CLElBQUksS0FBSyxHQUFXLEdBQUcsQ0FBQyxDQUFDLDJDQUEyQztJQUNwRSxJQUFJLGdCQUFnQixHQUFlLElBQUksQ0FBQyxDQUFDLFFBQVEsQ0FBQyxNQUFNLEVBQUUsQ0FBQyxDQUFDLFVBQVUsRUFBRSxJQUFJLENBQUMsQ0FBQyxhQUFhLENBQUMsSUFBSSxDQUFDLENBQUMsS0FBSyxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztJQUN0SCxJQUFJLGtCQUFrQixHQUFlLElBQUksQ0FBQyxDQUFDLFFBQVEsQ0FBQyxlQUFlLEVBQUUsQ0FBQyxDQUFDLFVBQVUsRUFBRSxJQUFJLENBQUMsQ0FBQyxhQUFhLENBQUMsSUFBSSxDQUFDLENBQUMsS0FBSyxDQUFDLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxF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IGFuZCBjcmVhdGluZyBhIHNob3J0Y3V0IGYgdG8gd3JpdGUgRnVkZ2VDb2RlIG1vcmUgY29tZm9ydGFibHlcclxuXHJcbm5hbWVzcGFjZSBUdXRvcmlhbHNfRlVER0VQaHlzaWNzX0xlc3NvbjEge1xyXG4gICAgaW1wb3J0IGYgPSBGdWRnZUNvcmU7XHJcblxyXG4gICAgLy9Hb2FsOiBMZWFybiBob3cgdG8gY3JlYXRlIGFuZCB1c2UgcGh5c2ljcyBiYXNlZCBldmVudHMgKENvbGxpc2lvbi9UcmlnZ2VyKSB0byBjb250cm9sIG5vZGVzIGluIHRoZSBhcHAuXHJcblxyXG4gICAgLy9GdWRnZSBCYXNpYyBWYXJpYWJsZXNcclxuICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKFwibG9hZFwiLCBpbml0KTtcclxuICAgIGNvbnN0IGFwcDogSFRNTENhbnZhc0VsZW1lbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiY2FudmFzXCIpOyAvLyBUaGUgaHRtbCBlbGVtZW50IHdoZXJlIHRoZSBzY2VuZSBpcyBkcmF3biB0b1xyXG4gICAgbGV0IHZpZXdQb3J0OiBmLlZpZXdwb3J0OyAvLyBUaGUgc2NlbmUgdmlzdWFsaXphdGlvblxyXG4gICAgbGV0IGhpZXJhcmNoeTogZi5Ob2RlOyAvLyBZb3UncmUgb2JqZWN0IHNjZW5lIHRyZWVcclxuXHJcblxyXG4gICAgLy9QaHlzaWNhbCBPYmplY3RzXHJcbiAgICBsZXQgYm9kaWVzOiBmLk5vZGVbXSA9IG5ldyBBcnJheSgpOyAvLyBBcnJheSBvZiBhbGwgcGh5c2ljYWwgb2JqZWN0cyBpbiB0aGUgc2NlbmUgdG8gaGF2ZSBhIHF1aWNrIHJlZmVyZW5jZVxyXG4gICAgbGV0IHBsYXllckJvZHk6IGYuTm9kZTsgLy8gVHJhbnNmb3JtIG9mIGEgYm9keSB0aGF0IGludGVyYWN0cyB3aXRoIHBoeXNpY3MgYnV0IGNhbiBiZSBtb3ZlZCBieSBub3JtYWwgRnVkZ2VUcmFuc2Zvcm1cclxuXHJcblxyXG4gICAgLy9TZXR0aW5nIFZhcmlhYmxlc1xyXG4gICAgbGV0IGZvcmNlOiBudW1iZXIgPSAwLjU7IC8vVGhlIGFtb3VudCBvZiBtb3ZlbWVudCB3aXRoIGVhY2gga2V5cHJlc3NcclxuICAgIGxldCBwbGF5ZXJEZWZhdWx0TWF0OiBmLk1hdGVyaWFsID0gbmV3IGYuTWF0ZXJpYWwoXCJDdWJlXCIsIGYuU2hhZGVyRmxhdCwgbmV3IGYuQ29hdFJlbWlzc2l2ZShuZXcgZi5Db2xvcigwLCAwLCAxLCAxKSkpO1xyXG4gICAgbGV0IHBsYXllclRyaWdnZXJlZE1hdDogZi5NYXRlcmlhbCA9IG5ldyBmLk1hdGVyaWFsKFwiQ3ViZVRyaWdnZXJlZFwiLCBmLlNoYWRlckZsYXQsIG5ldyBmLkNvYXRSZW1pc3NpdmUobmV3IGYuQ29sb3IoMC45LCAwLjEsIDAuMSwgMSkpKTtcclxuXHJcbiAgICAvL0Z1bmN0aW9uIHRvIGluaXRpYWxpemUgdGhlIEZ1ZGdlIFNjZW5lIHdpdGggYSBjYW1lcmEsIGxpZ2h0LCB2aWV3cG9ydCBhbmQgUEhZU0NJQUwgT2JqZWN0c1xyXG4gICAgZnVuY3Rpb24gaW5pdChfZXZlbnQ6IEV2ZW50KTogdm9pZCB7XHJcblxyXG4gICAgICAgIGhpZXJhcmNoeSA9IG5ldyBmLk5vZGUoXCJTY2VuZVwiKTsgLy9jcmVhdGUgdGhlIHJvb3QgTm9kZSB3aGVyZSBldmVyeSBvYmplY3QgaXMgcGFyZW50ZWQgdG8uIFNob3VsZCBuZXZlciBiZSBjaGFuZ2VkXHJcblxyXG4gICAgICAgIC8vI3JlZ2lvbiBQSFlTSUNTXHJcblxyXG4gICAgICAgIC8vUEhZU0lDUyAtIFN0ZXAgMjogQ3JlYXRlIHNvbWUgcGh5c2ljYWwgTm9kZXMgdG8gcGxheSB3aXRoIFxyXG4gICAgICAgIC8vQ3JlYXRpbmcgYSBwaHlzaWNhbGx5IHN0YXRpYyBncm91bmQgcGxhbmUgZm9yIG91ciBwaHlzaWNzIHBsYXlncm91bmQuIEEgc2ltcGxlIHNjYWxlZCBjdWJlIGJ1dCB3aXRoIHBoeXNpY3MgdHlwZSBzZXQgdG8gc3RhdGljXHJcbiAgICAgICAgYm9kaWVzWzBdID0gY3JlYXRlQ29tcGxldGVOb2RlKFwiR3JvdW5kXCIsIG5ldyBmLk1hdGVyaWFsKFwiR3JvdW5kXCIsIGYuU2hhZGVyRmxhdCwgbmV3IGYuQ29hdFJlbWlzc2l2ZShuZXcgZi5Db2xvcigwLjIsIDAuMiwgMC4yLCAxKSkpLCBuZXcgZi5NZXNoQ3ViZSgpLCAwLCBmLkJPRFlfVFlQRS5TVEFUSUMpO1xyXG4gICAgICAgIGJvZGllc1swXS5tdHhMb2NhbC5zY2FsZShuZXcgZi5WZWN0b3IzKDE0LCAwLjMsIDE0KSk7IC8vU2NhbGUgdGhlIGJvZHkgd2l0aCBpdCdzIHN0YW5kYXJkIENvbXBvbmVudFRyYW5zZm9ybVxyXG4gICAgICAgIGJvZGllc1swXS5tdHhMb2NhbC5yb3RhdGVYKDQsIHRydWUpOyAvL0dpdmUgaXQgYSBzbGlnaHQgcm90YXRpb24gc28gdGhlIHBoeXNpY2FsIG9iamVjdHMgYXJlIHNsaWRpbmcsIGFsd2F5cyBmcm9tIGxlZnQgd2hlbiBpdCdzIGFmdGVyIGEgc2NhbGluZ1xyXG4gICAgICAgIGhpZXJhcmNoeS5hcHBlbmRDaGlsZChib2RpZXNbMF0pOyAvL0FkZCB0aGUgbm9kZSB0byB0aGUgc2NlbmUgYnkgYWRkaW5nIGl0IHRvIHRoZSBzY2VuZS1yb290XHJcblxyXG4gICAgICAgIC8vU3RlcCAxIC0gQ3JlYXRpbmcgYSB0aGUgcGxheWVyIGN1YmUgLSB0byBpbnRlcmFjdCB0byB0cmlnZ2VyLCBDT0xMSURFUlMgYW5kIFRSSUdHRVJTIFxyXG4gICAgICAgIGJvZGllc1sxXSA9IGNyZWF0ZUNvbXBsZXRlTm9kZShcIlBsYXllclwiLCBwbGF5ZXJEZWZhdWx0TWF0LCBuZXcgZi5NZXNoQ3ViZSgpLCAxLCBmLkJPRFlfVFlQRS5EWU5BTUlDKTtcclxuICAgICAgICBwbGF5ZXJCb2R5ID0gYm9kaWVzWzFdOyAvL1JlZmVyZW5jZSB0aGlzIG5vZGUgc3BlY2lmaWNhbGx5IHNvIHdlIGNhbiBhY2Nlc3MgaXQgZm9yIGlucHV0IG1vcmUgZWFzaWx5XHJcbiAgICAgICAgcGxheWVyQm9keS5tdHhMb2NhbC50cmFuc2xhdGUobmV3IGYuVmVjdG9yMygwLCAxLCAwKSk7XHJcbiAgICAgICAgaGllcmFyY2h5LmFwcGVuZENoaWxkKGJvZGllc1sxXSk7XHJcbiAgICAgICAgcGxheWVyQm9keS5nZXRDb21wb25lbnQoZi5Db21wb25lbnRSaWdpZGJvZHkpLmVmZmVjdFJvdGF0aW9uID0gbmV3IGYuVmVjdG9yMygwLCAwLCAwKTsgLy9tYWtlIHJvdGF0aW9uIGZpeGVkIHRoZSBwbGF5ZXIgZG9lcyBub3Qgcm90YXRlXHJcbiAgICAgICAgcGxheWVyQm9keS5nZXRDb21wb25lbnQoZi5Db21wb25lbnRSaWdpZGJvZHkpLmZyaWN0aW9uID0gMTtcclxuXHJcbiAgICAgICAgLy9TdGVwIDIgLSBDcmVhdGUgYm9kaWVzIC0gb25lIHVzZWQgYXMgYSBidXR0b24gd2hlbiBpdCBjb2xsaWRlcyBpdCB3aWxsIGFuIGFjdGlvbiB3aWxsIGhhcHBlbiAtIG9uZSBhcyBhIHRyaWdnZXIsIHdoZW4gaXQncyBvdmVybGFwcGluZyBpdCB3aWxsIHRyaWdnZXIgYW4gYWN0aW9uXHJcbiAgICAgICAgLy9UaGUgQ29sbGlzaW9uIEV2ZW50IGlzIGhhcHBlbmluZyBvbiBhIGNvbGxpc2lvbiBzbyBhIG5vcm1hbCBib2R5IGNhbiByZWNlaXZlIGl0XHJcbiAgICAgICAgLy9BIHVzZSBjYXNlIGZvciBhIGNvbGxpc2lvbiBldmVudCBpcyBmb3IgZXhhbXBsZSB3aGVuIHRoZSBwbGF5ZXIgaXMgaGl0dGluZyB0aGUgZ3JvdW5kIHRvIHBsYXkgYSBzb3VuZFxyXG4gICAgICAgIGJvZGllc1syXSA9IGNyZWF0ZUNvbXBsZXRlTm9kZShcIkNvbGxpZGVyX0J1dHRvblwiLCBuZXcgZi5NYXRlcmlhbChcIkNvbGxpZGVyX0J1dHRvblwiLCBmLlNoYWRlckZsYXQsIG5ldyBmLkNvYXRSZW1pc3NpdmUobmV3IGYuQ29sb3IoMC4zLCAwLjMsIDAuNCwgMSkpKSwgbmV3IGYuTWVzaEN1YmUoKSwgMSwgZi5CT0RZX1RZUEUuU1RBVElDKTtcclxuICAgICAgICBib2RpZXNbMl0ubXR4TG9jYWwudHJhbnNsYXRlKG5ldyBmLlZlY3RvcjMoLTMsIDEsIDApKTtcclxuICAgICAgICBoaWVyYXJjaHkuYXBwZW5kQ2hpbGQoYm9kaWVzWzJdKTtcclxuXHJcbiAgICAgICAgLy9UaGUgVHJpZ2dlciBFdmVudCBpcyBoYXBwZW5pbmcgd2hlbiBib2RpZXMgb3ZlcmxhcCwgc28gd2UgbmVlZCBhIHNwZWNpYWwgYm9keSB0aGF0IGRvZXMgbm90IGNvbGxpZGUgYnV0IG92ZXJsYXBcclxuICAgICAgICAvL1NvIGl0IG11c3QgYmUgZmxhZ2dlZCBhcyB0cmlnZ2VyLCBhbmQgbm9ybWFsbHkgaW4gZ2FtZXMgaXQncyBpbnZpc2JsZSwgc28gaXQgaGFzIG5vIG1lc2ggY29tcG9uZW50IG9yIGlzIGZ1bGx5IHRyYW5zcGFyZW50LlxyXG4gICAgICAgIC8vQSB1c2UgY2FzZSBpcyBzb21ldGhpbmcgbGlrZSBzcGF3bmluZyBlbmVtaWVzIHdoZW4gYSBwbGF5ZXIgZW50ZXJzIGEgcm9vbS5cclxuICAgICAgICBib2RpZXNbM10gPSBjcmVhdGVDb21wbGV0ZU5vZGUoXCJUcmlnZ2VyX0J1dHRvblwiLCBuZXcgZi5NYXRlcmlhbChcIlRyaWdnZXJfQnV0dG9uXCIsIGYuU2hhZGVyRmxhdCwgbmV3IGYuQ29hdFJlbWlzc2l2ZShuZXcgZi5Db2xvcigwLjUsIDAuMywgMC4yLCAwLjMpKSksIG5ldyBmLk1lc2hDdWJlKCksIDEsIGYuQk9EWV9UWVBFLlNUQVRJQywgZi5DT0xMSVNJT05fR1JPVVAuREVGQVVMVCk7XHJcbiAgICAgICAgYm9kaWVzWzNdLm10eExvY2FsLnRyYW5zbGF0ZShuZXcgZi5WZWN0b3IzKDMsIDEsIDApKTtcclxuICAgICAgICBib2RpZXNbM10uZ2V0Q29tcG9uZW50KGYuQ29tcG9uZW50UmlnaWRib2R5KS5pc1RyaWdnZXIgPSB0cnVlO1xyXG4gICAgICAgIGhpZXJhcmNoeS5hcHBlbmRDaGlsZChib2RpZXNbM10pO1xyXG5cclxuICAgICAgICAvL1RyaWdnZXIgd2hlbiBwbGF5ZXIgaXMgZmFsbGluZyBvZiB0aGUgcGxhbmVcclxuICAgICAgICBib2RpZXNbNF0gPSBjcmVhdGVDb21wbGV0ZU5vZGUoXCJUcmlnZ2VyX1Jlc2V0XCIsIG5ldyBmLk1hdGVyaWFsKFwiVHJpZ2dlcl9SZXNldFwiLCBmLlNoYWRlckZsYXQsIG5ldyBmLkNvYXRSZW1pc3NpdmUobmV3IGYuQ29sb3IoMC41LCAwLjMsIDAuMiwgMC4zKSkpLCBuZXcgZi5NZXNoQ3ViZSgpLCAxLCBmLkJPRFlfVFlQRS5TVEFUSUMsIGYuQ09MTElTSU9OX0dST1VQLkRFRkFVTFQpO1xyXG4gICAgICAgIGJvZGllc1s0XS5nZXRDb21wb25lbnQoZi5Db21wb25lbnRSaWdpZGJvZHkpLmlzVHJpZ2dlciA9IHRydWU7XHJcbiAgICAgICAgYm9kaWVzWzRdLnJlbW92ZUNvbXBvbmVudChib2RpZXNbNF0uZ2V0Q29tcG9uZW50KGYuQ29tcG9uZW50TWVzaCkpOyAvL3JlbW92aW5nIHRoZSBtZXNoIHRvIGhhdmUgaW52aXNpYmxlIHRyaWdnZXIgLSBzdGFuZGFyZCBwcmFjdGljZVxyXG4gICAgICAgIGJvZGllc1s0XS5tdHhMb2NhbC50cmFuc2xhdGUobmV3IGYuVmVjdG9yMygwLCAtNCwgMCkpO1xyXG4gICAgICAgIGJvZGllc1s0XS5tdHhMb2NhbC5zY2FsZShuZXcgZi5WZWN0b3IzKDMwLCAxLCAzMCkpOyAvL01ha2UgaXQgYmlnIGVub3VnaCBzbyB0aGUgcGxheWVyIHNob3VsZCBoaXQgaXRcclxuICAgICAgICBoaWVyYXJjaHkuYXBwZW5kQ2hpbGQoYm9kaWVzWzRdKTtcclxuXHJcbiAgICAgICAgLy9TdGVwIDMgLSBBZnRlciBjcmVhdGluZyBvdXIgUGh5c2ljIEV2ZW50IEJvZGllcywgd2UgdGVsbCB0aGVtIHRvIGxpc3RlbiB0byB0aGUgc3BlY2lmaWMgZXZlbnQgaGFwcGVuaW5nXHJcbiAgICAgICAgLy9UaGVzZSBldmVudHMgYXJlIGhhcHBlbmluZyBvbiB0aGUgcGh5c2ljIGNvbXBvbmVudCBub3Qgb24gdGhlIG5vZGUuIFNvIGJlIHN1cmUgdG8gYWRkIHRoZW0gdG8gdGhlIGNvbXBvbmVudCBub3QgdG8gdGhlIG5vZGVcclxuICAgICAgICAvL0EgYm9keSBjYW4gcmVjZWl2ZSBhIGVudGVyL2V4aXQgZXZlbnQsIGFuZCBpdCdzIG9ubHkgaGFwcGVuaW5nIG9uY2UuIElmIGEgYm9keSBpcyBzdGF5aW5nIG9uIGEgY29sbGlzaW9uIG9yIGluIGEgdHJpZ2dlciBpdCBuZWVkcyB0byBiZSBoYW5kbGVkIG1hbnVhbGx5XHJcbiAgICAgICAgYm9kaWVzWzJdLmdldENvbXBvbmVudChmLkNvbXBvbmVudFJpZ2lkYm9keSkuYWRkRXZlbnRMaXN0ZW5lcihmLkVWRU5UX1BIWVNJQ1MuQ09MTElTSU9OX0VOVEVSLCBobmRDb2xsaXNpb25FdmVudEVudGVyKTtcclxuICAgICAgICBib2RpZXNbMl0uZ2V0Q29tcG9uZW50KGYuQ29tcG9uZW50UmlnaWRib2R5KS5hZGRFdmVudExpc3RlbmVyKGYuRVZFTlRfUEhZU0lDUy5DT0xMSVNJT05fRVhJVCwgaG5kQ29sbGlzaW9uRXZlbnRFeGl0KTtcclxuICAgICAgICAvKkhpbnQ6IFRoZSBDb2xsaXNpb24gRXZlbnQgaXMgb25seSBoYXBwZW5pbmcgaWYgdGhlIG9iamVjdCBpcyBoaXR0aW5nIGl0IHBoeXNpY2FsbHksIFxyXG4gICAgICAgICAgU28gS0lORU1BVElDIHZzLiBTVEFUSUMgZG9lcyBub3QgcmVjZWl2ZSBhIGNvbGxpc2lvbiBFdmVudC4gT25seSBEWU5BTUlDIHZzLiBEWU5BTUlDL1NUQVRJQy9LSU5FTUFUSUMsIG5laXRoZXIgZG8gdHdvIEtpbmVtYXRpYyBoaXQgZWFjaCBvdGhlciBub3IgZG8gS2luZW1hdGljL1N0YXRpYy5cclxuICAgICAgICAgIElmIHlvdSByZWFsbHkgbmVlZCBhIGtpbmVtYXRpYyBoaXR0aW5nIGEgc3RhdGljIG9iamVjdCBhbmQgc3RpbGwgaGF2ZSBhIGFjdGlvbiwgdXNlIHRyaWdnZXIsIG9yIG1ha2UgdGhlIG9iamVjdCBub3Qgc3RhdGljIGJ1dCBkeW5hbWljIGJ1dCB1bm1vdmluZyBieSBoYXZpbmcgYSByaWRpY3Vsb3VzbHkgaGlnaCB3ZWlnaHQuXHJcbiAgICAgICAgICBUaGF0cyB3aHkgd2UgdXNlIGEgZHluYW1pYyBwbGF5ZXIgY3ViZSBpbnN0ZWFkIG9mIGEga2luZW1hdGljIGxpa2Ugd2UgZGlkIGluIExlc3NvbiAxLlxyXG4gICAgICAgICovXHJcblxyXG4gICAgICAgIC8vU2FtZSBhcyBmb3IgY29sbGlzaW9uIGEgdHJpZ2dlciBpcyBhbHNvIGxpc3RlbmluZyBvbiBhIGV2ZW50IHR5cGUgaW4gZm9ybSBvZiBmLkVWRU5UX1BIWVNJQ1MgYW5kIGEgZnVuY3Rpb24gdGhhdCB3aWxsIGJlIGNhbGxlZFxyXG4gICAgICAgIGJvZGllc1szXS5nZXRDb21wb25lbnQoZi5Db21wb25lbnRSaWdpZGJvZHkpLmFkZEV2ZW50TGlzdGVuZXIoZi5FVkVOVF9QSFlTSUNTLlRSSUdHRVJfRU5URVIsIGhuZFRyaWdnZXJFdmVudEVudGVyKTtcclxuICAgICAgICBib2RpZXNbM10uZ2V0Q29tcG9uZW50KGYuQ29tcG9uZW50UmlnaWRib2R5KS5hZGRFdmVudExpc3RlbmVyKGYuRVZFTlRfUEhZU0lDUy5UUklHR0VSX0VYSVQsIGhuZFRyaWdnZXJFdmVudEV4aXQpO1xyXG5cclxuICAgICAgICAvL1NldHRpbmcgdXAgb3VyIHJlc2V0XHJcbiAgICAgICAgYm9kaWVzWzRdLmdldENvbXBvbmVudChmLkNvbXBvbmVudFJpZ2lkYm9keSkuYWRkRXZlbnRMaXN0ZW5lcihmLkVWRU5UX1BIWVNJQ1MuVFJJR0dFUl9FTlRFUiwgaG5kUmVzZXRUcmlnZ2VyKTtcclxuICAgICAgICAvLyNlbmRyZWdpb24gUEhZU0lDU1xyXG5cclxuXHJcbiAgICAgICAgLy9TdGFuZGFyZCBGdWRnZSBTY2VuZSBJbml0aWFsaXphdGlvbiAtIENyZWF0aW5nIGEgZGlyZWN0aW9uYWwgbGlnaHQsIGEgY2FtZXJhIGFuZCBpbml0aWFsaXplIHRoZSB2aWV3cG9ydFxyXG4gICAgICAgIGxldCBjbXBMaWdodDogZi5Db21wb25lbnRMaWdodCA9IG5ldyBmLkNvbXBvbmVudExpZ2h0KG5ldyBmLkxpZ2h0RGlyZWN0aW9uYWwoZi5Db2xvci5DU1MoXCJXSElURVwiKSkpO1xyXG4gICAgICAgIGNtcExpZ2h0Lm10eFBpdm90Lmxvb2tBdChuZXcgZi5WZWN0b3IzKDAuNSwgLTEsIC0wLjgpKTsgLy9TZXQgbGlnaHQgZGlyZWN0aW9uXHJcbiAgICAgICAgaGllcmFyY2h5LmFkZENvbXBvbmVudChjbXBMaWdodCk7XHJcblxyXG4gICAgICAgIGxldCBjbXBDYW1lcmE6IGYuQ29tcG9uZW50Q2FtZXJhID0gbmV3IGYuQ29tcG9uZW50Q2FtZXJhKCk7XHJcbiAgICAgICAgY21wQ2FtZXJhLmNsckJhY2tncm91bmQgPSBmLkNvbG9yLkNTUyhcIkdSRVlcIik7XHJcbiAgICAgICAgY21wQ2FtZXJhLm10eFBpdm90LnRyYW5zbGF0ZShuZXcgZi5WZWN0b3IzKDIsIDMuNSwgMTcpKTsgLy9Nb3ZlIGNhbWVyYSBmYXIgYmFjayBzbyB0aGUgd2hvbGUgc2NlbmUgaXMgdmlzaWJsZVxyXG4gICAgICAgIGNtcENhbWVyYS5tdHhQaXZvdC5sb29rQXQoZi5WZWN0b3IzLlpFUk8oKSk7IC8vU2V0IHRoZSBjYW1lcmEgbWF0cml4IHNvIHRoYXQgaXQgbG9va3MgYXQgdGhlIGNlbnRlciBvZiB0aGUgc2NlbmVcclxuXHJcbiAgICAgICAgdmlld1BvcnQgPSBuZXcgZi5WaWV3cG9ydCgpOyAvL0NyZWF0aW5nIGEgdmlld3BvcnQgdGhhdCBpcyByZW5kZXJlZCBvbnRvIHRoZSBodG1sIGNhbnZhcyBlbGVtZW50XHJcbiAgICAgICAgdmlld1BvcnQuaW5pdGlhbGl6ZShcIlZpZXdwb3J0XCIsIGhpZXJhcmNoeSwgY21wQ2FtZXJhLCBhcHApOyAvL2luaXRpYWxpemUgdGhlIHZpZXdwb3J0IHdpdGggdGhlIHJvb3Qgbm9kZSwgY2FtZXJhIGFuZCBjYW52YXNcclxuXHJcbiAgICAgICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcImtleXByZXNzXCIsIGhuZEtleSk7IC8vQWRkaW5nIGEgbGlzdGVuZXIgZm9yIGtleXByZXNzIGhhbmRsaW5nXHJcblxyXG4gICAgICAgIC8vUEhZU0lDUyAtIFN0YXJ0IHVzaW5nIHBoeXNpY3MgYnkgdGVsbGluZyB0aGUgcGh5c2ljcyB0aGUgc2NlbmUgcm9vdCBvYmplY3QuIFBoeXNpY3Mgd2lsbCByZWNhbGN1bGF0ZSBldmVyeSB0cmFuc2Zvcm0gYW5kIGluaXRpYWxpemVcclxuICAgICAgICBmLlBoeXNpY3MuYWRqdXN0VHJhbnNmb3JtcyhoaWVyYXJjaHkpO1xyXG5cclxuICAgICAgICAvL0ltcG9ydGFudCBzdGFydCB0aGUgZ2FtZSBsb29wIGFmdGVyIHN0YXJ0aW5nIHBoeXNpY3MsIHNvIHBoeXNpY3MgY2FuIHVzZSB0aGUgY3VycmVudCB0cmFuc2Zvcm0gYmVmb3JlIGl0J3MgZmlyc3QgaXRlcmF0aW9uXHJcbiAgICAgICAgZi5Mb29wLmFkZEV2ZW50TGlzdGVuZXIoZi5FVkVOVC5MT09QX0ZSQU1FLCB1cGRhdGUpOyAvL1RlbGwgdGhlIGdhbWUgbG9vcCB0byBjYWxsIHRoZSB1cGRhdGUgZnVuY3Rpb24gb24gZWFjaCBmcmFtZVxyXG4gICAgICAgIGYuTG9vcC5zdGFydCgpOyAvL1N0YXJkIHRoZSBnYW1lIGxvb3BcclxuICAgIH1cclxuXHJcbiAgICAvL0Z1bmN0aW9uIHRvIGFuaW1hdGUvdXBkYXRlIHRoZSBGdWRnZSBzY2VuZSwgY29tbW9ubHkga25vd24gYXMgZ2FtZWxvb3BcclxuICAgIGZ1bmN0aW9uIHVwZGF0ZSgpOiB2b2lkIHtcclxuICAgICAgICBmLlBoeXNpY3Muc2ltdWxhdGUoKTsgLy9QSFlTSUNTIC0gU2ltdWxhdGUgcGh5c2ljYWwgY2hhbmdlcyBlYWNoIGZyYW1lLCBwYXJhbWV0ZXIgdG8gc2V0IHRpbWUgYmV0d2VlbiBmcmFtZXNcclxuICAgICAgICB2aWV3UG9ydC5kcmF3KCk7IC8vIERyYXcgdGhlIGN1cnJlbnQgRnVkZ2UgU2NlbmUgdG8gdGhlIGNhbnZhc1xyXG4gICAgfVxyXG5cclxuICAgIC8vIEZ1bmN0aW9uIHRvIHF1aWNrbHkgY3JlYXRlIGEgbm9kZSB3aXRoIG11bHRpcGxlIG5lZWRlZCBGdWRnZUNvbXBvbmVudHMsIGluY2x1ZGluZyBhIHBoeXNpY3MgY29tcG9uZW50XHJcbiAgICBmdW5jdGlvbiBjcmVhdGVDb21wbGV0ZU5vZGUoX25hbWU6IHN0cmluZywgX21hdGVyaWFsOiBmLk1hdGVyaWFsLCBfbWVzaDogZi5NZXNoLCBfbWFzczogbnVtYmVyLCBfcGh5c2ljc1R5cGU6IGYuQk9EWV9UWVBFLCBfZ3JvdXA6IGYuQ09MTElTSU9OX0dST1VQID0gZi5DT0xMSVNJT05fR1JPVVAuREVGQVVMVCwgX2NvbFR5cGU6IGYuQ09MTElERVJfVFlQRSA9IGYuQ09MTElERVJfVFlQRS5DVUJFKTogZi5Ob2RlIHtcclxuICAgICAgICBsZXQgbm9kZTogZi5Ob2RlID0gbmV3IGYuTm9kZShfbmFtZSk7IC8vQ3JlYXRpbmcgdGhlIG5vZGVcclxuICAgICAgICBsZXQgY21wTWVzaDogZi5Db21wb25lbnRNZXNoID0gbmV3IGYuQ29tcG9uZW50TWVzaChfbWVzaCk7IC8vQ3JlYXRpbmcgYSBtZXNoIGZvciB0aGUgbm9kZVxyXG4gICAgICAgIGxldCBjbXBNYXRlcmlhbDogZi5Db21wb25lbnRNYXRlcmlhbCA9IG5ldyBmLkNvbXBvbmVudE1hdGVyaWFsKF9tYXRlcmlhbCk7IC8vQ3JlYXRpbmcgYSBtYXRlcmlhbCBmb3IgdGhlIG5vZGVcclxuICAgICAgICBsZXQgY21wVHJhbnNmb3JtOiBmLkNvbXBvbmVudFRyYW5zZm9ybSA9IG5ldyBmLkNvbXBvbmVudFRyYW5zZm9ybSgpOyAgLy9UcmFuc2Zvcm0gaG9sZGluZyBwb3NpdGlvbi9yb3RhdGlvbi9zY2FsaW5nIG9mIHRoZSBub2RlXHJcblxyXG4gICAgICAgIGxldCBjbXBSaWdpZGJvZHk6IGYuQ29tcG9uZW50UmlnaWRib2R5ID0gbmV3IGYuQ29tcG9uZW50UmlnaWRib2R5KF9tYXNzLCBfcGh5c2ljc1R5cGUsIF9jb2xUeXBlLCBfZ3JvdXApOyAvLzwtLSBhZGRpbmcgdGhlIGdyb3VwIHdoZW4gdXNpbmcgdHJpZ2dlcnMsIHNpbmNlIGEgdHJpZ2dlciBzaG91bGQgbm90IGNvbGxpZGUgd2l0aCBhbnl0aGluZyBlbHNlXHJcblxyXG4gICAgICAgIG5vZGUuYWRkQ29tcG9uZW50KGNtcE1lc2gpO1xyXG4gICAgICAgIG5vZGUuYWRkQ29tcG9uZW50KGNtcE1hdGVyaWFsKTtcclxuICAgICAgICBub2RlLmFkZENvbXBvbmVudChjbXBUcmFuc2Zvcm0pO1xyXG4gICAgICAgIG5vZGUuYWRkQ29tcG9uZW50KGNtcFJpZ2lkYm9keSk7IC8vIDwtLSBiZXN0IHByYWN0aWNlIHRvIGFkZCBwaHlzaWNzIGNvbXBvbmVudCBsYXN0XHJcbiAgICAgICAgcmV0dXJuIG5vZGU7IC8vcmV0dXJuIHRoZSBmdWxsIGNyZWF0ZWQgbm9kZVxyXG4gICAgfVxyXG5cclxuICAgIC8vIEV2ZW50IEZ1bmN0aW9uIGhhbmRsaW5nIGtleWJvYXJkIGlucHV0IC0gc2ltaWxhciB0byBMZXNzb24gMSBidXQgYSBsaXR0bGUgZGlmZmVyZW50LCBzaW5jZSBpdCdzIHB1c2hpbmcgdGhlIHBsYXllciBieSBmb3JjZVxyXG4gICAgZnVuY3Rpb24gaG5kS2V5KF9ldmVudDogS2V5Ym9hcmRFdmVudCk6IHZvaWQge1xyXG4gICAgICAgIGxldCBob3Jpem9udGFsOiBudW1iZXIgPSAwOyAgLy9sZWZ0L3JpZ2h0XHJcbiAgICAgICAgbGV0IHZlcnRpY2FsOiBudW1iZXIgPSAwOyAvL2Zyb250L2JhY2tcclxuICAgICAgICBsZXQgaGVpZ2h0OiBudW1iZXIgPSAwOyAvL3Vwd2FyZHMvZG93bndhcmRzXHJcblxyXG4gICAgICAgIC8vQ2hlY2sga2V5Ym9hcmQgaW5wdXQgZnJvbSBFdmVudFxyXG4gICAgICAgIGlmIChfZXZlbnQuY29kZSA9PSBmLktFWUJPQVJEX0NPREUuQSkge1xyXG4gICAgICAgICAgICBob3Jpem9udGFsIC09IGZvcmNlO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoX2V2ZW50LmNvZGUgPT0gZi5LRVlCT0FSRF9DT0RFLkQpIHtcclxuICAgICAgICAgICAgaG9yaXpvbnRhbCArPSBmb3JjZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKF9ldmVudC5jb2RlID09IGYuS0VZQk9BUkRfQ09ERS5XKSB7XHJcbiAgICAgICAgICAgIHZlcnRpY2FsIC09IGZvcmNlO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoX2V2ZW50LmNvZGUgPT0gZi5LRVlCT0FSRF9DT0RFLlMpIHtcclxuICAgICAgICAgICAgdmVydGljYWwgKz0gZm9yY2U7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChfZXZlbnQuY29kZSA9PSBmLktFWUJPQVJEX0NPREUuU1BBQ0UpIHsgLy9KdW1wXHJcbiAgICAgICAgICAgIGhlaWdodCArPSBmb3JjZSAqIDEwO1xyXG4gICAgICAgIH1cclxuICAgICAgICBwbGF5ZXJCb2R5LmdldENvbXBvbmVudChmLkNvbXBvbmVudFJpZ2lkYm9keSkuYXBwbHlMaW5lYXJJbXB1bHNlKG5ldyBmLlZlY3RvcjMoaG9yaXpvbnRhbCwgaGVpZ2h0LCB2ZXJ0aWNhbCkpO1xyXG4gICAgfVxyXG5cclxuXHJcbiAgICAvL1N0ZXAgNCAtIFJlY2VpdmluZyBhbmQgaGFuZGxpbmcgdGhlIGV2ZW50c1xyXG4gICAgLy9FdmVudCBmdW5jdGlvbiBoYW5kbGluZyBjb2xsaXNpb24gLSBBIEVWRU5UX1BIWVNJQ1MgaXMgcmVjZWl2aW5nIGEgZi5FdmVudFBoeXNpY3Mgd2l0aCBpbmZvcyBhYm91dCB0aGUgZXZlbnRcclxuICAgIGZ1bmN0aW9uIGhuZENvbGxpc2lvbkV2ZW50RW50ZXIoX2V2ZW50OiBmLkV2ZW50UGh5c2ljcyk6IHZvaWQge1xyXG4gICAgICAgIC8vX2V2ZW50LiBrZWVwcyBhIHBsZXRob3JhIG9mIGluZm9ybWF0aW9ucyBhYm91dCB0aGUgZXZlbnQgdGhlIG1vc3QgaW50ZXJlc3RpbmcgYXJlIHRoaW5ncyBsaWtlIFxyXG4gICAgICAgIC8qIFxyXG4gICAgICAgICAgX2V2ZW50LmNtcFJpZ2lkYm9keSAtPiB0byBpZGVudGlmeSB0aGUgYm9keSBpbnZvbHZlZCBpbiB0aGUgZXZlbnQsIHdpdGggbm9kZS5uYW1lIHlvdSBnZXQgdGhlIGFjdHVhbCBuYW1lIG9mIHRoZSBub2RlIGludm9sdmVkIFxyXG4gICAgICAgICAgX2V2ZW50Lm5vcm1hbEltcHVsc2UgLT4gaW50ZW5zaXR5IG9mIHRoZSBjb2xsaXNpb24gZ29vZCB0byBwbGF5IGEgc291bmQgdGhhdCBpcyBvbmx5IGFzIGhlYXZ5IGFzIHRoZSBjb2xsaXNpb25cclxuICAgICAgICAgIF9ldmVudC5jb2xsaXNpb25Qb2ludCAtPiB0aGUgcG9pbnQgaW4gdGhlIHdvcmxkIHdoZXJlIHRoZSBjb2xsaXNpb24gaXMgaGFwcGVuaW5nIHRvIG1heWJlIHNwYXduIHRoaW5ncyBsaWtlIHBhcnRpY2xlc1xyXG4gICAgICAgICAgX2V2ZW50LmNvbGxpc2lvbk5vcm1hbCAtPiB0aGUgZGlyZWN0aW9uIHRoZSBjb2xsaXNpb24gaXMgaGFwcGVuaW5nIG9mdGVuIHVzZWQgdG8gY29ycmVjdGx5IHJvdGF0ZSBzcGF3bmVkIHRoaW5ncyBvbiB0aGUgY29sbGlkaW5nIHN1cmZhY2VcclxuICAgICAgICAqL1xyXG4gICAgICAgIGlmIChfZXZlbnQuY21wUmlnaWRib2R5Lm5vZGUubmFtZSA9PSBcIlBsYXllclwiKSB7IC8vT3VyIEV2ZW50IGlzIGhhcHBlbmluZyB3aXRoIHRoZSBib2R5IE5PREUgY2FsbGVkIFwiUGxheWVyXCJcclxuICAgICAgICAgICAgZi5EZWJ1Zy5sb2coXCJQbGF5ZXIgaGl0IG1lIC0gQ29sbGlkZXJcIik7XHJcbiAgICAgICAgICAgIC8vV2UgbGV0IHRoaXMgY29sbGlkZXIgYWN0IGxpa2UgYSBidW1wZXIgdGhyb3VnaCB0aGlzIGV2ZW50LiBXZSB0YWtlIHRoZSBldmVudCBub3JtYWwgYW5kIHNob290IHRoZSBwbGF5ZXIgYXdheSBmcm9tIHRoZSBidW1wZXIgb24gdGhlIGNvbnRhY3QgcG9pbnQuXHJcbiAgICAgICAgICAgIHBsYXllckJvZHkuZ2V0Q29tcG9uZW50KGYuQ29tcG9uZW50UmlnaWRib2R5KS5hcHBseUZvcmNlQXRQb2ludChuZXcgZi5WZWN0b3IzKF9ldmVudC5jb2xsaXNpb25Ob3JtYWwueCAqIDUwMCwgX2V2ZW50LmNvbGxpc2lvbk5vcm1hbC55ICogNTAwLCBfZXZlbnQuY29sbGlzaW9uTm9ybWFsLnogKiA1MDApLCBfZXZlbnQuY29sbGlzaW9uUG9pbnQpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBmdW5jdGlvbiBobmRDb2xsaXNpb25FdmVudEV4aXQoX2V2ZW50OiBmLkV2ZW50UGh5c2ljcyk6IHZvaWQge1xyXG4gICAgICAgIGlmIChfZXZlbnQuY21wUmlnaWRib2R5Lm5vZGUubmFtZSA9PSBcIlBsYXllclwiKSB7XHJcbiAgICAgICAgICAgIGYuRGVidWcubG9nKFwiUGxheWVyIGxlZnQgbWUgLSBDb2xsaWRlclwiKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgLy9FdmVudCBmdW5jdGlvbiBoYW5kbGluZyB0cmlnZ2VyaW5nXHJcbiAgICBmdW5jdGlvbiBobmRUcmlnZ2VyRXZlbnRFbnRlcihfZXZlbnQ6IGYuRXZlbnRQaHlzaWNzKTogdm9pZCB7XHJcbiAgICAgICAgaWYgKF9ldmVudC5jbXBSaWdpZGJvZHkubm9kZS5uYW1lID09IFwiUGxheWVyXCIpIHtcclxuICAgICAgICAgICAgZi5EZWJ1Zy5sb2coXCJQbGF5ZXIgZW50ZXJlZCBtZSAtIFRyaWdnZXJcIik7XHJcbiAgICAgICAgICAgIHBsYXllckJvZHkuZ2V0Q29tcG9uZW50KGYuQ29tcG9uZW50TWF0ZXJpYWwpLm1hdGVyaWFsID0gcGxheWVyVHJpZ2dlcmVkTWF0O1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBmdW5jdGlvbiBobmRUcmlnZ2VyRXZlbnRFeGl0KF9ldmVudDogZi5FdmVudFBoeXNpY3MpOiB2b2lkIHtcclxuICAgICAgICBpZiAoX2V2ZW50LmNtcFJpZ2lkYm9keS5ub2RlLm5hbWUgPT0gXCJQbGF5ZXJcIikge1xyXG4gICAgICAgICAgICBmLkRlYnVnLmxvZyhcIlBsYXllciBsZWZ0IG1lIC0gVHJpZ2dlclwiKTtcclxuICAgICAgICAgICAgcGxheWVyQm9keS5nZXRDb21wb25lbnQoZi5Db21wb25lbnRNYXRlcmlhbCkubWF0ZXJpYWwgPSBwbGF5ZXJEZWZhdWx0TWF0O1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICAvL1NpbmNlIHRoZSBwbGF5ZXIgY291bGQgZmFsbCBvZiB3ZSB3aWxsIHJlc2V0IGhpbSBiYWNrIHdpdGggYSB0cmlnZ2VyIHdoZW4gaGUgZmFsbHMgZG93biBmcm9tIHRoZSBwbGFuZVxyXG4gICAgZnVuY3Rpb24gaG5kUmVzZXRUcmlnZ2VyKF9ldmVudDogZi5FdmVudFBoeXNpY3MpOiB2b2lkIHtcclxuICAgICAgICBpZiAoX2V2ZW50LmNtcFJpZ2lkYm9keS5ub2RlLm5hbWUgPT0gXCJQbGF5ZXJcIikge1xyXG4gICAgICAgICAgICBwbGF5ZXJCb2R5LmdldENvbXBvbmVudChmLkNvbXBvbmVudFJpZ2lkYm9keSkuc2V0UG9zaXRpb24obmV3IGYuVmVjdG9yMygwLCAzLCAwKSk7IC8vU2luY2UgaXQncyBhIHBoeXNpY3MgYm9keSB3ZSBoYXZlIHRvIHNldCBwb3NpdGlvbiB0aHJvdWdoIHBoeXNpY3Mgbm90IHRyYW5zZm9ybVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbn0iXX0=