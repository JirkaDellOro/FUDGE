(function(t){"use strict";function $extend(t,a){function Inherit(){}Inherit.prototype=t;var i=new Inherit;for(var r in a)i[r]=a[r];if(a.toString!==Object.prototype.toString)i.toString=a.toString;return i}var a=function(t){this._type=t;this._numProxies=0;this._proxyList=null;this._proxyListLast=null;this._proxyPairList=null;this._incremental=false;this._testCount=0;this._proxyPairPool=null;this._idCount=0;this._convexSweep=new i;this._aabb=new r;this.identity=new j;this.zero=new Is;this.rayCastHit=new z};a.prototype={createProxy:function(t,a){return null},destroyProxy:function(t){},moveProxy:function(t,a,i){},isOverlapping:function(t,a){if(t._aabbMinX<a._aabbMaxX&&t._aabbMaxX>a._aabbMinX&&t._aabbMinY<a._aabbMaxY&&t._aabbMaxY>a._aabbMinY&&t._aabbMinZ<a._aabbMaxZ){return t._aabbMaxZ>a._aabbMinZ}else{return false}},collectPairs:function(){},getProxyPairList:function(){return this._proxyPairList},isIncremental:function(){return this._incremental},getTestCount:function(){return this._testCount},rayCast:function(t,a,i){},convexCast:function(t,a,i,r){},aabbTest:function(t,a){}};var o=function(t){this._type=t;this._volume=0};o.prototype={_updateMass:function(){},_computeAabb:function(t,a){},_rayCastLocal:function(t,a,i,r,o,s,n){return false},getType:function(){return this._type},getVolume:function(){return this._volume},rayCast:function(t,a,i,r){var o;var s;var n;var e;var _;var v;var h;var l;var c=t;s=c.x;n=c.y;e=c.z;var p=a;v=p.x;h=p.y;l=p.z;s-=i._positionX;n-=i._positionY;e-=i._positionZ;v-=i._positionX;h-=i._positionY;l-=i._positionZ;var f;var m;var b;f=i._rotation00*s+i._rotation10*n+i._rotation20*e;m=i._rotation01*s+i._rotation11*n+i._rotation21*e;b=i._rotation02*s+i._rotation12*n+i._rotation22*e;s=f;n=m;e=b;var u;var x;var y;u=i._rotation00*v+i._rotation10*h+i._rotation20*l;x=i._rotation01*v+i._rotation11*h+i._rotation21*l;y=i._rotation02*v+i._rotation12*h+i._rotation22*l;v=u;h=x;l=y;if(this._rayCastLocal(s,n,e,v,h,l,r)){var g;var X;var z;var M;var Y;var Z;var d;var I;var w=r.position;X=w.x;z=w.y;M=w.z;var V=r.normal;Z=V.x;d=V.y;I=V.z;var L;var A;var k;L=i._rotation00*X+i._rotation01*z+i._rotation02*M;A=i._rotation10*X+i._rotation11*z+i._rotation12*M;k=i._rotation20*X+i._rotation21*z+i._rotation22*M;X=L;z=A;M=k;var B;var P;var T;B=i._rotation00*Z+i._rotation01*d+i._rotation02*I;P=i._rotation10*Z+i._rotation11*d+i._rotation12*I;T=i._rotation20*Z+i._rotation21*d+i._rotation22*I;Z=B;d=P;I=T;X+=i._positionX;z+=i._positionY;M+=i._positionZ;var S=r.position;S.x=X;S.y=z;S.z=M;var C=r.normal;C.x=Z;C.y=d;C.z=I;return true}return false}};var _=function(t){o.call(this,t);this._gjkMargin=ys.defaultGJKMargin;this._useGjkRayCast=false};_.__super__=o;_.prototype=$extend(o.prototype,{getGjkMergin:function(){return this._gjkMargin},setGjkMergin:function(t){if(t<0){t=0}this._gjkMargin=t},computeLocalSupportingVertex:function(t,a){},rayCast:function(t,a,i,r){if(this._useGjkRayCast){return N.instance.rayCast(this,i,t,a,r)}else{return o.prototype.rayCast.call(this,t,a,i,r)}}});var i=function(){_.call(this,-1)};i.__super__=_;i.prototype=$extend(_.prototype,{init:function(t,a,i){this.c=t;var r;var o;var s;var n;var e=i;o=e.x;s=e.y;n=e.z;var _;var v;var h;var l;var c;var p;var f;c=a._rotation00*o+a._rotation10*s+a._rotation20*n;p=a._rotation01*o+a._rotation11*s+a._rotation21*n;f=a._rotation02*o+a._rotation12*s+a._rotation22*n;v=c;h=p;l=f;this.localTranslation=new Is;var m=this.localTranslation;m.x=v;m.y=h;m.z=l;this._gjkMargin=t._gjkMargin},computeLocalSupportingVertex:function(t,a){this.c.computeLocalSupportingVertex(t,a);var i=this.localTranslation;if(t.x*i.x+t.y*i.y+t.z*i.z>0){var r=this.localTranslation;var o=a.x+r.x;var s=a.y+r.y;var n=a.z+r.z;a.x=o;a.y=s;a.z=n}}});var r=function(){_.call(this,-1);this.min=new Is;this.max=new Is};r.__super__=_;r.prototype=$extend(_.prototype,{computeLocalSupportingVertex:function(t,a){a.x=t.x>0?this.max.x:this.min.x;a.y=t.y>0?this.max.y:this.min.y;a.z=t.z>0?this.max.z:this.min.z}});var s=function(){};s.prototype={process:function(t){}};var n=function(){};var e=function(t,a){this.userData=t;this._id=a;this._prev=null;this._next=null;this._aabbMinX=0;this._aabbMinY=0;this._aabbMinZ=0;this._aabbMaxX=0;this._aabbMaxY=0;this._aabbMaxZ=0};e.prototype={getId:function(){return this._id},getFatAabb:function(){var t=new m;t._minX=this._aabbMinX;t._minY=this._aabbMinY;t._minZ=this._aabbMinZ;t._maxX=this._aabbMaxX;t._maxY=this._aabbMaxY;t._maxZ=this._aabbMaxZ;return t},getFatAabbTo:function(t){t._minX=this._aabbMinX;t._minY=this._aabbMinY;t._minZ=this._aabbMinZ;t._maxX=this._aabbMaxX;t._maxY=this._aabbMaxY;t._maxZ=this._aabbMaxZ}};var v=function(){this._p1=null;this._p2=null};v.prototype={getProxy1:function(){return this._p1},getProxy2:function(){return this._p2},getNext:function(){return this._next}};var h=function(){a.call(this,1);this._incremental=false};h.__super__=a;h.prototype=$extend(a.prototype,{createProxy:function(t,a){var i=new e(t,this._idCount++);this._numProxies++;if(this._proxyList==null){this._proxyList=i;this._proxyListLast=i}else{this._proxyListLast._next=i;i._prev=this._proxyListLast;this._proxyListLast=i}i._aabbMinX=a._minX;i._aabbMinY=a._minY;i._aabbMinZ=a._minZ;i._aabbMaxX=a._maxX;i._aabbMaxY=a._maxY;i._aabbMaxZ=a._maxZ;return i},destroyProxy:function(t){this._numProxies--;var a=t._prev;var i=t._next;if(a!=null){a._next=i}if(i!=null){i._prev=a}if(t==this._proxyList){this._proxyList=this._proxyList._next}if(t==this._proxyListLast){this._proxyListLast=this._proxyListLast._prev}t._next=null;t._prev=null;t.userData=null},moveProxy:function(t,a,i){t._aabbMinX=a._minX;t._aabbMinY=a._minY;t._aabbMinZ=a._minZ;t._aabbMaxX=a._maxX;t._aabbMaxY=a._maxY;t._aabbMaxZ=a._maxZ},collectPairs:function(){var t=this._proxyPairList;if(t!=null){while(true){t._p1=null;t._p2=null;t=t._next;if(!(t!=null)){break}}this._proxyPairList._next=this._proxyPairPool;this._proxyPairPool=this._proxyPairList;this._proxyPairList=null}this._testCount=0;var a=this._proxyList;while(a!=null){var i=a._next;var r=a._next;while(r!=null){var o=r._next;this._testCount++;if(a._aabbMinX<r._aabbMaxX&&a._aabbMaxX>r._aabbMinX&&a._aabbMinY<r._aabbMaxY&&a._aabbMaxY>r._aabbMinY&&a._aabbMinZ<r._aabbMaxZ&&a._aabbMaxZ>r._aabbMinZ){var s=this._proxyPairPool;if(s!=null){this._proxyPairPool=s._next;s._next=null}else{s=new v}var n=s;if(this._proxyPairList==null){this._proxyPairList=n}else{n._next=this._proxyPairList;this._proxyPairList=n}n._p1=a;n._p2=r}r=o}a=i}},rayCast:function(t,a,i){var r;var o;var s;var n;var e;var _;var v;var h;var l;var c;var p;var f;var m=t;o=m.x;s=m.y;n=m.z;var b=a;_=b.x;v=b.y;h=b.z;c=_-o;p=v-s;f=h-n;var u;var x;var y;var g;var X;var z;var M;var Y;x=o<_?o:_;y=s<v?s:v;g=n<h?n:h;z=o>_?o:_;M=s>v?s:v;Y=n>h?n:h;var Z=this._proxyList;while(Z!=null){var d=Z._next;var I=o;var w=s;var V=n;var L=_;var A=v;var k=h;var B=I<L?I:L;var P=w<A?w:A;var T=V<k?V:k;var S=I>L?I:L;var C=w>A?w:A;var q=V>k?V:k;var R=Z._aabbMinX;var E=Z._aabbMinY;var j=Z._aabbMinZ;var N=Z._aabbMaxX;var D=Z._aabbMaxY;var F=Z._aabbMaxZ;var O;if(R>S||N<B||E>C||D<P||j>q||F<T){O=false}else{var W=L-I;var G=A-w;var H=k-V;var U=W<0?-W:W;var J=G<0?-G:G;var Q=H<0?-H:H;var $=(N-R)*.5;var K=(D-E)*.5;var tt=(F-j)*.5;var at=(N+R)*.5;var it=(D+E)*.5;var rt=(F+j)*.5;var ot=I-at;var st=w-it;var nt=V-rt;var et;var _t;var vt=st*H-nt*G;if(!((vt<0?-vt:vt)-(K*Q+tt*J)>0)){var ht=nt*W-ot*H;_t=(ht<0?-ht:ht)-(tt*U+$*Q)>0}else{_t=true}if(!_t){var lt=ot*G-st*W;et=(lt<0?-lt:lt)-($*J+K*U)>0}else{et=true}O=et?false:true}if(O){i.process(Z)}Z=d}},convexCast:function(t,a,i,r){var o=this._proxyList;while(o!=null){var s=o._next;var n=this._aabb.min;n.x=o._aabbMinX;n.y=o._aabbMinY;n.z=o._aabbMinZ;var e=this._aabb.max;e.x=o._aabbMaxX;e.y=o._aabbMaxY;e.z=o._aabbMaxZ;this._convexSweep.init(t,a,i);var _=N.instance;if(_.computeClosestPointsImpl(this._convexSweep,this._aabb,a,this.identity,null,false)==0&&_.distance<=0){r.process(o)}o=s}},aabbTest:function(t,a){var i=this._proxyList;while(i!=null){var r=i._next;if(t._minX<i._aabbMaxX&&t._maxX>i._aabbMinX&&t._minY<i._aabbMaxY&&t._maxY>i._aabbMinY&&t._minZ<i._aabbMaxZ&&t._maxZ>i._aabbMinZ){a.process(i)}i=r}}});var l=function(){a.call(this,2);this._incremental=true;this._tree=new f;var t=new Array(1024);this.movedProxies=t;this.numMovedProxies=0};l.__super__=a;l.prototype=$extend(a.prototype,{collide:function(t,a){this._testCount++;var i=t._height==0;var r=a._height==0;if(t==a){if(i){return}this.collide(t._children[0],a);this.collide(t._children[1],a);return}if(!(t._aabbMinX<a._aabbMaxX&&t._aabbMaxX>a._aabbMinX&&t._aabbMinY<a._aabbMaxY&&t._aabbMaxY>a._aabbMinY&&t._aabbMinZ<a._aabbMaxZ&&t._aabbMaxZ>a._aabbMinZ)){return}if(i&&r){var o=t._proxy;var s=a._proxy;var n=this._proxyPairPool;if(n!=null){this._proxyPairPool=n._next;n._next=null}else{n=new v}var e=n;if(this._proxyPairList==null){this._proxyPairList=e}else{e._next=this._proxyPairList;this._proxyPairList=e}e._p1=o;e._p2=s;return}if(r||t._height>a._height){this.collide(t._children[0],a);this.collide(t._children[1],a)}else{this.collide(a._children[0],t);this.collide(a._children[1],t)}},rayCastRecursive:function(t,a,i,r,o,s,n,e){var _;var v;var h;var l;var c;var p;var f;var m;v=a;h=i;l=r;p=o;f=s;m=n;var b=v;var u=h;var x=l;var y=p;var g=f;var X=m;var z=b<y?b:y;var M=u<g?u:g;var Y=x<X?x:X;var Z=b>y?b:y;var d=u>g?u:g;var I=x>X?x:X;var w=t._aabbMinX;var V=t._aabbMinY;var L=t._aabbMinZ;var A=t._aabbMaxX;var k=t._aabbMaxY;var B=t._aabbMaxZ;var P;if(w>Z||A<z||V>d||k<M||L>I||B<Y){P=false}else{var T=y-b;var S=g-u;var C=X-x;var q=T<0?-T:T;var R=S<0?-S:S;var E=C<0?-C:C;var j=(A-w)*.5;var N=(k-V)*.5;var D=(B-L)*.5;var F=(A+w)*.5;var O=(k+V)*.5;var W=(B+L)*.5;var G=b-F;var H=u-O;var U=x-W;var J;var Q;var $=H*C-U*S;if(!(($<0?-$:$)-(N*E+D*R)>0)){var K=U*T-G*C;Q=(K<0?-K:K)-(D*q+j*E)>0}else{Q=true}if(!Q){var tt=G*S-H*T;J=(tt<0?-tt:tt)-(j*R+N*q)>0}else{J=true}P=J?false:true}if(!P){return}if(t._height==0){e.process(t._proxy);return}this.rayCastRecursive(t._children[0],v,h,l,p,f,m,e);this.rayCastRecursive(t._children[1],v,h,l,p,f,m,e)},convexCastRecursive:function(t,a,i,r,o){var s=this._aabb.min;s.x=t._aabbMinX;s.y=t._aabbMinY;s.z=t._aabbMinZ;var n=this._aabb.max;n.x=t._aabbMaxX;n.y=t._aabbMaxY;n.z=t._aabbMaxZ;this._convexSweep.init(a,i,r);var e=N.instance;if(!(e.computeClosestPointsImpl(this._convexSweep,this._aabb,i,this.identity,null,false)==0&&e.distance<=0)){return}if(t._height==0){o.process(t._proxy);return}this.convexCastRecursive(t._children[0],a,i,r,o);this.convexCastRecursive(t._children[1],a,i,r,o)},aabbTestRecursive:function(t,a,i){if(!(t._aabbMinX<a._maxX&&t._aabbMaxX>a._minX&&t._aabbMinY<a._maxY&&t._aabbMaxY>a._minY&&t._aabbMinZ<a._maxZ&&t._aabbMaxZ>a._minZ)){return}if(t._height==0){i.process(t._proxy);return}this.aabbTestRecursive(t._children[0],a,i);this.aabbTestRecursive(t._children[1],a,i)},createProxy:function(t,a){var i=new Mt(t,this._idCount++);this._numProxies++;if(this._proxyList==null){this._proxyList=i;this._proxyListLast=i}else{this._proxyListLast._next=i;i._prev=this._proxyListLast;this._proxyListLast=i}i._aabbMinX=a._minX;i._aabbMinY=a._minY;i._aabbMinZ=a._minZ;i._aabbMaxX=a._maxX;i._aabbMaxY=a._maxY;i._aabbMaxZ=a._maxZ;var r=ys.bvhProxyPadding;var o;var s;var n;var e;s=r;n=r;e=r;i._aabbMinX-=s;i._aabbMinY-=n;i._aabbMinZ-=e;i._aabbMaxX+=s;i._aabbMaxY+=n;i._aabbMaxZ+=e;var _=this._tree;var v=_._nodePool;if(v!=null){_._nodePool=v._next;v._next=null}else{v=new Ba}var h=v;h._proxy=i;i._leaf=h;h._aabbMinX=i._aabbMinX;h._aabbMinY=i._aabbMinY;h._aabbMinZ=i._aabbMinZ;h._aabbMaxX=i._aabbMaxX;h._aabbMaxY=i._aabbMaxY;h._aabbMaxZ=i._aabbMaxZ;_._numLeaves++;if(_.leafList==null){_.leafList=h;_.leafListLast=h}else{_.leafListLast._nextLeaf=h;h._prevLeaf=_.leafListLast;_.leafListLast=h}if(_._root==null){_._root=h}else{var l=_._root;while(l._height>0){var c=_._strategy._decideInsertion(l,h);if(c==-1){break}else{l=l._children[c]}}var p=l._parent;var f=_._nodePool;if(f!=null){_._nodePool=f._next;f._next=null}else{f=new Ba}var m=f;if(p==null){_._root=m}else{var b=l._childIndex;p._children[b]=m;m._parent=p;m._childIndex=b}var u=l._childIndex;m._children[u]=l;l._parent=m;l._childIndex=u;var x=l._childIndex^1;m._children[x]=h;h._parent=m;h._childIndex=x;while(m!=null){if(_._strategy._balancingEnabled){var y=m._height;if(y<2){m=m}else{var g=m._parent;var X=m._children[0];var z=m._children[1];var M=X._height;var Y=z._height;var Z=M-Y;var d=m._childIndex;if(Z>1){var I=X._children[0];var w=X._children[1];var V=I._height;var L=w._height;if(V>L){X._children[1]=m;m._parent=X;m._childIndex=1;m._children[0]=w;w._parent=m;w._childIndex=0;var A=X._children[0];var k=X._children[1];X._aabbMinX=A._aabbMinX<k._aabbMinX?A._aabbMinX:k._aabbMinX;X._aabbMinY=A._aabbMinY<k._aabbMinY?A._aabbMinY:k._aabbMinY;X._aabbMinZ=A._aabbMinZ<k._aabbMinZ?A._aabbMinZ:k._aabbMinZ;X._aabbMaxX=A._aabbMaxX>k._aabbMaxX?A._aabbMaxX:k._aabbMaxX;X._aabbMaxY=A._aabbMaxY>k._aabbMaxY?A._aabbMaxY:k._aabbMaxY;X._aabbMaxZ=A._aabbMaxZ>k._aabbMaxZ?A._aabbMaxZ:k._aabbMaxZ;var B=X._children[0]._height;var P=X._children[1]._height;X._height=(B>P?B:P)+1;var T=m._children[0];var S=m._children[1];m._aabbMinX=T._aabbMinX<S._aabbMinX?T._aabbMinX:S._aabbMinX;m._aabbMinY=T._aabbMinY<S._aabbMinY?T._aabbMinY:S._aabbMinY;m._aabbMinZ=T._aabbMinZ<S._aabbMinZ?T._aabbMinZ:S._aabbMinZ;m._aabbMaxX=T._aabbMaxX>S._aabbMaxX?T._aabbMaxX:S._aabbMaxX;m._aabbMaxY=T._aabbMaxY>S._aabbMaxY?T._aabbMaxY:S._aabbMaxY;m._aabbMaxZ=T._aabbMaxZ>S._aabbMaxZ?T._aabbMaxZ:S._aabbMaxZ;var C=m._children[0]._height;var q=m._children[1]._height;m._height=(C>q?C:q)+1}else{X._children[0]=m;m._parent=X;m._childIndex=0;m._children[0]=I;I._parent=m;I._childIndex=0;var R=X._children[0];var E=X._children[1];X._aabbMinX=R._aabbMinX<E._aabbMinX?R._aabbMinX:E._aabbMinX;X._aabbMinY=R._aabbMinY<E._aabbMinY?R._aabbMinY:E._aabbMinY;X._aabbMinZ=R._aabbMinZ<E._aabbMinZ?R._aabbMinZ:E._aabbMinZ;X._aabbMaxX=R._aabbMaxX>E._aabbMaxX?R._aabbMaxX:E._aabbMaxX;X._aabbMaxY=R._aabbMaxY>E._aabbMaxY?R._aabbMaxY:E._aabbMaxY;X._aabbMaxZ=R._aabbMaxZ>E._aabbMaxZ?R._aabbMaxZ:E._aabbMaxZ;var j=X._children[0]._height;var N=X._children[1]._height;X._height=(j>N?j:N)+1;var D=m._children[0];var F=m._children[1];m._aabbMinX=D._aabbMinX<F._aabbMinX?D._aabbMinX:F._aabbMinX;m._aabbMinY=D._aabbMinY<F._aabbMinY?D._aabbMinY:F._aabbMinY;m._aabbMinZ=D._aabbMinZ<F._aabbMinZ?D._aabbMinZ:F._aabbMinZ;m._aabbMaxX=D._aabbMaxX>F._aabbMaxX?D._aabbMaxX:F._aabbMaxX;m._aabbMaxY=D._aabbMaxY>F._aabbMaxY?D._aabbMaxY:F._aabbMaxY;m._aabbMaxZ=D._aabbMaxZ>F._aabbMaxZ?D._aabbMaxZ:F._aabbMaxZ;var O=m._children[0]._height;var W=m._children[1]._height;m._height=(O>W?O:W)+1}if(g!=null){g._children[d]=X;X._parent=g;X._childIndex=d}else{_._root=X;X._parent=null}m=X}else if(Z<-1){var G=z._children[0];var H=z._children[1];var U=G._height;var J=H._height;if(U>J){z._children[1]=m;m._parent=z;m._childIndex=1;m._children[1]=H;H._parent=m;H._childIndex=1;var Q=z._children[0];var $=z._children[1];z._aabbMinX=Q._aabbMinX<$._aabbMinX?Q._aabbMinX:$._aabbMinX;z._aabbMinY=Q._aabbMinY<$._aabbMinY?Q._aabbMinY:$._aabbMinY;z._aabbMinZ=Q._aabbMinZ<$._aabbMinZ?Q._aabbMinZ:$._aabbMinZ;z._aabbMaxX=Q._aabbMaxX>$._aabbMaxX?Q._aabbMaxX:$._aabbMaxX;z._aabbMaxY=Q._aabbMaxY>$._aabbMaxY?Q._aabbMaxY:$._aabbMaxY;z._aabbMaxZ=Q._aabbMaxZ>$._aabbMaxZ?Q._aabbMaxZ:$._aabbMaxZ;var K=z._children[0]._height;var tt=z._children[1]._height;z._height=(K>tt?K:tt)+1;var at=m._children[0];var it=m._children[1];m._aabbMinX=at._aabbMinX<it._aabbMinX?at._aabbMinX:it._aabbMinX;m._aabbMinY=at._aabbMinY<it._aabbMinY?at._aabbMinY:it._aabbMinY;m._aabbMinZ=at._aabbMinZ<it._aabbMinZ?at._aabbMinZ:it._aabbMinZ;m._aabbMaxX=at._aabbMaxX>it._aabbMaxX?at._aabbMaxX:it._aabbMaxX;m._aabbMaxY=at._aabbMaxY>it._aabbMaxY?at._aabbMaxY:it._aabbMaxY;m._aabbMaxZ=at._aabbMaxZ>it._aabbMaxZ?at._aabbMaxZ:it._aabbMaxZ;var rt=m._children[0]._height;var ot=m._children[1]._height;m._height=(rt>ot?rt:ot)+1}else{z._children[0]=m;m._parent=z;m._childIndex=0;m._children[1]=G;G._parent=m;G._childIndex=1;var st=z._children[0];var nt=z._children[1];z._aabbMinX=st._aabbMinX<nt._aabbMinX?st._aabbMinX:nt._aabbMinX;z._aabbMinY=st._aabbMinY<nt._aabbMinY?st._aabbMinY:nt._aabbMinY;z._aabbMinZ=st._aabbMinZ<nt._aabbMinZ?st._aabbMinZ:nt._aabbMinZ;z._aabbMaxX=st._aabbMaxX>nt._aabbMaxX?st._aabbMaxX:nt._aabbMaxX;z._aabbMaxY=st._aabbMaxY>nt._aabbMaxY?st._aabbMaxY:nt._aabbMaxY;z._aabbMaxZ=st._aabbMaxZ>nt._aabbMaxZ?st._aabbMaxZ:nt._aabbMaxZ;var et=z._children[0]._height;var _t=z._children[1]._height;z._height=(et>_t?et:_t)+1;var vt=m._children[0];var ht=m._children[1];m._aabbMinX=vt._aabbMinX<ht._aabbMinX?vt._aabbMinX:ht._aabbMinX;m._aabbMinY=vt._aabbMinY<ht._aabbMinY?vt._aabbMinY:ht._aabbMinY;m._aabbMinZ=vt._aabbMinZ<ht._aabbMinZ?vt._aabbMinZ:ht._aabbMinZ;m._aabbMaxX=vt._aabbMaxX>ht._aabbMaxX?vt._aabbMaxX:ht._aabbMaxX;m._aabbMaxY=vt._aabbMaxY>ht._aabbMaxY?vt._aabbMaxY:ht._aabbMaxY;m._aabbMaxZ=vt._aabbMaxZ>ht._aabbMaxZ?vt._aabbMaxZ:ht._aabbMaxZ;var lt=m._children[0]._height;var ct=m._children[1]._height;m._height=(lt>ct?lt:ct)+1}if(g!=null){g._children[d]=z;z._parent=g;z._childIndex=d}else{_._root=z;z._parent=null}m=z}else{m=m}}}var pt=m._children[0]._height;var ft=m._children[1]._height;m._height=(pt>ft?pt:ft)+1;var mt=m._children[0];var bt=m._children[1];m._aabbMinX=mt._aabbMinX<bt._aabbMinX?mt._aabbMinX:bt._aabbMinX;m._aabbMinY=mt._aabbMinY<bt._aabbMinY?mt._aabbMinY:bt._aabbMinY;m._aabbMinZ=mt._aabbMinZ<bt._aabbMinZ?mt._aabbMinZ:bt._aabbMinZ;m._aabbMaxX=mt._aabbMaxX>bt._aabbMaxX?mt._aabbMaxX:bt._aabbMaxX;m._aabbMaxY=mt._aabbMaxY>bt._aabbMaxY?mt._aabbMaxY:bt._aabbMaxY;m._aabbMaxZ=mt._aabbMaxZ>bt._aabbMaxZ?mt._aabbMaxZ:bt._aabbMaxZ;m=m._parent}}if(!i._moved){i._moved=true;if(this.movedProxies.length==this.numMovedProxies){var ut=this.numMovedProxies<<1;var xt=new Array(ut);var yt=xt;var gt=0;var Xt=this.numMovedProxies;while(gt<Xt){var zt=gt++;yt[zt]=this.movedProxies[zt];this.movedProxies[zt]=null}this.movedProxies=yt}this.movedProxies[this.numMovedProxies++]=i}return i},destroyProxy:function(t){this._numProxies--;var a=t._prev;var i=t._next;if(a!=null){a._next=i}if(i!=null){i._prev=a}if(t==this._proxyList){this._proxyList=this._proxyList._next}if(t==this._proxyListLast){this._proxyListLast=this._proxyListLast._prev}t._next=null;t._prev=null;var r=t;var o=this._tree;var s=r._leaf;o._numLeaves--;var n=s._prevLeaf;var e=s._nextLeaf;if(n!=null){n._nextLeaf=e}if(e!=null){e._prevLeaf=n}if(s==o.leafList){o.leafList=o.leafList._nextLeaf}if(s==o.leafListLast){o.leafListLast=o.leafListLast._prevLeaf}s._nextLeaf=null;s._prevLeaf=null;if(o._root==s){o._root=null}else{var _=s._parent;var v=_._children[s._childIndex^1];var h=_._parent;if(h==null){v._parent=null;v._childIndex=0;o._root=v;_._next=null;_._childIndex=0;_._children[0]=null;_._children[1]=null;_._childIndex=0;_._parent=null;_._height=0;_._proxy=null;_._next=o._nodePool;o._nodePool=_}else{v._parent=h;var l=_._childIndex;h._children[l]=v;v._parent=h;v._childIndex=l;_._next=null;_._childIndex=0;_._children[0]=null;_._children[1]=null;_._childIndex=0;_._parent=null;_._height=0;_._proxy=null;_._next=o._nodePool;o._nodePool=_;var c=h;while(c!=null){if(o._strategy._balancingEnabled){var p=c._height;if(p<2){c=c}else{var f=c._parent;var m=c._children[0];var b=c._children[1];var u=m._height;var x=b._height;var y=u-x;var g=c._childIndex;if(y>1){var X=m._children[0];var z=m._children[1];var M=X._height;var Y=z._height;if(M>Y){m._children[1]=c;c._parent=m;c._childIndex=1;c._children[0]=z;z._parent=c;z._childIndex=0;var Z=m._children[0];var d=m._children[1];m._aabbMinX=Z._aabbMinX<d._aabbMinX?Z._aabbMinX:d._aabbMinX;m._aabbMinY=Z._aabbMinY<d._aabbMinY?Z._aabbMinY:d._aabbMinY;m._aabbMinZ=Z._aabbMinZ<d._aabbMinZ?Z._aabbMinZ:d._aabbMinZ;m._aabbMaxX=Z._aabbMaxX>d._aabbMaxX?Z._aabbMaxX:d._aabbMaxX;m._aabbMaxY=Z._aabbMaxY>d._aabbMaxY?Z._aabbMaxY:d._aabbMaxY;m._aabbMaxZ=Z._aabbMaxZ>d._aabbMaxZ?Z._aabbMaxZ:d._aabbMaxZ;var I=m._children[0]._height;var w=m._children[1]._height;m._height=(I>w?I:w)+1;var V=c._children[0];var L=c._children[1];c._aabbMinX=V._aabbMinX<L._aabbMinX?V._aabbMinX:L._aabbMinX;c._aabbMinY=V._aabbMinY<L._aabbMinY?V._aabbMinY:L._aabbMinY;c._aabbMinZ=V._aabbMinZ<L._aabbMinZ?V._aabbMinZ:L._aabbMinZ;c._aabbMaxX=V._aabbMaxX>L._aabbMaxX?V._aabbMaxX:L._aabbMaxX;c._aabbMaxY=V._aabbMaxY>L._aabbMaxY?V._aabbMaxY:L._aabbMaxY;c._aabbMaxZ=V._aabbMaxZ>L._aabbMaxZ?V._aabbMaxZ:L._aabbMaxZ;var A=c._children[0]._height;var k=c._children[1]._height;c._height=(A>k?A:k)+1}else{m._children[0]=c;c._parent=m;c._childIndex=0;c._children[0]=X;X._parent=c;X._childIndex=0;var B=m._children[0];var P=m._children[1];m._aabbMinX=B._aabbMinX<P._aabbMinX?B._aabbMinX:P._aabbMinX;m._aabbMinY=B._aabbMinY<P._aabbMinY?B._aabbMinY:P._aabbMinY;m._aabbMinZ=B._aabbMinZ<P._aabbMinZ?B._aabbMinZ:P._aabbMinZ;m._aabbMaxX=B._aabbMaxX>P._aabbMaxX?B._aabbMaxX:P._aabbMaxX;m._aabbMaxY=B._aabbMaxY>P._aabbMaxY?B._aabbMaxY:P._aabbMaxY;m._aabbMaxZ=B._aabbMaxZ>P._aabbMaxZ?B._aabbMaxZ:P._aabbMaxZ;var T=m._children[0]._height;var S=m._children[1]._height;m._height=(T>S?T:S)+1;var C=c._children[0];var q=c._children[1];c._aabbMinX=C._aabbMinX<q._aabbMinX?C._aabbMinX:q._aabbMinX;c._aabbMinY=C._aabbMinY<q._aabbMinY?C._aabbMinY:q._aabbMinY;c._aabbMinZ=C._aabbMinZ<q._aabbMinZ?C._aabbMinZ:q._aabbMinZ;c._aabbMaxX=C._aabbMaxX>q._aabbMaxX?C._aabbMaxX:q._aabbMaxX;c._aabbMaxY=C._aabbMaxY>q._aabbMaxY?C._aabbMaxY:q._aabbMaxY;c._aabbMaxZ=C._aabbMaxZ>q._aabbMaxZ?C._aabbMaxZ:q._aabbMaxZ;var R=c._children[0]._height;var E=c._children[1]._height;c._height=(R>E?R:E)+1}if(f!=null){f._children[g]=m;m._parent=f;m._childIndex=g}else{o._root=m;m._parent=null}c=m}else if(y<-1){var j=b._children[0];var N=b._children[1];var D=j._height;var F=N._height;if(D>F){b._children[1]=c;c._parent=b;c._childIndex=1;c._children[1]=N;N._parent=c;N._childIndex=1;var O=b._children[0];var W=b._children[1];b._aabbMinX=O._aabbMinX<W._aabbMinX?O._aabbMinX:W._aabbMinX;b._aabbMinY=O._aabbMinY<W._aabbMinY?O._aabbMinY:W._aabbMinY;b._aabbMinZ=O._aabbMinZ<W._aabbMinZ?O._aabbMinZ:W._aabbMinZ;b._aabbMaxX=O._aabbMaxX>W._aabbMaxX?O._aabbMaxX:W._aabbMaxX;b._aabbMaxY=O._aabbMaxY>W._aabbMaxY?O._aabbMaxY:W._aabbMaxY;b._aabbMaxZ=O._aabbMaxZ>W._aabbMaxZ?O._aabbMaxZ:W._aabbMaxZ;var G=b._children[0]._height;var H=b._children[1]._height;b._height=(G>H?G:H)+1;var U=c._children[0];var J=c._children[1];c._aabbMinX=U._aabbMinX<J._aabbMinX?U._aabbMinX:J._aabbMinX;c._aabbMinY=U._aabbMinY<J._aabbMinY?U._aabbMinY:J._aabbMinY;c._aabbMinZ=U._aabbMinZ<J._aabbMinZ?U._aabbMinZ:J._aabbMinZ;c._aabbMaxX=U._aabbMaxX>J._aabbMaxX?U._aabbMaxX:J._aabbMaxX;c._aabbMaxY=U._aabbMaxY>J._aabbMaxY?U._aabbMaxY:J._aabbMaxY;c._aabbMaxZ=U._aabbMaxZ>J._aabbMaxZ?U._aabbMaxZ:J._aabbMaxZ;var Q=c._children[0]._height;var $=c._children[1]._height;c._height=(Q>$?Q:$)+1}else{b._children[0]=c;c._parent=b;c._childIndex=0;c._children[1]=j;j._parent=c;j._childIndex=1;var K=b._children[0];var tt=b._children[1];b._aabbMinX=K._aabbMinX<tt._aabbMinX?K._aabbMinX:tt._aabbMinX;b._aabbMinY=K._aabbMinY<tt._aabbMinY?K._aabbMinY:tt._aabbMinY;b._aabbMinZ=K._aabbMinZ<tt._aabbMinZ?K._aabbMinZ:tt._aabbMinZ;b._aabbMaxX=K._aabbMaxX>tt._aabbMaxX?K._aabbMaxX:tt._aabbMaxX;b._aabbMaxY=K._aabbMaxY>tt._aabbMaxY?K._aabbMaxY:tt._aabbMaxY;b._aabbMaxZ=K._aabbMaxZ>tt._aabbMaxZ?K._aabbMaxZ:tt._aabbMaxZ;var at=b._children[0]._height;var it=b._children[1]._height;b._height=(at>it?at:it)+1;var rt=c._children[0];var ot=c._children[1];c._aabbMinX=rt._aabbMinX<ot._aabbMinX?rt._aabbMinX:ot._aabbMinX;c._aabbMinY=rt._aabbMinY<ot._aabbMinY?rt._aabbMinY:ot._aabbMinY;c._aabbMinZ=rt._aabbMinZ<ot._aabbMinZ?rt._aabbMinZ:ot._aabbMinZ;c._aabbMaxX=rt._aabbMaxX>ot._aabbMaxX?rt._aabbMaxX:ot._aabbMaxX;c._aabbMaxY=rt._aabbMaxY>ot._aabbMaxY?rt._aabbMaxY:ot._aabbMaxY;c._aabbMaxZ=rt._aabbMaxZ>ot._aabbMaxZ?rt._aabbMaxZ:ot._aabbMaxZ;var st=c._children[0]._height;var nt=c._children[1]._height;c._height=(st>nt?st:nt)+1}if(f!=null){f._children[g]=b;b._parent=f;b._childIndex=g}else{o._root=b;b._parent=null}c=b}else{c=c}}}var et=c._children[0]._height;var _t=c._children[1]._height;c._height=(et>_t?et:_t)+1;var vt=c._children[0];var ht=c._children[1];c._aabbMinX=vt._aabbMinX<ht._aabbMinX?vt._aabbMinX:ht._aabbMinX;c._aabbMinY=vt._aabbMinY<ht._aabbMinY?vt._aabbMinY:ht._aabbMinY;c._aabbMinZ=vt._aabbMinZ<ht._aabbMinZ?vt._aabbMinZ:ht._aabbMinZ;c._aabbMaxX=vt._aabbMaxX>ht._aabbMaxX?vt._aabbMaxX:ht._aabbMaxX;c._aabbMaxY=vt._aabbMaxY>ht._aabbMaxY?vt._aabbMaxY:ht._aabbMaxY;c._aabbMaxZ=vt._aabbMaxZ>ht._aabbMaxZ?vt._aabbMaxZ:ht._aabbMaxZ;c=c._parent}}}r._leaf=null;s._next=null;s._childIndex=0;s._children[0]=null;s._children[1]=null;s._childIndex=0;s._parent=null;s._height=0;s._proxy=null;s._next=o._nodePool;o._nodePool=s;r.userData=null;r._next=null;r._prev=null;if(r._moved){r._moved=false}},moveProxy:function(t,a,i){var r=t;if(r._aabbMinX<=a._minX&&r._aabbMaxX>=a._maxX&&r._aabbMinY<=a._minY&&r._aabbMaxY>=a._maxY&&r._aabbMinZ<=a._minZ&&r._aabbMaxZ>=a._maxZ){return}r._aabbMinX=a._minX;r._aabbMinY=a._minY;r._aabbMinZ=a._minZ;r._aabbMaxX=a._maxX;r._aabbMaxY=a._maxY;r._aabbMaxZ=a._maxZ;var o=ys.bvhProxyPadding;var s;var n;var e;var _;n=o;e=o;_=o;r._aabbMinX-=n;r._aabbMinY-=e;r._aabbMinZ-=_;r._aabbMaxX+=n;r._aabbMaxY+=e;r._aabbMaxZ+=_;if(i!=null){var v;var h;var l;var c;var p;var f;var m;var b;var u;var x;var y;var g;var X;var z;var M;var Y;f=0;m=0;b=0;var Z=i;h=Z.x;l=Z.y;c=Z.z;x=f<h?f:h;y=m<l?m:l;g=b<c?b:c;z=f>h?f:h;M=m>l?m:l;Y=b>c?b:c;r._aabbMinX+=x;r._aabbMinY+=y;r._aabbMinZ+=g;r._aabbMaxX+=z;r._aabbMaxY+=M;r._aabbMaxZ+=Y}if(!r._moved){r._moved=true;if(this.movedProxies.length==this.numMovedProxies){var d=this.numMovedProxies<<1;var I=new Array(d);var w=I;var V=0;var L=this.numMovedProxies;while(V<L){var A=V++;w[A]=this.movedProxies[A];this.movedProxies[A]=null}this.movedProxies=w}this.movedProxies[this.numMovedProxies++]=r}},collectPairs:function(){var t=this._proxyPairList;if(t!=null){while(true){t._p1=null;t._p2=null;t=t._next;if(!(t!=null)){break}}this._proxyPairList._next=this._proxyPairPool;this._proxyPairPool=this._proxyPairList;this._proxyPairList=null}this._testCount=0;if(this._numProxies<2){return}var a=false;if(a){while(this.numMovedProxies>0)this.movedProxies[--this.numMovedProxies]=null;var i=this._tree;if(i._root!=null){if(i._root!=null){i.decomposeRecursive(i._root);i._root=null}while(i.tmp.length<i._numLeaves){var r=i.tmp.length<<1;var o=new Array(r);var s=o;var n=0;var e=i.tmp.length;while(n<e){var _=n++;s[_]=i.tmp[_];i.tmp[_]=null}i.tmp=s}var v=0;var h=i.leafList;while(h!=null){var l=h._nextLeaf;i.tmp[v]=h;++v;h=l}i._root=i.buildTopDownRecursive(i.tmp,0,i._numLeaves)}this.collide(this._tree._root,this._tree._root);return}var c=this.numMovedProxies/this._numProxies<ys.bvhIncrementalCollisionThreshold;var p=0;var f=this.numMovedProxies;while(p<f){var m=p++;var b=this.movedProxies[m];if(b._moved){var u=this._tree;var x=b._leaf;u._numLeaves--;var y=x._prevLeaf;var g=x._nextLeaf;if(y!=null){y._nextLeaf=g}if(g!=null){g._prevLeaf=y}if(x==u.leafList){u.leafList=u.leafList._nextLeaf}if(x==u.leafListLast){u.leafListLast=u.leafListLast._prevLeaf}x._nextLeaf=null;x._prevLeaf=null;if(u._root==x){u._root=null}else{var X=x._parent;var z=X._children[x._childIndex^1];var M=X._parent;if(M==null){z._parent=null;z._childIndex=0;u._root=z;X._next=null;X._childIndex=0;X._children[0]=null;X._children[1]=null;X._childIndex=0;X._parent=null;X._height=0;X._proxy=null;X._next=u._nodePool;u._nodePool=X}else{z._parent=M;var Y=X._childIndex;M._children[Y]=z;z._parent=M;z._childIndex=Y;X._next=null;X._childIndex=0;X._children[0]=null;X._children[1]=null;X._childIndex=0;X._parent=null;X._height=0;X._proxy=null;X._next=u._nodePool;u._nodePool=X;var Z=M;while(Z!=null){if(u._strategy._balancingEnabled){var d=Z._height;if(d<2){Z=Z}else{var I=Z._parent;var w=Z._children[0];var V=Z._children[1];var L=w._height;var A=V._height;var k=L-A;var B=Z._childIndex;if(k>1){var P=w._children[0];var T=w._children[1];var S=P._height;var C=T._height;if(S>C){w._children[1]=Z;Z._parent=w;Z._childIndex=1;Z._children[0]=T;T._parent=Z;T._childIndex=0;var q=w._children[0];var R=w._children[1];w._aabbMinX=q._aabbMinX<R._aabbMinX?q._aabbMinX:R._aabbMinX;w._aabbMinY=q._aabbMinY<R._aabbMinY?q._aabbMinY:R._aabbMinY;w._aabbMinZ=q._aabbMinZ<R._aabbMinZ?q._aabbMinZ:R._aabbMinZ;w._aabbMaxX=q._aabbMaxX>R._aabbMaxX?q._aabbMaxX:R._aabbMaxX;w._aabbMaxY=q._aabbMaxY>R._aabbMaxY?q._aabbMaxY:R._aabbMaxY;w._aabbMaxZ=q._aabbMaxZ>R._aabbMaxZ?q._aabbMaxZ:R._aabbMaxZ;var E=w._children[0]._height;var j=w._children[1]._height;w._height=(E>j?E:j)+1;var N=Z._children[0];var D=Z._children[1];Z._aabbMinX=N._aabbMinX<D._aabbMinX?N._aabbMinX:D._aabbMinX;Z._aabbMinY=N._aabbMinY<D._aabbMinY?N._aabbMinY:D._aabbMinY;Z._aabbMinZ=N._aabbMinZ<D._aabbMinZ?N._aabbMinZ:D._aabbMinZ;Z._aabbMaxX=N._aabbMaxX>D._aabbMaxX?N._aabbMaxX:D._aabbMaxX;Z._aabbMaxY=N._aabbMaxY>D._aabbMaxY?N._aabbMaxY:D._aabbMaxY;Z._aabbMaxZ=N._aabbMaxZ>D._aabbMaxZ?N._aabbMaxZ:D._aabbMaxZ;var F=Z._children[0]._height;var O=Z._children[1]._height;Z._height=(F>O?F:O)+1}else{w._children[0]=Z;Z._parent=w;Z._childIndex=0;Z._children[0]=P;P._parent=Z;P._childIndex=0;var W=w._children[0];var G=w._children[1];w._aabbMinX=W._aabbMinX<G._aabbMinX?W._aabbMinX:G._aabbMinX;w._aabbMinY=W._aabbMinY<G._aabbMinY?W._aabbMinY:G._aabbMinY;w._aabbMinZ=W._aabbMinZ<G._aabbMinZ?W._aabbMinZ:G._aabbMinZ;w._aabbMaxX=W._aabbMaxX>G._aabbMaxX?W._aabbMaxX:G._aabbMaxX;w._aabbMaxY=W._aabbMaxY>G._aabbMaxY?W._aabbMaxY:G._aabbMaxY;w._aabbMaxZ=W._aabbMaxZ>G._aabbMaxZ?W._aabbMaxZ:G._aabbMaxZ;var H=w._children[0]._height;var U=w._children[1]._height;w._height=(H>U?H:U)+1;var J=Z._children[0];var Q=Z._children[1];Z._aabbMinX=J._aabbMinX<Q._aabbMinX?J._aabbMinX:Q._aabbMinX;Z._aabbMinY=J._aabbMinY<Q._aabbMinY?J._aabbMinY:Q._aabbMinY;Z._aabbMinZ=J._aabbMinZ<Q._aabbMinZ?J._aabbMinZ:Q._aabbMinZ;Z._aabbMaxX=J._aabbMaxX>Q._aabbMaxX?J._aabbMaxX:Q._aabbMaxX;Z._aabbMaxY=J._aabbMaxY>Q._aabbMaxY?J._aabbMaxY:Q._aabbMaxY;Z._aabbMaxZ=J._aabbMaxZ>Q._aabbMaxZ?J._aabbMaxZ:Q._aabbMaxZ;var $=Z._children[0]._height;var K=Z._children[1]._height;Z._height=($>K?$:K)+1}if(I!=null){I._children[B]=w;w._parent=I;w._childIndex=B}else{u._root=w;w._parent=null}Z=w}else if(k<-1){var tt=V._children[0];var at=V._children[1];var it=tt._height;var rt=at._height;if(it>rt){V._children[1]=Z;Z._parent=V;Z._childIndex=1;Z._children[1]=at;at._parent=Z;at._childIndex=1;var ot=V._children[0];var st=V._children[1];V._aabbMinX=ot._aabbMinX<st._aabbMinX?ot._aabbMinX:st._aabbMinX;V._aabbMinY=ot._aabbMinY<st._aabbMinY?ot._aabbMinY:st._aabbMinY;V._aabbMinZ=ot._aabbMinZ<st._aabbMinZ?ot._aabbMinZ:st._aabbMinZ;V._aabbMaxX=ot._aabbMaxX>st._aabbMaxX?ot._aabbMaxX:st._aabbMaxX;V._aabbMaxY=ot._aabbMaxY>st._aabbMaxY?ot._aabbMaxY:st._aabbMaxY;V._aabbMaxZ=ot._aabbMaxZ>st._aabbMaxZ?ot._aabbMaxZ:st._aabbMaxZ;var nt=V._children[0]._height;var et=V._children[1]._height;V._height=(nt>et?nt:et)+1;var _t=Z._children[0];var vt=Z._children[1];Z._aabbMinX=_t._aabbMinX<vt._aabbMinX?_t._aabbMinX:vt._aabbMinX;Z._aabbMinY=_t._aabbMinY<vt._aabbMinY?_t._aabbMinY:vt._aabbMinY;Z._aabbMinZ=_t._aabbMinZ<vt._aabbMinZ?_t._aabbMinZ:vt._aabbMinZ;Z._aabbMaxX=_t._aabbMaxX>vt._aabbMaxX?_t._aabbMaxX:vt._aabbMaxX;Z._aabbMaxY=_t._aabbMaxY>vt._aabbMaxY?_t._aabbMaxY:vt._aabbMaxY;Z._aabbMaxZ=_t._aabbMaxZ>vt._aabbMaxZ?_t._aabbMaxZ:vt._aabbMaxZ;var ht=Z._children[0]._height;var lt=Z._children[1]._height;Z._height=(ht>lt?ht:lt)+1}else{V._children[0]=Z;Z._parent=V;Z._childIndex=0;Z._children[1]=tt;tt._parent=Z;tt._childIndex=1;var ct=V._children[0];var pt=V._children[1];V._aabbMinX=ct._aabbMinX<pt._aabbMinX?ct._aabbMinX:pt._aabbMinX;V._aabbMinY=ct._aabbMinY<pt._aabbMinY?ct._aabbMinY:pt._aabbMinY;V._aabbMinZ=ct._aabbMinZ<pt._aabbMinZ?ct._aabbMinZ:pt._aabbMinZ;V._aabbMaxX=ct._aabbMaxX>pt._aabbMaxX?ct._aabbMaxX:pt._aabbMaxX;V._aabbMaxY=ct._aabbMaxY>pt._aabbMaxY?ct._aabbMaxY:pt._aabbMaxY;V._aabbMaxZ=ct._aabbMaxZ>pt._aabbMaxZ?ct._aabbMaxZ:pt._aabbMaxZ;var ft=V._children[0]._height;var mt=V._children[1]._height;V._height=(ft>mt?ft:mt)+1;var bt=Z._children[0];var ut=Z._children[1];Z._aabbMinX=bt._aabbMinX<ut._aabbMinX?bt._aabbMinX:ut._aabbMinX;Z._aabbMinY=bt._aabbMinY<ut._aabbMinY?bt._aabbMinY:ut._aabbMinY;Z._aabbMinZ=bt._aabbMinZ<ut._aabbMinZ?bt._aabbMinZ:ut._aabbMinZ;Z._aabbMaxX=bt._aabbMaxX>ut._aabbMaxX?bt._aabbMaxX:ut._aabbMaxX;Z._aabbMaxY=bt._aabbMaxY>ut._aabbMaxY?bt._aabbMaxY:ut._aabbMaxY;Z._aabbMaxZ=bt._aabbMaxZ>ut._aabbMaxZ?bt._aabbMaxZ:ut._aabbMaxZ;var xt=Z._children[0]._height;var yt=Z._children[1]._height;Z._height=(xt>yt?xt:yt)+1}if(I!=null){I._children[B]=V;V._parent=I;V._childIndex=B}else{u._root=V;V._parent=null}Z=V}else{Z=Z}}}var gt=Z._children[0]._height;var Xt=Z._children[1]._height;Z._height=(gt>Xt?gt:Xt)+1;var zt=Z._children[0];var Mt=Z._children[1];Z._aabbMinX=zt._aabbMinX<Mt._aabbMinX?zt._aabbMinX:Mt._aabbMinX;Z._aabbMinY=zt._aabbMinY<Mt._aabbMinY?zt._aabbMinY:Mt._aabbMinY;Z._aabbMinZ=zt._aabbMinZ<Mt._aabbMinZ?zt._aabbMinZ:Mt._aabbMinZ;Z._aabbMaxX=zt._aabbMaxX>Mt._aabbMaxX?zt._aabbMaxX:Mt._aabbMaxX;Z._aabbMaxY=zt._aabbMaxY>Mt._aabbMaxY?zt._aabbMaxY:Mt._aabbMaxY;Z._aabbMaxZ=zt._aabbMaxZ>Mt._aabbMaxZ?zt._aabbMaxZ:Mt._aabbMaxZ;Z=Z._parent}}}b._leaf=null;x._next=null;x._childIndex=0;x._children[0]=null;x._children[1]=null;x._childIndex=0;x._parent=null;x._height=0;x._proxy=null;x._next=u._nodePool;u._nodePool=x;var Yt=this._tree;var Zt=Yt._nodePool;if(Zt!=null){Yt._nodePool=Zt._next;Zt._next=null}else{Zt=new Ba}var dt=Zt;dt._proxy=b;b._leaf=dt;dt._aabbMinX=b._aabbMinX;dt._aabbMinY=b._aabbMinY;dt._aabbMinZ=b._aabbMinZ;dt._aabbMaxX=b._aabbMaxX;dt._aabbMaxY=b._aabbMaxY;dt._aabbMaxZ=b._aabbMaxZ;Yt._numLeaves++;if(Yt.leafList==null){Yt.leafList=dt;Yt.leafListLast=dt}else{Yt.leafListLast._nextLeaf=dt;dt._prevLeaf=Yt.leafListLast;Yt.leafListLast=dt}if(Yt._root==null){Yt._root=dt}else{var It=Yt._root;while(It._height>0){var wt=Yt._strategy._decideInsertion(It,dt);if(wt==-1){break}else{It=It._children[wt]}}var Vt=It._parent;var Lt=Yt._nodePool;if(Lt!=null){Yt._nodePool=Lt._next;Lt._next=null}else{Lt=new Ba}var At=Lt;if(Vt==null){Yt._root=At}else{var kt=It._childIndex;Vt._children[kt]=At;At._parent=Vt;At._childIndex=kt}var Bt=It._childIndex;At._children[Bt]=It;It._parent=At;It._childIndex=Bt;var Pt=It._childIndex^1;At._children[Pt]=dt;dt._parent=At;dt._childIndex=Pt;while(At!=null){if(Yt._strategy._balancingEnabled){var Tt=At._height;if(Tt<2){At=At}else{var St=At._parent;var Ct=At._children[0];var qt=At._children[1];var Rt=Ct._height;var Et=qt._height;var jt=Rt-Et;var Nt=At._childIndex;if(jt>1){var Dt=Ct._children[0];var Ft=Ct._children[1];var Ot=Dt._height;var Wt=Ft._height;if(Ot>Wt){Ct._children[1]=At;At._parent=Ct;At._childIndex=1;At._children[0]=Ft;Ft._parent=At;Ft._childIndex=0;var Gt=Ct._children[0];var Ht=Ct._children[1];Ct._aabbMinX=Gt._aabbMinX<Ht._aabbMinX?Gt._aabbMinX:Ht._aabbMinX;Ct._aabbMinY=Gt._aabbMinY<Ht._aabbMinY?Gt._aabbMinY:Ht._aabbMinY;Ct._aabbMinZ=Gt._aabbMinZ<Ht._aabbMinZ?Gt._aabbMinZ:Ht._aabbMinZ;Ct._aabbMaxX=Gt._aabbMaxX>Ht._aabbMaxX?Gt._aabbMaxX:Ht._aabbMaxX;Ct._aabbMaxY=Gt._aabbMaxY>Ht._aabbMaxY?Gt._aabbMaxY:Ht._aabbMaxY;Ct._aabbMaxZ=Gt._aabbMaxZ>Ht._aabbMaxZ?Gt._aabbMaxZ:Ht._aabbMaxZ;var Ut=Ct._children[0]._height;var Jt=Ct._children[1]._height;Ct._height=(Ut>Jt?Ut:Jt)+1;var Qt=At._children[0];var $t=At._children[1];At._aabbMinX=Qt._aabbMinX<$t._aabbMinX?Qt._aabbMinX:$t._aabbMinX;At._aabbMinY=Qt._aabbMinY<$t._aabbMinY?Qt._aabbMinY:$t._aabbMinY;At._aabbMinZ=Qt._aabbMinZ<$t._aabbMinZ?Qt._aabbMinZ:$t._aabbMinZ;At._aabbMaxX=Qt._aabbMaxX>$t._aabbMaxX?Qt._aabbMaxX:$t._aabbMaxX;At._aabbMaxY=Qt._aabbMaxY>$t._aabbMaxY?Qt._aabbMaxY:$t._aabbMaxY;At._aabbMaxZ=Qt._aabbMaxZ>$t._aabbMaxZ?Qt._aabbMaxZ:$t._aabbMaxZ;var Kt=At._children[0]._height;var ta=At._children[1]._height;At._height=(Kt>ta?Kt:ta)+1}else{Ct._children[0]=At;At._parent=Ct;At._childIndex=0;At._children[0]=Dt;Dt._parent=At;Dt._childIndex=0;var aa=Ct._children[0];var ia=Ct._children[1];Ct._aabbMinX=aa._aabbMinX<ia._aabbMinX?aa._aabbMinX:ia._aabbMinX;Ct._aabbMinY=aa._aabbMinY<ia._aabbMinY?aa._aabbMinY:ia._aabbMinY;Ct._aabbMinZ=aa._aabbMinZ<ia._aabbMinZ?aa._aabbMinZ:ia._aabbMinZ;Ct._aabbMaxX=aa._aabbMaxX>ia._aabbMaxX?aa._aabbMaxX:ia._aabbMaxX;Ct._aabbMaxY=aa._aabbMaxY>ia._aabbMaxY?aa._aabbMaxY:ia._aabbMaxY;Ct._aabbMaxZ=aa._aabbMaxZ>ia._aabbMaxZ?aa._aabbMaxZ:ia._aabbMaxZ;var ra=Ct._children[0]._height;var oa=Ct._children[1]._height;Ct._height=(ra>oa?ra:oa)+1;var sa=At._children[0];var na=At._children[1];At._aabbMinX=sa._aabbMinX<na._aabbMinX?sa._aabbMinX:na._aabbMinX;At._aabbMinY=sa._aabbMinY<na._aabbMinY?sa._aabbMinY:na._aabbMinY;At._aabbMinZ=sa._aabbMinZ<na._aabbMinZ?sa._aabbMinZ:na._aabbMinZ;At._aabbMaxX=sa._aabbMaxX>na._aabbMaxX?sa._aabbMaxX:na._aabbMaxX;At._aabbMaxY=sa._aabbMaxY>na._aabbMaxY?sa._aabbMaxY:na._aabbMaxY;At._aabbMaxZ=sa._aabbMaxZ>na._aabbMaxZ?sa._aabbMaxZ:na._aabbMaxZ;var ea=At._children[0]._height;var _a=At._children[1]._height;At._height=(ea>_a?ea:_a)+1}if(St!=null){St._children[Nt]=Ct;Ct._parent=St;Ct._childIndex=Nt}else{Yt._root=Ct;Ct._parent=null}At=Ct}else if(jt<-1){var va=qt._children[0];var ha=qt._children[1];var la=va._height;var ca=ha._height;if(la>ca){qt._children[1]=At;At._parent=qt;At._childIndex=1;At._children[1]=ha;ha._parent=At;ha._childIndex=1;var pa=qt._children[0];var fa=qt._children[1];qt._aabbMinX=pa._aabbMinX<fa._aabbMinX?pa._aabbMinX:fa._aabbMinX;qt._aabbMinY=pa._aabbMinY<fa._aabbMinY?pa._aabbMinY:fa._aabbMinY;qt._aabbMinZ=pa._aabbMinZ<fa._aabbMinZ?pa._aabbMinZ:fa._aabbMinZ;qt._aabbMaxX=pa._aabbMaxX>fa._aabbMaxX?pa._aabbMaxX:fa._aabbMaxX;qt._aabbMaxY=pa._aabbMaxY>fa._aabbMaxY?pa._aabbMaxY:fa._aabbMaxY;qt._aabbMaxZ=pa._aabbMaxZ>fa._aabbMaxZ?pa._aabbMaxZ:fa._aabbMaxZ;var ma=qt._children[0]._height;var ba=qt._children[1]._height;qt._height=(ma>ba?ma:ba)+1;var ua=At._children[0];var xa=At._children[1];At._aabbMinX=ua._aabbMinX<xa._aabbMinX?ua._aabbMinX:xa._aabbMinX;At._aabbMinY=ua._aabbMinY<xa._aabbMinY?ua._aabbMinY:xa._aabbMinY;At._aabbMinZ=ua._aabbMinZ<xa._aabbMinZ?ua._aabbMinZ:xa._aabbMinZ;At._aabbMaxX=ua._aabbMaxX>xa._aabbMaxX?ua._aabbMaxX:xa._aabbMaxX;At._aabbMaxY=ua._aabbMaxY>xa._aabbMaxY?ua._aabbMaxY:xa._aabbMaxY;At._aabbMaxZ=ua._aabbMaxZ>xa._aabbMaxZ?ua._aabbMaxZ:xa._aabbMaxZ;var ya=At._children[0]._height;var ga=At._children[1]._height;At._height=(ya>ga?ya:ga)+1}else{qt._children[0]=At;At._parent=qt;At._childIndex=0;At._children[1]=va;va._parent=At;va._childIndex=1;var Xa=qt._children[0];var za=qt._children[1];qt._aabbMinX=Xa._aabbMinX<za._aabbMinX?Xa._aabbMinX:za._aabbMinX;qt._aabbMinY=Xa._aabbMinY<za._aabbMinY?Xa._aabbMinY:za._aabbMinY;qt._aabbMinZ=Xa._aabbMinZ<za._aabbMinZ?Xa._aabbMinZ:za._aabbMinZ;qt._aabbMaxX=Xa._aabbMaxX>za._aabbMaxX?Xa._aabbMaxX:za._aabbMaxX;qt._aabbMaxY=Xa._aabbMaxY>za._aabbMaxY?Xa._aabbMaxY:za._aabbMaxY;qt._aabbMaxZ=Xa._aabbMaxZ>za._aabbMaxZ?Xa._aabbMaxZ:za._aabbMaxZ;var Ma=qt._children[0]._height;var Ya=qt._children[1]._height;qt._height=(Ma>Ya?Ma:Ya)+1;var Za=At._children[0];var da=At._children[1];At._aabbMinX=Za._aabbMinX<da._aabbMinX?Za._aabbMinX:da._aabbMinX;At._aabbMinY=Za._aabbMinY<da._aabbMinY?Za._aabbMinY:da._aabbMinY;At._aabbMinZ=Za._aabbMinZ<da._aabbMinZ?Za._aabbMinZ:da._aabbMinZ;At._aabbMaxX=Za._aabbMaxX>da._aabbMaxX?Za._aabbMaxX:da._aabbMaxX;At._aabbMaxY=Za._aabbMaxY>da._aabbMaxY?Za._aabbMaxY:da._aabbMaxY;At._aabbMaxZ=Za._aabbMaxZ>da._aabbMaxZ?Za._aabbMaxZ:da._aabbMaxZ;var Ia=At._children[0]._height;var wa=At._children[1]._height;At._height=(Ia>wa?Ia:wa)+1}if(St!=null){St._children[Nt]=qt;qt._parent=St;qt._childIndex=Nt}else{Yt._root=qt;qt._parent=null}At=qt}else{At=At}}}var Va=At._children[0]._height;var La=At._children[1]._height;At._height=(Va>La?Va:La)+1;var Aa=At._children[0];var ka=At._children[1];At._aabbMinX=Aa._aabbMinX<ka._aabbMinX?Aa._aabbMinX:ka._aabbMinX;At._aabbMinY=Aa._aabbMinY<ka._aabbMinY?Aa._aabbMinY:ka._aabbMinY;At._aabbMinZ=Aa._aabbMinZ<ka._aabbMinZ?Aa._aabbMinZ:ka._aabbMinZ;At._aabbMaxX=Aa._aabbMaxX>ka._aabbMaxX?Aa._aabbMaxX:ka._aabbMaxX;At._aabbMaxY=Aa._aabbMaxY>ka._aabbMaxY?Aa._aabbMaxY:ka._aabbMaxY;At._aabbMaxZ=Aa._aabbMaxZ>ka._aabbMaxZ?Aa._aabbMaxZ:ka._aabbMaxZ;At=At._parent}}if(c){this.collide(this._tree._root,b._leaf)}b._moved=false}this.movedProxies[m]=null}if(!c){this.collide(this._tree._root,this._tree._root)}this.numMovedProxies=0},rayCast:function(t,a,i){if(this._tree._root==null){return}var r;var o;var s;var n;var e;var _;var v;var h;var l=t;o=l.x;s=l.y;n=l.z;var c=a;_=c.x;v=c.y;h=c.z;this.rayCastRecursive(this._tree._root,o,s,n,_,v,h,i)},convexCast:function(t,a,i,r){if(this._tree._root==null){return}this.convexCastRecursive(this._tree._root,t,a,i,r)},aabbTest:function(t,a){if(this._tree._root==null){return}this.aabbTestRecursive(this._tree._root,t,a)},getTreeBalance:function(){return this._tree._getBalance()}});var c=function(){};var Ba=function(){this._next=null;this._prevLeaf=null;this._nextLeaf=null;var t=new Array(2);this._children=t;this._childIndex=0;this._parent=null;this._height=0;this._proxy=null;this._aabbMinX=0;this._aabbMinY=0;this._aabbMinZ=0;this._aabbMaxX=0;this._aabbMaxY=0;this._aabbMaxZ=0};var Mt=function(t,a){e.call(this,t,a);this._leaf=null;this._moved=false};Mt.__super__=e;Mt.prototype=$extend(e.prototype,{});var p=function(){this._insertionStrategy=0;this._balancingEnabled=false};p.prototype={_decideInsertion:function(t,a){var i=this._insertionStrategy;switch(i){case 0:var r;var o;var s;var n;o=a._aabbMinX+a._aabbMaxX;s=a._aabbMinY+a._aabbMaxY;n=a._aabbMinZ+a._aabbMaxZ;var e=t._children[0];var _=t._children[1];var v;var h;var l;var c;var p;var f;var m;var b;h=e._aabbMinX+e._aabbMaxX;l=e._aabbMinY+e._aabbMaxY;c=e._aabbMinZ+e._aabbMaxZ;f=_._aabbMinX+_._aabbMaxX;m=_._aabbMinY+_._aabbMaxY;b=_._aabbMinZ+_._aabbMaxZ;h-=o;l-=s;c-=n;f-=o;m-=s;b-=n;var u=h*h+l*l+c*c;var x=f*f+m*m+b*b;if(u<x){return 0}else{return 1}break;case 1:var y=t._children[0];var g=t._children[1];var X=t._aabbMaxX-t._aabbMinX;var z=t._aabbMaxY-t._aabbMinY;var M=t._aabbMaxZ-t._aabbMinZ;var Y=(X*(z+M)+z*M)*2;var Z;var d;var I;var w;var V;var L;var A;var k;d=t._aabbMinX<a._aabbMinX?t._aabbMinX:a._aabbMinX;I=t._aabbMinY<a._aabbMinY?t._aabbMinY:a._aabbMinY;w=t._aabbMinZ<a._aabbMinZ?t._aabbMinZ:a._aabbMinZ;L=t._aabbMaxX>a._aabbMaxX?t._aabbMaxX:a._aabbMaxX;A=t._aabbMaxY>a._aabbMaxY?t._aabbMaxY:a._aabbMaxY;k=t._aabbMaxZ>a._aabbMaxZ?t._aabbMaxZ:a._aabbMaxZ;var B=L-d;var P=A-I;var T=k-w;var S=(B*(P+T)+P*T)*2;var C=S*2;var q=(S-Y)*2;var R=q;d=y._aabbMinX<a._aabbMinX?y._aabbMinX:a._aabbMinX;I=y._aabbMinY<a._aabbMinY?y._aabbMinY:a._aabbMinY;w=y._aabbMinZ<a._aabbMinZ?y._aabbMinZ:a._aabbMinZ;L=y._aabbMaxX>a._aabbMaxX?y._aabbMaxX:a._aabbMaxX;A=y._aabbMaxY>a._aabbMaxY?y._aabbMaxY:a._aabbMaxY;k=y._aabbMaxZ>a._aabbMaxZ?y._aabbMaxZ:a._aabbMaxZ;if(y._height==0){var E=L-d;var j=A-I;var N=k-w;R+=(E*(j+N)+j*N)*2}else{var D=L-d;var F=A-I;var O=k-w;var W=y._aabbMaxX-y._aabbMinX;var G=y._aabbMaxY-y._aabbMinY;var H=y._aabbMaxZ-y._aabbMinZ;R+=(D*(F+O)+F*O)*2-(W*(G+H)+G*H)*2}var U=q;d=g._aabbMinX<a._aabbMinX?g._aabbMinX:a._aabbMinX;I=g._aabbMinY<a._aabbMinY?g._aabbMinY:a._aabbMinY;w=g._aabbMinZ<a._aabbMinZ?g._aabbMinZ:a._aabbMinZ;L=g._aabbMaxX>a._aabbMaxX?g._aabbMaxX:a._aabbMaxX;A=g._aabbMaxY>a._aabbMaxY?g._aabbMaxY:a._aabbMaxY;k=g._aabbMaxZ>a._aabbMaxZ?g._aabbMaxZ:a._aabbMaxZ;if(g._height==0){var J=L-d;var Q=A-I;var $=k-w;U+=(J*(Q+$)+Q*$)*2}else{var K=L-d;var tt=A-I;var at=k-w;var it=g._aabbMaxX-g._aabbMinX;var rt=g._aabbMaxY-g._aabbMinY;var ot=g._aabbMaxZ-g._aabbMinZ;U+=(K*(tt+at)+tt*at)*2-(it*(rt+ot)+rt*ot)*2}if(C<R){if(C<U){return-1}else{return 1}}else if(R<U){return 0}else{return 1}break;default:console.log("BvhStrategy.hx:37:","invalid BVH insertion strategy: "+this._insertionStrategy);return-1}},_splitLeaves:function(t,a,i){var r=1/(i-a);var o;var s;var n;var e;s=0;n=0;e=0;var _=a;var v=i;while(_<v){var h=_++;var l=t[h];l._tmpX=l._aabbMaxX+l._aabbMinX;l._tmpY=l._aabbMaxY+l._aabbMinY;l._tmpZ=l._aabbMaxZ+l._aabbMinZ;s+=l._tmpX;n+=l._tmpY;e+=l._tmpZ}s*=r;n*=r;e*=r;var c;var p;var f;var m;p=0;f=0;m=0;var b=a;var u=i;while(b<u){var x=b++;var y=t[x];var g;var X;var z;var M;X=y._tmpX-s;z=y._tmpY-n;M=y._tmpZ-e;X*=X;z*=z;M*=M;p+=X;f+=z;m+=M}var Y=p;var Z=f;var d=m;var I=a;var w=i-1;if(Y>Z){if(Y>d){var V=s;while(true){while(true){var L=t[I];if(L._tmpX<=V){break}++I}while(true){var A=t[w];if(A._tmpX>=V){break}--w}if(I>=w){break}var k=t[I];t[I]=t[w];t[w]=k;++I;--w}}else{var B=e;while(true){while(true){var P=t[I];if(P._tmpZ<=B){break}++I}while(true){var T=t[w];if(T._tmpZ>=B){break}--w}if(I>=w){break}var S=t[I];t[I]=t[w];t[w]=S;++I;--w}}}else if(Z>d){var C=n;while(true){while(true){var q=t[I];if(q._tmpY<=C){break}++I}while(true){var R=t[w];if(R._tmpY>=C){break}--w}if(I>=w){break}var E=t[I];t[I]=t[w];t[w]=E;++I;--w}}else{var j=e;while(true){while(true){var N=t[I];if(N._tmpZ<=j){break}++I}while(true){var D=t[w];if(D._tmpZ>=j){break}--w}if(I>=w){break}var F=t[I];t[I]=t[w];t[w]=F;++I;--w}}return I}};var f=function(){this._root=null;this._numLeaves=0;this._strategy=new p;this._nodePool=null;this.leafList=null;this.leafListLast=null;var t=new Array(1024);this.tmp=t};f.prototype={_print:function(t,a){if(a==null){a=""}if(t==null){return}if(t._height==0){console.log("BvhTree.hx:39:",a+t._proxy._id)}else{this._print(t._children[0],a+"  ");var i;var r;var o;var s;var n;o=t._aabbMaxX-t._aabbMinX;s=t._aabbMaxY-t._aabbMinY;n=t._aabbMaxZ-t._aabbMinZ;var e=o;var _=s;var v=n;if(e*(_+v)+_*v>0){var h;var l;var c;var p;l=t._aabbMaxX-t._aabbMinX;c=t._aabbMaxY-t._aabbMinY;p=t._aabbMaxZ-t._aabbMinZ;var f=l;var m=c;var b=p;i=((f*(m+b)+m*b)*1e3+.5|0)/1e3}else{var u;var x;var y;var g;x=t._aabbMaxX-t._aabbMinX;y=t._aabbMaxY-t._aabbMinY;g=t._aabbMaxZ-t._aabbMinZ;var X=x;var z=y;var M=g;i=((X*(z+M)+z*M)*1e3-.5|0)/1e3}console.log("BvhTree.hx:42:",a+"#"+t._height+", "+i);this._print(t._children[1],a+"  ")}},_getBalance:function(){return this.getBalanceRecursive(this._root)},deleteRecursive:function(t){if(t._height==0){var a=t._prevLeaf;var i=t._nextLeaf;if(a!=null){a._nextLeaf=i}if(i!=null){i._prevLeaf=a}if(t==this.leafList){this.leafList=this.leafList._nextLeaf}if(t==this.leafListLast){this.leafListLast=this.leafListLast._prevLeaf}t._nextLeaf=null;t._prevLeaf=null;t._proxy._leaf=null;t._next=null;t._childIndex=0;t._children[0]=null;t._children[1]=null;t._childIndex=0;t._parent=null;t._height=0;t._proxy=null;t._next=this._nodePool;this._nodePool=t;return}this.deleteRecursive(t._children[0]);this.deleteRecursive(t._children[1]);t._next=null;t._childIndex=0;t._children[0]=null;t._children[1]=null;t._childIndex=0;t._parent=null;t._height=0;t._proxy=null;t._next=this._nodePool;this._nodePool=t},decomposeRecursive:function(t){if(t._height==0){t._childIndex=0;t._parent=null;return}this.decomposeRecursive(t._children[0]);this.decomposeRecursive(t._children[1]);t._next=null;t._childIndex=0;t._children[0]=null;t._children[1]=null;t._childIndex=0;t._parent=null;t._height=0;t._proxy=null;t._next=this._nodePool;this._nodePool=t},buildTopDownRecursive:function(t,a,i){var r=i-a;if(r==1){var o=t[a];var s=o._proxy;o._aabbMinX=s._aabbMinX;o._aabbMinY=s._aabbMinY;o._aabbMinZ=s._aabbMinZ;o._aabbMaxX=s._aabbMaxX;o._aabbMaxY=s._aabbMaxY;o._aabbMaxZ=s._aabbMaxZ;return o}var n=this._strategy._splitLeaves(t,a,i);var e=this.buildTopDownRecursive(t,a,n);var _=this.buildTopDownRecursive(t,n,i);var v=this._nodePool;if(v!=null){this._nodePool=v._next;v._next=null}else{v=new Ba}var h=v;h._children[0]=e;e._parent=h;e._childIndex=0;h._children[1]=_;_._parent=h;_._childIndex=1;var l=h._children[0];var c=h._children[1];h._aabbMinX=l._aabbMinX<c._aabbMinX?l._aabbMinX:c._aabbMinX;h._aabbMinY=l._aabbMinY<c._aabbMinY?l._aabbMinY:c._aabbMinY;h._aabbMinZ=l._aabbMinZ<c._aabbMinZ?l._aabbMinZ:c._aabbMinZ;h._aabbMaxX=l._aabbMaxX>c._aabbMaxX?l._aabbMaxX:c._aabbMaxX;h._aabbMaxY=l._aabbMaxY>c._aabbMaxY?l._aabbMaxY:c._aabbMaxY;h._aabbMaxZ=l._aabbMaxZ>c._aabbMaxZ?l._aabbMaxZ:c._aabbMaxZ;var p=h._children[0]._height;var f=h._children[1]._height;h._height=(p>f?p:f)+1;return h},getBalanceRecursive:function(t){if(t==null||t._height==0){return 0}var a=t._children[0]._height-t._children[1]._height;if(a<0){a=-a}return a+this.getBalanceRecursive(t._children[0])+this.getBalanceRecursive(t._children[1])}};var m=function(){this._minX=0;this._minY=0;this._minZ=0;this._maxX=0;this._maxY=0;this._maxZ=0};m.prototype={init:function(t,a){var i=t;this._minX=i.x;this._minY=i.y;this._minZ=i.z;var r=a;this._maxX=r.x;this._maxY=r.y;this._maxZ=r.z;return this},getMin:function(){var t=new Is;var a=t;a.x=this._minX;a.y=this._minY;a.z=this._minZ;return t},getMinTo:function(t){var a=t;a.x=this._minX;a.y=this._minY;a.z=this._minZ},setMin:function(t){var a=t;this._minX=a.x;this._minY=a.y;this._minZ=a.z;return this},getMax:function(){var t=new Is;var a=t;a.x=this._maxX;a.y=this._maxY;a.z=this._maxZ;return t},getMaxTo:function(t){var a=t;a.x=this._maxX;a.y=this._maxY;a.z=this._maxZ},setMax:function(t){var a=t;this._maxX=a.x;this._maxY=a.y;this._maxZ=a.z;return this},getCenter:function(){var t=new Is;var a;var i;var r;var o;i=this._minX+this._maxX;r=this._minY+this._maxY;o=this._minZ+this._maxZ;i*=.5;r*=.5;o*=.5;var s=t;s.x=i;s.y=r;s.z=o;return t},getCenterTo:function(t){var a;var i;var r;var o;i=this._minX+this._maxX;r=this._minY+this._maxY;o=this._minZ+this._maxZ;i*=.5;r*=.5;o*=.5;var s=t;s.x=i;s.y=r;s.z=o},getExtents:function(){var t=new Is;var a;var i;var r;var o;i=this._maxX-this._minX;r=this._maxY-this._minY;o=this._maxZ-this._minZ;i*=.5;r*=.5;o*=.5;var s=t;s.x=i;s.y=r;s.z=o;return t},getExtentsTo:function(t){var a;var i;var r;var o;i=this._maxX-this._minX;r=this._maxY-this._minY;o=this._maxZ-this._minZ;i*=.5;r*=.5;o*=.5;var s=t;s.x=i;s.y=r;s.z=o},combine:function(t){this._minX=this._minX<t._minX?this._minX:t._minX;this._minY=this._minY<t._minY?this._minY:t._minY;this._minZ=this._minZ<t._minZ?this._minZ:t._minZ;this._maxX=this._maxX>t._maxX?this._maxX:t._maxX;this._maxY=this._maxY>t._maxY?this._maxY:t._maxY;this._maxZ=this._maxZ>t._maxZ?this._maxZ:t._maxZ;return this},combined:function(t){var a=new m;a._minX=this._minX<t._minX?this._minX:t._minX;a._minY=this._minY<t._minY?this._minY:t._minY;a._minZ=this._minZ<t._minZ?this._minZ:t._minZ;a._maxX=this._maxX>t._maxX?this._maxX:t._maxX;a._maxY=this._maxY>t._maxY?this._maxY:t._maxY;a._maxZ=this._maxZ>t._maxZ?this._maxZ:t._maxZ;return a},overlap:function(t){if(this._minX<t._maxX&&this._maxX>t._minX&&this._minY<t._maxY&&this._maxY>t._minY&&this._minZ<t._maxZ){return this._maxZ>t._minZ}else{return false}},getIntersection:function(t){var a=new m;a._minX=this._minX>t._minX?this._minX:t._minX;a._minY=this._minY>t._minY?this._minY:t._minY;a._minZ=this._minZ>t._minZ?this._minZ:t._minZ;a._maxX=this._maxX<t._maxX?this._maxX:t._maxX;a._maxY=this._maxY<t._maxY?this._maxY:t._maxY;a._maxZ=this._maxZ<t._maxZ?this._maxZ:t._maxZ;return a},getIntersectionTo:function(t,a){a._minX=this._minX>t._minX?this._minX:t._minX;a._minY=this._minY>t._minY?this._minY:t._minY;a._minZ=this._minZ>t._minZ?this._minZ:t._minZ;a._maxX=this._maxX<t._maxX?this._maxX:t._maxX;a._maxY=this._maxY<t._maxY?this._maxY:t._maxY;a._maxZ=this._maxZ<t._maxZ?this._maxZ:t._maxZ},copyFrom:function(t){this._minX=t._minX;this._minY=t._minY;this._minZ=t._minZ;this._maxX=t._maxX;this._maxY=t._maxY;this._maxZ=t._maxZ;return this},clone:function(){var t=new m;t._minX=this._minX;t._minY=this._minY;t._minZ=this._minZ;t._maxX=this._maxX;t._maxY=this._maxY;t._maxZ=this._maxZ;return t}};var b=function(t){_.call(this,1);var a=t;this._halfExtentsX=a.x;this._halfExtentsY=a.y;this._halfExtentsZ=a.z;this._halfAxisXX=t.x;this._halfAxisXY=0;this._halfAxisXZ=0;this._halfAxisYX=0;this._halfAxisYY=t.y;this._halfAxisYZ=0;this._halfAxisZX=0;this._halfAxisZY=0;this._halfAxisZZ=t.z;this._updateMass();var i=t.x<t.y?t.z<t.x?t.z:t.x:t.z<t.y?t.z:t.y;if(this._gjkMargin>i*.2){this._gjkMargin=i*.2}};b.__super__=_;b.prototype=$extend(_.prototype,{getHalfExtents:function(){var t=new Is;var a=t;a.x=this._halfExtentsX;a.y=this._halfExtentsY;a.z=this._halfExtentsZ;return t},getHalfExtentsTo:function(t){var a=t;a.x=this._halfExtentsX;a.y=this._halfExtentsY;a.z=this._halfExtentsZ},_updateMass:function(){this._volume=8*(this._halfExtentsX*this._halfExtentsY*this._halfExtentsZ);var t;var a;var i;var r;a=this._halfExtentsX*this._halfExtentsX;i=this._halfExtentsY*this._halfExtentsY;r=this._halfExtentsZ*this._halfExtentsZ;this._inertiaCoeff00=.3333333333333333*(i+r);this._inertiaCoeff01=0;this._inertiaCoeff02=0;this._inertiaCoeff10=0;this._inertiaCoeff11=.3333333333333333*(r+a);this._inertiaCoeff12=0;this._inertiaCoeff20=0;this._inertiaCoeff21=0;this._inertiaCoeff22=.3333333333333333*(a+i)},_computeAabb:function(t,a){var i;var r;var o;var s;var n;var e;var _;var v;var h;var l;var c;var p;var f;var m;var b;f=a._rotation00*this._halfAxisXX+a._rotation01*this._halfAxisXY+a._rotation02*this._halfAxisXZ;m=a._rotation10*this._halfAxisXX+a._rotation11*this._halfAxisXY+a._rotation12*this._halfAxisXZ;b=a._rotation20*this._halfAxisXX+a._rotation21*this._halfAxisXY+a._rotation22*this._halfAxisXZ;r=f;o=m;s=b;var u;var x;var y;u=a._rotation00*this._halfAxisYX+a._rotation01*this._halfAxisYY+a._rotation02*this._halfAxisYZ;x=a._rotation10*this._halfAxisYX+a._rotation11*this._halfAxisYY+a._rotation12*this._halfAxisYZ;y=a._rotation20*this._halfAxisYX+a._rotation21*this._halfAxisYY+a._rotation22*this._halfAxisYZ;e=u;_=x;v=y;var g;var X;var z;g=a._rotation00*this._halfAxisZX+a._rotation01*this._halfAxisZY+a._rotation02*this._halfAxisZZ;X=a._rotation10*this._halfAxisZX+a._rotation11*this._halfAxisZY+a._rotation12*this._halfAxisZZ;z=a._rotation20*this._halfAxisZX+a._rotation21*this._halfAxisZY+a._rotation22*this._halfAxisZZ;l=g;c=X;p=z;r=r<0?-r:r;o=o<0?-o:o;s=s<0?-s:s;e=e<0?-e:e;_=_<0?-_:_;v=v<0?-v:v;l=l<0?-l:l;c=c<0?-c:c;p=p<0?-p:p;var M;var Y;var Z;var d;Y=r+e;Z=o+_;d=s+v;Y+=l;Z+=c;d+=p;t._minX=a._positionX-Y;t._minY=a._positionY-Z;t._minZ=a._positionZ-d;t._maxX=a._positionX+Y;t._maxY=a._positionY+Z;t._maxZ=a._positionZ+d},computeLocalSupportingVertex:function(t,a){var i;var r;var o;var s;var n;var e;var _;var v;r=this._gjkMargin;o=this._gjkMargin;s=this._gjkMargin;r=r<this._halfExtentsX?r:this._halfExtentsX;o=o<this._halfExtentsY?o:this._halfExtentsY;s=s<this._halfExtentsZ?s:this._halfExtentsZ;e=this._halfExtentsX-r;_=this._halfExtentsY-o;v=this._halfExtentsZ-s;a.x=t.x>0?e:-e;a.y=t.y>0?_:-_;a.z=t.z>0?v:-v},_rayCastLocal:function(t,a,i,r,o,s,n){var e=t;var _=a;var v=i;var h=r;var l=o;var c=s;var p=this._halfExtentsX;var f=this._halfExtentsY;var m=this._halfExtentsZ;var b=h-e;var u=l-_;var x=c-v;var y=0;var g=0;var X=0;var z=1;var M=1;var Y=1;if(b>-1e-6&&b<1e-6){if(e<=-p||e>=p){return false}}else{var Z=1/b;var d=(-p-e)*Z;var I=(p-e)*Z;if(d>I){var w=d;d=I;I=w}if(d>0){y=d}if(I<1){z=I}}if(u>-1e-6&&u<1e-6){if(_<=-f||_>=f){return false}}else{var V=1/u;var L=(-f-_)*V;var A=(f-_)*V;if(L>A){var k=L;L=A;A=k}if(L>0){g=L}if(A<1){M=A}}if(x>-1e-6&&x<1e-6){if(v<=-m||v>=m){return false}}else{var B=1/x;var P=(-m-v)*B;var T=(m-v)*B;if(P>T){var S=P;P=T;T=S}if(P>0){X=P}if(T<1){Y=T}}if(y>=1||g>=1||X>=1||z<=0||M<=0||Y<=0){return false}var C=y;var q=z;var R=0;if(g>C){C=g;R=1}if(X>C){C=X;R=2}if(M<q){q=M}if(Y<q){q=Y}if(C>q){return false}if(C==0){return false}switch(R){case 0:n.normal.init(b>0?-1:1,0,0);break;case 1:n.normal.init(0,u>0?-1:1,0);break;case 2:n.normal.init(0,0,x>0?-1:1);break}n.position.init(e+C*b,_+C*u,v+C*x);n.fraction=C;return true}});var u=function(t,a){_.call(this,4);this._radius=t;this._halfHeight=a;this._gjkMargin=this._radius;this._updateMass()};u.__super__=_;u.prototype=$extend(_.prototype,{getRadius:function(){return this._radius},getHalfHeight:function(){return this._halfHeight},_updateMass:function(){var t=this._radius*this._radius;var a=this._halfHeight*this._halfHeight;var i=6.28318530717958*t*this._halfHeight;var r=3.14159265358979*t*this._radius*4/3;this._volume=i+r;var o=this._volume==0?0:1/this._volume;var s=o*(i*t*.5+r*t*.4);var n=o*(i*(t*.25+a/3)+r*(t*.4+this._halfHeight*this._radius*.75+a));this._inertiaCoeff00=n;this._inertiaCoeff01=0;this._inertiaCoeff02=0;this._inertiaCoeff10=0;this._inertiaCoeff11=s;this._inertiaCoeff12=0;this._inertiaCoeff20=0;this._inertiaCoeff21=0;this._inertiaCoeff22=n},_computeAabb:function(t,a){var i;var r;var o;var s;r=this._radius;o=this._radius;s=this._radius;var n;var e;var _;var v;e=a._rotation01;_=a._rotation11;v=a._rotation21;e=e<0?-e:e;_=_<0?-_:_;v=v<0?-v:v;e*=this._halfHeight;_*=this._halfHeight;v*=this._halfHeight;r+=e;o+=_;s+=v;t._minX=a._positionX-r;t._minY=a._positionY-o;t._minZ=a._positionZ-s;t._maxX=a._positionX+r;t._maxY=a._positionY+o;t._maxZ=a._positionZ+s},computeLocalSupportingVertex:function(t,a){if(t.y>0){a.init(0,this._halfHeight,0)}else{a.init(0,-this._halfHeight,0)}},_rayCastLocal:function(t,a,i,r,o,s,n){var e=t;var _=a;var v=i;var h=r;var l=o;var c=s;var p=this._halfHeight;var f=h-e;var m=l-_;var b=c-v;var u=0;var x=1;var y=f*f+b*b;var g=e*f+v*b;var X=e*e+v*v-this._radius*this._radius;var z=g*g-y*X;if(z<0){return false}var M;if(y>0){var Y=Math.sqrt(z);u=(-g-Y)/y;x=(-g+Y)/y;if(u>=1||x<=0){return false}}else{if(X>=0){return false}u=0;x=1}var Z=_+m*u;var d;if(Z>-p&&Z<p){if(u>0){d=u;var I=n.normal.init(e+f*d,0,v+b*d);var w=Math.sqrt(I.x*I.x+I.y*I.y+I.z*I.z);if(w>0){w=1/w}var V=I.x*w;var L=I.y*w;var A=I.z*w;I.x=V;I.y=L;I.z=A;n.position.init(e+d*f,Z,v+d*b);n.fraction=d;return true}return false}var k=Z<0?-p:p;var B;var P;var T;var S;var C;var q;var R;var E;P=0;T=k;S=0;q=t-P;R=a-T;E=i-S;var j;var N;var D;var F;N=r-t;D=o-a;F=s-i;y=N*N+D*D+F*F;g=q*N+R*D+E*F;X=q*q+R*R+E*E-this._radius*this._radius;z=g*g-y*X;if(z<0){return false}var O=(-g-Math.sqrt(z))/y;if(O<0||O>1){return false}var W;var G;var H;var U;var J;var Q;var $;var K;G=q+N*O;H=R+D*O;U=E+F*O;var tt=G*G+H*H+U*U;if(tt>0){tt=1/Math.sqrt(tt)}Q=G*tt;$=H*tt;K=U*tt;G+=P;H+=T;U+=S;var at=n.position;at.x=G;at.y=H;at.z=U;var it=n.normal;it.x=Q;it.y=$;it.z=K;n.fraction=O;return true}});var x=function(t,a){_.call(this,3);this._radius=t;this._halfHeight=a;this.sinTheta=t/Math.sqrt(t*t+4*a*a);this.cosTheta=2*a/Math.sqrt(t*t+4*a*a);this._updateMass()};x.__super__=_;x.prototype=$extend(_.prototype,{getRadius:function(){return this._radius},getHalfHeight:function(){return this._halfHeight},_updateMass:function(){var t=this._radius*this._radius;var a=this._halfHeight*this._halfHeight*4;this._volume=3.14159265358979*t*this._halfHeight*2/3;this._inertiaCoeff00=.05*(3*t+2*a);this._inertiaCoeff01=0;this._inertiaCoeff02=0;this._inertiaCoeff10=0;this._inertiaCoeff11=.3*t;this._inertiaCoeff12=0;this._inertiaCoeff20=0;this._inertiaCoeff21=0;this._inertiaCoeff22=.08333333333333333*(3*t+2*a)},_computeAabb:function(t,a){var i;var r;var o;var s;var n;var e;var _;var v;var h;var l;var c;var p;var f;var m;var b;var u;r=a._rotation01;o=a._rotation11;s=a._rotation21;e=r*r;_=o*o;v=s*s;var x=e;var y=_;var g=v;m=Math.sqrt(1-x);b=Math.sqrt(1-y);u=Math.sqrt(1-g);m*=this._radius;b*=this._radius;u*=this._radius;l=r*this._halfHeight;c=o*this._halfHeight;p=s*this._halfHeight;var X;var z;var M;var Y;var Z;var d;var I;var w;z=-l;M=-c;Y=-p;z-=m;M-=b;Y-=u;d=-l;I=-c;w=-p;d+=m;I+=b;w+=u;var V;var L;var A;var k;var B;var P;var T;var S;L=z>d?z:d;A=M>I?M:I;k=Y>w?Y:w;L=L>l?L:l;A=A>c?A:c;k=k>p?k:p;P=z<d?z:d;T=M<I?M:I;S=Y<w?Y:w;P=P<l?P:l;T=T<c?T:c;S=S<p?S:p;t._minX=a._positionX+P;t._minY=a._positionY+T;t._minZ=a._positionZ+S;t._maxX=a._positionX+L;t._maxY=a._positionY+A;t._maxZ=a._positionZ+k},computeLocalSupportingVertex:function(t,a){var i=t.x;var r=t.y;var o=t.z;if(r>0&&r*r>this.sinTheta*this.sinTheta*(i*i+r*r+o*o)){a.init(0,this._halfHeight-this._gjkMargin/this.sinTheta,0);if(a.y<0){a.y=0}return}var s=t.x;var n=t.z;var e=s*s+n*n;var _=2*this._halfHeight;var v=(_-this._gjkMargin)/_*this._radius-this._gjkMargin/this.cosTheta;if(v<0){v=0}var h=e>0?v/Math.sqrt(e):0;var l=this._halfHeight-this._gjkMargin;if(l<0){l=0}a.x=s*h;a.y=-l;a.z=n*h},_rayCastLocal:function(t,a,i,r,o,s,n){var e=t;var _=a;var v=i;var h=r;var l=o;var c=s;var p=this._halfHeight;var f=h-e;var m=l-_;var b=c-v;var u=0;var x=1;if(m>-1e-6&&m<1e-6){if(_<=-p||_>=p){return false}}else{var y=1/m;var g=(-p-_)*y;var X=(p-_)*y;if(g>X){var z=g;g=X;X=z}if(g>0){u=g}if(X<1){x=X}}if(u>=1||x<=0){return false}var M=0;var Y=0;_-=p;var Z=this.cosTheta*this.cosTheta;var d=Z*(f*f+m*m+b*b)-m*m;var I=Z*(e*f+_*m+v*b)-_*m;var w=Z*(e*e+_*_+v*v)-_*_;var V=I*I-d*w;if(d!=0){if(V<0){return false}var L=Math.sqrt(V);if(d<0){if(m>0){M=0;Y=(-I+L)/d;if(Y<=0){return false}}else{M=(-I-L)/d;Y=1;if(M>=1){return false}}}else{M=(-I-L)/d;Y=(-I+L)/d;if(M>=1||Y<=0){return false}}}else{var A=-w/(2*I);if(I>0){M=0;Y=A;if(A<=0){return false}}else{M=A;Y=1;if(A>=1){return false}}}_+=p;var k;if(Y<=u||x<=M){return false}if(M<u){k=u;if(k==0){return false}n.normal.init(0,m>0?-1:1,0)}else{k=M;if(k==0){return false}var B=n.normal.init(e+f*k,0,v+b*k);var P=Math.sqrt(B.x*B.x+B.y*B.y+B.z*B.z);if(P>0){P=1/P}var T=B.x*P;var S=B.y*P;var C=B.z*P;B.x=T;B.y=S;B.z=C;var q=B;var R=this.cosTheta;var E=q.x*R;var j=q.y*R;var N=q.z*R;q.x=E;q.y=j;q.z=N;n.normal.y+=this.sinTheta}n.position.init(e+k*f,_+k*m,v+k*b);n.fraction=k;return true}});var y=function(t){_.call(this,5);this._numVertices=t.length;var a=this._numVertices;var i=new Array(a);this._vertices=i;var r=this._numVertices;var o=new Array(r);this._tmpVertices=o;var s=0;var n=this._numVertices;while(s<n){var e=s++;this._vertices[e]=t[e];this._tmpVertices[e]=new Is}this._useGjkRayCast=true;this._updateMass()};y.__super__=_;y.prototype=$extend(_.prototype,{getVertices:function(){return this._vertices},_updateMass:function(){this._volume=1;this._inertiaCoeff00=1;this._inertiaCoeff01=0;this._inertiaCoeff02=0;this._inertiaCoeff10=0;this._inertiaCoeff11=1;this._inertiaCoeff12=0;this._inertiaCoeff20=0;this._inertiaCoeff21=0;this._inertiaCoeff22=1;var t=this._vertices[0].x;var a=this._vertices[0].y;var i=this._vertices[0].z;var r=this._vertices[0].x;var o=this._vertices[0].y;var s=this._vertices[0].z;var n=1;var e=this._numVertices;while(n<e){var _=n++;var v=this._vertices[_].x;var h=this._vertices[_].y;var l=this._vertices[_].z;if(v<t){t=v}else if(v>r){r=v}if(h<a){a=h}else if(h>o){o=h}if(l<i){i=l}else if(l>s){s=l}}var c=r-t;var p=o-a;var f=s-i;this._volume=c*p*f;var m=((t+r)*(t+r)+(a+o)*(a+o)+(i+s)*(i+s))*.25;c=c*c*.25;p=p*p*.25;f=f*f*.25;this._inertiaCoeff00=.3333333333333333*(p+f)+m;this._inertiaCoeff01=0;this._inertiaCoeff02=0;this._inertiaCoeff10=0;this._inertiaCoeff11=.3333333333333333*(f+c)+m;this._inertiaCoeff12=0;this._inertiaCoeff20=0;this._inertiaCoeff21=0;this._inertiaCoeff22=.3333333333333333*(c+p)+m},_computeAabb:function(t,a){var i;var r;var o;var s;var n;var e;var _;var v;var h;var l;var c;var p;l=this._gjkMargin;c=this._gjkMargin;p=this._gjkMargin;var f;var m;var b;var u;var x=this._vertices[0];m=x.x;b=x.y;u=x.z;var y;var g;var X;var z;var M;var Y;var Z;M=a._rotation00*m+a._rotation01*b+a._rotation02*u;Y=a._rotation10*m+a._rotation11*b+a._rotation12*u;Z=a._rotation20*m+a._rotation21*b+a._rotation22*u;g=M;X=Y;z=Z;g+=a._positionX;X+=a._positionY;z+=a._positionZ;r=g;o=X;s=z;e=g;_=X;v=z;var d=1;var I=this._numVertices;while(d<I){var w=d++;var V=this._vertices[w];m=V.x;b=V.y;u=V.z;var L;var A;var k;L=a._rotation00*m+a._rotation01*b+a._rotation02*u;A=a._rotation10*m+a._rotation11*b+a._rotation12*u;k=a._rotation20*m+a._rotation21*b+a._rotation22*u;g=L;X=A;z=k;g+=a._positionX;X+=a._positionY;z+=a._positionZ;r=r<g?r:g;o=o<X?o:X;s=s<z?s:z;e=e>g?e:g;_=_>X?_:X;v=v>z?v:z}t._minX=r-l;t._minY=o-c;t._minZ=s-p;t._maxX=e+l;t._maxY=_+c;t._maxZ=v+p},computeLocalSupportingVertex:function(t,a){var i=this._vertices[0];var r=i.x*t.x+i.y*t.y+i.z*t.z;var o=0;var s=1;var n=this._numVertices;while(s<n){var e=s++;var _=this._vertices[e];var v=_.x*t.x+_.y*t.y+_.z*t.z;if(v>r){r=v;o=e}}var h=this._vertices[o];a.x=h.x;a.y=h.y;a.z=h.z}});var g=function(t,a){_.call(this,2);this._radius=t;this._halfHeight=a;this._updateMass()};g.__super__=_;g.prototype=$extend(_.prototype,{getRadius:function(){return this._radius},getHalfHeight:function(){return this._halfHeight},_updateMass:function(){var t=this._radius*this._radius;var a=this._halfHeight*this._halfHeight*4;this._volume=3.14159265358979*t*this._halfHeight*2;this._inertiaCoeff00=.08333333333333333*(3*t+a);this._inertiaCoeff01=0;this._inertiaCoeff02=0;this._inertiaCoeff10=0;this._inertiaCoeff11=.5*t;this._inertiaCoeff12=0;this._inertiaCoeff20=0;this._inertiaCoeff21=0;this._inertiaCoeff22=.08333333333333333*(3*t+a)},_computeAabb:function(t,a){var i;var r;var o;var s;var n;var e;var _;var v;var h;var l;var c;var p;var f;var m;var b;var u;r=a._rotation01;o=a._rotation11;s=a._rotation21;r=r<0?-r:r;o=o<0?-o:o;s=s<0?-s:s;e=r*r;_=o*o;v=s*s;var x=e;var y=_;var g=v;m=Math.sqrt(1-x);b=Math.sqrt(1-y);u=Math.sqrt(1-g);m*=this._radius;b*=this._radius;u*=this._radius;l=r*this._halfHeight;c=o*this._halfHeight;p=s*this._halfHeight;var X;var z;var M;var Y;z=m+l;M=b+c;Y=u+p;t._minX=a._positionX-z;t._minY=a._positionY-M;t._minZ=a._positionZ-Y;t._maxX=a._positionX+z;t._maxY=a._positionY+M;t._maxZ=a._positionZ+Y},computeLocalSupportingVertex:function(t,a){var i=t.x;var r=t.z;var o=i*i+r*r;var s=this._radius-this._gjkMargin;if(s<0){s=0}var n=o>0?s/Math.sqrt(o):0;var e=this._halfHeight-this._gjkMargin;if(e<0){e=0}a.x=i*n;a.y=t.y>0?e:-e;a.z=r*n},_rayCastLocal:function(t,a,i,r,o,s,n){var e=t;var _=a;var v=i;var h=r;var l=o;var c=s;var p=this._halfHeight;var f=h-e;var m=l-_;var b=c-v;var u=0;var x=1;if(m>-1e-6&&m<1e-6){if(_<=-p||_>=p){return false}}else{var y=1/m;var g=(-p-_)*y;var X=(p-_)*y;if(g>X){var z=g;g=X;X=z}if(g>0){u=g}if(X<1){x=X}}if(u>=1||x<=0){return false}var M=0;var Y=1;var Z=f*f+b*b;var d=e*f+v*b;var I=e*e+v*v-this._radius*this._radius;var w=d*d-Z*I;if(w<0){return false}var V;if(Z>0){var L=Math.sqrt(w);M=(-d-L)/Z;Y=(-d+L)/Z;if(M>=1||Y<=0){return false}}else{if(I>=0){return false}M=0;Y=1}var A;if(Y<=u||x<=M){return false}if(M<u){A=u;if(A==0){return false}n.normal.init(0,m>0?-1:1,0)}else{A=M;if(A==0){return false}var k=n.normal.init(e+f*A,0,v+b*A);var B=Math.sqrt(k.x*k.x+k.y*k.y+k.z*k.z);if(B>0){B=1/B}var P=k.x*B;var T=k.y*B;var S=k.z*B;k.x=P;k.y=T;k.z=S}n.position.init(e+A*f,_+A*m,v+A*b);n.fraction=A;return true}});var X=function(){};var z=function(){this.position=new Is;this.normal=new Is;this.fraction=0};var M=function(t){_.call(this,0);this._radius=t;this._gjkMargin=this._radius;this._updateMass()};M.__super__=_;M.prototype=$extend(_.prototype,{getRadius:function(){return this._radius},_updateMass:function(){this._volume=4.188790204786386*this._radius*this._radius*this._radius;this._inertiaCoeff00=.4*this._radius*this._radius;this._inertiaCoeff01=0;this._inertiaCoeff02=0;this._inertiaCoeff10=0;this._inertiaCoeff11=.4*this._radius*this._radius;this._inertiaCoeff12=0;this._inertiaCoeff20=0;this._inertiaCoeff21=0;this._inertiaCoeff22=.4*this._radius*this._radius},_computeAabb:function(t,a){var i;var r;var o;var s;r=this._radius;o=this._radius;s=this._radius;t._minX=a._positionX-r;t._minY=a._positionY-o;t._minZ=a._positionZ-s;t._maxX=a._positionX+r;t._maxY=a._positionY+o;t._maxZ=a._positionZ+s},computeLocalSupportingVertex:function(t,a){a.zero()},_rayCastLocal:function(t,a,i,r,o,s,n){var e;var _;var v;var h;_=r-t;v=o-a;h=s-i;var l=_*_+v*v+h*h;var c=t*_+a*v+i*h;var p=t*t+a*a+i*i-this._radius*this._radius;var f=c*c-l*p;if(f<0){return false}var m=(-c-Math.sqrt(f))/l;if(m<0||m>1){return false}var b;var u;var x;var y;var g;var X;var z;var M;u=t+_*m;x=a+v*m;y=i+h*m;var Y=u*u+x*x+y*y;if(Y>0){Y=1/Math.sqrt(Y)}X=u*Y;z=x*Y;M=y*Y;var Z=n.position;Z.x=u;Z.y=x;Z.z=y;var d=n.normal;d.x=X;d.y=z;d.z=M;n.fraction=m;return true}});var Y=function(){var t=new Array(8);this.detectors=t;var a=0;while(a<6){var i=a++;var r=this.detectors;var o=new Array(8);r[i]=o}var s=new P;var n=0;var e=1;var _=2;var v=3;var h=4;var l=5;this.detectors[n][n]=new C;this.detectors[n][e]=new T(false);this.detectors[n][_]=s;this.detectors[n][v]=s;this.detectors[n][h]=new S(false);this.detectors[n][l]=s;this.detectors[e][n]=new T(true);this.detectors[e][e]=new w;this.detectors[e][_]=s;this.detectors[e][v]=s;this.detectors[e][h]=s;this.detectors[e][l]=s;this.detectors[_][n]=s;this.detectors[_][e]=s;this.detectors[_][_]=s;this.detectors[_][v]=s;this.detectors[_][h]=s;this.detectors[_][l]=s;this.detectors[v][n]=s;this.detectors[v][e]=s;this.detectors[v][_]=s;this.detectors[v][v]=s;this.detectors[v][h]=s;this.detectors[v][l]=s;this.detectors[h][n]=new S(true);this.detectors[h][e]=s;this.detectors[h][_]=s;this.detectors[h][v]=s;this.detectors[h][h]=new B;this.detectors[h][l]=s;this.detectors[l][n]=s;this.detectors[l][e]=s;this.detectors[l][_]=s;this.detectors[l][v]=s;this.detectors[l][h]=s;this.detectors[l][l]=s};Y.prototype={getDetector:function(t,a){return this.detectors[t][a]}};var Z=function(){this.numPoints=0;this.normal=new Is;var t=ys.maxManifoldPoints;var a=new Array(t);this.points=a;this.incremental=false;var i=0;var r=ys.maxManifoldPoints;while(i<r){var o=i++;this.points[o]=new d}};Z.prototype={getMaxDepth:function(){var t=0;var a=0;var i=this.numPoints;while(a<i){var r=a++;if(this.points[r].depth>t){t=this.points[r].depth}}return t},clear:function(){this.numPoints=0;var t=0;var a=this.points;while(t<a.length){var i=a[t];++t;i.position1.zero();i.position2.zero();i.depth=0;i.id=0}this.normal.zero()}};var d=function(){this.position1=new Is;this.position2=new Is;this.depth=0;this.id=0};var I=function(t){this.swapped=t};I.prototype={setNormal:function(t,a,i,r){var o=t.normal;o.x=a;o.y=i;o.z=r;if(this.swapped){var s=t.normal;var n=-s.x;var e=-s.y;var _=-s.z;s.x=n;s.y=e;s.z=_}},addPoint:function(t,a,i,r,o,s,n,e,_){var v=t.points[t.numPoints++];v.depth=e;v.id=_;if(this.swapped){var h=v.position1;h.x=o;h.y=s;h.z=n;var l=v.position2;l.x=a;l.y=i;l.z=r}else{var c=v.position1;c.x=a;c.y=i;c.z=r;var p=v.position2;p.x=o;p.y=s;p.z=n}},detectImpl:function(t,a,i,r,o,s){},detect:function(t,a,i,r,o,s){t.numPoints=0;var n=0;var e=t.points;while(n<e.length){var _=e[n];++n;_.position1.zero();_.position2.zero();_.depth=0;_.id=0}t.normal.zero();if(this.swapped){this.detectImpl(t,i,a,o,r,s)}else{this.detectImpl(t,a,i,r,o,s)}}};var w=function(){I.call(this,false);this.clipper=new L};w.__super__=I;w.prototype=$extend(I.prototype,{detectImpl:function(t,a,i,r,o,s){var n=a;var e=i;t.incremental=false;var _;var v;var h;var l;var c;var p;var f;var m;var b;var u;var x;var y;v=r._positionX;h=r._positionY;l=r._positionZ;p=o._positionX;f=o._positionY;m=o._positionZ;u=p-v;x=f-h;y=m-l;var g;var X;var z;var M;var Y;var Z;var d;var I;var w;var V;var L;var A;var k;var B;var P;var T;var S;var C;var q;var R;var E;var j;var N;var D;X=r._rotation00;z=r._rotation10;M=r._rotation20;Z=r._rotation01;d=r._rotation11;I=r._rotation21;V=r._rotation02;L=r._rotation12;A=r._rotation22;B=o._rotation00;P=o._rotation10;T=o._rotation20;C=o._rotation01;q=o._rotation11;R=o._rotation21;j=o._rotation02;N=o._rotation12;D=o._rotation22;var F=n._halfExtentsX;var O=n._halfExtentsY;var W=n._halfExtentsZ;var G=e._halfExtentsX;var H=e._halfExtentsY;var U=e._halfExtentsZ;var J;var Q;var $;var K;var tt;var at;var it;var rt;var ot;var st;var nt;var et;var _t;var vt;var ht;var lt;var ct;var pt;var ft;var mt;var bt;var ut;var xt;var yt;Q=X*F;$=z*F;K=M*F;at=Z*O;it=d*O;rt=I*O;st=V*W;nt=L*W;et=A*W;vt=B*G;ht=P*G;lt=T*G;pt=C*H;ft=q*H;mt=R*H;ut=j*U;xt=N*U;yt=D*U;var gt;var Xt;var zt=1/0;var Mt=-1;var Yt=0;var Zt;var dt;var It;var wt;dt=0;It=0;wt=0;var Vt=F;var Lt=X*vt+z*ht+M*lt;var At=X*pt+z*ft+M*mt;var kt=X*ut+z*xt+M*yt;if(Lt<0){Lt=-Lt}if(At<0){At=-At}if(kt<0){kt=-kt}var Bt=Lt+At+kt;var Pt=X*u+z*x+M*y;var Tt=Vt+Bt;var St=Pt<0;var Ct=St?-Pt:Pt;if(Ct<Tt){var qt=Tt-Ct;if(qt<zt){zt=qt;Mt=0;dt=X;It=z;wt=M;Yt=St?-1:1}}else{return}Vt=O;var Rt=Z*vt+d*ht+I*lt;var Et=Z*pt+d*ft+I*mt;var jt=Z*ut+d*xt+I*yt;if(Rt<0){Rt=-Rt}if(Et<0){Et=-Et}if(jt<0){jt=-jt}Bt=Rt+Et+jt;Pt=Z*u+d*x+I*y;var Nt=Vt+Bt;var Dt=Pt<0;var Ft=Dt?-Pt:Pt;if(Ft<Nt){var Ot=Nt-Ft;if(Ot<zt){zt=Ot;Mt=1;dt=Z;It=d;wt=I;Yt=Dt?-1:1}}else{return}Vt=W;var Wt=V*vt+L*ht+A*lt;var Gt=V*pt+L*ft+A*mt;var Ht=V*ut+L*xt+A*yt;if(Wt<0){Wt=-Wt}if(Gt<0){Gt=-Gt}if(Ht<0){Ht=-Ht}Bt=Wt+Gt+Ht;Pt=V*u+L*x+A*y;var Ut=Vt+Bt;var Jt=Pt<0;var Qt=Jt?-Pt:Pt;if(Qt<Ut){var $t=Ut-Qt;if($t<zt){zt=$t;Mt=2;dt=V;It=L;wt=A;Yt=Jt?-1:1}}else{return}if(zt>ys.linearSlop){zt-=ys.linearSlop}else{zt=0}var Kt=B*Q+P*$+T*K;var ta=B*at+P*it+T*rt;var aa=B*st+P*nt+T*et;if(Kt<0){Kt=-Kt}if(ta<0){ta=-ta}if(aa<0){aa=-aa}Vt=Kt+ta+aa;Bt=G;Pt=B*u+P*x+T*y;var ia=Vt+Bt;var ra=Pt<0;var oa=ra?-Pt:Pt;if(oa<ia){var sa=ia-oa;if(sa<zt){zt=sa;Mt=3;dt=B;It=P;wt=T;Yt=ra?-1:1}}else{return}var na=C*Q+q*$+R*K;var ea=C*at+q*it+R*rt;var _a=C*st+q*nt+R*et;if(na<0){na=-na}if(ea<0){ea=-ea}if(_a<0){_a=-_a}Vt=na+ea+_a;Bt=H;Pt=C*u+q*x+R*y;var va=Vt+Bt;var ha=Pt<0;var la=ha?-Pt:Pt;if(la<va){var ca=va-la;if(ca<zt){zt=ca;Mt=4;dt=C;It=q;wt=R;Yt=ha?-1:1}}else{return}var pa=j*Q+N*$+D*K;var fa=j*at+N*it+D*rt;var ma=j*st+N*nt+D*et;if(pa<0){pa=-pa}if(fa<0){fa=-fa}if(ma<0){ma=-ma}Vt=pa+fa+ma;Bt=U;Pt=j*u+N*x+D*y;var ba=Vt+Bt;var ua=Pt<0;var xa=ua?-Pt:Pt;if(xa<ba){var ya=ba-xa;if(ya<zt){zt=ya;Mt=5;dt=j;It=N;wt=D;Yt=ua?-1:1}}else{return}if(zt>ys.linearSlop){zt-=ys.linearSlop}else{zt=0}var ga;var Xa;var za;var Ma;Xa=z*T-M*P;za=M*B-X*T;Ma=X*P-z*B;if(!(Xa==0&&za==0&&Ma==0)){var Ya=Xa*Xa+za*za+Ma*Ma;if(Ya>0){Ya=1/Math.sqrt(Ya)}Xa*=Ya;za*=Ya;Ma*=Ya;var Za=Xa*at+za*it+Ma*rt;var da=Xa*st+za*nt+Ma*et;if(Za<0){Za=-Za}if(da<0){da=-da}Vt=Za+da;var Ia=Xa*pt+za*ft+Ma*mt;var wa=Xa*ut+za*xt+Ma*yt;if(Ia<0){Ia=-Ia}if(wa<0){wa=-wa}Bt=Ia+wa;Pt=Xa*u+za*x+Ma*y;var Va=Vt+Bt;var La=Pt<0;var Aa=La?-Pt:Pt;if(Aa<Va){var ka=Va-Aa;if(ka<zt){zt=ka;Mt=6;dt=Xa;It=za;wt=Ma;Yt=La?-1:1}}else{return}}Xa=z*R-M*q;za=M*C-X*R;Ma=X*q-z*C;if(!(Xa==0&&za==0&&Ma==0)){var Ba=Xa*Xa+za*za+Ma*Ma;if(Ba>0){Ba=1/Math.sqrt(Ba)}Xa*=Ba;za*=Ba;Ma*=Ba;var Pa=Xa*at+za*it+Ma*rt;var Ta=Xa*st+za*nt+Ma*et;if(Pa<0){Pa=-Pa}if(Ta<0){Ta=-Ta}Vt=Pa+Ta;var Sa=Xa*vt+za*ht+Ma*lt;var Ca=Xa*ut+za*xt+Ma*yt;if(Sa<0){Sa=-Sa}if(Ca<0){Ca=-Ca}Bt=Sa+Ca;Pt=Xa*u+za*x+Ma*y;var qa=Vt+Bt;var Ra=Pt<0;var Ea=Ra?-Pt:Pt;if(Ea<qa){var ja=qa-Ea;if(ja<zt){zt=ja;Mt=7;dt=Xa;It=za;wt=Ma;Yt=Ra?-1:1}}else{return}}Xa=z*D-M*N;za=M*j-X*D;Ma=X*N-z*j;if(!(Xa==0&&za==0&&Ma==0)){var Na=Xa*Xa+za*za+Ma*Ma;if(Na>0){Na=1/Math.sqrt(Na)}Xa*=Na;za*=Na;Ma*=Na;var Da=Xa*at+za*it+Ma*rt;var Fa=Xa*st+za*nt+Ma*et;if(Da<0){Da=-Da}if(Fa<0){Fa=-Fa}Vt=Da+Fa;var Oa=Xa*vt+za*ht+Ma*lt;var Wa=Xa*pt+za*ft+Ma*mt;if(Oa<0){Oa=-Oa}if(Wa<0){Wa=-Wa}Bt=Oa+Wa;Pt=Xa*u+za*x+Ma*y;var Ga=Vt+Bt;var Ha=Pt<0;var Ua=Ha?-Pt:Pt;if(Ua<Ga){var Ja=Ga-Ua;if(Ja<zt){zt=Ja;Mt=8;dt=Xa;It=za;wt=Ma;Yt=Ha?-1:1}}else{return}}Xa=d*T-I*P;za=I*B-Z*T;Ma=Z*P-d*B;if(!(Xa==0&&za==0&&Ma==0)){var Qa=Xa*Xa+za*za+Ma*Ma;if(Qa>0){Qa=1/Math.sqrt(Qa)}Xa*=Qa;za*=Qa;Ma*=Qa;var $a=Xa*Q+za*$+Ma*K;var Ka=Xa*st+za*nt+Ma*et;if($a<0){$a=-$a}if(Ka<0){Ka=-Ka}Vt=$a+Ka;var ti=Xa*pt+za*ft+Ma*mt;var ai=Xa*ut+za*xt+Ma*yt;if(ti<0){ti=-ti}if(ai<0){ai=-ai}Bt=ti+ai;Pt=Xa*u+za*x+Ma*y;var ii=Vt+Bt;var ri=Pt<0;var oi=ri?-Pt:Pt;if(oi<ii){var si=ii-oi;if(si<zt){zt=si;Mt=9;dt=Xa;It=za;wt=Ma;Yt=ri?-1:1}}else{return}}Xa=d*R-I*q;za=I*C-Z*R;Ma=Z*q-d*C;if(!(Xa==0&&za==0&&Ma==0)){var ni=Xa*Xa+za*za+Ma*Ma;if(ni>0){ni=1/Math.sqrt(ni)}Xa*=ni;za*=ni;Ma*=ni;var ei=Xa*Q+za*$+Ma*K;var _i=Xa*st+za*nt+Ma*et;if(ei<0){ei=-ei}if(_i<0){_i=-_i}Vt=ei+_i;var vi=Xa*vt+za*ht+Ma*lt;var hi=Xa*ut+za*xt+Ma*yt;if(vi<0){vi=-vi}if(hi<0){hi=-hi}Bt=vi+hi;Pt=Xa*u+za*x+Ma*y;var li=Vt+Bt;var ci=Pt<0;var pi=ci?-Pt:Pt;if(pi<li){var fi=li-pi;if(fi<zt){zt=fi;Mt=10;dt=Xa;It=za;wt=Ma;Yt=ci?-1:1}}else{return}}Xa=d*D-I*N;za=I*j-Z*D;Ma=Z*N-d*j;if(!(Xa==0&&za==0&&Ma==0)){var mi=Xa*Xa+za*za+Ma*Ma;if(mi>0){mi=1/Math.sqrt(mi)}Xa*=mi;za*=mi;Ma*=mi;var bi=Xa*Q+za*$+Ma*K;var ui=Xa*st+za*nt+Ma*et;if(bi<0){bi=-bi}if(ui<0){ui=-ui}Vt=bi+ui;var xi=Xa*vt+za*ht+Ma*lt;var yi=Xa*pt+za*ft+Ma*mt;if(xi<0){xi=-xi}if(yi<0){yi=-yi}Bt=xi+yi;Pt=Xa*u+za*x+Ma*y;var gi=Vt+Bt;var Xi=Pt<0;var zi=Xi?-Pt:Pt;if(zi<gi){var Mi=gi-zi;if(Mi<zt){zt=Mi;Mt=11;dt=Xa;It=za;wt=Ma;Yt=Xi?-1:1}}else{return}}Xa=L*T-A*P;za=A*B-V*T;Ma=V*P-L*B;if(!(Xa==0&&za==0&&Ma==0)){var Yi=Xa*Xa+za*za+Ma*Ma;if(Yi>0){Yi=1/Math.sqrt(Yi)}Xa*=Yi;za*=Yi;Ma*=Yi;var Zi=Xa*Q+za*$+Ma*K;var di=Xa*at+za*it+Ma*rt;if(Zi<0){Zi=-Zi}if(di<0){di=-di}Vt=Zi+di;var Ii=Xa*pt+za*ft+Ma*mt;var wi=Xa*ut+za*xt+Ma*yt;if(Ii<0){Ii=-Ii}if(wi<0){wi=-wi}Bt=Ii+wi;Pt=Xa*u+za*x+Ma*y;var Vi=Vt+Bt;var Li=Pt<0;var Ai=Li?-Pt:Pt;if(Ai<Vi){var ki=Vi-Ai;if(ki<zt){zt=ki;Mt=12;dt=Xa;It=za;wt=Ma;Yt=Li?-1:1}}else{return}}Xa=L*R-A*q;za=A*C-V*R;Ma=V*q-L*C;if(!(Xa==0&&za==0&&Ma==0)){var Bi=Xa*Xa+za*za+Ma*Ma;if(Bi>0){Bi=1/Math.sqrt(Bi)}Xa*=Bi;za*=Bi;Ma*=Bi;var Pi=Xa*Q+za*$+Ma*K;var Ti=Xa*at+za*it+Ma*rt;if(Pi<0){Pi=-Pi}if(Ti<0){Ti=-Ti}Vt=Pi+Ti;var Si=Xa*vt+za*ht+Ma*lt;var Ci=Xa*ut+za*xt+Ma*yt;if(Si<0){Si=-Si}if(Ci<0){Ci=-Ci}Bt=Si+Ci;Pt=Xa*u+za*x+Ma*y;var qi=Vt+Bt;var Ri=Pt<0;var Ei=Ri?-Pt:Pt;if(Ei<qi){var ji=qi-Ei;if(ji<zt){zt=ji;Mt=13;dt=Xa;It=za;wt=Ma;Yt=Ri?-1:1}}else{return}}Xa=L*D-A*N;za=A*j-V*D;Ma=V*N-L*j;if(!(Xa==0&&za==0&&Ma==0)){var Ni=Xa*Xa+za*za+Ma*Ma;if(Ni>0){Ni=1/Math.sqrt(Ni)}Xa*=Ni;za*=Ni;Ma*=Ni;var Di=Xa*Q+za*$+Ma*K;var Fi=Xa*at+za*it+Ma*rt;if(Di<0){Di=-Di}if(Fi<0){Fi=-Fi}Vt=Di+Fi;var Oi=Xa*vt+za*ht+Ma*lt;var Wi=Xa*pt+za*ft+Ma*mt;if(Oi<0){Oi=-Oi}if(Wi<0){Wi=-Wi}Bt=Oi+Wi;Pt=Xa*u+za*x+Ma*y;var Gi=Vt+Bt;var Hi=Pt<0;var Ui=Hi?-Pt:Pt;if(Ui<Gi){var Ji=Gi-Ui;if(Ji<zt){zt=Ji;Mt=14;dt=Xa;It=za;wt=Ma;Yt=Hi?-1:1}}else{return}}if(Mt>=6){dt*=Yt;It*=Yt;wt*=Yt;var Qi=(Mt-6)/3|0;var $i=Mt-6-Qi*3;var Ki;var tr;var ar;var ir;var rr;var or;var sr;var nr;var er;var _r;var vr;var hr;var lr;var cr;var pr;var fr;switch(Qi){case 0:_r=X;vr=z;hr=M;var mr=at*dt+it*It+rt*wt>0;var br=st*dt+nt*It+et*wt>0;if(mr){if(br){tr=at+st;ar=it+nt;ir=rt+et}else{tr=at-st;ar=it-nt;ir=rt-et}}else if(br){tr=st-at;ar=nt-it;ir=et-rt}else{tr=at+st;ar=it+nt;ir=rt+et;tr=-tr;ar=-ar;ir=-ir}break;case 1:_r=Z;vr=d;hr=I;var ur=Q*dt+$*It+K*wt>0;var xr=st*dt+nt*It+et*wt>0;if(ur){if(xr){tr=Q+st;ar=$+nt;ir=K+et}else{tr=Q-st;ar=$-nt;ir=K-et}}else if(xr){tr=st-Q;ar=nt-$;ir=et-K}else{tr=Q+st;ar=$+nt;ir=K+et;tr=-tr;ar=-ar;ir=-ir}break;default:_r=V;vr=L;hr=A;var yr=Q*dt+$*It+K*wt>0;var gr=at*dt+it*It+rt*wt>0;if(yr){if(gr){tr=Q+at;ar=$+it;ir=K+rt}else{tr=Q-at;ar=$-it;ir=K-rt}}else if(gr){tr=at-Q;ar=it-$;ir=rt-K}else{tr=Q+at;ar=$+it;ir=K+rt;tr=-tr;ar=-ar;ir=-ir}}tr=v+tr;ar=h+ar;ir=l+ir;switch($i){case 0:cr=B;pr=P;fr=T;var Xr=pt*dt+ft*It+mt*wt>0;var zr=ut*dt+xt*It+yt*wt>0;if(Xr){if(zr){or=pt+ut;sr=ft+xt;nr=mt+yt}else{or=pt-ut;sr=ft-xt;nr=mt-yt}}else if(zr){or=ut-pt;sr=xt-ft;nr=yt-mt}else{or=pt+ut;sr=ft+xt;nr=mt+yt;or=-or;sr=-sr;nr=-nr}break;case 1:cr=C;pr=q;fr=R;var Mr=vt*dt+ht*It+lt*wt>0;var Yr=ut*dt+xt*It+yt*wt>0;if(Mr){if(Yr){or=vt+ut;sr=ht+xt;nr=lt+yt}else{or=vt-ut;sr=ht-xt;nr=lt-yt}}else if(Yr){or=ut-vt;sr=xt-ht;nr=yt-lt}else{or=vt+ut;sr=ht+xt;nr=lt+yt;or=-or;sr=-sr;nr=-nr}break;default:cr=j;pr=N;fr=D;var Zr=vt*dt+ht*It+lt*wt>0;var dr=pt*dt+ft*It+mt*wt>0;if(Zr){if(dr){or=vt+pt;sr=ht+ft;nr=lt+mt}else{or=vt-pt;sr=ht-ft;nr=lt-mt}}else if(dr){or=pt-vt;sr=ft-ht;nr=mt-lt}else{or=vt+pt;sr=ht+ft;nr=lt+mt;or=-or;sr=-sr;nr=-nr}}or=p-or;sr=f-sr;nr=m-nr;var Ir;var wr;var Vr;var Lr;wr=tr-or;Vr=ar-sr;Lr=ir-nr;var Ar=_r*cr+vr*pr+hr*fr;var kr=_r*wr+vr*Vr+hr*Lr;var Br=cr*wr+pr*Vr+fr*Lr;var Pr=1/(1-Ar*Ar);var Tr=(Ar*Br-kr)*Pr;var Sr=(Br-Ar*kr)*Pr;var Cr;var qr;var Rr;var Er;var jr;var Nr;var Dr;var Fr;qr=tr+_r*Tr;Rr=ar+vr*Tr;Er=ir+hr*Tr;Nr=or+cr*Sr;Dr=sr+pr*Sr;Fr=nr+fr*Sr;var Or;var Wr;var Gr;var Hr;Wr=-dt;Gr=-It;Hr=-wt;this.setNormal(t,Wr,Gr,Hr);this.addPoint(t,qr,Rr,Er,Nr,Dr,Fr,zt,4);return}var Ur;var Jr;var Qr;var $r;var Kr;if(Mt>=3){Yt=-Yt;u=-u;x=-x;y=-y;var to=n;n=e;e=to;var ao=F;F=G;G=ao;var io=O;O=H;H=io;var ro=W;W=U;U=ro;Jr=v;Qr=h;$r=l;v=p;h=f;l=m;p=Jr;f=Qr;m=$r;Jr=X;Qr=z;$r=M;X=B;z=P;M=T;B=Jr;P=Qr;T=$r;Jr=Z;Qr=d;$r=I;Z=C;d=q;I=R;C=Jr;q=Qr;R=$r;Jr=V;Qr=L;$r=A;V=j;L=N;A=D;j=Jr;N=Qr;D=$r;Jr=Q;Qr=$;$r=K;Q=vt;$=ht;K=lt;vt=Jr;ht=Qr;lt=$r;Jr=at;Qr=it;$r=rt;at=pt;it=ft;rt=mt;pt=Jr;ft=Qr;mt=$r;Jr=st;Qr=nt;$r=et;st=ut;nt=xt;et=yt;ut=Jr;xt=Qr;yt=$r;Mt-=3;Kr=true}else{Kr=false}var oo;var so;var no;var eo;var _o;var vo;var ho;var lo;var co;var po;var fo;var mo;var bo;var uo;var xo;var yo;var go;var Xo;switch(Mt){case 0:so=Q;no=$;eo=K;vo=X;ho=z;lo=M;po=Z;fo=d;mo=I;uo=V;xo=L;yo=A;go=O;Xo=W;break;case 1:so=at;no=it;eo=rt;vo=Z;ho=d;lo=I;po=V;fo=L;mo=A;uo=X;xo=z;yo=M;go=W;Xo=F;break;default:so=st;no=nt;eo=et;vo=V;ho=L;lo=A;po=X;fo=z;mo=M;uo=Z;xo=d;yo=I;go=F;Xo=O}if(Yt<0){so=-so;no=-no;eo=-eo;vo=-vo;ho=-ho;lo=-lo;Jr=po;Qr=fo;$r=mo;po=uo;fo=xo;mo=yo;uo=Jr;xo=Qr;yo=$r;var zo=go;go=Xo;Xo=zo}so+=v;no+=h;eo+=l;var Mo=1;var Yo=0;var Zo=vo*B+ho*P+lo*T;if(Zo<Mo){Mo=Zo;Yo=0}if(-Zo<Mo){Mo=-Zo;Yo=1}Zo=vo*C+ho*q+lo*R;if(Zo<Mo){Mo=Zo;Yo=2}if(-Zo<Mo){Mo=-Zo;Yo=3}Zo=vo*j+ho*N+lo*D;if(Zo<Mo){Mo=Zo;Yo=4}if(-Zo<Mo){Mo=-Zo;Yo=5}var Io;var wo;var Vo;var Lo;var Ao;var ko;var Bo;var Po;var To;var So;var Co;var qo;var Ro;var Eo;var jo;var No;switch(Yo){case 0:wo=vt+pt;Vo=ht+ft;Lo=lt+mt;wo+=ut;Vo+=xt;Lo+=yt;ko=vt-pt;Bo=ht-ft;Po=lt-mt;ko+=ut;Bo+=xt;Po+=yt;So=vt-pt;Co=ht-ft;qo=lt-mt;So-=ut;Co-=xt;qo-=yt;Eo=vt+pt;jo=ht+ft;No=lt+mt;Eo-=ut;jo-=xt;No-=yt;break;case 1:wo=pt-vt;Vo=ft-ht;Lo=mt-lt;wo+=ut;Vo+=xt;Lo+=yt;ko=pt-vt;Bo=ft-ht;Po=mt-lt;ko-=ut;Bo-=xt;Po-=yt;So=vt+pt;Co=ht+ft;qo=lt+mt;So=-So;Co=-Co;qo=-qo;So-=ut;Co-=xt;qo-=yt;Eo=vt+pt;jo=ht+ft;No=lt+mt;Eo=-Eo;jo=-jo;No=-No;Eo+=ut;jo+=xt;No+=yt;break;case 2:wo=vt+pt;Vo=ht+ft;Lo=lt+mt;wo+=ut;Vo+=xt;Lo+=yt;ko=vt+pt;Bo=ht+ft;Po=lt+mt;ko-=ut;Bo-=xt;Po-=yt;So=pt-vt;Co=ft-ht;qo=mt-lt;So-=ut;Co-=xt;qo-=yt;Eo=pt-vt;jo=ft-ht;No=mt-lt;Eo+=ut;jo+=xt;No+=yt;break;case 3:wo=vt-pt;Vo=ht-ft;Lo=lt-mt;wo+=ut;Vo+=xt;Lo+=yt;ko=vt+pt;Bo=ht+ft;Po=lt+mt;ko=-ko;Bo=-Bo;Po=-Po;ko+=ut;Bo+=xt;Po+=yt;So=vt+pt;Co=ht+ft;qo=lt+mt;So=-So;Co=-Co;qo=-qo;So-=ut;Co-=xt;qo-=yt;Eo=vt-pt;jo=ht-ft;No=lt-mt;Eo-=ut;jo-=xt;No-=yt;break;case 4:wo=vt+pt;Vo=ht+ft;Lo=lt+mt;wo+=ut;Vo+=xt;Lo+=yt;ko=pt-vt;Bo=ft-ht;Po=mt-lt;ko+=ut;Bo+=xt;Po+=yt;So=vt+pt;Co=ht+ft;qo=lt+mt;So=-So;Co=-Co;qo=-qo;So+=ut;Co+=xt;qo+=yt;Eo=vt-pt;jo=ht-ft;No=lt-mt;Eo+=ut;jo+=xt;No+=yt;break;default:wo=vt+pt;Vo=ht+ft;Lo=lt+mt;wo-=ut;Vo-=xt;Lo-=yt;ko=vt-pt;Bo=ht-ft;Po=lt-mt;ko-=ut;Bo-=xt;Po-=yt;So=vt+pt;Co=ht+ft;qo=lt+mt;So=-So;Co=-Co;qo=-qo;So-=ut;Co-=xt;qo-=yt;Eo=pt-vt;jo=ft-ht;No=mt-lt;Eo-=ut;jo-=xt;No-=yt}wo+=u;Vo+=x;Lo+=y;ko+=u;Bo+=x;Po+=y;So+=u;Co+=x;qo+=y;Eo+=u;jo+=x;No+=y;var Do=this.clipper;Do.w=go;Do.h=Xo;Do.numVertices=0;Do.numTmpVertices=0;var Fo=this.clipper;var Oo=Fo.vertices[Fo.numVertices++];Oo.x=wo*po+Vo*fo+Lo*mo;Oo.y=wo*uo+Vo*xo+Lo*yo;Oo.wx=wo;Oo.wy=Vo;Oo.wz=Lo;var Wo=this.clipper;var Go=Wo.vertices[Wo.numVertices++];Go.x=ko*po+Bo*fo+Po*mo;Go.y=ko*uo+Bo*xo+Po*yo;Go.wx=ko;Go.wy=Bo;Go.wz=Po;var Ho=this.clipper;var Uo=Ho.vertices[Ho.numVertices++];Uo.x=So*po+Co*fo+qo*mo;Uo.y=So*uo+Co*xo+qo*yo;Uo.wx=So;Uo.wy=Co;Uo.wz=qo;var Jo=this.clipper;var Qo=Jo.vertices[Jo.numVertices++];Qo.x=Eo*po+jo*fo+No*mo;Qo.y=Eo*uo+jo*xo+No*yo;Qo.wx=Eo;Qo.wy=jo;Qo.wz=No;this.clipper.clip();this.clipper.reduce();var $o;var Ko;var ts;var as;if(Kr){Ko=vo;ts=ho;as=lo}else{Ko=-vo;ts=-ho;as=-lo}this.setNormal(t,Ko,ts,as);var is=0;var rs=this.clipper.numVertices;while(is<rs){var os=is++;var ss=this.clipper.vertices[os];var ns;var es;var _s;var vs;es=ss.wx;_s=ss.wy;vs=ss.wz;es+=v;_s+=h;vs+=l;var hs;var ls;var cs;var ps;ls=so-es;cs=no-_s;ps=eo-vs;var fs=ls*vo+cs*ho+ps*lo;var ms;var bs;var us;var xs;bs=es+vo*fs;us=_s+ho*fs;xs=vs+lo*fs;if(fs>-ys.contactPersistenceThreshold){if(Kr){this.addPoint(t,es,_s,vs,bs,us,xs,fs,os)}else{this.addPoint(t,bs,us,xs,es,_s,vs,fs,os)}}}}});var V=function(){this.x=0;this.y=0;this.wx=0;this.wy=0;this.wz=0};var L=function(){this.w=0;this.h=0;this.numVertices=0;this.numTmpVertices=0;var t=new Array(8);this.vertices=t;var a=new Array(8);this.tmpVertices=a;var i=0;while(i<8){var r=i++;this.vertices[r]=new V;this.tmpVertices[r]=new V}};L.prototype={clip:function(){var t=0;var a=this.numVertices;while(t<a){var i=t++;var r=this.vertices[i];var o=this.vertices[(i+1)%this.numVertices];var s=this.w+r.x;var n=this.w+o.x;if(s>0&&n>0){var e=this.tmpVertices[this.numTmpVertices++];e.x=r.x;e.y=r.y;e.wx=r.wx;e.wy=r.wy;e.wz=r.wz}else if(s>0&&n<=0){var _=this.tmpVertices[this.numTmpVertices++];_.x=r.x;_.y=r.y;_.wx=r.wx;_.wy=r.wy;_.wz=r.wz;var v=s/(s-n);var h=this.tmpVertices[this.numTmpVertices++];h.x=r.x+(o.x-r.x)*v;h.y=r.y+(o.y-r.y)*v;h.wx=r.wx+(o.wx-r.wx)*v;h.wy=r.wy+(o.wy-r.wy)*v;h.wz=r.wz+(o.wz-r.wz)*v}else if(s<=0&&n>0){var l=s/(s-n);var c=this.tmpVertices[this.numTmpVertices++];c.x=r.x+(o.x-r.x)*l;c.y=r.y+(o.y-r.y)*l;c.wx=r.wx+(o.wx-r.wx)*l;c.wy=r.wy+(o.wy-r.wy)*l;c.wz=r.wz+(o.wz-r.wz)*l}}var p=this.vertices;this.vertices=this.tmpVertices;this.tmpVertices=p;this.numVertices=this.numTmpVertices;this.numTmpVertices=0;var f=0;var m=this.numVertices;while(f<m){var b=f++;var u=this.vertices[b];var x=this.vertices[(b+1)%this.numVertices];var y=this.w-u.x;var g=this.w-x.x;if(y>0&&g>0){var X=this.tmpVertices[this.numTmpVertices++];X.x=u.x;X.y=u.y;X.wx=u.wx;X.wy=u.wy;X.wz=u.wz}else if(y>0&&g<=0){var z=this.tmpVertices[this.numTmpVertices++];z.x=u.x;z.y=u.y;z.wx=u.wx;z.wy=u.wy;z.wz=u.wz;var M=y/(y-g);var Y=this.tmpVertices[this.numTmpVertices++];Y.x=u.x+(x.x-u.x)*M;Y.y=u.y+(x.y-u.y)*M;Y.wx=u.wx+(x.wx-u.wx)*M;Y.wy=u.wy+(x.wy-u.wy)*M;Y.wz=u.wz+(x.wz-u.wz)*M}else if(y<=0&&g>0){var Z=y/(y-g);var d=this.tmpVertices[this.numTmpVertices++];d.x=u.x+(x.x-u.x)*Z;d.y=u.y+(x.y-u.y)*Z;d.wx=u.wx+(x.wx-u.wx)*Z;d.wy=u.wy+(x.wy-u.wy)*Z;d.wz=u.wz+(x.wz-u.wz)*Z}}var I=this.vertices;this.vertices=this.tmpVertices;this.tmpVertices=I;this.numVertices=this.numTmpVertices;this.numTmpVertices=0;var w=0;var V=this.numVertices;while(w<V){var L=w++;var A=this.vertices[L];var k=this.vertices[(L+1)%this.numVertices];var B=this.h+A.y;var P=this.h+k.y;if(B>0&&P>0){var T=this.tmpVertices[this.numTmpVertices++];T.x=A.x;T.y=A.y;T.wx=A.wx;T.wy=A.wy;T.wz=A.wz}else if(B>0&&P<=0){var S=this.tmpVertices[this.numTmpVertices++];S.x=A.x;S.y=A.y;S.wx=A.wx;S.wy=A.wy;S.wz=A.wz;var C=B/(B-P);var q=this.tmpVertices[this.numTmpVertices++];q.x=A.x+(k.x-A.x)*C;q.y=A.y+(k.y-A.y)*C;q.wx=A.wx+(k.wx-A.wx)*C;q.wy=A.wy+(k.wy-A.wy)*C;q.wz=A.wz+(k.wz-A.wz)*C}else if(B<=0&&P>0){var R=B/(B-P);var E=this.tmpVertices[this.numTmpVertices++];E.x=A.x+(k.x-A.x)*R;E.y=A.y+(k.y-A.y)*R;E.wx=A.wx+(k.wx-A.wx)*R;E.wy=A.wy+(k.wy-A.wy)*R;E.wz=A.wz+(k.wz-A.wz)*R}}var j=this.vertices;this.vertices=this.tmpVertices;this.tmpVertices=j;this.numVertices=this.numTmpVertices;this.numTmpVertices=0;var N=0;var D=this.numVertices;while(N<D){var F=N++;var O=this.vertices[F];var W=this.vertices[(F+1)%this.numVertices];var G=this.h-O.y;var H=this.h-W.y;if(G>0&&H>0){var U=this.tmpVertices[this.numTmpVertices++];U.x=O.x;U.y=O.y;U.wx=O.wx;U.wy=O.wy;U.wz=O.wz}else if(G>0&&H<=0){var J=this.tmpVertices[this.numTmpVertices++];J.x=O.x;J.y=O.y;J.wx=O.wx;J.wy=O.wy;J.wz=O.wz;var Q=G/(G-H);var $=this.tmpVertices[this.numTmpVertices++];$.x=O.x+(W.x-O.x)*Q;$.y=O.y+(W.y-O.y)*Q;$.wx=O.wx+(W.wx-O.wx)*Q;$.wy=O.wy+(W.wy-O.wy)*Q;$.wz=O.wz+(W.wz-O.wz)*Q}else if(G<=0&&H>0){var K=G/(G-H);var tt=this.tmpVertices[this.numTmpVertices++];tt.x=O.x+(W.x-O.x)*K;tt.y=O.y+(W.y-O.y)*K;tt.wx=O.wx+(W.wx-O.wx)*K;tt.wy=O.wy+(W.wy-O.wy)*K;tt.wz=O.wz+(W.wz-O.wz)*K}}var at=this.vertices;this.vertices=this.tmpVertices;this.tmpVertices=at;this.numVertices=this.numTmpVertices;this.numTmpVertices=0},reduce:function(){if(this.numVertices<4){return}var t=-1/0;var a=1/0;var i=-1/0;var r=1/0;var o=null;var s=null;var n=null;var e=null;var _=1;var v=1;var h=-1;var l=1;var c=0;var p=this.numVertices;while(c<p){var f=c++;var m=this.vertices[f];var b=m.x*_+m.y*v;var u=m.x*h+m.y*l;if(b>t){t=b;o=m}if(b<a){a=b;s=m}if(u>i){i=u;n=m}if(u<r){r=u;e=m}}var x=this.tmpVertices[this.numTmpVertices++];x.x=o.x;x.y=o.y;x.wx=o.wx;x.wy=o.wy;x.wz=o.wz;var y=this.tmpVertices[this.numTmpVertices++];y.x=n.x;y.y=n.y;y.wx=n.wx;y.wy=n.wy;y.wz=n.wz;var g=this.tmpVertices[this.numTmpVertices++];g.x=s.x;g.y=s.y;g.wx=s.wx;g.wy=s.wy;g.wz=s.wz;var X=this.tmpVertices[this.numTmpVertices++];X.x=e.x;X.y=e.y;X.wx=e.wx;X.wy=e.wy;X.wz=e.wz;var z=this.vertices;this.vertices=this.tmpVertices;this.tmpVertices=z;this.numVertices=this.numTmpVertices;this.numTmpVertices=0}};var A=function(){};var k=function(){};k.prototype={_clear:function(){if(this._gjkCache!=null){this._gjkCache.clear()}}};var B=function(){I.call(this,false)};B.__super__=I;B.prototype=$extend(I.prototype,{detectImpl:function(t,a,i,r,o,s){var n=a;var e=i;t.incremental=false;var _;var v;var h;var l;var c;var p;var f;var m;v=r._rotation01;h=r._rotation11;l=r._rotation21;p=o._rotation01;f=o._rotation11;m=o._rotation21;var b=n._halfHeight;var u=e._halfHeight;var x=n._radius;var y=e._radius;var g;var X;var z;var M;var Y;var Z;var d;var I;var w;var V;var L;var A;var k;var B;var P;var T;X=r._positionX+v*-b;z=r._positionY+h*-b;M=r._positionZ+l*-b;Z=r._positionX+v*b;d=r._positionY+h*b;I=r._positionZ+l*b;V=o._positionX+p*-u;L=o._positionY+f*-u;A=o._positionZ+m*-u;B=o._positionX+p*u;P=o._positionY+f*u;T=o._positionZ+m*u;var S;var C;var q;var R;C=X-V;q=z-L;R=M-A;var E;var j;var N;var D;var F;var O;var W;var G;j=Z-X;N=d-z;D=I-M;O=B-V;W=P-L;G=T-A;var H=-(C*j+q*N+R*D);var U=C*O+q*W+R*G;var J=b*b*4;var Q=j*O+N*W+D*G;var $=u*u*4;var K;var tt;if(J==0&&$==0){K=0;tt=0}else if(J==0){K=0;tt=U;if(tt<0){tt=0}else if(tt>$){tt=1}else{tt/=$}}else if($==0){tt=0;K=H;if(K<0){K=0}else if(K>J){K=1}else{K/=J}}else{var at=J*$-Q*Q;if(at==0){K=0}else{K=Q*U+$*H;if(K<0){K=0}else if(K>at){K=1}else{K/=at}}tt=K*Q+U;if(tt<0){tt=0;K=H;if(K<0){K=0}else if(K>J){K=1}else{K/=J}}else if(tt>$){tt=1;K=Q+H;if(K<0){K=0}else if(K>J){K=1}else{K/=J}}else{tt/=$}}var it;var rt;var ot;var st;var nt;var et;var _t;var vt;rt=X+j*K;ot=z+N*K;st=M+D*K;et=V+O*tt;_t=L+W*tt;vt=A+G*tt;var ht;var lt;var ct;var pt;lt=rt-et;ct=ot-_t;pt=st-vt;var ft=lt*lt+ct*ct+pt*pt;if(ft>=(x+y)*(x+y)){return}var mt=Math.sqrt(ft);var bt;var ut;var xt;var yt;if(mt>0){ut=lt*(1/mt);xt=ct*(1/mt);yt=pt*(1/mt)}else{ut=1;xt=0;yt=0}this.setNormal(t,ut,xt,yt);var gt;var Xt;var zt;var Mt;var Yt;var Zt;var dt;var It;Xt=rt+ut*-x;zt=ot+xt*-x;Mt=st+yt*-x;Zt=et+ut*y;dt=_t+xt*y;It=vt+yt*y;this.addPoint(t,Xt,zt,Mt,Zt,dt,It,x+y-mt,0)}});var P=function(){I.call(this,false)};P.__super__=I;P.prototype=$extend(I.prototype,{detectImpl:function(t,a,i,r,o,s){var n=N.instance;var e=a;var _=i;var v=n.computeClosestPointsImpl(e,_,r,o,ys.enableGJKCaching?s:null,true);t.incremental=true;if(v!=Ga.SUCCEEDED){console.log("GjkEpaDetector.hx:28:","GJK/EPA failed: status="+v);return}var h=e._gjkMargin;var l=_._gjkMargin;if(n.distance>h+l){return}var c;var p;var f;var m;var b;var u;var x;var y;var g=n.closestPoint1;p=g.x;f=g.y;m=g.z;var X=n.closestPoint2;u=X.x;x=X.y;y=X.z;var z;var M;var Y;var Z;M=p-u;Y=f-x;Z=m-y;if(M*M+Y*Y+Z*Z==0){return}if(n.distance<0){M=-M;Y=-Y;Z=-Z}var d=M*M+Y*Y+Z*Z;if(d>0){d=1/Math.sqrt(d)}M*=d;Y*=d;Z*=d;this.setNormal(t,M,Y,Z);p+=M*-e._gjkMargin;f+=Y*-e._gjkMargin;m+=Z*-e._gjkMargin;u+=M*_._gjkMargin;x+=Y*_._gjkMargin;y+=Z*_._gjkMargin;this.addPoint(t,p,f,m,u,x,y,e._gjkMargin+_._gjkMargin-n.distance,0)}});var T=function(t){I.call(this,t)};T.__super__=I;T.prototype=$extend(I.prototype,{detectImpl:function(t,a,i,r,o,s){var n=a;var e=i;t.incremental=false;var _;var v;var h;var l;var c;var p;var f;var m;v=e._halfExtentsX;h=e._halfExtentsY;l=e._halfExtentsZ;p=-v;f=-h;m=-l;var b=n._radius;var u;var x;var y;var g;x=r._positionX-o._positionX;y=r._positionY-o._positionY;g=r._positionZ-o._positionZ;var X;var z;var M;var Y;var Z;var d;var I;Z=o._rotation00*x+o._rotation10*y+o._rotation20*g;d=o._rotation01*x+o._rotation11*y+o._rotation21*g;I=o._rotation02*x+o._rotation12*y+o._rotation22*g;z=Z;M=d;Y=I;var w=p<z&&v>z&&f<M&&h>M&&m<Y&&l>Y;if(w){var V;var L;var A;var k;L=z<0?-z:z;A=M<0?-M:M;k=Y<0?-Y:Y;L=v-L;A=h-A;k=l-k;var B;var P;var T;var S;var C=L;var q=A;var R=k;var E;var j;var N;var D;var F;if(C<q){if(C<R){if(z>0){P=1;T=0;S=0}else{P=-1;T=0;S=0}N=0;D=1;F=1;E=C}else{if(Y>0){P=0;T=0;S=1}else{P=0;T=0;S=-1}N=1;D=1;F=0;E=R}}else if(q<R){if(M>0){P=0;T=1;S=0}else{P=0;T=-1;S=0}N=1;D=0;F=1;E=q}else{if(Y>0){P=0;T=0;S=1}else{P=0;T=0;S=-1}N=1;D=1;F=0;E=R}var O;var W;var G;var H;W=N*z;G=D*M;H=F*Y;var U;var J;var Q;var $;J=P*v;Q=T*h;$=S*l;J+=W;Q+=G;$+=H;var K;var tt;var at;var it;var rt;var ot;var st;var nt;var et;var _t;var vt;et=o._rotation00*J+o._rotation01*Q+o._rotation02*$;_t=o._rotation10*J+o._rotation11*Q+o._rotation12*$;vt=o._rotation20*J+o._rotation21*Q+o._rotation22*$;tt=et;at=_t;it=vt;var ht;var lt;var ct;ht=o._rotation00*P+o._rotation01*T+o._rotation02*S;lt=o._rotation10*P+o._rotation11*T+o._rotation12*S;ct=o._rotation20*P+o._rotation21*T+o._rotation22*S;ot=ht;st=lt;nt=ct;this.setNormal(t,ot,st,nt);var pt;var ft;var mt;var bt;var ut;var xt;var yt;var gt;ft=r._positionX+ot*-b;mt=r._positionY+st*-b;bt=r._positionZ+nt*-b;xt=o._positionX+tt;yt=o._positionY+at;gt=o._positionZ+it;this.addPoint(t,ft,mt,bt,xt,yt,gt,E,0);return}var Xt;var zt;var Mt;var Yt;var Zt=1e-9;var dt;var It;var wt;var Vt;It=Zt;wt=Zt;Vt=Zt;v-=It;h-=wt;l-=Vt;p+=It;f+=wt;m+=Vt;zt=z<v?z:v;Mt=M<h?M:h;Yt=Y<l?Y:l;zt=zt>p?zt:p;Mt=Mt>f?Mt:f;Yt=Yt>m?Yt:m;var Lt;var At;var kt;var Bt;At=z-zt;kt=M-Mt;Bt=Y-Yt;var Pt=At*At+kt*kt+Bt*Bt;if(Pt>=b*b){return}Pt=Math.sqrt(Pt);var Tt;var St;var Ct;var qt;var Rt;var Et;var jt;var Nt;var Dt;var Ft;var Ot;Dt=o._rotation00*zt+o._rotation01*Mt+o._rotation02*Yt;Ft=o._rotation10*zt+o._rotation11*Mt+o._rotation12*Yt;Ot=o._rotation20*zt+o._rotation21*Mt+o._rotation22*Yt;St=Dt;Ct=Ft;qt=Ot;var Wt;var Gt;var Ht;Wt=o._rotation00*At+o._rotation01*kt+o._rotation02*Bt;Gt=o._rotation10*At+o._rotation11*kt+o._rotation12*Bt;Ht=o._rotation20*At+o._rotation21*kt+o._rotation22*Bt;Et=Wt;jt=Gt;Nt=Ht;var Ut;var Jt;var Qt;var $t;var Kt=Et*Et+jt*jt+Nt*Nt;if(Kt>0){Kt=1/Math.sqrt(Kt)}Jt=Et*Kt;Qt=jt*Kt;$t=Nt*Kt;this.setNormal(t,Jt,Qt,$t);var ta;var aa;var ia;var ra;var oa;var sa;var na;var ea;aa=r._positionX+Jt*-b;ia=r._positionY+Qt*-b;ra=r._positionZ+$t*-b;sa=o._positionX+St;na=o._positionY+Ct;ea=o._positionZ+qt;this.addPoint(t,aa,ia,ra,sa,na,ea,b-Pt,0)}});var S=function(t){I.call(this,t)};S.__super__=I;S.prototype=$extend(I.prototype,{detectImpl:function(t,a,i,r,o,s){var n=a;var e=i;t.incremental=false;var _=e._halfHeight;var v=n._radius;var h=e._radius;var l;var c;var p;var f;c=o._rotation01;p=o._rotation11;f=o._rotation21;var m;var b;var u;var x;b=r._positionX;u=r._positionY;x=r._positionZ;var y;var g;var X;var z;var M;var Y;var Z;var d;g=o._positionX+c*-_;X=o._positionY+p*-_;z=o._positionZ+f*-_;Y=o._positionX+c*_;Z=o._positionY+p*_;d=o._positionZ+f*_;var I;var w;var V;var L;w=b-g;V=u-X;L=x-z;var A;var k;var B;var P;k=Y-g;B=Z-X;P=d-z;var T=_*_*4;var S=w*k+V*B+L*P;if(S<0){S=0}else if(S>T){S=1}else{S/=T}var C;var q;var R;var E;q=g+k*S;R=X+B*S;E=z+P*S;var j;var N;var D;var F;N=b-q;D=u-R;F=x-E;var O=N*N+D*D+F*F;if(O>=(v+h)*(v+h)){return}var W=Math.sqrt(O);var G;var H;var U;var J;if(W>0){H=N*(1/W);U=D*(1/W);J=F*(1/W)}else{H=1;U=0;J=0}this.setNormal(t,H,U,J);var Q;var $;var K;var tt;var at;var it;var rt;var ot;$=b+H*-v;K=u+U*-v;tt=x+J*-v;it=q+H*h;rt=R+U*h;ot=E+J*h;this.addPoint(t,$,K,tt,it,rt,ot,v+h-W,0)}});var C=function(){I.call(this,false)};C.__super__=I;C.prototype=$extend(I.prototype,{detectImpl:function(t,a,i,r,o,s){var n=a;var e=i;t.incremental=false;var _;var v;var h;var l;v=r._positionX-o._positionX;h=r._positionY-o._positionY;l=r._positionZ-o._positionZ;var c=n._radius;var p=e._radius;var f=v*v+h*h+l*l;if(f>=(c+p)*(c+p)){return}var m=Math.sqrt(f);var b;var u;var x;var y;if(m>0){u=v*(1/m);x=h*(1/m);y=l*(1/m)}else{u=1;x=0;y=0}this.setNormal(t,u,x,y);var g;var X;var z;var M;var Y;var Z;var d;var I;X=r._positionX+u*-c;z=r._positionY+x*-c;M=r._positionZ+y*-c;Z=o._positionX+u*p;d=o._positionY+x*p;I=o._positionZ+y*p;this.addPoint(t,X,z,M,Z,d,I,c+p-m,0)}});var q=function(){var t=ys.maxEPAVertices;var a=new Array(t);this._vertices=a;this._center=new Is;this._numVertices=0;this._triangleList=null;this._triangleListLast=null;this._numTriangles=0;this._trianglePool=null;this._vertexPool=null};q.prototype={dumpHoleEdge:function(t){},validate:function(){var t=this._triangleList;while(t!=null){var a=t._next;var i=0;while(i<3){var r=i++;t._vertices[r]._tmpEdgeLoopOuterTriangle=null;t._vertices[r]._tmpEdgeLoopNext=null;if(t._adjacentPairIndex[r]==-1){this._status=2;return false}if(t._adjacentTriangles[r]==null){this._status=3;return false}}t=a}return true},findEdgeLoop:function(t,a,i){if(a._tmpDfsId==t){return}a._tmpDfsId=t;var r=a.tmp;r.x=i.x;r.y=i.y;r.z=i.z;var o=r;var s=a._vertices[0].v;var n=o.x-s.x;var e=o.y-s.y;var _=o.z-s.z;o.x=n;o.y=e;o.z=_;var v=a.tmp;var h=a._normal;a._tmpDfsVisible=v.x*h.x+v.y*h.y+v.z*h.z>0;if(!a._tmpDfsVisible){this._status=6;return}var l=0;while(l<3){var c=l++;var p=a._adjacentTriangles[c];if(p==null){continue}var f=p.tmp;f.x=i.x;f.y=i.y;f.z=i.z;var m=f;var b=p._vertices[0].v;var u=m.x-b.x;var x=m.y-b.y;var y=m.z-b.z;m.x=u;m.y=x;m.z=y;var g=p.tmp;var X=p._normal;p._tmpDfsVisible=g.x*X.x+g.y*X.y+g.z*X.z>0;if(p._tmpDfsVisible){this.findEdgeLoop(t,p,i)}else{var z=a._nextIndex[c];var M=a._vertices[c];var Y=a._vertices[z];M._tmpEdgeLoopNext=Y;M._tmpEdgeLoopOuterTriangle=p}}var Z=0;while(Z<3){var d=Z++;var I=a._adjacentTriangles[d];if(I!=null){var w=a._adjacentPairIndex[d];I._adjacentTriangles[w]=null;I._adjacentPairIndex[w]=-1;a._adjacentTriangles[d]=null;a._adjacentPairIndex[d]=-1}}this._numTriangles--;var V=a._prev;var L=a._next;if(V!=null){V._next=L}if(L!=null){L._prev=V}if(a==this._triangleList){this._triangleList=this._triangleList._next}if(a==this._triangleListLast){this._triangleListLast=this._triangleListLast._prev}a._next=null;a._prev=null;a.removeReferences();a._next=this._trianglePool;this._trianglePool=a},_init:function(t,a,i,r){this._status=0;this._numVertices=4;this._vertices[0]=t;this._vertices[1]=a;this._vertices[2]=i;this._vertices[3]=r;var o=this._center;var s=t.v;o.x=s.x;o.y=s.y;o.z=s.z;var n=o;var e=a.v;var _=n.x+e.x;var v=n.y+e.y;var h=n.z+e.z;n.x=_;n.y=v;n.z=h;var l=n;var c=i.v;var p=l.x+c.x;var f=l.y+c.y;var m=l.z+c.z;l.x=p;l.y=f;l.z=m;var b=l;var u=r.v;var x=b.x+u.x;var y=b.y+u.y;var g=b.z+u.z;b.x=x;b.y=y;b.z=g;var X=b;var z=X.x*.25;var M=X.y*.25;var Y=X.z*.25;X.x=z;X.y=M;X.z=Y;var Z=this._trianglePool;if(Z!=null){this._trianglePool=Z._next;Z._next=null}else{Z=new E}var d=Z;var I=this._trianglePool;if(I!=null){this._trianglePool=I._next;I._next=null}else{I=new E}var w=I;var V=this._trianglePool;if(V!=null){this._trianglePool=V._next;V._next=null}else{V=new E}var L=V;var A=this._trianglePool;if(A!=null){this._trianglePool=A._next;A._next=null}else{A=new E}var k=A;if(!d.init(t,a,i,this._center,true)){this._status=1}if(!w.init(t,a,r,this._center,true)){this._status=1}if(!L.init(t,i,r,this._center,true)){this._status=1}if(!k.init(a,i,r,this._center,true)){this._status=1}if(!d.setAdjacentTriangle(w)){this._status=1}if(!d.setAdjacentTriangle(L)){this._status=1}if(!d.setAdjacentTriangle(k)){this._status=1}if(!w.setAdjacentTriangle(L)){this._status=1}if(!w.setAdjacentTriangle(k)){this._status=1}if(!L.setAdjacentTriangle(k)){this._status=1}this._numTriangles++;if(this._triangleList==null){this._triangleList=d;this._triangleListLast=d}else{this._triangleListLast._next=d;d._prev=this._triangleListLast;this._triangleListLast=d}this._numTriangles++;if(this._triangleList==null){this._triangleList=w;this._triangleListLast=w}else{this._triangleListLast._next=w;w._prev=this._triangleListLast;this._triangleListLast=w}this._numTriangles++;if(this._triangleList==null){this._triangleList=L;this._triangleListLast=L}else{this._triangleListLast._next=L;L._prev=this._triangleListLast;this._triangleListLast=L}this._numTriangles++;if(this._triangleList==null){this._triangleList=k;this._triangleListLast=k}else{this._triangleListLast._next=k;k._prev=this._triangleListLast;this._triangleListLast=k}return this._status==0},_addVertex:function(t,a){this._vertices[this._numVertices++]=t;var i=a._vertices[0];this.findEdgeLoop(this._numVertices,a,t.v);if(this._status!=0){return false}var r=i;var o=i;var s=null;var n=null;while(true){if(r._tmpEdgeLoopNext==null){this._dumpAsObjModel();this._status=4;return false}if(r._tmpEdgeLoopOuterTriangle==null){this._status=5;return false}var e=this._trianglePool;if(e!=null){this._trianglePool=e._next;e._next=null}else{e=new E}var _=e;if(n==null){n=_}if(!_.init(r,r._tmpEdgeLoopNext,t,this._center,false)){this._status=1}if(this._status!=0){return false}this._numTriangles++;if(this._triangleList==null){this._triangleList=_;this._triangleListLast=_}else{this._triangleListLast._next=_;_._prev=this._triangleListLast;this._triangleListLast=_}if(!_.setAdjacentTriangle(r._tmpEdgeLoopOuterTriangle)){this._status=1}if(s!=null){if(!_.setAdjacentTriangle(s)){this._status=1}}s=_;r=r._tmpEdgeLoopNext;if(!(r!=o)){break}}if(!s.setAdjacentTriangle(n)){this._status=1}if(this._status==0){return this.validate()}else{return false}},_dumpAsObjModel:function(){}};var R=function(){};var E=function(){this.id=++E.count;this._next=null;this._prev=null;this._normal=new Is;this._distanceSq=0;this._tmpDfsId=0;this._tmpDfsVisible=false;var t=new Array(3);this._vertices=t;var a=new Array(3);this._adjacentTriangles=a;var i=new Array(3);this._adjacentPairIndex=i;this.tmp=new Is;var r=new Array(3);this._nextIndex=r;this._nextIndex[0]=1;this._nextIndex[1]=2;this._nextIndex[2]=0};E.prototype={init:function(t,a,i,r,o){if(o==null){o=false}var s;var n;var e;var _;var v;var h;var l;var c;var p;var f;var m;var b;var u;var x;var y;var g;var X=t.v;n=X.x;e=X.y;_=X.z;var z=a.v;h=z.x;l=z.y;c=z.z;var M=i.v;f=M.x;m=M.y;b=M.z;var Y=r;x=Y.x;y=Y.y;g=Y.z;var Z;var d;var I;var w;var V;var L;var A;var k;var B;var P;var T;var S;d=h-n;I=l-e;w=c-_;L=f-n;A=m-e;k=b-_;P=n-x;T=e-y;S=_-g;var C;var q;var R;var E;q=I*k-w*A;R=w*L-d*k;E=d*A-I*L;var j=false;var N=P*q+T*R+S*E;if(N<0){if(o){var D=a;a=i;i=D;q*=-1;R*=-1;E*=-1}else{j=true}}this._vertices[0]=t;this._vertices[1]=a;this._vertices[2]=i;var F=this._normal;F.x=q;F.y=R;F.z=E;var O=t.v;var W=a.v;var G=i.v;var H=this.tmp;var U;var J;var Q;var $;var K;var tt;var at;var it;var rt;var ot;var st;var nt;var et;var _t;var vt;var ht;var lt;var ct;var pt;var ft;var mt;var bt;var ut;var xt;var yt=O;J=yt.x;Q=yt.y;$=yt.z;var gt=W;tt=gt.x;at=gt.y;it=gt.z;var Xt=G;ot=Xt.x;st=Xt.y;nt=Xt.z;_t=tt-J;vt=at-Q;ht=it-$;ct=ot-tt;pt=st-at;ft=nt-it;bt=J-ot;ut=Q-st;xt=$-nt;var zt;var Mt;var Yt;var Zt;Mt=vt*ft-ht*pt;Yt=ht*ct-_t*ft;Zt=_t*pt-vt*ct;var dt;var It;var wt;var Vt;var Lt;var At;var kt;var Bt;var Pt;var Tt;var St;var Ct;It=vt*Zt-ht*Yt;wt=ht*Mt-_t*Zt;Vt=_t*Yt-vt*Mt;At=pt*Zt-ft*Yt;kt=ft*Mt-ct*Zt;Bt=ct*Yt-pt*Mt;Tt=ut*Zt-xt*Yt;St=xt*Mt-bt*Zt;Ct=bt*Yt-ut*Mt;var qt=J*It+Q*wt+$*Vt;var Rt=tt*At+at*kt+it*Bt;var Et=ot*Tt+st*St+nt*Ct;var jt=-1;var Nt;var Dt;var Ft;var Ot;var Wt=0;Dt=0;Ft=0;Ot=0;if(qt<0){var Gt;var Ht;var Ut;var Jt;var Qt;var $t;var Kt;var ta;var aa=O;Ht=aa.x;Ut=aa.y;Jt=aa.z;var ia=W;$t=ia.x;Kt=ia.y;ta=ia.z;var ra;var oa;var sa;var na;oa=$t-Ht;sa=Kt-Ut;na=ta-Jt;var ea=oa*oa+sa*sa+na*na;var _a=oa*Ht+sa*Ut+na*Jt;_a=-_a/ea;var va;if(_a<0){var ha=H;ha.x=Ht;ha.y=Ut;ha.z=Jt;va=1}else if(_a>1){var la=H;la.x=$t;la.y=Kt;la.z=ta;va=2}else{var ca;var pa;var fa;var ma;pa=Ht+oa*_a;fa=Ut+sa*_a;ma=Jt+na*_a;var ba=H;ba.x=pa;ba.y=fa;ba.z=ma;va=3}var ua=H.x*H.x+H.y*H.y+H.z*H.z;Wt=va;jt=ua;var xa=H;Dt=xa.x;Ft=xa.y;Ot=xa.z}if(Rt<0){var ya;var ga;var Xa;var za;var Ma;var Ya;var Za;var da;var Ia=W;ga=Ia.x;Xa=Ia.y;za=Ia.z;var wa=G;Ya=wa.x;Za=wa.y;da=wa.z;var Va;var La;var Aa;var ka;La=Ya-ga;Aa=Za-Xa;ka=da-za;var Ba=La*La+Aa*Aa+ka*ka;var Pa=La*ga+Aa*Xa+ka*za;Pa=-Pa/Ba;var Ta;if(Pa<0){var Sa=H;Sa.x=ga;Sa.y=Xa;Sa.z=za;Ta=1}else if(Pa>1){var Ca=H;Ca.x=Ya;Ca.y=Za;Ca.z=da;Ta=2}else{var qa;var Ra;var Ea;var ja;Ra=ga+La*Pa;Ea=Xa+Aa*Pa;ja=za+ka*Pa;var Na=H;Na.x=Ra;Na.y=Ea;Na.z=ja;Ta=3}var Da=H.x*H.x+H.y*H.y+H.z*H.z;if(jt<0||Da<jt){Wt=Ta<<1;jt=Da;var Fa=H;Dt=Fa.x;Ft=Fa.y;Ot=Fa.z}}if(Et<0){var Oa;var Wa;var Ga;var Ha;var Ua;var Ja;var Qa;var $a;var Ka=O;Wa=Ka.x;Ga=Ka.y;Ha=Ka.z;var ti=G;Ja=ti.x;Qa=ti.y;$a=ti.z;var ai;var ii;var ri;var oi;ii=Ja-Wa;ri=Qa-Ga;oi=$a-Ha;var si=ii*ii+ri*ri+oi*oi;var ni=ii*Wa+ri*Ga+oi*Ha;ni=-ni/si;var ei;if(ni<0){var _i=H;_i.x=Wa;_i.y=Ga;_i.z=Ha;ei=1}else if(ni>1){var vi=H;vi.x=Ja;vi.y=Qa;vi.z=$a;ei=2}else{var hi;var li;var ci;var pi;li=Wa+ii*ni;ci=Ga+ri*ni;pi=Ha+oi*ni;var fi=H;fi.x=li;fi.y=ci;fi.z=pi;ei=3}var mi=H.x*H.x+H.y*H.y+H.z*H.z;if(jt<0||mi<jt){Wt=ei&1|(ei&2)<<1;jt=mi;var bi=H;Dt=bi.x;Ft=bi.y;Ot=bi.z}}if(jt>0){var ui=H;ui.x=Dt;ui.y=Ft;ui.z=Ot}else{var xi=Mt*Mt+Yt*Yt+Zt*Zt;if(xi>0){xi=1/Math.sqrt(xi)}Mt*=xi;Yt*=xi;Zt*=xi;var yi=J*Mt+Q*Yt+$*Zt;var gi=Mt*Mt+Yt*Yt+Zt*Zt;gi=yi/gi;Dt=Mt*gi;Ft=Yt*gi;Ot=Zt*gi;var Xi=H;Xi.x=Dt;Xi.y=Ft;Xi.z=Ot}var zi=this.tmp;this._distanceSq=zi.x*zi.x+zi.y*zi.y+zi.z*zi.z;this._adjacentTriangles[0]=null;this._adjacentTriangles[1]=null;this._adjacentTriangles[2]=null;this._adjacentPairIndex[0]=-1;this._adjacentPairIndex[1]=-1;this._adjacentPairIndex[2]=-1;return!j},setAdjacentTriangle:function(t){var a=0;var i=0;while(i<3){var r=i++;var o=0;while(o<3){var s=o++;var n=this._nextIndex[r];var e=this._nextIndex[s];if(this._vertices[r]==t._vertices[e]&&this._vertices[n]==t._vertices[s]){this._adjacentTriangles[r]=t;this._adjacentPairIndex[r]=s;t._adjacentTriangles[s]=this;t._adjacentPairIndex[s]=r;++a}}}if(a!=1){return false}return true},removeAdjacentTriangles:function(){var t=0;while(t<3){var a=t++;var i=this._adjacentTriangles[a];if(i!=null){var r=this._adjacentPairIndex[a];i._adjacentTriangles[r]=null;i._adjacentPairIndex[r]=-1;this._adjacentTriangles[a]=null;this._adjacentPairIndex[a]=-1}}},removeReferences:function(){this._next=null;this._prev=null;this._tmpDfsId=0;this._tmpDfsVisible=false;this._distanceSq=0;this._vertices[0]=null;this._vertices[1]=null;this._vertices[2]=null;this._adjacentTriangles[0]=null;this._adjacentTriangles[1]=null;this._adjacentTriangles[2]=null;this._adjacentPairIndex[0]=0;this._adjacentPairIndex[1]=0;this._adjacentPairIndex[2]=0},dump:function(){}};var Wa=function(){this.randId=Math.random()*1e5|0;this.v=new Is;this.w1=new Is;this.w2=new Is};Wa.prototype={init:function(t,a,i){var r=this.v;r.x=t.x;r.y=t.y;r.z=t.z;var o=this.w1;o.x=a.x;o.y=a.y;o.z=a.z;var s=this.w2;s.x=i.x;s.y=i.y;s.z=i.z;this._next=null;this._tmpEdgeLoopNext=null;this._tmpEdgeLoopOuterTriangle=null;return this},removeReferences:function(){this._next=null;this._tmpEdgeLoopNext=null;this._tmpEdgeLoopOuterTriangle=null}};var Bf=function(){this.prevClosestDir=new Is};Bf.prototype={clear:function(){this.prevClosestDir.zero()}};var Is=function(t,a,i){if(i==null){i=0}if(a==null){a=0}if(t==null){t=0}this.x=t;this.y=a;this.z=i;Is.numCreations++};Is.prototype={init:function(t,a,i){this.x=t;this.y=a;this.z=i;return this},zero:function(){var t=0;var a=0;var i=0;this.x=t;this.y=a;this.z=i;return this},add:function(t){return new Is(this.x+t.x,this.y+t.y,this.z+t.z)},addScaled:function(t,a){return new Is(this.x+t.x*a,this.y+t.y*a,this.z+t.z*a)},sub:function(t){return new Is(this.x-t.x,this.y-t.y,this.z-t.z)},scale:function(t){return new Is(this.x*t,this.y*t,this.z*t)},scale3:function(t,a,i){return new Is(this.x*t,this.y*a,this.z*i)},dot:function(t){return this.x*t.x+this.y*t.y+this.z*t.z},cross:function(t){return new Is(this.y*t.z-this.z*t.y,this.z*t.x-this.x*t.z,this.x*t.y-this.y*t.x)},addEq:function(t){var a=this.x+t.x;var i=this.y+t.y;var r=this.z+t.z;this.x=a;this.y=i;this.z=r;return this},addScaledEq:function(t,a){var i=this.x+t.x*a;var r=this.y+t.y*a;var o=this.z+t.z*a;this.x=i;this.y=r;this.z=o;return this},subEq:function(t){var a=this.x-t.x;var i=this.y-t.y;var r=this.z-t.z;this.x=a;this.y=i;this.z=r;return this},scaleEq:function(t){var a=this.x*t;var i=this.y*t;var r=this.z*t;this.x=a;this.y=i;this.z=r;return this},scale3Eq:function(t,a,i){var r=this.x*t;var o=this.y*a;var s=this.z*i;this.x=r;this.y=o;this.z=s;return this},crossEq:function(t){var a=this.y*t.z-this.z*t.y;var i=this.z*t.x-this.x*t.z;var r=this.x*t.y-this.y*t.x;this.x=a;this.y=i;this.z=r;return this},mulMat3:function(t){return new Is(this.x*t.e00+this.y*t.e01+this.z*t.e02,this.x*t.e10+this.y*t.e11+this.z*t.e12,this.x*t.e20+this.y*t.e21+this.z*t.e22)},mulMat4:function(t){return new Is(this.x*t.e00+this.y*t.e01+this.z*t.e02+t.e03,this.x*t.e10+this.y*t.e11+this.z*t.e12+t.e13,this.x*t.e20+this.y*t.e21+this.z*t.e22+t.e23)},mulTransform:function(t){var a;var i;var r;var o;var s=this;i=s.x;r=s.y;o=s.z;var n;var e;var _;n=t._rotation00*i+t._rotation01*r+t._rotation02*o;e=t._rotation10*i+t._rotation11*r+t._rotation12*o;_=t._rotation20*i+t._rotation21*r+t._rotation22*o;i=n;r=e;o=_;i+=t._positionX;r+=t._positionY;o+=t._positionZ;var v=new Is;var h=v;h.x=i;h.y=r;h.z=o;return v},mulMat3Eq:function(t){var a=this.x*t.e00+this.y*t.e01+this.z*t.e02;var i=this.x*t.e10+this.y*t.e11+this.z*t.e12;var r=this.x*t.e20+this.y*t.e21+this.z*t.e22;this.x=a;this.y=i;this.z=r;return this},mulMat4Eq:function(t){var a=this.x*t.e00+this.y*t.e01+this.z*t.e02+t.e03;var i=this.x*t.e10+this.y*t.e11+this.z*t.e12+t.e13;var r=this.x*t.e20+this.y*t.e21+this.z*t.e22+t.e23;this.x=a;this.y=i;this.z=r;return this},mulTransformEq:function(t){var a;var i;var r;var o;var s=this;i=s.x;r=s.y;o=s.z;var n;var e;var _;n=t._rotation00*i+t._rotation01*r+t._rotation02*o;e=t._rotation10*i+t._rotation11*r+t._rotation12*o;_=t._rotation20*i+t._rotation21*r+t._rotation22*o;i=n;r=e;o=_;i+=t._positionX;r+=t._positionY;o+=t._positionZ;var v=this;v.x=i;v.y=r;v.z=o;return this},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},normalized:function(){var t=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z);if(t>0){t=1/t}return new Is(this.x*t,this.y*t,this.z*t)},normalize:function(){var t=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z);if(t>0){t=1/t}var a=this.x*t;var i=this.y*t;var r=this.z*t;this.x=a;this.y=i;this.z=r;return this},negate:function(){return new Is(-this.x,-this.y,-this.z)},negateEq:function(){var t=-this.x;var a=-this.y;var i=-this.z;this.x=t;this.y=a;this.z=i;return this},copyFrom:function(t){this.x=t.x;this.y=t.y;this.z=t.z;return this},clone:function(){return new Is(this.x,this.y,this.z)},toString:function(){return"Vec3["+(this.x>0?(this.x*1e7+.5|0)/1e7:(this.x*1e7-.5|0)/1e7)+", "+(this.y>0?(this.y*1e7+.5|0)/1e7:(this.y*1e7-.5|0)/1e7)+", "+(this.z>0?(this.z*1e7+.5|0)/1e7:(this.z*1e7-.5|0)/1e7)+"]"}};var j=function(){this._positionX=0;this._positionY=0;this._positionZ=0;this._rotation00=1;this._rotation01=0;this._rotation02=0;this._rotation10=0;this._rotation11=1;this._rotation12=0;this._rotation20=0;this._rotation21=0;this._rotation22=1};j.prototype={identity:function(){this._positionX=0;this._positionY=0;this._positionZ=0;this._rotation00=1;this._rotation01=0;this._rotation02=0;this._rotation10=0;this._rotation11=1;this._rotation12=0;this._rotation20=0;this._rotation21=0;this._rotation22=1;return this},getPosition:function(){var t=new Is;var a=t;a.x=this._positionX;a.y=this._positionY;a.z=this._positionZ;return t},getPositionTo:function(t){var a=t;a.x=this._positionX;a.y=this._positionY;a.z=this._positionZ},setPosition:function(t){var a=t;this._positionX=a.x;this._positionY=a.y;this._positionZ=a.z;return this},translate:function(t){var a;var i;var r;var o;var s=t;i=s.x;r=s.y;o=s.z;this._positionX+=i;this._positionY+=r;this._positionZ+=o},getRotation:function(){var t=new ws;var a=t;a.e00=this._rotation00;a.e01=this._rotation01;a.e02=this._rotation02;a.e10=this._rotation10;a.e11=this._rotation11;a.e12=this._rotation12;a.e20=this._rotation20;a.e21=this._rotation21;a.e22=this._rotation22;return t},getRotationTo:function(t){var a=t;a.e00=this._rotation00;a.e01=this._rotation01;a.e02=this._rotation02;a.e10=this._rotation10;a.e11=this._rotation11;a.e12=this._rotation12;a.e20=this._rotation20;a.e21=this._rotation21;a.e22=this._rotation22},setRotation:function(t){var a=t;this._rotation00=a.e00;this._rotation01=a.e01;this._rotation02=a.e02;this._rotation10=a.e10;this._rotation11=a.e11;this._rotation12=a.e12;this._rotation20=a.e20;this._rotation21=a.e21;this._rotation22=a.e22;return this},setRotationXyz:function(t){var a;var i;var r;var o;var s=t;i=s.x;r=s.y;o=s.z;var n=Math.sin(i);var e=Math.sin(r);var _=Math.sin(o);var v=Math.cos(i);var h=Math.cos(r);var l=Math.cos(o);this._rotation00=h*l;this._rotation01=-h*_;this._rotation02=e;this._rotation10=v*_+l*n*e;this._rotation11=v*l-n*e*_;this._rotation12=-h*n;this._rotation20=n*_-v*l*e;this._rotation21=l*n+v*e*_;this._rotation22=v*h},rotate:function(t){var a;var i;var r;var o;var s;var n;var e;var _;var v;var h;var l=t;i=l.e00;r=l.e01;o=l.e02;s=l.e10;n=l.e11;e=l.e12;_=l.e20;v=l.e21;h=l.e22;var c;var p;var f;var m;var b;var u;var x;var y;var g;c=i*this._rotation00+r*this._rotation10+o*this._rotation20;p=i*this._rotation01+r*this._rotation11+o*this._rotation21;f=i*this._rotation02+r*this._rotation12+o*this._rotation22;m=s*this._rotation00+n*this._rotation10+e*this._rotation20;b=s*this._rotation01+n*this._rotation11+e*this._rotation21;u=s*this._rotation02+n*this._rotation12+e*this._rotation22;x=_*this._rotation00+v*this._rotation10+h*this._rotation20;y=_*this._rotation01+v*this._rotation11+h*this._rotation21;g=_*this._rotation02+v*this._rotation12+h*this._rotation22;this._rotation00=c;this._rotation01=p;this._rotation02=f;this._rotation10=m;this._rotation11=b;this._rotation12=u;this._rotation20=x;this._rotation21=y;this._rotation22=g},rotateXyz:function(t){var a;var i;var r;var o;var s;var n;var e;var _;var v;var h;var l;var c;var p;var f;var m=t;i=m.x;r=m.y;o=m.z;var b=Math.sin(i);var u=Math.sin(r);var x=Math.sin(o);var y=Math.cos(i);var g=Math.cos(r);var X=Math.cos(o);n=g*X;e=-g*x;_=u;v=y*x+X*b*u;h=y*X-b*u*x;l=-g*b;c=b*x-y*X*u;p=X*b+y*u*x;f=y*g;var z;var M;var Y;var Z;var d;var I;var w;var V;var L;z=n*this._rotation00+e*this._rotation10+_*this._rotation20;M=n*this._rotation01+e*this._rotation11+_*this._rotation21;Y=n*this._rotation02+e*this._rotation12+_*this._rotation22;Z=v*this._rotation00+h*this._rotation10+l*this._rotation20;d=v*this._rotation01+h*this._rotation11+l*this._rotation21;I=v*this._rotation02+h*this._rotation12+l*this._rotation22;w=c*this._rotation00+p*this._rotation10+f*this._rotation20;V=c*this._rotation01+p*this._rotation11+f*this._rotation21;L=c*this._rotation02+p*this._rotation12+f*this._rotation22;this._rotation00=z;this._rotation01=M;this._rotation02=Y;this._rotation10=Z;this._rotation11=d;this._rotation12=I;this._rotation20=w;this._rotation21=V;this._rotation22=L},getOrientation:function(){var t=new va;var a;var i;var r;var o;var s;var n=this._rotation00;var e=this._rotation11;var _=this._rotation22;var v=n+e+_;var h;if(v>0){h=Math.sqrt(v+1);s=.5*h;h=.5/h;i=(this._rotation21-this._rotation12)*h;r=(this._rotation02-this._rotation20)*h;o=(this._rotation10-this._rotation01)*h}else if(n>e){if(n>_){h=Math.sqrt(n-e-_+1);i=.5*h;h=.5/h;r=(this._rotation01+this._rotation10)*h;o=(this._rotation02+this._rotation20)*h;s=(this._rotation21-this._rotation12)*h}else{h=Math.sqrt(_-n-e+1);o=.5*h;h=.5/h;i=(this._rotation02+this._rotation20)*h;r=(this._rotation12+this._rotation21)*h;s=(this._rotation10-this._rotation01)*h}}else if(e>_){h=Math.sqrt(e-_-n+1);r=.5*h;h=.5/h;i=(this._rotation01+this._rotation10)*h;o=(this._rotation12+this._rotation21)*h;s=(this._rotation02-this._rotation20)*h}else{h=Math.sqrt(_-n-e+1);o=.5*h;h=.5/h;i=(this._rotation02+this._rotation20)*h;r=(this._rotation12+this._rotation21)*h;s=(this._rotation10-this._rotation01)*h}var l=t;l.x=i;l.y=r;l.z=o;l.w=s;return t},getOrientationTo:function(t){var a;var i;var r;var o;var s;var n=this._rotation00;var e=this._rotation11;var _=this._rotation22;var v=n+e+_;var h;if(v>0){h=Math.sqrt(v+1);s=.5*h;h=.5/h;i=(this._rotation21-this._rotation12)*h;r=(this._rotation02-this._rotation20)*h;o=(this._rotation10-this._rotation01)*h}else if(n>e){if(n>_){h=Math.sqrt(n-e-_+1);i=.5*h;h=.5/h;r=(this._rotation01+this._rotation10)*h;o=(this._rotation02+this._rotation20)*h;s=(this._rotation21-this._rotation12)*h}else{h=Math.sqrt(_-n-e+1);o=.5*h;h=.5/h;i=(this._rotation02+this._rotation20)*h;r=(this._rotation12+this._rotation21)*h;s=(this._rotation10-this._rotation01)*h}}else if(e>_){h=Math.sqrt(e-_-n+1);r=.5*h;h=.5/h;i=(this._rotation01+this._rotation10)*h;o=(this._rotation12+this._rotation21)*h;s=(this._rotation02-this._rotation20)*h}else{h=Math.sqrt(_-n-e+1);o=.5*h;h=.5/h;i=(this._rotation02+this._rotation20)*h;r=(this._rotation12+this._rotation21)*h;s=(this._rotation10-this._rotation01)*h}var l=t;l.x=i;l.y=r;l.z=o;l.w=s},setOrientation:function(t){var a;var i;var r;var o;var s;var n=t;i=n.x;r=n.y;o=n.z;s=n.w;var e=i;var _=r;var v=o;var h=s;var l=2*e;var c=2*_;var p=2*v;var f=e*l;var m=_*c;var b=v*p;var u=e*c;var x=_*p;var y=e*p;var g=h*l;var X=h*c;var z=h*p;this._rotation00=1-m-b;this._rotation01=u-z;this._rotation02=y+X;this._rotation10=u+z;this._rotation11=1-f-b;this._rotation12=x-g;this._rotation20=y-X;this._rotation21=x+g;this._rotation22=1-f-m;return this},clone:function(){var t=new j;t._positionX=this._positionX;t._positionY=this._positionY;t._positionZ=this._positionZ;t._rotation00=this._rotation00;t._rotation01=this._rotation01;t._rotation02=this._rotation02;t._rotation10=this._rotation10;t._rotation11=this._rotation11;t._rotation12=this._rotation12;t._rotation20=this._rotation20;t._rotation21=this._rotation21;t._rotation22=this._rotation22;return t},copyFrom:function(t){this._positionX=t._positionX;this._positionY=t._positionY;this._positionZ=t._positionZ;this._rotation00=t._rotation00;this._rotation01=t._rotation01;this._rotation02=t._rotation02;this._rotation10=t._rotation10;this._rotation11=t._rotation11;this._rotation12=t._rotation12;this._rotation20=t._rotation20;this._rotation21=t._rotation21;this._rotation22=t._rotation22;return this}};var ys=function(){};var N=function(){var t=new Array(4);this.s=t;var a=new Array(4);this.w1=a;var i=new Array(4);this.w2=i;var r=new Array(3);this.baseDirs=r;this.baseDirs[0]=new Is(1,0,0);this.baseDirs[1]=new Is(0,1,0);this.baseDirs[2]=new Is(0,0,1);this.tl1=new Is;this.tl2=new Is;this.rayX=new Is;this.rayR=new Is;this.tempTransform=new j;var o=0;while(o<4){var s=o++;this.s[s]=new Is;this.w1[s]=new Is;this.w2[s]=new Is}this.dir=new Is;this.closest=new Is;this.closestPoint1=new Is;this.closestPoint2=new Is;this.polyhedron=new q};N.getInstance=function(){return N.instance};N.prototype={computeClosestPointsImpl:function(t,a,i,r,o,s){this.c1=t;this.c2=a;this.tf1=i;this.tf2=r;var n=this.s;var e=this.w1;var _=this.w2;var v=this.closest;var h=this.dir;if(o!=null){if(o._gjkCache==null){o._gjkCache=new Bf}this.loadCache(o._gjkCache)}else{h.zero()}if(h.x*h.x+h.y*h.y+h.z*h.z==0){var l;var c;var p;var f;c=r._positionX-i._positionX;p=r._positionY-i._positionY;f=r._positionZ-i._positionZ;var m=h;m.x=c;m.y=p;m.z=f;if(h.x*h.x+h.y*h.y+h.z*h.z<1e-6){h.init(1,0,0)}}this.simplexSize=0;this.computeWitnessPoint1(false);this.computeWitnessPoint2(false);var b=this.s[this.simplexSize];var u=this.w1[this.simplexSize];b.x=u.x;b.y=u.y;b.z=u.z;var x=b;var y=this.w2[this.simplexSize];var g=x.x-y.x;var X=x.y-y.y;var z=x.z-y.z;x.x=g;x.y=X;x.z=z;this.simplexSize=1;var M=0;var Y=40;var Z=1e-4;var d=Z*Z;while(M<Y){var I=0;var w=this.simplexSize;switch(w){case 1:var V=n[0];v.x=V.x;v.y=V.y;v.z=V.z;I=1;break;case 2:var L;var A;var k;var B;var P;var T;var S;var C;var q=n[0];A=q.x;k=q.y;B=q.z;var R=n[1];T=R.x;S=R.y;C=R.z;var E;var j;var N;var D;j=T-A;N=S-k;D=C-B;var F=j*j+N*N+D*D;var O=j*A+N*k+D*B;O=-O/F;if(O<0){var W=v;W.x=A;W.y=k;W.z=B;I=1}else if(O>1){var G=v;G.x=T;G.y=S;G.z=C;I=2}else{var H;var U;var J;var Q;U=A+j*O;J=k+N*O;Q=B+D*O;var $=v;$.x=U;$.y=J;$.z=Q;I=3}break;case 3:var K=n[0];var tt=n[1];var at=n[2];var it;var rt;var ot;var st;var nt;var et;var _t;var vt;var ht;var lt;var ct;var pt;var ft;var mt;var bt;var ut;var xt;var yt;var gt;var Xt;var zt;var Mt;var Yt;var Zt;var dt=K;rt=dt.x;ot=dt.y;st=dt.z;var It=tt;et=It.x;_t=It.y;vt=It.z;var wt=at;lt=wt.x;ct=wt.y;pt=wt.z;mt=et-rt;bt=_t-ot;ut=vt-st;yt=lt-et;gt=ct-_t;Xt=pt-vt;Mt=rt-lt;Yt=ot-ct;Zt=st-pt;var Vt;var Lt;var At;var kt;Lt=bt*Xt-ut*gt;At=ut*yt-mt*Xt;kt=mt*gt-bt*yt;var Bt;var Pt;var Tt;var St;var Ct;var qt;var Rt;var Et;var jt;var Nt;var Dt;var Ft;Pt=bt*kt-ut*At;Tt=ut*Lt-mt*kt;St=mt*At-bt*Lt;qt=gt*kt-Xt*At;Rt=Xt*Lt-yt*kt;Et=yt*At-gt*Lt;Nt=Yt*kt-Zt*At;Dt=Zt*Lt-Mt*kt;Ft=Mt*At-Yt*Lt;var Ot=rt*Pt+ot*Tt+st*St;var Wt=et*qt+_t*Rt+vt*Et;var Gt=lt*Nt+ct*Dt+pt*Ft;var Ht=-1;var Ut;var Jt;var Qt;var $t;var Kt=0;Jt=0;Qt=0;$t=0;if(Ot<0){var ta;var aa;var ia;var ra;var oa;var sa;var na;var ea;var _a=K;aa=_a.x;ia=_a.y;ra=_a.z;var va=tt;sa=va.x;na=va.y;ea=va.z;var ha;var la;var ca;var pa;la=sa-aa;ca=na-ia;pa=ea-ra;var fa=la*la+ca*ca+pa*pa;var ma=la*aa+ca*ia+pa*ra;ma=-ma/fa;var ba;if(ma<0){var ua=v;ua.x=aa;ua.y=ia;ua.z=ra;ba=1}else if(ma>1){var xa=v;xa.x=sa;xa.y=na;xa.z=ea;ba=2}else{var ya;var ga;var Xa;var za;ga=aa+la*ma;Xa=ia+ca*ma;za=ra+pa*ma;var Ma=v;Ma.x=ga;Ma.y=Xa;Ma.z=za;ba=3}var Ya=v.x*v.x+v.y*v.y+v.z*v.z;Kt=ba;Ht=Ya;var Za=v;Jt=Za.x;Qt=Za.y;$t=Za.z}if(Wt<0){var da;var Ia;var wa;var Va;var La;var Aa;var ka;var Ba;var Pa=tt;Ia=Pa.x;wa=Pa.y;Va=Pa.z;var Ta=at;Aa=Ta.x;ka=Ta.y;Ba=Ta.z;var Sa;var Ca;var qa;var Ra;Ca=Aa-Ia;qa=ka-wa;Ra=Ba-Va;var Ea=Ca*Ca+qa*qa+Ra*Ra;var ja=Ca*Ia+qa*wa+Ra*Va;ja=-ja/Ea;var Na;if(ja<0){var Da=v;Da.x=Ia;Da.y=wa;Da.z=Va;Na=1}else if(ja>1){var Fa=v;Fa.x=Aa;Fa.y=ka;Fa.z=Ba;Na=2}else{var Oa;var Wa;var Ga;var Ha;Wa=Ia+Ca*ja;Ga=wa+qa*ja;Ha=Va+Ra*ja;var Ua=v;Ua.x=Wa;Ua.y=Ga;Ua.z=Ha;Na=3}var Ja=v.x*v.x+v.y*v.y+v.z*v.z;if(Ht<0||Ja<Ht){Kt=Na<<1;Ht=Ja;var Qa=v;Jt=Qa.x;Qt=Qa.y;$t=Qa.z}}if(Gt<0){var $a;var Ka;var ti;var ai;var ii;var ri;var oi;var si;var ni=K;Ka=ni.x;ti=ni.y;ai=ni.z;var ei=at;ri=ei.x;oi=ei.y;si=ei.z;var _i;var vi;var hi;var li;vi=ri-Ka;hi=oi-ti;li=si-ai;var ci=vi*vi+hi*hi+li*li;var pi=vi*Ka+hi*ti+li*ai;pi=-pi/ci;var fi;if(pi<0){var mi=v;mi.x=Ka;mi.y=ti;mi.z=ai;fi=1}else if(pi>1){var bi=v;bi.x=ri;bi.y=oi;bi.z=si;fi=2}else{var ui;var xi;var yi;var gi;xi=Ka+vi*pi;yi=ti+hi*pi;gi=ai+li*pi;var Xi=v;Xi.x=xi;Xi.y=yi;Xi.z=gi;fi=3}var zi=v.x*v.x+v.y*v.y+v.z*v.z;if(Ht<0||zi<Ht){Kt=fi&1|(fi&2)<<1;Ht=zi;var Mi=v;Jt=Mi.x;Qt=Mi.y;$t=Mi.z}}if(Ht>0){var Yi=v;Yi.x=Jt;Yi.y=Qt;Yi.z=$t;I=Kt}else{var Zi=Lt*Lt+At*At+kt*kt;if(Zi>0){Zi=1/Math.sqrt(Zi)}Lt*=Zi;At*=Zi;kt*=Zi;var di=rt*Lt+ot*At+st*kt;var Ii=Lt*Lt+At*At+kt*kt;Ii=di/Ii;Jt=Lt*Ii;Qt=At*Ii;$t=kt*Ii;var wi=v;wi.x=Jt;wi.y=Qt;wi.z=$t;I=7}break;case 4:var Vi=n[0];var Li=n[1];var Ai=n[2];var ki=n[3];var Bi;var Pi;var Ti;var Si;var Ci;var qi;var Ri;var Ei;var ji;var Ni;var Di;var Fi;var Oi;var Wi;var Gi;var Hi;var Ui;var Ji;var Qi;var $i;var Ki;var tr;var ar;var ir;var rr;var or;var sr;var nr;var er;var _r;var vr;var hr;var lr;var cr;var pr;var fr;var mr;var br;var ur;var xr;var yr=Vi;Pi=yr.x;Ti=yr.y;Si=yr.z;var gr=Li;qi=gr.x;Ri=gr.y;Ei=gr.z;var Xr=Ai;Ni=Xr.x;Di=Xr.y;Fi=Xr.z;var zr=ki;Wi=zr.x;Gi=zr.y;Hi=zr.z;Ji=qi-Pi;Qi=Ri-Ti;$i=Ei-Si;tr=Ni-Pi;ar=Di-Ti;ir=Fi-Si;or=Wi-Pi;sr=Gi-Ti;nr=Hi-Si;_r=Ni-qi;vr=Di-Ri;hr=Fi-Ei;cr=Wi-qi;pr=Gi-Ri;fr=Hi-Ei;br=Wi-Ni;ur=Gi-Di;xr=Hi-Fi;var Mr;var Yr;var Zr;var dr;var Ir;var wr;var Vr;var Lr;var Ar;var kr;var Br;var Pr;var Tr;var Sr;var Cr;var qr;var Rr;var Er;var jr;var Nr;var Dr;Zr=Qi*ir-$i*ar;dr=$i*tr-Ji*ir;Ir=Ji*ar-Qi*tr;Vr=ar*nr-ir*sr;Lr=ir*or-tr*nr;Ar=tr*sr-ar*or;Br=sr*$i-nr*Qi;Pr=nr*Ji-or*$i;Tr=or*Qi-sr*Ji;Cr=pr*hr-fr*vr;qr=fr*_r-cr*hr;Rr=cr*vr-pr*_r;var Fr=Ji*Cr+Qi*qr+$i*Rr>0?1:-1;var Or=Pi*Zr+Ti*dr+Si*Ir;var Wr=Pi*Vr+Ti*Lr+Si*Ar;var Gr=Pi*Br+Ti*Pr+Si*Tr;var Hr=qi*Cr+Ri*qr+Ei*Rr;var Ur=-1;var Jr;var Qr;var $r;var Kr;var to=0;Qr=0;$r=0;Kr=0;if(Or*Fr<0){var ao;var io;var ro;var oo;var so;var no;var eo;var _o;var vo;var ho;var lo;var co;var po;var fo;var mo;var bo;var uo;var xo;var yo;var go;var Xo;var zo;var Mo;var Yo;var Zo=Vi;io=Zo.x;ro=Zo.y;oo=Zo.z;var Io=Li;no=Io.x;eo=Io.y;_o=Io.z;var wo=Ai;ho=wo.x;lo=wo.y;co=wo.z;fo=no-io;mo=eo-ro;bo=_o-oo;xo=ho-no;yo=lo-eo;go=co-_o;zo=io-ho;Mo=ro-lo;Yo=oo-co;var Vo;var Lo;var Ao;var ko;Lo=mo*go-bo*yo;Ao=bo*xo-fo*go;ko=fo*yo-mo*xo;var Bo;var Po;var To;var So;var Co;var qo;var Ro;var Eo;var jo;var No;var Do;var Fo;Po=mo*ko-bo*Ao;To=bo*Lo-fo*ko;So=fo*Ao-mo*Lo;qo=yo*ko-go*Ao;Ro=go*Lo-xo*ko;Eo=xo*Ao-yo*Lo;No=Mo*ko-Yo*Ao;Do=Yo*Lo-zo*ko;Fo=zo*Ao-Mo*Lo;var Oo=io*Po+ro*To+oo*So;var Wo=no*qo+eo*Ro+_o*Eo;var Go=ho*No+lo*Do+co*Fo;var Ho=-1;var Uo;var Jo;var Qo;var $o;var Ko=0;Jo=0;Qo=0;$o=0;if(Oo<0){var ts;var as;var is;var rs;var os;var ss;var ns;var es;var _s=Vi;as=_s.x;is=_s.y;rs=_s.z;var vs=Li;ss=vs.x;ns=vs.y;es=vs.z;var hs;var ls;var cs;var ps;ls=ss-as;cs=ns-is;ps=es-rs;var fs=ls*ls+cs*cs+ps*ps;var ms=ls*as+cs*is+ps*rs;ms=-ms/fs;var bs;if(ms<0){var us=v;us.x=as;us.y=is;us.z=rs;bs=1}else if(ms>1){var xs=v;xs.x=ss;xs.y=ns;xs.z=es;bs=2}else{var ys;var gs;var Xs;var zs;gs=as+ls*ms;Xs=is+cs*ms;zs=rs+ps*ms;var Ms=v;Ms.x=gs;Ms.y=Xs;Ms.z=zs;bs=3}var Ys=v.x*v.x+v.y*v.y+v.z*v.z;Ko=bs;Ho=Ys;var Zs=v;Jo=Zs.x;Qo=Zs.y;$o=Zs.z}if(Wo<0){var ds;var Is;var ws;var Vs;var Ls;var As;var ks;var Bs;var Ps=Li;Is=Ps.x;ws=Ps.y;Vs=Ps.z;var Ts=Ai;As=Ts.x;ks=Ts.y;Bs=Ts.z;var Ss;var Cs;var qs;var Rs;Cs=As-Is;qs=ks-ws;Rs=Bs-Vs;var Es=Cs*Cs+qs*qs+Rs*Rs;var js=Cs*Is+qs*ws+Rs*Vs;js=-js/Es;var Ns;if(js<0){var Ds=v;Ds.x=Is;Ds.y=ws;Ds.z=Vs;Ns=1}else if(js>1){var Fs=v;Fs.x=As;Fs.y=ks;Fs.z=Bs;Ns=2}else{var Os;var Ws;var Gs;var Hs;Ws=Is+Cs*js;Gs=ws+qs*js;Hs=Vs+Rs*js;var Us=v;Us.x=Ws;Us.y=Gs;Us.z=Hs;Ns=3}var Js=v.x*v.x+v.y*v.y+v.z*v.z;if(Ho<0||Js<Ho){Ko=Ns<<1;Ho=Js;var Qs=v;Jo=Qs.x;Qo=Qs.y;$o=Qs.z}}if(Go<0){var $s;var Ks;var tn;var an;var rn;var on;var sn;var nn;var en=Vi;Ks=en.x;tn=en.y;an=en.z;var _n=Ai;on=_n.x;sn=_n.y;nn=_n.z;var vn;var hn;var ln;var cn;hn=on-Ks;ln=sn-tn;cn=nn-an;var pn=hn*hn+ln*ln+cn*cn;var fn=hn*Ks+ln*tn+cn*an;fn=-fn/pn;var mn;if(fn<0){var bn=v;bn.x=Ks;bn.y=tn;bn.z=an;mn=1}else if(fn>1){var un=v;un.x=on;un.y=sn;un.z=nn;mn=2}else{var xn;var yn;var gn;var Xn;yn=Ks+hn*fn;gn=tn+ln*fn;Xn=an+cn*fn;var zn=v;zn.x=yn;zn.y=gn;zn.z=Xn;mn=3}var Mn=v.x*v.x+v.y*v.y+v.z*v.z;if(Ho<0||Mn<Ho){Ko=mn&1|(mn&2)<<1;Ho=Mn;var Yn=v;Jo=Yn.x;Qo=Yn.y;$o=Yn.z}}var Zn;if(Ho>0){var dn=v;dn.x=Jo;dn.y=Qo;dn.z=$o;Zn=Ko}else{var In=Lo*Lo+Ao*Ao+ko*ko;if(In>0){In=1/Math.sqrt(In)}Lo*=In;Ao*=In;ko*=In;var wn=io*Lo+ro*Ao+oo*ko;var Vn=Lo*Lo+Ao*Ao+ko*ko;Vn=wn/Vn;Jo=Lo*Vn;Qo=Ao*Vn;$o=ko*Vn;var Ln=v;Ln.x=Jo;Ln.y=Qo;Ln.z=$o;Zn=7}var An=v.x*v.x+v.y*v.y+v.z*v.z;to=Zn;Ur=An;var kn=v;Qr=kn.x;$r=kn.y;Kr=kn.z}if(Wr*Fr<0){var Bn;var Pn;var Tn;var Sn;var Cn;var qn;var Rn;var En;var jn;var Nn;var Dn;var Fn;var On;var Wn;var Gn;var Hn;var Un;var Jn;var Qn;var $n;var Kn;var te;var ae;var ie;var re=Vi;Pn=re.x;Tn=re.y;Sn=re.z;var oe=Ai;qn=oe.x;Rn=oe.y;En=oe.z;var se=ki;Nn=se.x;Dn=se.y;Fn=se.z;Wn=qn-Pn;Gn=Rn-Tn;Hn=En-Sn;Jn=Nn-qn;Qn=Dn-Rn;$n=Fn-En;te=Pn-Nn;ae=Tn-Dn;ie=Sn-Fn;var ne;var ee;var _e;var ve;ee=Gn*$n-Hn*Qn;_e=Hn*Jn-Wn*$n;ve=Wn*Qn-Gn*Jn;var he;var le;var ce;var pe;var fe;var me;var be;var ue;var xe;var ye;var ge;var Xe;le=Gn*ve-Hn*_e;ce=Hn*ee-Wn*ve;pe=Wn*_e-Gn*ee;me=Qn*ve-$n*_e;be=$n*ee-Jn*ve;ue=Jn*_e-Qn*ee;ye=ae*ve-ie*_e;ge=ie*ee-te*ve;Xe=te*_e-ae*ee;var ze=Pn*le+Tn*ce+Sn*pe;var Me=qn*me+Rn*be+En*ue;var Ye=Nn*ye+Dn*ge+Fn*Xe;var Ze=-1;var de;var Ie;var we;var Ve;var Le=0;Ie=0;we=0;Ve=0;if(ze<0){var Ae;var ke;var Be;var Pe;var Te;var Se;var Ce;var qe;var Re=Vi;ke=Re.x;Be=Re.y;Pe=Re.z;var Ee=Ai;Se=Ee.x;Ce=Ee.y;qe=Ee.z;var je;var Ne;var De;var Fe;Ne=Se-ke;De=Ce-Be;Fe=qe-Pe;var Oe=Ne*Ne+De*De+Fe*Fe;var We=Ne*ke+De*Be+Fe*Pe;We=-We/Oe;var Ge;if(We<0){var He=v;He.x=ke;He.y=Be;He.z=Pe;Ge=1}else if(We>1){var Ue=v;Ue.x=Se;Ue.y=Ce;Ue.z=qe;Ge=2}else{var Je;var Qe;var $e;var Ke;Qe=ke+Ne*We;$e=Be+De*We;Ke=Pe+Fe*We;var t_=v;t_.x=Qe;t_.y=$e;t_.z=Ke;Ge=3}var a_=v.x*v.x+v.y*v.y+v.z*v.z;Le=Ge;Ze=a_;var i_=v;Ie=i_.x;we=i_.y;Ve=i_.z}if(Me<0){var r_;var o_;var s_;var n_;var e_;var __;var v_;var h_;var l_=Ai;o_=l_.x;s_=l_.y;n_=l_.z;var c_=ki;__=c_.x;v_=c_.y;h_=c_.z;var p_;var f_;var m_;var b_;f_=__-o_;m_=v_-s_;b_=h_-n_;var u_=f_*f_+m_*m_+b_*b_;var x_=f_*o_+m_*s_+b_*n_;x_=-x_/u_;var y_;if(x_<0){var g_=v;g_.x=o_;g_.y=s_;g_.z=n_;y_=1}else if(x_>1){var X_=v;X_.x=__;X_.y=v_;X_.z=h_;y_=2}else{var z_;var M_;var Y_;var Z_;M_=o_+f_*x_;Y_=s_+m_*x_;Z_=n_+b_*x_;var d_=v;d_.x=M_;d_.y=Y_;d_.z=Z_;y_=3}var I_=v.x*v.x+v.y*v.y+v.z*v.z;if(Ze<0||I_<Ze){Le=y_<<1;Ze=I_;var w_=v;Ie=w_.x;we=w_.y;Ve=w_.z}}if(Ye<0){var V_;var L_;var A_;var k_;var B_;var P_;var T_;var S_;var C_=Vi;L_=C_.x;A_=C_.y;k_=C_.z;var q_=ki;P_=q_.x;T_=q_.y;S_=q_.z;var R_;var E_;var j_;var N_;E_=P_-L_;j_=T_-A_;N_=S_-k_;var D_=E_*E_+j_*j_+N_*N_;var F_=E_*L_+j_*A_+N_*k_;F_=-F_/D_;var O_;if(F_<0){var W_=v;W_.x=L_;W_.y=A_;W_.z=k_;O_=1}else if(F_>1){var G_=v;G_.x=P_;G_.y=T_;G_.z=S_;O_=2}else{var H_;var U_;var J_;var Q_;U_=L_+E_*F_;J_=A_+j_*F_;Q_=k_+N_*F_;var $_=v;$_.x=U_;$_.y=J_;$_.z=Q_;O_=3}var K_=v.x*v.x+v.y*v.y+v.z*v.z;if(Ze<0||K_<Ze){Le=O_&1|(O_&2)<<1;Ze=K_;var tv=v;Ie=tv.x;we=tv.y;Ve=tv.z}}var av;if(Ze>0){var iv=v;iv.x=Ie;iv.y=we;iv.z=Ve;av=Le}else{var rv=ee*ee+_e*_e+ve*ve;if(rv>0){rv=1/Math.sqrt(rv)}ee*=rv;_e*=rv;ve*=rv;var ov=Pn*ee+Tn*_e+Sn*ve;var sv=ee*ee+_e*_e+ve*ve;sv=ov/sv;Ie=ee*sv;we=_e*sv;Ve=ve*sv;var nv=v;nv.x=Ie;nv.y=we;nv.z=Ve;av=7}var ev=v.x*v.x+v.y*v.y+v.z*v.z;if(Ur<0||ev<Ur){to=av&1|(av&6)<<1;Ur=ev;var _v=v;Qr=_v.x;$r=_v.y;Kr=_v.z}}if(Gr*Fr<0){var vv;var hv;var lv;var cv;var pv;var fv;var mv;var bv;var uv;var xv;var yv;var gv;var Xv;var zv;var Mv;var Yv;var Zv;var dv;var Iv;var wv;var Vv;var Lv;var Av;var kv;var Bv=Vi;hv=Bv.x;lv=Bv.y;cv=Bv.z;var Pv=Li;fv=Pv.x;mv=Pv.y;bv=Pv.z;var Tv=ki;xv=Tv.x;yv=Tv.y;gv=Tv.z;zv=fv-hv;Mv=mv-lv;Yv=bv-cv;dv=xv-fv;Iv=yv-mv;wv=gv-bv;Lv=hv-xv;Av=lv-yv;kv=cv-gv;var Sv;var Cv;var qv;var Rv;Cv=Mv*wv-Yv*Iv;qv=Yv*dv-zv*wv;Rv=zv*Iv-Mv*dv;var Ev;var jv;var Nv;var Dv;var Fv;var Ov;var Wv;var Gv;var Hv;var Uv;var Jv;var Qv;jv=Mv*Rv-Yv*qv;Nv=Yv*Cv-zv*Rv;Dv=zv*qv-Mv*Cv;Ov=Iv*Rv-wv*qv;Wv=wv*Cv-dv*Rv;Gv=dv*qv-Iv*Cv;Uv=Av*Rv-kv*qv;Jv=kv*Cv-Lv*Rv;Qv=Lv*qv-Av*Cv;var $v=hv*jv+lv*Nv+cv*Dv;var Kv=fv*Ov+mv*Wv+bv*Gv;var th=xv*Uv+yv*Jv+gv*Qv;var ah=-1;var ih;var rh;var oh;var sh;var nh=0;rh=0;oh=0;sh=0;if($v<0){var eh;var _h;var vh;var hh;var lh;var ch;var ph;var fh;var mh=Vi;_h=mh.x;vh=mh.y;hh=mh.z;var bh=Li;ch=bh.x;ph=bh.y;fh=bh.z;var uh;var xh;var yh;var gh;xh=ch-_h;yh=ph-vh;gh=fh-hh;var Xh=xh*xh+yh*yh+gh*gh;var zh=xh*_h+yh*vh+gh*hh;zh=-zh/Xh;var Mh;if(zh<0){var Yh=v;Yh.x=_h;Yh.y=vh;Yh.z=hh;Mh=1}else if(zh>1){var Zh=v;Zh.x=ch;Zh.y=ph;Zh.z=fh;Mh=2}else{var dh;var Ih;var wh;var Vh;Ih=_h+xh*zh;wh=vh+yh*zh;Vh=hh+gh*zh;var Lh=v;Lh.x=Ih;Lh.y=wh;Lh.z=Vh;Mh=3}var Ah=v.x*v.x+v.y*v.y+v.z*v.z;nh=Mh;ah=Ah;var kh=v;rh=kh.x;oh=kh.y;sh=kh.z}if(Kv<0){var Bh;var Ph;var Th;var Sh;var Ch;var qh;var Rh;var Eh;var jh=Li;Ph=jh.x;Th=jh.y;Sh=jh.z;var Nh=ki;qh=Nh.x;Rh=Nh.y;Eh=Nh.z;var Dh;var Fh;var Oh;var Wh;Fh=qh-Ph;Oh=Rh-Th;Wh=Eh-Sh;var Gh=Fh*Fh+Oh*Oh+Wh*Wh;var Hh=Fh*Ph+Oh*Th+Wh*Sh;Hh=-Hh/Gh;var Uh;if(Hh<0){var Jh=v;Jh.x=Ph;Jh.y=Th;Jh.z=Sh;Uh=1}else if(Hh>1){var Qh=v;Qh.x=qh;Qh.y=Rh;Qh.z=Eh;Uh=2}else{var $h;var Kh;var tl;var al;Kh=Ph+Fh*Hh;tl=Th+Oh*Hh;al=Sh+Wh*Hh;var il=v;il.x=Kh;il.y=tl;il.z=al;Uh=3}var rl=v.x*v.x+v.y*v.y+v.z*v.z;if(ah<0||rl<ah){nh=Uh<<1;ah=rl;var ol=v;rh=ol.x;oh=ol.y;sh=ol.z}}if(th<0){var sl;var nl;var el;var _l;var vl;var hl;var ll;var cl;var pl=Vi;nl=pl.x;el=pl.y;_l=pl.z;var fl=ki;hl=fl.x;ll=fl.y;cl=fl.z;var ml;var bl;var ul;var xl;bl=hl-nl;ul=ll-el;xl=cl-_l;var yl=bl*bl+ul*ul+xl*xl;var gl=bl*nl+ul*el+xl*_l;gl=-gl/yl;var Xl;if(gl<0){var zl=v;zl.x=nl;zl.y=el;zl.z=_l;Xl=1}else if(gl>1){var Ml=v;Ml.x=hl;Ml.y=ll;Ml.z=cl;Xl=2}else{var Yl;var Zl;var dl;var Il;Zl=nl+bl*gl;dl=el+ul*gl;Il=_l+xl*gl;var wl=v;wl.x=Zl;wl.y=dl;wl.z=Il;Xl=3}var Vl=v.x*v.x+v.y*v.y+v.z*v.z;if(ah<0||Vl<ah){nh=Xl&1|(Xl&2)<<1;ah=Vl;var Ll=v;rh=Ll.x;oh=Ll.y;sh=Ll.z}}var Al;if(ah>0){var kl=v;kl.x=rh;kl.y=oh;kl.z=sh;Al=nh}else{var Bl=Cv*Cv+qv*qv+Rv*Rv;if(Bl>0){Bl=1/Math.sqrt(Bl)}Cv*=Bl;qv*=Bl;Rv*=Bl;var Pl=hv*Cv+lv*qv+cv*Rv;var Tl=Cv*Cv+qv*qv+Rv*Rv;Tl=Pl/Tl;rh=Cv*Tl;oh=qv*Tl;sh=Rv*Tl;var Sl=v;Sl.x=rh;Sl.y=oh;Sl.z=sh;Al=7}var Cl=v.x*v.x+v.y*v.y+v.z*v.z;if(Ur<0||Cl<Ur){to=Al&3|(Al&4)<<1;Ur=Cl;var ql=v;Qr=ql.x;$r=ql.y;Kr=ql.z}}if(Hr*Fr<0){var Rl;var El;var jl;var Nl;var Dl;var Fl;var Ol;var Wl;var Gl;var Hl;var Ul;var Jl;var Ql;var $l;var Kl;var tc;var ac;var ic;var rc;var oc;var sc;var nc;var ec;var _c;var vc=Li;El=vc.x;jl=vc.y;Nl=vc.z;var hc=Ai;Fl=hc.x;Ol=hc.y;Wl=hc.z;var lc=ki;Hl=lc.x;Ul=lc.y;Jl=lc.z;$l=Fl-El;Kl=Ol-jl;tc=Wl-Nl;ic=Hl-Fl;rc=Ul-Ol;oc=Jl-Wl;nc=El-Hl;ec=jl-Ul;_c=Nl-Jl;var cc;var pc;var fc;var mc;pc=Kl*oc-tc*rc;fc=tc*ic-$l*oc;mc=$l*rc-Kl*ic;var bc;var uc;var xc;var yc;var gc;var Xc;var zc;var Mc;var Yc;var Zc;var dc;var Ic;uc=Kl*mc-tc*fc;xc=tc*pc-$l*mc;yc=$l*fc-Kl*pc;Xc=rc*mc-oc*fc;zc=oc*pc-ic*mc;Mc=ic*fc-rc*pc;Zc=ec*mc-_c*fc;dc=_c*pc-nc*mc;Ic=nc*fc-ec*pc;var wc=El*uc+jl*xc+Nl*yc;var Vc=Fl*Xc+Ol*zc+Wl*Mc;var Lc=Hl*Zc+Ul*dc+Jl*Ic;var Ac=-1;var kc;var Bc;var Pc;var Tc;var Sc=0;Bc=0;Pc=0;Tc=0;if(wc<0){var Cc;var qc;var Rc;var Ec;var jc;var Nc;var Dc;var Fc;var Oc=Li;qc=Oc.x;Rc=Oc.y;Ec=Oc.z;var Wc=Ai;Nc=Wc.x;Dc=Wc.y;Fc=Wc.z;var Gc;var Hc;var Uc;var Jc;Hc=Nc-qc;Uc=Dc-Rc;Jc=Fc-Ec;var Qc=Hc*Hc+Uc*Uc+Jc*Jc;var $c=Hc*qc+Uc*Rc+Jc*Ec;$c=-$c/Qc;var Kc;if($c<0){var tp=v;tp.x=qc;tp.y=Rc;tp.z=Ec;Kc=1}else if($c>1){var ap=v;ap.x=Nc;ap.y=Dc;ap.z=Fc;Kc=2}else{var ip;var rp;var op;var sp;rp=qc+Hc*$c;op=Rc+Uc*$c;sp=Ec+Jc*$c;var np=v;np.x=rp;np.y=op;np.z=sp;Kc=3}var ep=v.x*v.x+v.y*v.y+v.z*v.z;Sc=Kc;Ac=ep;var _p=v;Bc=_p.x;Pc=_p.y;Tc=_p.z}if(Vc<0){var vp;var hp;var lp;var cp;var pp;var fp;var mp;var bp;var up=Ai;hp=up.x;lp=up.y;cp=up.z;var xp=ki;fp=xp.x;mp=xp.y;bp=xp.z;var yp;var gp;var Xp;var zp;gp=fp-hp;Xp=mp-lp;zp=bp-cp;var Mp=gp*gp+Xp*Xp+zp*zp;var Yp=gp*hp+Xp*lp+zp*cp;Yp=-Yp/Mp;var Zp;if(Yp<0){var dp=v;dp.x=hp;dp.y=lp;dp.z=cp;Zp=1}else if(Yp>1){var Ip=v;Ip.x=fp;Ip.y=mp;Ip.z=bp;Zp=2}else{var wp;var Vp;var Lp;var Ap;Vp=hp+gp*Yp;Lp=lp+Xp*Yp;Ap=cp+zp*Yp;var kp=v;kp.x=Vp;kp.y=Lp;kp.z=Ap;Zp=3}var Bp=v.x*v.x+v.y*v.y+v.z*v.z;if(Ac<0||Bp<Ac){Sc=Zp<<1;Ac=Bp;var Pp=v;Bc=Pp.x;Pc=Pp.y;Tc=Pp.z}}if(Lc<0){var Tp;var Sp;var Cp;var qp;var Rp;var Ep;var jp;var Np;var Dp=Li;Sp=Dp.x;Cp=Dp.y;qp=Dp.z;var Fp=ki;Ep=Fp.x;jp=Fp.y;Np=Fp.z;var Op;var Wp;var Gp;var Hp;Wp=Ep-Sp;Gp=jp-Cp;Hp=Np-qp;var Up=Wp*Wp+Gp*Gp+Hp*Hp;var Jp=Wp*Sp+Gp*Cp+Hp*qp;Jp=-Jp/Up;var Qp;if(Jp<0){var $p=v;$p.x=Sp;$p.y=Cp;$p.z=qp;Qp=1}else if(Jp>1){var Kp=v;Kp.x=Ep;Kp.y=jp;Kp.z=Np;Qp=2}else{var tf;var af;var rf;var of;af=Sp+Wp*Jp;rf=Cp+Gp*Jp;of=qp+Hp*Jp;var sf=v;sf.x=af;sf.y=rf;sf.z=of;Qp=3}var nf=v.x*v.x+v.y*v.y+v.z*v.z;if(Ac<0||nf<Ac){Sc=Qp&1|(Qp&2)<<1;Ac=nf;var ef=v;Bc=ef.x;Pc=ef.y;Tc=ef.z}}var _f;if(Ac>0){var vf=v;vf.x=Bc;vf.y=Pc;vf.z=Tc;_f=Sc}else{var hf=pc*pc+fc*fc+mc*mc;if(hf>0){hf=1/Math.sqrt(hf)}pc*=hf;fc*=hf;mc*=hf;var lf=El*pc+jl*fc+Nl*mc;var cf=pc*pc+fc*fc+mc*mc;cf=lf/cf;Bc=pc*cf;Pc=fc*cf;Tc=mc*cf;var pf=v;pf.x=Bc;pf.y=Pc;pf.z=Tc;_f=7}var ff=v.x*v.x+v.y*v.y+v.z*v.z;if(Ur<0||ff<Ur){to=_f<<1;Ur=ff;var mf=v;Qr=mf.x;$r=mf.y;Kr=mf.z}}if(Ur>0){var bf=v;bf.x=Qr;bf.y=$r;bf.z=Kr;I=to}else{v.zero();I=15}break}if(v.x*v.x+v.y*v.y+v.z*v.z<d){if(!s){this.distance=0;return 0}var uf=this.simplexSize;switch(uf){case 1:this.pointToTetrahedron();break;case 2:this.lineToTetrahedron();break;case 3:this.triangleToTetrahedron();break}if(this.simplexSize==4){var xf=this.computeDepth(t,a,i,r,n,e,_);if(xf!=0){this.distance=0;return xf}this.distance=-this.depth;return 0}this.distance=0;return 1}this.shrinkSimplex(I);h.x=v.x;h.y=v.y;h.z=v.z;var yf=h;var gf=-yf.x;var Xf=-yf.y;var zf=-yf.z;yf.x=gf;yf.y=Xf;yf.z=zf;this.computeWitnessPoint1(false);this.computeWitnessPoint2(false);var Mf=this.s[this.simplexSize];var Yf=this.w1[this.simplexSize];Mf.x=Yf.x;Mf.y=Yf.y;Mf.z=Yf.z;var Zf=Mf;var df=this.w2[this.simplexSize];var If=Zf.x-df.x;var wf=Zf.y-df.y;var Vf=Zf.z-df.z;Zf.x=If;Zf.y=wf;Zf.z=Vf;if(h.x*h.x+h.y*h.y+h.z*h.z<d){throw new Error("!?")}var Lf=v.x*h.x+v.y*h.y+v.z*h.z;var Af=n[this.simplexSize];var kf=Af.x*h.x+Af.y*h.y+Af.z*h.z;if(kf-Lf<d){this.interpolateClosestPoints();this.distance=Math.sqrt(v.x*v.x+v.y*v.y+v.z*v.z);if(o!=null&&o._gjkCache!=null){this.saveCache(o._gjkCache)}return 0}this.simplexSize++;++M}return 2},convexCastImpl:function(t,a,i,r,o,s,n){this.c1=t;this.c2=a;this.tf1=i;this.tf2=r;var e=this.s;var _=this.w1;var v=this.w2;var h=this.closest;var l=this.dir;var c;var p;var f;var m;p=r._positionX-i._positionX;f=r._positionY-i._positionY;m=r._positionZ-i._positionZ;var b=l;b.x=p;b.y=f;b.z=m;if(l.x*l.x+l.y*l.y+l.z*l.z<1e-6){l.init(1,0,0)}this.simplexSize=0;if(this.c1!=null){this.computeWitnessPoint1(true)}else{var u=this.w1[this.simplexSize];u.x=this.tf1._positionX;u.y=this.tf1._positionY;u.z=this.tf1._positionZ}this.computeWitnessPoint2(true);var x=this.s[this.simplexSize];var y=this.w1[this.simplexSize];x.x=y.x;x.y=y.y;x.z=y.z;var g=x;var X=this.w2[this.simplexSize];var z=g.x-X.x;var M=g.y-X.y;var Y=g.z-X.z;g.x=z;g.y=M;g.z=Y;this.simplexSize=1;var Z=0;var d=40;var I=0;var w=this.rayX;var V=this.rayR;w.zero();V.x=s.x;V.y=s.y;V.z=s.z;var L=V;var A=L.x-o.x;var k=L.y-o.y;var B=L.z-o.z;L.x=A;L.y=k;L.z=B;var P=1e-4;var T=P*P;while(Z<d){var S=0;var C=this.simplexSize;switch(C){case 1:var q=e[0];h.x=q.x;h.y=q.y;h.z=q.z;S=1;break;case 2:var R;var E;var j;var N;var D;var F;var O;var W;var G=e[0];E=G.x;j=G.y;N=G.z;var H=e[1];F=H.x;O=H.y;W=H.z;var U;var J;var Q;var $;J=F-E;Q=O-j;$=W-N;var K=J*J+Q*Q+$*$;var tt=J*E+Q*j+$*N;tt=-tt/K;if(tt<0){var at=h;at.x=E;at.y=j;at.z=N;S=1}else if(tt>1){var it=h;it.x=F;it.y=O;it.z=W;S=2}else{var rt;var ot;var st;var nt;ot=E+J*tt;st=j+Q*tt;nt=N+$*tt;var et=h;et.x=ot;et.y=st;et.z=nt;S=3}break;case 3:var _t=e[0];var vt=e[1];var ht=e[2];var lt;var ct;var pt;var ft;var mt;var bt;var ut;var xt;var yt;var gt;var Xt;var zt;var Mt;var Yt;var Zt;var dt;var It;var wt;var Vt;var Lt;var At;var kt;var Bt;var Pt;var Tt=_t;ct=Tt.x;pt=Tt.y;ft=Tt.z;var St=vt;bt=St.x;ut=St.y;xt=St.z;var Ct=ht;gt=Ct.x;Xt=Ct.y;zt=Ct.z;Yt=bt-ct;Zt=ut-pt;dt=xt-ft;wt=gt-bt;Vt=Xt-ut;Lt=zt-xt;kt=ct-gt;Bt=pt-Xt;Pt=ft-zt;var qt;var Rt;var Et;var jt;Rt=Zt*Lt-dt*Vt;Et=dt*wt-Yt*Lt;jt=Yt*Vt-Zt*wt;var Nt;var Dt;var Ft;var Ot;var Wt;var Gt;var Ht;var Ut;var Jt;var Qt;var $t;var Kt;Dt=Zt*jt-dt*Et;Ft=dt*Rt-Yt*jt;Ot=Yt*Et-Zt*Rt;Gt=Vt*jt-Lt*Et;Ht=Lt*Rt-wt*jt;Ut=wt*Et-Vt*Rt;Qt=Bt*jt-Pt*Et;$t=Pt*Rt-kt*jt;Kt=kt*Et-Bt*Rt;var ta=ct*Dt+pt*Ft+ft*Ot;var aa=bt*Gt+ut*Ht+xt*Ut;var ia=gt*Qt+Xt*$t+zt*Kt;var ra=-1;var oa;var sa;var na;var ea;var _a=0;sa=0;na=0;ea=0;if(ta<0){var va;var ha;var la;var ca;var pa;var fa;var ma;var ba;var ua=_t;ha=ua.x;la=ua.y;ca=ua.z;var xa=vt;fa=xa.x;ma=xa.y;ba=xa.z;var ya;var ga;var Xa;var za;ga=fa-ha;Xa=ma-la;za=ba-ca;var Ma=ga*ga+Xa*Xa+za*za;var Ya=ga*ha+Xa*la+za*ca;Ya=-Ya/Ma;var Za;if(Ya<0){var da=h;da.x=ha;da.y=la;da.z=ca;Za=1}else if(Ya>1){var Ia=h;Ia.x=fa;Ia.y=ma;Ia.z=ba;Za=2}else{var wa;var Va;var La;var Aa;Va=ha+ga*Ya;La=la+Xa*Ya;Aa=ca+za*Ya;var ka=h;ka.x=Va;ka.y=La;ka.z=Aa;Za=3}var Ba=h.x*h.x+h.y*h.y+h.z*h.z;_a=Za;ra=Ba;var Pa=h;sa=Pa.x;na=Pa.y;ea=Pa.z}if(aa<0){var Ta;var Sa;var Ca;var qa;var Ra;var Ea;var ja;var Na;var Da=vt;Sa=Da.x;Ca=Da.y;qa=Da.z;var Fa=ht;Ea=Fa.x;ja=Fa.y;Na=Fa.z;var Oa;var Wa;var Ga;var Ha;Wa=Ea-Sa;Ga=ja-Ca;Ha=Na-qa;var Ua=Wa*Wa+Ga*Ga+Ha*Ha;var Ja=Wa*Sa+Ga*Ca+Ha*qa;Ja=-Ja/Ua;var Qa;if(Ja<0){var $a=h;$a.x=Sa;$a.y=Ca;$a.z=qa;Qa=1}else if(Ja>1){var Ka=h;Ka.x=Ea;Ka.y=ja;Ka.z=Na;Qa=2}else{var ti;var ai;var ii;var ri;ai=Sa+Wa*Ja;ii=Ca+Ga*Ja;ri=qa+Ha*Ja;var oi=h;oi.x=ai;oi.y=ii;oi.z=ri;Qa=3}var si=h.x*h.x+h.y*h.y+h.z*h.z;if(ra<0||si<ra){_a=Qa<<1;ra=si;var ni=h;sa=ni.x;na=ni.y;ea=ni.z}}if(ia<0){var ei;var _i;var vi;var hi;var li;var ci;var pi;var fi;var mi=_t;_i=mi.x;vi=mi.y;hi=mi.z;var bi=ht;ci=bi.x;pi=bi.y;fi=bi.z;var ui;var xi;var yi;var gi;xi=ci-_i;yi=pi-vi;gi=fi-hi;var Xi=xi*xi+yi*yi+gi*gi;var zi=xi*_i+yi*vi+gi*hi;zi=-zi/Xi;var Mi;if(zi<0){var Yi=h;Yi.x=_i;Yi.y=vi;Yi.z=hi;Mi=1}else if(zi>1){var Zi=h;Zi.x=ci;Zi.y=pi;Zi.z=fi;Mi=2}else{var di;var Ii;var wi;var Vi;Ii=_i+xi*zi;wi=vi+yi*zi;Vi=hi+gi*zi;var Li=h;Li.x=Ii;Li.y=wi;Li.z=Vi;Mi=3}var Ai=h.x*h.x+h.y*h.y+h.z*h.z;if(ra<0||Ai<ra){_a=Mi&1|(Mi&2)<<1;ra=Ai;var ki=h;sa=ki.x;na=ki.y;ea=ki.z}}if(ra>0){var Bi=h;Bi.x=sa;Bi.y=na;Bi.z=ea;S=_a}else{var Pi=Rt*Rt+Et*Et+jt*jt;if(Pi>0){Pi=1/Math.sqrt(Pi)}Rt*=Pi;Et*=Pi;jt*=Pi;var Ti=ct*Rt+pt*Et+ft*jt;var Si=Rt*Rt+Et*Et+jt*jt;Si=Ti/Si;sa=Rt*Si;na=Et*Si;ea=jt*Si;var Ci=h;Ci.x=sa;Ci.y=na;Ci.z=ea;S=7}break;case 4:var qi=e[0];var Ri=e[1];var Ei=e[2];var ji=e[3];var Ni;var Di;var Fi;var Oi;var Wi;var Gi;var Hi;var Ui;var Ji;var Qi;var $i;var Ki;var tr;var ar;var ir;var rr;var or;var sr;var nr;var er;var _r;var vr;var hr;var lr;var cr;var pr;var fr;var mr;var br;var ur;var xr;var yr;var gr;var Xr;var zr;var Mr;var Yr;var Zr;var dr;var Ir;var wr=qi;Di=wr.x;Fi=wr.y;Oi=wr.z;var Vr=Ri;Gi=Vr.x;Hi=Vr.y;Ui=Vr.z;var Lr=Ei;Qi=Lr.x;$i=Lr.y;Ki=Lr.z;var Ar=ji;ar=Ar.x;ir=Ar.y;rr=Ar.z;sr=Gi-Di;nr=Hi-Fi;er=Ui-Oi;vr=Qi-Di;hr=$i-Fi;lr=Ki-Oi;pr=ar-Di;fr=ir-Fi;mr=rr-Oi;ur=Qi-Gi;xr=$i-Hi;yr=Ki-Ui;Xr=ar-Gi;zr=ir-Hi;Mr=rr-Ui;Zr=ar-Qi;dr=ir-$i;Ir=rr-Ki;var kr;var Br;var Pr;var Tr;var Sr;var Cr;var qr;var Rr;var Er;var jr;var Nr;var Dr;var Fr;var Or;var Wr;var Gr;var Hr;var Ur;var Jr;var Qr;var $r;Pr=nr*lr-er*hr;Tr=er*vr-sr*lr;Sr=sr*hr-nr*vr;qr=hr*mr-lr*fr;Rr=lr*pr-vr*mr;Er=vr*fr-hr*pr;Nr=fr*er-mr*nr;Dr=mr*sr-pr*er;Fr=pr*nr-fr*sr;Wr=zr*yr-Mr*xr;Gr=Mr*ur-Xr*yr;Hr=Xr*xr-zr*ur;var Kr=sr*Wr+nr*Gr+er*Hr>0?1:-1;var to=Di*Pr+Fi*Tr+Oi*Sr;var ao=Di*qr+Fi*Rr+Oi*Er;var io=Di*Nr+Fi*Dr+Oi*Fr;var ro=Gi*Wr+Hi*Gr+Ui*Hr;var oo=-1;var so;var no;var eo;var _o;var vo=0;no=0;eo=0;_o=0;if(to*Kr<0){var ho;var lo;var co;var po;var fo;var mo;var bo;var uo;var xo;var yo;var go;var Xo;var zo;var Mo;var Yo;var Zo;var Io;var wo;var Vo;var Lo;var Ao;var ko;var Bo;var Po;var To=qi;lo=To.x;co=To.y;po=To.z;var So=Ri;mo=So.x;bo=So.y;uo=So.z;var Co=Ei;yo=Co.x;go=Co.y;Xo=Co.z;Mo=mo-lo;Yo=bo-co;Zo=uo-po;wo=yo-mo;Vo=go-bo;Lo=Xo-uo;ko=lo-yo;Bo=co-go;Po=po-Xo;var qo;var Ro;var Eo;var jo;Ro=Yo*Lo-Zo*Vo;Eo=Zo*wo-Mo*Lo;jo=Mo*Vo-Yo*wo;var No;var Do;var Fo;var Oo;var Wo;var Go;var Ho;var Uo;var Jo;var Qo;var $o;var Ko;Do=Yo*jo-Zo*Eo;Fo=Zo*Ro-Mo*jo;Oo=Mo*Eo-Yo*Ro;Go=Vo*jo-Lo*Eo;Ho=Lo*Ro-wo*jo;Uo=wo*Eo-Vo*Ro;Qo=Bo*jo-Po*Eo;$o=Po*Ro-ko*jo;Ko=ko*Eo-Bo*Ro;var ts=lo*Do+co*Fo+po*Oo;var as=mo*Go+bo*Ho+uo*Uo;var is=yo*Qo+go*$o+Xo*Ko;var rs=-1;var os;var ss;var ns;var es;var _s=0;ss=0;ns=0;es=0;if(ts<0){var vs;var hs;var ls;var cs;var ps;var fs;var ms;var bs;var us=qi;hs=us.x;ls=us.y;cs=us.z;var xs=Ri;fs=xs.x;ms=xs.y;bs=xs.z;var ys;var gs;var Xs;var zs;gs=fs-hs;Xs=ms-ls;zs=bs-cs;var Ms=gs*gs+Xs*Xs+zs*zs;var Ys=gs*hs+Xs*ls+zs*cs;Ys=-Ys/Ms;var Zs;if(Ys<0){var ds=h;ds.x=hs;ds.y=ls;ds.z=cs;Zs=1}else if(Ys>1){var Is=h;Is.x=fs;Is.y=ms;Is.z=bs;Zs=2}else{var ws;var Vs;var Ls;var As;Vs=hs+gs*Ys;Ls=ls+Xs*Ys;As=cs+zs*Ys;var ks=h;ks.x=Vs;ks.y=Ls;ks.z=As;Zs=3}var Bs=h.x*h.x+h.y*h.y+h.z*h.z;_s=Zs;rs=Bs;var Ps=h;ss=Ps.x;ns=Ps.y;es=Ps.z}if(as<0){var Ts;var Ss;var Cs;var qs;var Rs;var Es;var js;var Ns;var Ds=Ri;Ss=Ds.x;Cs=Ds.y;qs=Ds.z;var Fs=Ei;Es=Fs.x;js=Fs.y;Ns=Fs.z;var Os;var Ws;var Gs;var Hs;Ws=Es-Ss;Gs=js-Cs;Hs=Ns-qs;var Us=Ws*Ws+Gs*Gs+Hs*Hs;var Js=Ws*Ss+Gs*Cs+Hs*qs;Js=-Js/Us;var Qs;if(Js<0){var $s=h;$s.x=Ss;$s.y=Cs;$s.z=qs;Qs=1}else if(Js>1){var Ks=h;Ks.x=Es;Ks.y=js;Ks.z=Ns;Qs=2}else{var tn;var an;var rn;var on;an=Ss+Ws*Js;rn=Cs+Gs*Js;on=qs+Hs*Js;var sn=h;sn.x=an;sn.y=rn;sn.z=on;Qs=3}var nn=h.x*h.x+h.y*h.y+h.z*h.z;if(rs<0||nn<rs){_s=Qs<<1;rs=nn;var en=h;ss=en.x;ns=en.y;es=en.z}}if(is<0){var _n;var vn;var hn;var ln;var cn;var pn;var fn;var mn;var bn=qi;vn=bn.x;hn=bn.y;ln=bn.z;var un=Ei;pn=un.x;fn=un.y;mn=un.z;var xn;var yn;var gn;var Xn;yn=pn-vn;gn=fn-hn;Xn=mn-ln;var zn=yn*yn+gn*gn+Xn*Xn;var Mn=yn*vn+gn*hn+Xn*ln;Mn=-Mn/zn;var Yn;if(Mn<0){var Zn=h;Zn.x=vn;Zn.y=hn;Zn.z=ln;Yn=1}else if(Mn>1){var dn=h;dn.x=pn;dn.y=fn;dn.z=mn;Yn=2}else{var In;var wn;var Vn;var Ln;wn=vn+yn*Mn;Vn=hn+gn*Mn;Ln=ln+Xn*Mn;var An=h;An.x=wn;An.y=Vn;An.z=Ln;Yn=3}var kn=h.x*h.x+h.y*h.y+h.z*h.z;if(rs<0||kn<rs){_s=Yn&1|(Yn&2)<<1;rs=kn;var Bn=h;ss=Bn.x;ns=Bn.y;es=Bn.z}}var Pn;if(rs>0){var Tn=h;Tn.x=ss;Tn.y=ns;Tn.z=es;Pn=_s}else{var Sn=Ro*Ro+Eo*Eo+jo*jo;if(Sn>0){Sn=1/Math.sqrt(Sn)}Ro*=Sn;Eo*=Sn;jo*=Sn;var Cn=lo*Ro+co*Eo+po*jo;var qn=Ro*Ro+Eo*Eo+jo*jo;qn=Cn/qn;ss=Ro*qn;ns=Eo*qn;es=jo*qn;var Rn=h;Rn.x=ss;Rn.y=ns;Rn.z=es;Pn=7}var En=h.x*h.x+h.y*h.y+h.z*h.z;vo=Pn;oo=En;var jn=h;no=jn.x;eo=jn.y;_o=jn.z}if(ao*Kr<0){var Nn;var Dn;var Fn;var On;var Wn;var Gn;var Hn;var Un;var Jn;var Qn;var $n;var Kn;var te;var ae;var ie;var re;var oe;var se;var ne;var ee;var _e;var ve;var he;var le;var ce=qi;Dn=ce.x;Fn=ce.y;On=ce.z;var pe=Ei;Gn=pe.x;Hn=pe.y;Un=pe.z;var fe=ji;Qn=fe.x;$n=fe.y;Kn=fe.z;ae=Gn-Dn;ie=Hn-Fn;re=Un-On;se=Qn-Gn;ne=$n-Hn;ee=Kn-Un;ve=Dn-Qn;he=Fn-$n;le=On-Kn;var me;var be;var ue;var xe;be=ie*ee-re*ne;ue=re*se-ae*ee;xe=ae*ne-ie*se;var ye;var ge;var Xe;var ze;var Me;var Ye;var Ze;var de;var Ie;var we;var Ve;var Le;ge=ie*xe-re*ue;Xe=re*be-ae*xe;ze=ae*ue-ie*be;Ye=ne*xe-ee*ue;Ze=ee*be-se*xe;de=se*ue-ne*be;we=he*xe-le*ue;Ve=le*be-ve*xe;Le=ve*ue-he*be;var Ae=Dn*ge+Fn*Xe+On*ze;var ke=Gn*Ye+Hn*Ze+Un*de;var Be=Qn*we+$n*Ve+Kn*Le;var Pe=-1;var Te;var Se;var Ce;var qe;var Re=0;Se=0;Ce=0;qe=0;if(Ae<0){var Ee;var je;var Ne;var De;var Fe;var Oe;var We;var Ge;var He=qi;je=He.x;Ne=He.y;De=He.z;var Ue=Ei;Oe=Ue.x;We=Ue.y;Ge=Ue.z;var Je;var Qe;var $e;var Ke;Qe=Oe-je;$e=We-Ne;Ke=Ge-De;var t_=Qe*Qe+$e*$e+Ke*Ke;var a_=Qe*je+$e*Ne+Ke*De;a_=-a_/t_;var i_;if(a_<0){var r_=h;r_.x=je;r_.y=Ne;r_.z=De;i_=1}else if(a_>1){var o_=h;o_.x=Oe;o_.y=We;o_.z=Ge;i_=2}else{var s_;var n_;var e_;var __;n_=je+Qe*a_;e_=Ne+$e*a_;__=De+Ke*a_;var v_=h;v_.x=n_;v_.y=e_;v_.z=__;i_=3}var h_=h.x*h.x+h.y*h.y+h.z*h.z;Re=i_;Pe=h_;var l_=h;Se=l_.x;Ce=l_.y;qe=l_.z}if(ke<0){var c_;var p_;var f_;var m_;var b_;var u_;var x_;var y_;var g_=Ei;p_=g_.x;f_=g_.y;m_=g_.z;var X_=ji;u_=X_.x;x_=X_.y;y_=X_.z;var z_;var M_;var Y_;var Z_;M_=u_-p_;Y_=x_-f_;Z_=y_-m_;var d_=M_*M_+Y_*Y_+Z_*Z_;var I_=M_*p_+Y_*f_+Z_*m_;I_=-I_/d_;var w_;if(I_<0){var V_=h;V_.x=p_;V_.y=f_;V_.z=m_;w_=1}else if(I_>1){var L_=h;L_.x=u_;L_.y=x_;L_.z=y_;w_=2}else{var A_;var k_;var B_;var P_;k_=p_+M_*I_;B_=f_+Y_*I_;P_=m_+Z_*I_;var T_=h;T_.x=k_;T_.y=B_;T_.z=P_;w_=3}var S_=h.x*h.x+h.y*h.y+h.z*h.z;if(Pe<0||S_<Pe){Re=w_<<1;Pe=S_;var C_=h;Se=C_.x;Ce=C_.y;qe=C_.z}}if(Be<0){var q_;var R_;var E_;var j_;var N_;var D_;var F_;var O_;var W_=qi;R_=W_.x;E_=W_.y;j_=W_.z;var G_=ji;D_=G_.x;F_=G_.y;O_=G_.z;var H_;var U_;var J_;var Q_;U_=D_-R_;J_=F_-E_;Q_=O_-j_;var $_=U_*U_+J_*J_+Q_*Q_;var K_=U_*R_+J_*E_+Q_*j_;K_=-K_/$_;var tv;if(K_<0){var av=h;av.x=R_;av.y=E_;av.z=j_;tv=1}else if(K_>1){var iv=h;iv.x=D_;iv.y=F_;iv.z=O_;tv=2}else{var rv;var ov;var sv;var nv;ov=R_+U_*K_;sv=E_+J_*K_;nv=j_+Q_*K_;var ev=h;ev.x=ov;ev.y=sv;ev.z=nv;tv=3}var _v=h.x*h.x+h.y*h.y+h.z*h.z;if(Pe<0||_v<Pe){Re=tv&1|(tv&2)<<1;Pe=_v;var vv=h;Se=vv.x;Ce=vv.y;qe=vv.z}}var hv;if(Pe>0){var lv=h;lv.x=Se;lv.y=Ce;lv.z=qe;hv=Re}else{var cv=be*be+ue*ue+xe*xe;if(cv>0){cv=1/Math.sqrt(cv)}be*=cv;ue*=cv;xe*=cv;var pv=Dn*be+Fn*ue+On*xe;var fv=be*be+ue*ue+xe*xe;fv=pv/fv;Se=be*fv;Ce=ue*fv;qe=xe*fv;var mv=h;mv.x=Se;mv.y=Ce;mv.z=qe;hv=7}var bv=h.x*h.x+h.y*h.y+h.z*h.z;if(oo<0||bv<oo){vo=hv&1|(hv&6)<<1;oo=bv;var uv=h;no=uv.x;eo=uv.y;_o=uv.z}}if(io*Kr<0){var xv;var yv;var gv;var Xv;var zv;var Mv;var Yv;var Zv;var dv;var Iv;var wv;var Vv;var Lv;var Av;var kv;var Bv;var Pv;var Tv;var Sv;var Cv;var qv;var Rv;var Ev;var jv;var Nv=qi;yv=Nv.x;gv=Nv.y;Xv=Nv.z;var Dv=Ri;Mv=Dv.x;Yv=Dv.y;Zv=Dv.z;var Fv=ji;Iv=Fv.x;wv=Fv.y;Vv=Fv.z;Av=Mv-yv;kv=Yv-gv;Bv=Zv-Xv;Tv=Iv-Mv;Sv=wv-Yv;Cv=Vv-Zv;Rv=yv-Iv;Ev=gv-wv;jv=Xv-Vv;var Ov;var Wv;var Gv;var Hv;Wv=kv*Cv-Bv*Sv;Gv=Bv*Tv-Av*Cv;Hv=Av*Sv-kv*Tv;var Uv;var Jv;var Qv;var $v;var Kv;var th;var ah;var ih;var rh;var oh;var sh;var nh;Jv=kv*Hv-Bv*Gv;Qv=Bv*Wv-Av*Hv;$v=Av*Gv-kv*Wv;th=Sv*Hv-Cv*Gv;ah=Cv*Wv-Tv*Hv;ih=Tv*Gv-Sv*Wv;oh=Ev*Hv-jv*Gv;sh=jv*Wv-Rv*Hv;nh=Rv*Gv-Ev*Wv;var eh=yv*Jv+gv*Qv+Xv*$v;var _h=Mv*th+Yv*ah+Zv*ih;var vh=Iv*oh+wv*sh+Vv*nh;var hh=-1;var lh;var ch;var ph;var fh;var mh=0;ch=0;ph=0;fh=0;if(eh<0){var bh;var uh;var xh;var yh;var gh;var Xh;var zh;var Mh;var Yh=qi;uh=Yh.x;xh=Yh.y;yh=Yh.z;var Zh=Ri;Xh=Zh.x;zh=Zh.y;Mh=Zh.z;var dh;var Ih;var wh;var Vh;Ih=Xh-uh;wh=zh-xh;Vh=Mh-yh;var Lh=Ih*Ih+wh*wh+Vh*Vh;var Ah=Ih*uh+wh*xh+Vh*yh;Ah=-Ah/Lh;var kh;if(Ah<0){var Bh=h;Bh.x=uh;Bh.y=xh;Bh.z=yh;kh=1}else if(Ah>1){var Ph=h;Ph.x=Xh;Ph.y=zh;Ph.z=Mh;kh=2}else{var Th;var Sh;var Ch;var qh;Sh=uh+Ih*Ah;Ch=xh+wh*Ah;qh=yh+Vh*Ah;var Rh=h;Rh.x=Sh;Rh.y=Ch;Rh.z=qh;kh=3}var Eh=h.x*h.x+h.y*h.y+h.z*h.z;mh=kh;hh=Eh;var jh=h;ch=jh.x;ph=jh.y;fh=jh.z}if(_h<0){var Nh;var Dh;var Fh;var Oh;var Wh;var Gh;var Hh;var Uh;var Jh=Ri;Dh=Jh.x;Fh=Jh.y;Oh=Jh.z;var Qh=ji;Gh=Qh.x;Hh=Qh.y;Uh=Qh.z;var $h;var Kh;var tl;var al;Kh=Gh-Dh;tl=Hh-Fh;al=Uh-Oh;var il=Kh*Kh+tl*tl+al*al;var rl=Kh*Dh+tl*Fh+al*Oh;rl=-rl/il;var ol;if(rl<0){var sl=h;sl.x=Dh;sl.y=Fh;sl.z=Oh;ol=1}else if(rl>1){var nl=h;nl.x=Gh;nl.y=Hh;nl.z=Uh;ol=2}else{var el;var _l;var vl;var hl;_l=Dh+Kh*rl;vl=Fh+tl*rl;hl=Oh+al*rl;var ll=h;ll.x=_l;ll.y=vl;ll.z=hl;ol=3}var cl=h.x*h.x+h.y*h.y+h.z*h.z;if(hh<0||cl<hh){mh=ol<<1;hh=cl;var pl=h;ch=pl.x;ph=pl.y;fh=pl.z}}if(vh<0){var fl;var ml;var bl;var ul;var xl;var yl;var gl;var Xl;var zl=qi;ml=zl.x;bl=zl.y;ul=zl.z;var Ml=ji;yl=Ml.x;gl=Ml.y;Xl=Ml.z;var Yl;var Zl;var dl;var Il;Zl=yl-ml;dl=gl-bl;Il=Xl-ul;var wl=Zl*Zl+dl*dl+Il*Il;var Vl=Zl*ml+dl*bl+Il*ul;Vl=-Vl/wl;var Ll;if(Vl<0){var Al=h;Al.x=ml;Al.y=bl;Al.z=ul;Ll=1}else if(Vl>1){var kl=h;kl.x=yl;kl.y=gl;kl.z=Xl;Ll=2}else{var Bl;var Pl;var Tl;var Sl;Pl=ml+Zl*Vl;Tl=bl+dl*Vl;Sl=ul+Il*Vl;var Cl=h;Cl.x=Pl;Cl.y=Tl;Cl.z=Sl;Ll=3}var ql=h.x*h.x+h.y*h.y+h.z*h.z;if(hh<0||ql<hh){mh=Ll&1|(Ll&2)<<1;hh=ql;var Rl=h;ch=Rl.x;ph=Rl.y;fh=Rl.z}}var El;if(hh>0){var jl=h;jl.x=ch;jl.y=ph;jl.z=fh;El=mh}else{var Nl=Wv*Wv+Gv*Gv+Hv*Hv;if(Nl>0){Nl=1/Math.sqrt(Nl)}Wv*=Nl;Gv*=Nl;Hv*=Nl;var Dl=yv*Wv+gv*Gv+Xv*Hv;var Fl=Wv*Wv+Gv*Gv+Hv*Hv;Fl=Dl/Fl;ch=Wv*Fl;ph=Gv*Fl;fh=Hv*Fl;var Ol=h;Ol.x=ch;Ol.y=ph;Ol.z=fh;El=7}var Wl=h.x*h.x+h.y*h.y+h.z*h.z;if(oo<0||Wl<oo){vo=El&3|(El&4)<<1;oo=Wl;var Gl=h;no=Gl.x;eo=Gl.y;_o=Gl.z}}if(ro*Kr<0){var Hl;var Ul;var Jl;var Ql;var $l;var Kl;var tc;var ac;var ic;var rc;var oc;var sc;var nc;var ec;var _c;var vc;var hc;var lc;var cc;var pc;var fc;var mc;var bc;var uc;var xc=Ri;Ul=xc.x;Jl=xc.y;Ql=xc.z;var yc=Ei;Kl=yc.x;tc=yc.y;ac=yc.z;var gc=ji;rc=gc.x;oc=gc.y;sc=gc.z;ec=Kl-Ul;_c=tc-Jl;vc=ac-Ql;lc=rc-Kl;cc=oc-tc;pc=sc-ac;mc=Ul-rc;bc=Jl-oc;uc=Ql-sc;var Xc;var zc;var Mc;var Yc;zc=_c*pc-vc*cc;Mc=vc*lc-ec*pc;Yc=ec*cc-_c*lc;var Zc;var dc;var Ic;var wc;var Vc;var Lc;var Ac;var kc;var Bc;var Pc;var Tc;var Sc;dc=_c*Yc-vc*Mc;Ic=vc*zc-ec*Yc;wc=ec*Mc-_c*zc;Lc=cc*Yc-pc*Mc;Ac=pc*zc-lc*Yc;kc=lc*Mc-cc*zc;Pc=bc*Yc-uc*Mc;Tc=uc*zc-mc*Yc;Sc=mc*Mc-bc*zc;var Cc=Ul*dc+Jl*Ic+Ql*wc;var qc=Kl*Lc+tc*Ac+ac*kc;var Rc=rc*Pc+oc*Tc+sc*Sc;var Ec=-1;var jc;var Nc;var Dc;var Fc;var Oc=0;Nc=0;Dc=0;Fc=0;if(Cc<0){var Wc;var Gc;var Hc;var Uc;var Jc;var Qc;var $c;var Kc;var tp=Ri;Gc=tp.x;Hc=tp.y;Uc=tp.z;var ap=Ei;Qc=ap.x;$c=ap.y;Kc=ap.z;var ip;var rp;var op;var sp;rp=Qc-Gc;op=$c-Hc;sp=Kc-Uc;var np=rp*rp+op*op+sp*sp;var ep=rp*Gc+op*Hc+sp*Uc;ep=-ep/np;var _p;if(ep<0){var vp=h;vp.x=Gc;vp.y=Hc;vp.z=Uc;_p=1}else if(ep>1){var hp=h;hp.x=Qc;hp.y=$c;hp.z=Kc;_p=2}else{var lp;var cp;var pp;var fp;cp=Gc+rp*ep;pp=Hc+op*ep;fp=Uc+sp*ep;var mp=h;mp.x=cp;mp.y=pp;mp.z=fp;_p=3}var bp=h.x*h.x+h.y*h.y+h.z*h.z;Oc=_p;Ec=bp;var up=h;Nc=up.x;Dc=up.y;Fc=up.z}if(qc<0){var xp;var yp;var gp;var Xp;var zp;var Mp;var Yp;var Zp;var dp=Ei;yp=dp.x;gp=dp.y;Xp=dp.z;var Ip=ji;Mp=Ip.x;Yp=Ip.y;Zp=Ip.z;var wp;var Vp;var Lp;var Ap;Vp=Mp-yp;Lp=Yp-gp;Ap=Zp-Xp;var kp=Vp*Vp+Lp*Lp+Ap*Ap;var Bp=Vp*yp+Lp*gp+Ap*Xp;Bp=-Bp/kp;var Pp;if(Bp<0){var Tp=h;Tp.x=yp;Tp.y=gp;Tp.z=Xp;Pp=1}else if(Bp>1){var Sp=h;Sp.x=Mp;Sp.y=Yp;Sp.z=Zp;Pp=2}else{var Cp;var qp;var Rp;var Ep;qp=yp+Vp*Bp;Rp=gp+Lp*Bp;Ep=Xp+Ap*Bp;var jp=h;jp.x=qp;jp.y=Rp;jp.z=Ep;Pp=3}var Np=h.x*h.x+h.y*h.y+h.z*h.z;if(Ec<0||Np<Ec){Oc=Pp<<1;Ec=Np;var Dp=h;Nc=Dp.x;Dc=Dp.y;Fc=Dp.z}}if(Rc<0){var Fp;var Op;var Wp;var Gp;var Hp;var Up;var Jp;var Qp;var $p=Ri;Op=$p.x;Wp=$p.y;Gp=$p.z;var Kp=ji;Up=Kp.x;Jp=Kp.y;Qp=Kp.z;var tf;var af;var rf;var of;af=Up-Op;rf=Jp-Wp;of=Qp-Gp;var sf=af*af+rf*rf+of*of;var nf=af*Op+rf*Wp+of*Gp;nf=-nf/sf;var ef;if(nf<0){var _f=h;_f.x=Op;_f.y=Wp;_f.z=Gp;ef=1}else if(nf>1){var vf=h;vf.x=Up;vf.y=Jp;vf.z=Qp;ef=2}else{var hf;var lf;var cf;var pf;lf=Op+af*nf;cf=Wp+rf*nf;pf=Gp+of*nf;var ff=h;ff.x=lf;ff.y=cf;ff.z=pf;ef=3}var mf=h.x*h.x+h.y*h.y+h.z*h.z;if(Ec<0||mf<Ec){Oc=ef&1|(ef&2)<<1;Ec=mf;var bf=h;Nc=bf.x;Dc=bf.y;Fc=bf.z}}var uf;if(Ec>0){var xf=h;xf.x=Nc;xf.y=Dc;xf.z=Fc;uf=Oc}else{var yf=zc*zc+Mc*Mc+Yc*Yc;if(yf>0){yf=1/Math.sqrt(yf)}zc*=yf;Mc*=yf;Yc*=yf;var gf=Ul*zc+Jl*Mc+Ql*Yc;var Xf=zc*zc+Mc*Mc+Yc*Yc;Xf=gf/Xf;Nc=zc*Xf;Dc=Mc*Xf;Fc=Yc*Xf;var zf=h;zf.x=Nc;zf.y=Dc;zf.z=Fc;uf=7}var Mf=h.x*h.x+h.y*h.y+h.z*h.z;if(oo<0||Mf<oo){vo=uf<<1;oo=Mf;var Yf=h;no=Yf.x;eo=Yf.y;_o=Yf.z}}if(oo>0){var Zf=h;Zf.x=no;Zf.y=eo;Zf.z=_o;S=vo}else{h.zero();S=15}break}this.shrinkSimplex(S);if(h.x*h.x+h.y*h.y+h.z*h.z<T){if(I==0||this.simplexSize==4){n.fraction=I;return false}this.interpolateClosestPoints();n.fraction=I;var df=n.normal;df.x=l.x;df.y=l.y;df.z=l.z;var If=df;var wf=Math.sqrt(If.x*If.x+If.y*If.y+If.z*If.z);if(wf>0){wf=1/wf}var Vf=If.x*wf;var Lf=If.y*wf;var Af=If.z*wf;If.x=Vf;If.y=Lf;If.z=Af;var kf=n.position;var Bf=this.closestPoint1;kf.x=Bf.x;kf.y=Bf.y;kf.z=Bf.z;var Pf=kf;var Tf=Pf.x+o.x*I;var Sf=Pf.y+o.y*I;var Cf=Pf.z+o.z*I;Pf.x=Tf;Pf.y=Sf;Pf.z=Cf;return true}l.x=h.x;l.y=h.y;l.z=h.z;var qf=l;var Rf=-qf.x;var Ef=-qf.y;var jf=-qf.z;qf.x=Rf;qf.y=Ef;qf.z=jf;if(this.c1!=null){this.computeWitnessPoint1(true)}else{var Nf=this.w1[this.simplexSize];Nf.x=this.tf1._positionX;Nf.y=this.tf1._positionY;Nf.z=this.tf1._positionZ}this.computeWitnessPoint2(true);var Df=this.s[this.simplexSize];var Ff=this.w1[this.simplexSize];Df.x=Ff.x;Df.y=Ff.y;Df.z=Ff.z;var Of=Df;var Wf=this.w2[this.simplexSize];var Gf=Of.x-Wf.x;var Hf=Of.y-Wf.y;var Uf=Of.z-Wf.z;Of.x=Gf;Of.y=Hf;Of.z=Uf;var Jf=e[this.simplexSize];var Qf=Jf.x-w.x;var $f=Jf.y-w.y;var Kf=Jf.z-w.z;Jf.x=Qf;Jf.y=$f;Jf.z=Kf;if(l.x*l.x+l.y*l.y+l.z*l.z<T){throw new Error("!?")}var tm=e[this.simplexSize];var am=l;var im=tm.x*am.x+tm.y*am.y+tm.z*am.z;if(im<0){if(V.x*am.x+V.y*am.y+V.z*am.z>=0){return false}var rm=im/(V.x*am.x+V.y*am.y+V.z*am.z);I+=rm;if(I>=1){return false}var om=w.x+V.x*rm;var sm=w.y+V.y*rm;var nm=w.z+V.z*rm;w.x=om;w.y=sm;w.z=nm;var em=0;var _m=this.simplexSize+1;while(em<_m){var vm=em++;var hm=e[vm];var lm=-rm;var cm=hm.x+V.x*lm;var pm=hm.y+V.y*lm;var fm=hm.z+V.z*lm;hm.x=cm;hm.y=pm;hm.z=fm}}var mm=false;var bm=0;var um=this.simplexSize;while(bm<um){var xm=bm++;var ym=e[xm].x-e[this.simplexSize].x;var gm=e[xm].y-e[this.simplexSize].y;var Xm=e[xm].z-e[this.simplexSize].z;if(ym*ym+gm*gm+Xm*Xm<T){mm=true;break}}if(!mm){this.simplexSize++}++Z}return false},interpolateClosestPoints:function(){var t=this.simplexSize;switch(t){case 1:var a=this.closestPoint1;var i=this.w1[0];a.x=i.x;a.y=i.y;a.z=i.z;var r=this.closestPoint2;var o=this.w2[0];r.x=o.x;r.y=o.y;r.z=o.z;break;case 2:var s;var n;var e;var _;var v=this.closest;n=v.x;e=v.y;_=v.z;var h;var l;var c;var p;var f;var m;var b;var u;var x;var y;var g;var X;var z;var M;var Y;var Z;var d;var I;var w;var V;var L;var A;var k;var B;var P;var T;var S;var C;var q;var R;var E;var j;var N;var D;var F;var O;var W=this.s[0];l=W.x;c=W.y;p=W.z;var G=this.w1[0];m=G.x;b=G.y;u=G.z;var H=this.w2[0];y=H.x;g=H.y;X=H.z;var U=this.s[1];M=U.x;Y=U.y;Z=U.z;var J=this.w1[1];I=J.x;w=J.y;V=J.z;var Q=this.w2[1];A=Q.x;k=Q.y;B=Q.z;var $=this.s[2];T=$.x;S=$.y;C=$.z;var K=this.w1[2];R=K.x;E=K.y;j=K.z;var tt=this.w2[2];D=tt.x;F=tt.y;O=tt.z;var at;var it;var rt;var ot;it=M-l;rt=Y-c;ot=Z-p;var st=it*it+rt*rt+ot*ot;if(st!=0){st=1/st}var nt;var et;var _t;var vt;et=n-l;_t=e-c;vt=_-p;var ht=(et*it+_t*rt+vt*ot)*st;var lt;var ct;var pt;var ft;var mt;var bt;var ut;var xt;var yt;var gt;var Xt;var zt;ct=I-m;pt=w-b;ft=V-u;bt=m+ct*ht;ut=b+pt*ht;xt=u+ft*ht;ct=A-y;pt=k-g;ft=B-X;gt=y+ct*ht;Xt=g+pt*ht;zt=X+ft*ht;var Mt=this.closestPoint1;Mt.x=bt;Mt.y=ut;Mt.z=xt;var Yt=this.closestPoint2;Yt.x=gt;Yt.y=Xt;Yt.z=zt;break;case 3:var Zt;var dt;var It;var wt;var Vt=this.closest;dt=Vt.x;It=Vt.y;wt=Vt.z;var Lt;var At;var kt;var Bt;var Pt;var Tt;var St;var Ct;var qt;var Rt;var Et;var jt;var Nt;var Dt;var Ft;var Ot;var Wt;var Gt;var Ht;var Ut;var Jt;var Qt;var $t;var Kt;var ta;var aa;var ia;var ra;var oa;var sa;var na;var ea;var _a;var va;var ha;var la;var ca=this.s[0];At=ca.x;kt=ca.y;Bt=ca.z;var pa=this.w1[0];Tt=pa.x;St=pa.y;Ct=pa.z;var fa=this.w2[0];Rt=fa.x;Et=fa.y;jt=fa.z;var ma=this.s[1];Dt=ma.x;Ft=ma.y;Ot=ma.z;var ba=this.w1[1];Gt=ba.x;Ht=ba.y;Ut=ba.z;var ua=this.w2[1];Qt=ua.x;$t=ua.y;Kt=ua.z;var xa=this.s[2];aa=xa.x;ia=xa.y;ra=xa.z;var ya=this.w1[2];sa=ya.x;na=ya.y;ea=ya.z;var ga=this.w2[2];va=ga.x;ha=ga.y;la=ga.z;var Xa;var za;var Ma;var Ya;var Za;var da;var Ia;var wa;var Va;var La;var Aa;var ka;za=Dt-At;Ma=Ft-kt;Ya=Ot-Bt;da=aa-At;Ia=ia-kt;wa=ra-Bt;La=dt-At;Aa=It-kt;ka=wt-Bt;var Ba=za*za+Ma*Ma+Ya*Ya;var Pa=za*da+Ma*Ia+Ya*wa;var Ta=da*da+Ia*Ia+wa*wa;var Sa=za*La+Ma*Aa+Ya*ka;var Ca=da*La+Ia*Aa+wa*ka;var qa=Ba*Ta-Pa*Pa;if(qa!=0){qa=1/qa}var Ra=(Sa*Ta-Ca*Pa)*qa;var Ea=(-Sa*Pa+Ca*Ba)*qa;var ja;var Na;var Da;var Fa;var Oa;var Wa;var Ga;var Ha;var Ua;var Ja;var Qa;var $a;Na=Gt-Tt;Da=Ht-St;Fa=Ut-Ct;Wa=Tt+Na*Ra;Ga=St+Da*Ra;Ha=Ct+Fa*Ra;Na=sa-Tt;Da=na-St;Fa=ea-Ct;Wa+=Na*Ea;Ga+=Da*Ea;Ha+=Fa*Ea;Na=Qt-Rt;Da=$t-Et;Fa=Kt-jt;Ja=Rt+Na*Ra;Qa=Et+Da*Ra;$a=jt+Fa*Ra;Na=va-Rt;Da=ha-Et;Fa=la-jt;Ja+=Na*Ea;Qa+=Da*Ea;$a+=Fa*Ea;var Ka=this.closestPoint1;Ka.x=Wa;Ka.y=Ga;Ka.z=Ha;var ti=this.closestPoint2;ti.x=Ja;ti.y=Qa;ti.z=$a;break;default:throw new Error("!?")}},loadCache:function(t){var a=this.dir;var i=t.prevClosestDir;a.x=i.x;a.y=i.y;a.z=i.z},saveCache:function(t){var a=t.prevClosestDir;var i=this.closest;a.x=i.x;a.y=i.y;a.z=i.z;var r=a;var o=-r.x;var s=-r.y;var n=-r.z;r.x=o;r.y=s;r.z=n},shrinkSimplex:function(t){this.simplexSize=t;this.simplexSize=(this.simplexSize&5)+(this.simplexSize>>1&5);this.simplexSize=(this.simplexSize&3)+(this.simplexSize>>2&3);switch(t){case 2:var a=this.s[0];var i=this.s[1];a.x=i.x;a.y=i.y;a.z=i.z;var r=this.w1[0];var o=this.w1[1];r.x=o.x;r.y=o.y;r.z=o.z;var s=this.w2[0];var n=this.w2[1];s.x=n.x;s.y=n.y;s.z=n.z;break;case 4:var e=this.s[0];var _=this.s[2];e.x=_.x;e.y=_.y;e.z=_.z;var v=this.w1[0];var h=this.w1[2];v.x=h.x;v.y=h.y;v.z=h.z;var l=this.w2[0];var c=this.w2[2];l.x=c.x;l.y=c.y;l.z=c.z;break;case 5:var p=this.s[1];var f=this.s[2];p.x=f.x;p.y=f.y;p.z=f.z;var m=this.w1[1];var b=this.w1[2];m.x=b.x;m.y=b.y;m.z=b.z;var u=this.w2[1];var x=this.w2[2];u.x=x.x;u.y=x.y;u.z=x.z;break;case 6:var y=this.s[0];var g=this.s[2];y.x=g.x;y.y=g.y;y.z=g.z;var X=this.w1[0];var z=this.w1[2];X.x=z.x;X.y=z.y;X.z=z.z;var M=this.w2[0];var Y=this.w2[2];M.x=Y.x;M.y=Y.y;M.z=Y.z;break;case 8:var Z=this.s[0];var d=this.s[3];Z.x=d.x;Z.y=d.y;Z.z=d.z;var I=this.w1[0];var w=this.w1[3];I.x=w.x;I.y=w.y;I.z=w.z;var V=this.w2[0];var L=this.w2[3];V.x=L.x;V.y=L.y;V.z=L.z;break;case 9:var A=this.s[1];var k=this.s[3];A.x=k.x;A.y=k.y;A.z=k.z;var B=this.w1[1];var P=this.w1[3];B.x=P.x;B.y=P.y;B.z=P.z;var T=this.w2[1];var S=this.w2[3];T.x=S.x;T.y=S.y;T.z=S.z;break;case 10:var C=this.s[0];var q=this.s[3];C.x=q.x;C.y=q.y;C.z=q.z;var R=this.w1[0];var E=this.w1[3];R.x=E.x;R.y=E.y;R.z=E.z;var j=this.w2[0];var N=this.w2[3];j.x=N.x;j.y=N.y;j.z=N.z;break;case 11:var D=this.s[2];var F=this.s[3];D.x=F.x;D.y=F.y;D.z=F.z;var O=this.w1[2];var W=this.w1[3];O.x=W.x;O.y=W.y;O.z=W.z;var G=this.w2[2];var H=this.w2[3];G.x=H.x;G.y=H.y;G.z=H.z;break;case 12:var U=this.s[0];var J=this.s[2];U.x=J.x;U.y=J.y;U.z=J.z;var Q=this.w1[0];var $=this.w1[2];Q.x=$.x;Q.y=$.y;Q.z=$.z;var K=this.w2[0];var tt=this.w2[2];K.x=tt.x;K.y=tt.y;K.z=tt.z;var at=this.s[1];var it=this.s[3];at.x=it.x;at.y=it.y;at.z=it.z;var rt=this.w1[1];var ot=this.w1[3];rt.x=ot.x;rt.y=ot.y;rt.z=ot.z;var st=this.w2[1];var nt=this.w2[3];st.x=nt.x;st.y=nt.y;st.z=nt.z;break;case 13:var et=this.s[1];var _t=this.s[3];et.x=_t.x;et.y=_t.y;et.z=_t.z;var vt=this.w1[1];var ht=this.w1[3];vt.x=ht.x;vt.y=ht.y;vt.z=ht.z;var lt=this.w2[1];var ct=this.w2[3];lt.x=ct.x;lt.y=ct.y;lt.z=ct.z;break;case 14:var pt=this.s[0];var ft=this.s[3];pt.x=ft.x;pt.y=ft.y;pt.z=ft.z;var mt=this.w1[0];var bt=this.w1[3];mt.x=bt.x;mt.y=bt.y;mt.z=bt.z;var ut=this.w2[0];var xt=this.w2[3];ut.x=xt.x;ut.y=xt.y;ut.z=xt.z;break}},computeWitnessPoint1:function(t){var a;var i;var r;var o;var s;var n;var e;var _;var v=this.dir;n=v.x;e=v.y;_=v.z;var h;var l;var c;var p;var f;var m;var b;f=this.tf1._rotation00*n+this.tf1._rotation10*e+this.tf1._rotation20*_;m=this.tf1._rotation01*n+this.tf1._rotation11*e+this.tf1._rotation21*_;b=this.tf1._rotation02*n+this.tf1._rotation12*e+this.tf1._rotation22*_;l=f;c=m;p=b;var u;var x;var y;var g;var X=this.dir;X.x=l;X.y=c;X.z=p;this.c1.computeLocalSupportingVertex(this.dir,this.w1[this.simplexSize]);if(t){var z=this.dir;var M=Math.sqrt(z.x*z.x+z.y*z.y+z.z*z.z);if(M>0){M=1/M}var Y=z.x*M;var Z=z.y*M;var d=z.z*M;z.x=Y;z.y=Z;z.z=d;var I=this.w1[this.simplexSize];var w=this.dir;var V=this.c1._gjkMargin;var L=I.x+w.x*V;var A=I.y+w.y*V;var k=I.z+w.z*V;I.x=L;I.y=A;I.z=k}var B=this.w1[this.simplexSize];i=B.x;r=B.y;o=B.z;var P;var T;var S;P=this.tf1._rotation00*i+this.tf1._rotation01*r+this.tf1._rotation02*o;T=this.tf1._rotation10*i+this.tf1._rotation11*r+this.tf1._rotation12*o;S=this.tf1._rotation20*i+this.tf1._rotation21*r+this.tf1._rotation22*o;x=P;y=T;g=S;x+=this.tf1._positionX;y+=this.tf1._positionY;g+=this.tf1._positionZ;var C=this.w1[this.simplexSize];C.x=x;C.y=y;C.z=g;var q=this.dir;q.x=n;q.y=e;q.z=_},computeWitnessPoint2:function(t){var a;var i;var r;var o;var s;var n;var e;var _;var v=this.dir;n=v.x;e=v.y;_=v.z;var h;var l;var c;var p;var f;var m;var b;f=this.tf2._rotation00*n+this.tf2._rotation10*e+this.tf2._rotation20*_;m=this.tf2._rotation01*n+this.tf2._rotation11*e+this.tf2._rotation21*_;b=this.tf2._rotation02*n+this.tf2._rotation12*e+this.tf2._rotation22*_;l=f;c=m;p=b;l=-l;c=-c;p=-p;var u;var x;var y;var g;var X=this.dir;X.x=l;X.y=c;X.z=p;this.c2.computeLocalSupportingVertex(this.dir,this.w2[this.simplexSize]);if(t){var z=this.dir;var M=Math.sqrt(z.x*z.x+z.y*z.y+z.z*z.z);if(M>0){M=1/M}var Y=z.x*M;var Z=z.y*M;var d=z.z*M;z.x=Y;z.y=Z;z.z=d;var I=this.w2[this.simplexSize];var w=this.dir;var V=this.c2._gjkMargin;var L=I.x+w.x*V;var A=I.y+w.y*V;var k=I.z+w.z*V;I.x=L;I.y=A;I.z=k}var B=this.w2[this.simplexSize];i=B.x;r=B.y;o=B.z;var P;var T;var S;P=this.tf2._rotation00*i+this.tf2._rotation01*r+this.tf2._rotation02*o;T=this.tf2._rotation10*i+this.tf2._rotation11*r+this.tf2._rotation12*o;S=this.tf2._rotation20*i+this.tf2._rotation21*r+this.tf2._rotation22*o;x=P;y=T;g=S;x+=this.tf2._positionX;y+=this.tf2._positionY;g+=this.tf2._positionZ;var C=this.w2[this.simplexSize];C.x=x;C.y=y;C.z=g;var q=this.dir;q.x=n;q.y=e;q.z=_},pointToTetrahedron:function(){var t=0;while(t<3){var a=t++;var i=this.dir;var r=this.baseDirs[a];i.x=r.x;i.y=r.y;i.z=r.z;this.computeWitnessPoint1(false);this.computeWitnessPoint2(false);var o=this.s[this.simplexSize];var s=this.w1[this.simplexSize];o.x=s.x;o.y=s.y;o.z=s.z;var n=o;var e=this.w2[this.simplexSize];var _=n.x-e.x;var v=n.y-e.y;var h=n.z-e.z;n.x=_;n.y=v;n.z=h;this.simplexSize++;this.lineToTetrahedron();if(this.simplexSize==4){break}this.simplexSize--;var l=this.dir;var c=-l.x;var p=-l.y;var f=-l.z;l.x=c;l.y=p;l.z=f;this.computeWitnessPoint1(false);this.computeWitnessPoint2(false);var m=this.s[this.simplexSize];var b=this.w1[this.simplexSize];m.x=b.x;m.y=b.y;m.z=b.z;var u=m;var x=this.w2[this.simplexSize];var y=u.x-x.x;var g=u.y-x.y;var X=u.z-x.z;u.x=y;u.y=g;u.z=X;this.simplexSize++;this.lineToTetrahedron();if(this.simplexSize==4){break}this.simplexSize--}},lineToTetrahedron:function(){var t;var a;var i;var r;var o=this.dir;a=o.x;i=o.y;r=o.z;var s;var n;var e;var _;var v;var h;var l;var c;var p;var f;var m;var b;var u=this.s[0];n=u.x;e=u.y;_=u.z;var x=this.s[1];h=x.x;l=x.y;c=x.z;f=n-h;m=e-l;b=_-c;var y=0;while(y<3){var g=y++;var X;var z;var M;var Y;var Z=this.baseDirs[g];z=Z.x;M=Z.y;Y=Z.z;var d;var I;var w;var V;I=m*Y-b*M;w=b*z-f*Y;V=f*M-m*z;var L=this.dir;L.x=I;L.y=w;L.z=V;this.computeWitnessPoint1(false);this.computeWitnessPoint2(false);var A=this.s[this.simplexSize];var k=this.w1[this.simplexSize];A.x=k.x;A.y=k.y;A.z=k.z;var B=A;var P=this.w2[this.simplexSize];var T=B.x-P.x;var S=B.y-P.y;var C=B.z-P.z;B.x=T;B.y=S;B.z=C;this.simplexSize++;this.triangleToTetrahedron();if(this.simplexSize==4){break}this.simplexSize--;var q=this.dir;var R=-q.x;var E=-q.y;var j=-q.z;q.x=R;q.y=E;q.z=j;this.computeWitnessPoint1(false);this.computeWitnessPoint2(false);var N=this.s[this.simplexSize];var D=this.w1[this.simplexSize];N.x=D.x;N.y=D.y;N.z=D.z;var F=N;var O=this.w2[this.simplexSize];var W=F.x-O.x;var G=F.y-O.y;var H=F.z-O.z;F.x=W;F.y=G;F.z=H;this.simplexSize++;this.triangleToTetrahedron();if(this.simplexSize==4){break}this.simplexSize--}var U=this.dir;U.x=a;U.y=i;U.z=r},triangleToTetrahedron:function(){var t;var a;var i;var r;var o=this.dir;a=o.x;i=o.y;r=o.z;while(true){var s;var n;var e;var _;var v;var h;var l;var c;var p;var f;var m;var b;var u;var x;var y;var g;var X;var z;var M;var Y;var Z=this.s[0];n=Z.x;e=Z.y;_=Z.z;var d=this.s[1];h=d.x;l=d.y;c=d.z;var I=this.s[2];f=I.x;m=I.y;b=I.z;x=h-n;y=l-e;g=c-_;z=f-n;M=m-e;Y=b-_;var w;var V;var L;var A;V=y*Y-g*M;L=g*z-x*Y;A=x*M-y*z;var k=this.dir;k.x=V;k.y=L;k.z=A;this.computeWitnessPoint1(false);this.computeWitnessPoint2(false);var B=this.s[this.simplexSize];var P=this.w1[this.simplexSize];B.x=P.x;B.y=P.y;B.z=P.z;var T=B;var S=this.w2[this.simplexSize];var C=T.x-S.x;var q=T.y-S.y;var R=T.z-S.z;T.x=C;T.y=q;T.z=R;this.simplexSize++;if(this.isValidTetrahedron()){break}this.simplexSize--;var E=this.dir;var j=-E.x;var N=-E.y;var D=-E.z;E.x=j;E.y=N;E.z=D;this.computeWitnessPoint1(false);this.computeWitnessPoint2(false);var F=this.s[this.simplexSize];var O=this.w1[this.simplexSize];F.x=O.x;F.y=O.y;F.z=O.z;var W=F;var G=this.w2[this.simplexSize];var H=W.x-G.x;var U=W.y-G.y;var J=W.z-G.z;W.x=H;W.y=U;W.z=J;this.simplexSize++;if(this.isValidTetrahedron()){break}this.simplexSize--;if(!false){break}}var Q=this.dir;Q.x=a;Q.y=i;Q.z=r},isValidTetrahedron:function(){var t=this.s[1].x-this.s[0].x;var a=this.s[1].y-this.s[0].y;var i=this.s[1].z-this.s[0].z;var r=this.s[2].x-this.s[0].x;var o=this.s[2].y-this.s[0].y;var s=this.s[2].z-this.s[0].z;var n=this.s[3].x-this.s[0].x;var e=this.s[3].y-this.s[0].y;var _=this.s[3].z-this.s[0].z;var v=t*(o*_-s*e)-a*(r*_-s*n)+i*(r*e-o*n);if(!(v>1e-12)){return v<-1e-12}else{return true}},computeDepth:function(t,a,i,r,o,s,n){var e=this.polyhedron;while(e._numTriangles>0){var _=e._triangleList;e._numTriangles--;var v=_._prev;var h=_._next;if(v!=null){v._next=h}if(h!=null){h._prev=v}if(_==e._triangleList){e._triangleList=e._triangleList._next}if(_==e._triangleListLast){e._triangleListLast=e._triangleListLast._prev}_._next=null;_._prev=null;_.removeReferences();_._next=e._trianglePool;e._trianglePool=_}while(e._numVertices>0){var l=e._vertices[--e._numVertices];l.removeReferences();l._next=e._vertexPool;e._vertexPool=l}var c=this.polyhedron;var p=this.polyhedron;var f=p._vertexPool;if(f!=null){p._vertexPool=f._next;f._next=null}else{f=new Wa}var m=f.init(o[0],s[0],n[0]);var b=this.polyhedron;var u=b._vertexPool;if(u!=null){b._vertexPool=u._next;u._next=null}else{u=new Wa}var x=u.init(o[1],s[1],n[1]);var y=this.polyhedron;var g=y._vertexPool;if(g!=null){y._vertexPool=g._next;g._next=null}else{g=new Wa}var X=g.init(o[2],s[2],n[2]);var z=this.polyhedron;var M=z._vertexPool;if(M!=null){z._vertexPool=M._next;M._next=null}else{M=new Wa}if(!c._init(m,x,X,M.init(o[3],s[3],n[3]))){return Ga.EPA_FAILED_TO_INIT}this.simplexSize=0;var Y=this.s[0];var Z=this.w1[0];var d=this.w2[0];var I=0;var w=40;while(I<w){var V=this.polyhedron._triangleList;var L=1/0;var A=null;while(V!=null){var k=V._next;if(V._distanceSq<L){L=V._distanceSq;A=V}V=k}var B=A;var P=this.dir;var T=B._normal;P.x=T.x;P.y=T.y;P.z=T.z;var S=P;var C=Math.sqrt(S.x*S.x+S.y*S.y+S.z*S.z);if(C>0){C=1/C}var q=S.x*C;var R=S.y*C;var E=S.z*C;S.x=q;S.y=R;S.z=E;this.computeWitnessPoint1(false);this.computeWitnessPoint2(false);var j=this.s[this.simplexSize];var N=this.w1[this.simplexSize];j.x=N.x;j.y=N.y;j.z=N.z;var D=j;var F=this.w2[this.simplexSize];var O=D.x-F.x;var W=D.y-F.y;var G=D.z-F.z;D.x=O;D.y=W;D.z=G;var H=B._vertices[0];var U=B._vertices[1];var J=B._vertices[2];var Q=H.v;var $=this.dir;var K=Q.x*$.x+Q.y*$.y+Q.z*$.z;var tt=this.dir;var at=Y.x*tt.x+Y.y*tt.y+Y.z*tt.z;if(at-K<1e-6||I==w-1){var it=this.closest;var rt=this.dir;it.x=rt.x;it.y=rt.y;it.z=rt.z;var ot=it;var st=this.dir;var nt=H.v;var et=this.dir;var _t=(st.x*nt.x+st.y*nt.y+st.z*nt.z)/(et.x*et.x+et.y*et.y+et.z*et.z);var vt=ot.x*_t;var ht=ot.y*_t;var lt=ot.z*_t;ot.x=vt;ot.y=ht;ot.z=lt;var ct;var pt;var ft;var mt;var bt=this.closest;pt=bt.x;ft=bt.y;mt=bt.z;var ut;var xt;var yt;var gt;var Xt;var zt;var Mt;var Yt;var Zt;var dt;var It;var wt;var Vt;var Lt;var At;var kt;var Bt;var Pt;var Tt;var St;var Ct;var qt;var Rt;var Et;var jt;var Nt;var Dt;var Ft;var Ot;var Wt;var Gt;var Ht;var Ut;var Jt;var Qt;var $t;var Kt=H.v;xt=Kt.x;yt=Kt.y;gt=Kt.z;var ta=H.w1;zt=ta.x;Mt=ta.y;Yt=ta.z;var aa=H.w2;dt=aa.x;It=aa.y;wt=aa.z;var ia=U.v;Lt=ia.x;At=ia.y;kt=ia.z;var ra=U.w1;Pt=ra.x;Tt=ra.y;St=ra.z;var oa=U.w2;qt=oa.x;Rt=oa.y;Et=oa.z;var sa=J.v;Nt=sa.x;Dt=sa.y;Ft=sa.z;var na=J.w1;Wt=na.x;Gt=na.y;Ht=na.z;var ea=J.w2;Jt=ea.x;Qt=ea.y;$t=ea.z;var _a;var va;var ha;var la;var ca;var pa;var fa;var ma;var ba;var ua;var xa;var ya;va=Lt-xt;ha=At-yt;la=kt-gt;pa=Nt-xt;fa=Dt-yt;ma=Ft-gt;ua=pt-xt;xa=ft-yt;ya=mt-gt;var ga=va*va+ha*ha+la*la;var Xa=va*pa+ha*fa+la*ma;var za=pa*pa+fa*fa+ma*ma;var Ma=va*ua+ha*xa+la*ya;var Ya=pa*ua+fa*xa+ma*ya;var Za=ga*za-Xa*Xa;if(Za!=0){Za=1/Za}var da=(Ma*za-Ya*Xa)*Za;var Ia=(-Ma*Xa+Ya*ga)*Za;var wa;var Va;var La;var Aa;var ka;var Ba;var Pa;var Ta;var Sa;var Ca;var qa;var Ra;Va=Pt-zt;La=Tt-Mt;Aa=St-Yt;Ba=zt+Va*da;Pa=Mt+La*da;Ta=Yt+Aa*da;Va=Wt-zt;La=Gt-Mt;Aa=Ht-Yt;Ba+=Va*Ia;Pa+=La*Ia;Ta+=Aa*Ia;Va=qt-dt;La=Rt-It;Aa=Et-wt;Ca=dt+Va*da;qa=It+La*da;Ra=wt+Aa*da;Va=Jt-dt;La=Qt-It;Aa=$t-wt;Ca+=Va*Ia;qa+=La*Ia;Ra+=Aa*Ia;var Ea=this.closestPoint1;Ea.x=Ba;Ea.y=Pa;Ea.z=Ta;var ja=this.closestPoint2;ja.x=Ca;ja.y=qa;ja.z=Ra;var Na=this.closest;this.depth=Math.sqrt(Na.x*Na.x+Na.y*Na.y+Na.z*Na.z);return Ga.SUCCEEDED}var Da=this.polyhedron;var Fa=Da._vertexPool;if(Fa!=null){Da._vertexPool=Fa._next;Fa._next=null}else{Fa=new Wa}var Oa=Fa.init(Y,Z,d);if(!this.polyhedron._addVertex(Oa,B)){return Ga.EPA_FAILED_TO_ADD_VERTEX}++I}return Ga.EPA_DID_NOT_CONVERGE},computeClosestPoints:function(t,a,i,r,o){return this.computeClosestPointsImpl(t,a,i,r,o,true)},computeDistance:function(t,a,i,r,o){return this.computeClosestPointsImpl(t,a,i,r,o,false)},convexCast:function(t,a,i,r,o,s,n){return this.convexCastImpl(t,a,i,r,o,s,n)},rayCast:function(t,a,i,r,o){var s=this.tempTransform;var n=a;var e=i;s._positionX=e.x;s._positionY=e.y;s._positionZ=e.z;var _=this.tl1;var v=this.tl2;_.x=r.x;_.y=r.y;_.z=r.z;var h=_;var l=h.x-i.x;var c=h.y-i.y;var p=h.z-i.z;h.x=l;h.y=c;h.z=p;v.zero();return this.convexCastImpl(null,t,s,n,_,v,o)}};var D=function(){};var Ga=function(){};var F=function(){};F.projectOrigin2=function(t,a,i){var r;var o;var s;var n;var e;var _;var v;var h;var l=t;o=l.x;s=l.y;n=l.z;var c=a;_=c.x;v=c.y;h=c.z;var p;var f;var m;var b;f=_-o;m=v-s;b=h-n;var u=f*f+m*m+b*b;var x=f*o+m*s+b*n;x=-x/u;if(x<0){var y=i;y.x=o;y.y=s;y.z=n;return 1}if(x>1){var g=i;g.x=_;g.y=v;g.z=h;return 2}var X;var z;var M;var Y;z=o+f*x;M=s+m*x;Y=n+b*x;var Z=i;Z.x=z;Z.y=M;Z.z=Y;return 3};F.projectOrigin3=function(t,a,i,r){var o;var s;var n;var e;var _;var v;var h;var l;var c;var p;var f;var m;var b;var u;var x;var y;var g;var X;var z;var M;var Y;var Z;var d;var I;var w=t;s=w.x;n=w.y;e=w.z;var V=a;v=V.x;h=V.y;l=V.z;var L=i;p=L.x;f=L.y;m=L.z;u=v-s;x=h-n;y=l-e;X=p-v;z=f-h;M=m-l;Z=s-p;d=n-f;I=e-m;var A;var k;var B;var P;k=x*M-y*z;B=y*X-u*M;P=u*z-x*X;var T;var S;var C;var q;var R;var E;var j;var N;var D;var F;var O;var W;S=x*P-y*B;C=y*k-u*P;q=u*B-x*k;E=z*P-M*B;j=M*k-X*P;N=X*B-z*k;F=d*P-I*B;O=I*k-Z*P;W=Z*B-d*k;var G=s*S+n*C+e*q;var H=v*E+h*j+l*N;var U=p*F+f*O+m*W;var J=-1;var Q;var $;var K;var tt;var at=0;$=0;K=0;tt=0;if(G<0){var it;var rt;var ot;var st;var nt;var et;var _t;var vt;var ht=t;rt=ht.x;ot=ht.y;st=ht.z;var lt=a;et=lt.x;_t=lt.y;vt=lt.z;var ct;var pt;var ft;var mt;pt=et-rt;ft=_t-ot;mt=vt-st;var bt=pt*pt+ft*ft+mt*mt;var ut=pt*rt+ft*ot+mt*st;ut=-ut/bt;var xt;if(ut<0){var yt=r;yt.x=rt;yt.y=ot;yt.z=st;xt=1}else if(ut>1){var gt=r;gt.x=et;gt.y=_t;gt.z=vt;xt=2}else{var Xt;var zt;var Mt;var Yt;zt=rt+pt*ut;Mt=ot+ft*ut;Yt=st+mt*ut;var Zt=r;Zt.x=zt;Zt.y=Mt;Zt.z=Yt;xt=3}var dt=r.x*r.x+r.y*r.y+r.z*r.z;at=xt;J=dt;var It=r;$=It.x;K=It.y;tt=It.z}if(H<0){var wt;var Vt;var Lt;var At;var kt;var Bt;var Pt;var Tt;var St=a;Vt=St.x;Lt=St.y;At=St.z;var Ct=i;Bt=Ct.x;Pt=Ct.y;Tt=Ct.z;var qt;var Rt;var Et;var jt;Rt=Bt-Vt;Et=Pt-Lt;jt=Tt-At;var Nt=Rt*Rt+Et*Et+jt*jt;var Dt=Rt*Vt+Et*Lt+jt*At;Dt=-Dt/Nt;var Ft;if(Dt<0){var Ot=r;Ot.x=Vt;Ot.y=Lt;Ot.z=At;Ft=1}else if(Dt>1){var Wt=r;Wt.x=Bt;Wt.y=Pt;Wt.z=Tt;Ft=2}else{var Gt;var Ht;var Ut;var Jt;Ht=Vt+Rt*Dt;Ut=Lt+Et*Dt;Jt=At+jt*Dt;var Qt=r;Qt.x=Ht;Qt.y=Ut;Qt.z=Jt;Ft=3}var $t=r.x*r.x+r.y*r.y+r.z*r.z;if(J<0||$t<J){at=Ft<<1;J=$t;var Kt=r;$=Kt.x;K=Kt.y;tt=Kt.z}}if(U<0){var ta;var aa;var ia;var ra;var oa;var sa;var na;var ea;var _a=t;aa=_a.x;ia=_a.y;ra=_a.z;var va=i;sa=va.x;na=va.y;ea=va.z;var ha;var la;var ca;var pa;la=sa-aa;ca=na-ia;pa=ea-ra;var fa=la*la+ca*ca+pa*pa;var ma=la*aa+ca*ia+pa*ra;ma=-ma/fa;var ba;if(ma<0){var ua=r;ua.x=aa;ua.y=ia;ua.z=ra;ba=1}else if(ma>1){var xa=r;xa.x=sa;xa.y=na;xa.z=ea;ba=2}else{var ya;var ga;var Xa;var za;ga=aa+la*ma;Xa=ia+ca*ma;za=ra+pa*ma;var Ma=r;Ma.x=ga;Ma.y=Xa;Ma.z=za;ba=3}var Ya=r.x*r.x+r.y*r.y+r.z*r.z;if(J<0||Ya<J){at=ba&1|(ba&2)<<1;J=Ya;var Za=r;$=Za.x;K=Za.y;tt=Za.z}}if(J>0){var da=r;da.x=$;da.y=K;da.z=tt;return at}var Ia=k*k+B*B+P*P;if(Ia>0){Ia=1/Math.sqrt(Ia)}k*=Ia;B*=Ia;P*=Ia;var wa=s*k+n*B+e*P;var Va=k*k+B*B+P*P;Va=wa/Va;$=k*Va;K=B*Va;tt=P*Va;var La=r;La.x=$;La.y=K;La.z=tt;return 7};F.projectOrigin4=function(t,a,i,r,o){var s;var n;var e;var _;var v;var h;var l;var c;var p;var f;var m;var b;var u;var x;var y;var g;var X;var z;var M;var Y;var Z;var d;var I;var w;var V;var L;var A;var k;var B;var P;var T;var S;var C;var q;var R;var E;var j;var N;var D;var F;var O=t;n=O.x;e=O.y;_=O.z;var W=a;h=W.x;l=W.y;c=W.z;var G=i;f=G.x;m=G.y;b=G.z;var H=r;x=H.x;y=H.y;g=H.z;z=h-n;M=l-e;Y=c-_;d=f-n;I=m-e;w=b-_;L=x-n;A=y-e;k=g-_;P=f-h;T=m-l;S=b-c;q=x-h;R=y-l;E=g-c;N=x-f;D=y-m;F=g-b;var U;var J;var Q;var $;var K;var tt;var at;var it;var rt;var ot;var st;var nt;var et;var _t;var vt;var ht;var lt;var ct;var pt;var ft;var mt;Q=M*w-Y*I;$=Y*d-z*w;K=z*I-M*d;at=I*k-w*A;it=w*L-d*k;rt=d*A-I*L;st=A*Y-k*M;nt=k*z-L*Y;et=L*M-A*z;vt=R*S-E*T;ht=E*P-q*S;lt=q*T-R*P;var bt=z*vt+M*ht+Y*lt>0?1:-1;var ut=n*Q+e*$+_*K;var xt=n*at+e*it+_*rt;var yt=n*st+e*nt+_*et;var gt=h*vt+l*ht+c*lt;var Xt=-1;var zt;var Mt;var Yt;var Zt;var dt=0;Mt=0;Yt=0;Zt=0;if(ut*bt<0){var It;var wt;var Vt;var Lt;var At;var kt;var Bt;var Pt;var Tt;var St;var Ct;var qt;var Rt;var Et;var jt;var Nt;var Dt;var Ft;var Ot;var Wt;var Gt;var Ht;var Ut;var Jt;var Qt=t;wt=Qt.x;Vt=Qt.y;Lt=Qt.z;var $t=a;kt=$t.x;Bt=$t.y;Pt=$t.z;var Kt=i;St=Kt.x;Ct=Kt.y;qt=Kt.z;Et=kt-wt;jt=Bt-Vt;Nt=Pt-Lt;Ft=St-kt;Ot=Ct-Bt;Wt=qt-Pt;Ht=wt-St;Ut=Vt-Ct;Jt=Lt-qt;var ta;var aa;var ia;var ra;aa=jt*Wt-Nt*Ot;ia=Nt*Ft-Et*Wt;ra=Et*Ot-jt*Ft;var oa;var sa;var na;var ea;var _a;var va;var ha;var la;var ca;var pa;var fa;var ma;sa=jt*ra-Nt*ia;na=Nt*aa-Et*ra;ea=Et*ia-jt*aa;va=Ot*ra-Wt*ia;ha=Wt*aa-Ft*ra;la=Ft*ia-Ot*aa;pa=Ut*ra-Jt*ia;fa=Jt*aa-Ht*ra;ma=Ht*ia-Ut*aa;var ba=wt*sa+Vt*na+Lt*ea;var ua=kt*va+Bt*ha+Pt*la;var xa=St*pa+Ct*fa+qt*ma;var ya=-1;var ga;var Xa;var za;var Ma;var Ya=0;Xa=0;za=0;Ma=0;if(ba<0){var Za;var da;var Ia;var wa;var Va;var La;var Aa;var ka;var Ba=t;da=Ba.x;Ia=Ba.y;wa=Ba.z;var Pa=a;La=Pa.x;Aa=Pa.y;ka=Pa.z;var Ta;var Sa;var Ca;var qa;Sa=La-da;Ca=Aa-Ia;qa=ka-wa;var Ra=Sa*Sa+Ca*Ca+qa*qa;var Ea=Sa*da+Ca*Ia+qa*wa;Ea=-Ea/Ra;var ja;if(Ea<0){var Na=o;Na.x=da;Na.y=Ia;Na.z=wa;ja=1}else if(Ea>1){var Da=o;Da.x=La;Da.y=Aa;Da.z=ka;ja=2}else{var Fa;var Oa;var Wa;var Ga;Oa=da+Sa*Ea;Wa=Ia+Ca*Ea;Ga=wa+qa*Ea;var Ha=o;Ha.x=Oa;Ha.y=Wa;Ha.z=Ga;ja=3}var Ua=o.x*o.x+o.y*o.y+o.z*o.z;Ya=ja;ya=Ua;var Ja=o;Xa=Ja.x;za=Ja.y;Ma=Ja.z}if(ua<0){var Qa;var $a;var Ka;var ti;var ai;var ii;var ri;var oi;var si=a;$a=si.x;Ka=si.y;ti=si.z;var ni=i;ii=ni.x;ri=ni.y;oi=ni.z;var ei;var _i;var vi;var hi;_i=ii-$a;vi=ri-Ka;hi=oi-ti;var li=_i*_i+vi*vi+hi*hi;var ci=_i*$a+vi*Ka+hi*ti;ci=-ci/li;var pi;if(ci<0){var fi=o;fi.x=$a;fi.y=Ka;fi.z=ti;pi=1}else if(ci>1){var mi=o;mi.x=ii;mi.y=ri;mi.z=oi;pi=2}else{var bi;var ui;var xi;var yi;ui=$a+_i*ci;xi=Ka+vi*ci;yi=ti+hi*ci;var gi=o;gi.x=ui;gi.y=xi;gi.z=yi;pi=3}var Xi=o.x*o.x+o.y*o.y+o.z*o.z;if(ya<0||Xi<ya){Ya=pi<<1;ya=Xi;var zi=o;Xa=zi.x;za=zi.y;Ma=zi.z}}if(xa<0){var Mi;var Yi;var Zi;var di;var Ii;var wi;var Vi;var Li;var Ai=t;Yi=Ai.x;Zi=Ai.y;di=Ai.z;var ki=i;wi=ki.x;Vi=ki.y;Li=ki.z;var Bi;var Pi;var Ti;var Si;Pi=wi-Yi;Ti=Vi-Zi;Si=Li-di;var Ci=Pi*Pi+Ti*Ti+Si*Si;var qi=Pi*Yi+Ti*Zi+Si*di;qi=-qi/Ci;var Ri;if(qi<0){var Ei=o;Ei.x=Yi;Ei.y=Zi;Ei.z=di;Ri=1}else if(qi>1){var ji=o;ji.x=wi;ji.y=Vi;ji.z=Li;Ri=2}else{var Ni;var Di;var Fi;var Oi;Di=Yi+Pi*qi;Fi=Zi+Ti*qi;Oi=di+Si*qi;var Wi=o;Wi.x=Di;Wi.y=Fi;Wi.z=Oi;Ri=3}var Gi=o.x*o.x+o.y*o.y+o.z*o.z;if(ya<0||Gi<ya){Ya=Ri&1|(Ri&2)<<1;ya=Gi;var Hi=o;Xa=Hi.x;za=Hi.y;Ma=Hi.z}}var Ui;if(ya>0){var Ji=o;Ji.x=Xa;Ji.y=za;Ji.z=Ma;Ui=Ya}else{var Qi=aa*aa+ia*ia+ra*ra;if(Qi>0){Qi=1/Math.sqrt(Qi)}aa*=Qi;ia*=Qi;ra*=Qi;var $i=wt*aa+Vt*ia+Lt*ra;var Ki=aa*aa+ia*ia+ra*ra;Ki=$i/Ki;Xa=aa*Ki;za=ia*Ki;Ma=ra*Ki;var tr=o;tr.x=Xa;tr.y=za;tr.z=Ma;Ui=7}var ar=o.x*o.x+o.y*o.y+o.z*o.z;dt=Ui;Xt=ar;var ir=o;Mt=ir.x;Yt=ir.y;Zt=ir.z}if(xt*bt<0){var rr;var or;var sr;var nr;var er;var _r;var vr;var hr;var lr;var cr;var pr;var fr;var mr;var br;var ur;var xr;var yr;var gr;var Xr;var zr;var Mr;var Yr;var Zr;var dr;var Ir=t;or=Ir.x;sr=Ir.y;nr=Ir.z;var wr=i;_r=wr.x;vr=wr.y;hr=wr.z;var Vr=r;cr=Vr.x;pr=Vr.y;fr=Vr.z;br=_r-or;ur=vr-sr;xr=hr-nr;gr=cr-_r;Xr=pr-vr;zr=fr-hr;Yr=or-cr;Zr=sr-pr;dr=nr-fr;var Lr;var Ar;var kr;var Br;Ar=ur*zr-xr*Xr;kr=xr*gr-br*zr;Br=br*Xr-ur*gr;var Pr;var Tr;var Sr;var Cr;var qr;var Rr;var Er;var jr;var Nr;var Dr;var Fr;var Or;Tr=ur*Br-xr*kr;Sr=xr*Ar-br*Br;Cr=br*kr-ur*Ar;Rr=Xr*Br-zr*kr;Er=zr*Ar-gr*Br;jr=gr*kr-Xr*Ar;Dr=Zr*Br-dr*kr;Fr=dr*Ar-Yr*Br;Or=Yr*kr-Zr*Ar;var Wr=or*Tr+sr*Sr+nr*Cr;var Gr=_r*Rr+vr*Er+hr*jr;var Hr=cr*Dr+pr*Fr+fr*Or;var Ur=-1;var Jr;var Qr;var $r;var Kr;var to=0;Qr=0;$r=0;Kr=0;if(Wr<0){var ao;var io;var ro;var oo;var so;var no;var eo;var _o;var vo=t;io=vo.x;ro=vo.y;oo=vo.z;var ho=i;no=ho.x;eo=ho.y;_o=ho.z;var lo;var co;var po;var fo;co=no-io;po=eo-ro;fo=_o-oo;var mo=co*co+po*po+fo*fo;var bo=co*io+po*ro+fo*oo;bo=-bo/mo;var uo;if(bo<0){var xo=o;xo.x=io;xo.y=ro;xo.z=oo;uo=1}else if(bo>1){var yo=o;yo.x=no;yo.y=eo;yo.z=_o;uo=2}else{var go;var Xo;var zo;var Mo;Xo=io+co*bo;zo=ro+po*bo;Mo=oo+fo*bo;var Yo=o;Yo.x=Xo;Yo.y=zo;Yo.z=Mo;uo=3}var Zo=o.x*o.x+o.y*o.y+o.z*o.z;to=uo;Ur=Zo;var Io=o;Qr=Io.x;$r=Io.y;Kr=Io.z}if(Gr<0){var wo;var Vo;var Lo;var Ao;var ko;var Bo;var Po;var To;var So=i;Vo=So.x;Lo=So.y;Ao=So.z;var Co=r;Bo=Co.x;Po=Co.y;To=Co.z;var qo;var Ro;var Eo;var jo;Ro=Bo-Vo;Eo=Po-Lo;jo=To-Ao;var No=Ro*Ro+Eo*Eo+jo*jo;var Do=Ro*Vo+Eo*Lo+jo*Ao;Do=-Do/No;var Fo;if(Do<0){var Oo=o;Oo.x=Vo;Oo.y=Lo;Oo.z=Ao;Fo=1}else if(Do>1){var Wo=o;Wo.x=Bo;Wo.y=Po;Wo.z=To;Fo=2}else{var Go;var Ho;var Uo;var Jo;Ho=Vo+Ro*Do;Uo=Lo+Eo*Do;Jo=Ao+jo*Do;var Qo=o;Qo.x=Ho;Qo.y=Uo;Qo.z=Jo;Fo=3}var $o=o.x*o.x+o.y*o.y+o.z*o.z;if(Ur<0||$o<Ur){to=Fo<<1;Ur=$o;var Ko=o;Qr=Ko.x;$r=Ko.y;Kr=Ko.z}}if(Hr<0){var ts;var as;var is;var rs;var os;var ss;var ns;var es;var _s=t;as=_s.x;is=_s.y;rs=_s.z;var vs=r;ss=vs.x;ns=vs.y;es=vs.z;var hs;var ls;var cs;var ps;ls=ss-as;cs=ns-is;ps=es-rs;var fs=ls*ls+cs*cs+ps*ps;var ms=ls*as+cs*is+ps*rs;ms=-ms/fs;var bs;if(ms<0){var us=o;us.x=as;us.y=is;us.z=rs;bs=1}else if(ms>1){var xs=o;xs.x=ss;xs.y=ns;xs.z=es;bs=2}else{var ys;var gs;var Xs;var zs;gs=as+ls*ms;Xs=is+cs*ms;zs=rs+ps*ms;var Ms=o;Ms.x=gs;Ms.y=Xs;Ms.z=zs;bs=3}var Ys=o.x*o.x+o.y*o.y+o.z*o.z;if(Ur<0||Ys<Ur){to=bs&1|(bs&2)<<1;Ur=Ys;var Zs=o;Qr=Zs.x;$r=Zs.y;Kr=Zs.z}}var ds;if(Ur>0){var Is=o;Is.x=Qr;Is.y=$r;Is.z=Kr;ds=to}else{var ws=Ar*Ar+kr*kr+Br*Br;if(ws>0){ws=1/Math.sqrt(ws)}Ar*=ws;kr*=ws;Br*=ws;var Vs=or*Ar+sr*kr+nr*Br;var Ls=Ar*Ar+kr*kr+Br*Br;Ls=Vs/Ls;Qr=Ar*Ls;$r=kr*Ls;Kr=Br*Ls;var As=o;As.x=Qr;As.y=$r;As.z=Kr;ds=7}var ks=o.x*o.x+o.y*o.y+o.z*o.z;if(Xt<0||ks<Xt){dt=ds&1|(ds&6)<<1;Xt=ks;var Bs=o;Mt=Bs.x;Yt=Bs.y;Zt=Bs.z}}if(yt*bt<0){var Ps;var Ts;var Ss;var Cs;var qs;var Rs;var Es;var js;var Ns;var Ds;var Fs;var Os;var Ws;var Gs;var Hs;var Us;var Js;var Qs;var $s;var Ks;var tn;var an;var rn;var on;var sn=t;Ts=sn.x;Ss=sn.y;Cs=sn.z;var nn=a;Rs=nn.x;Es=nn.y;js=nn.z;var en=r;Ds=en.x;Fs=en.y;Os=en.z;Gs=Rs-Ts;Hs=Es-Ss;Us=js-Cs;Qs=Ds-Rs;$s=Fs-Es;Ks=Os-js;an=Ts-Ds;rn=Ss-Fs;on=Cs-Os;var _n;var vn;var hn;var ln;vn=Hs*Ks-Us*$s;hn=Us*Qs-Gs*Ks;ln=Gs*$s-Hs*Qs;var cn;var pn;var fn;var mn;var bn;var un;var xn;var yn;var gn;var Xn;var zn;var Mn;pn=Hs*ln-Us*hn;fn=Us*vn-Gs*ln;mn=Gs*hn-Hs*vn;un=$s*ln-Ks*hn;xn=Ks*vn-Qs*ln;yn=Qs*hn-$s*vn;Xn=rn*ln-on*hn;zn=on*vn-an*ln;Mn=an*hn-rn*vn;var Yn=Ts*pn+Ss*fn+Cs*mn;var Zn=Rs*un+Es*xn+js*yn;var dn=Ds*Xn+Fs*zn+Os*Mn;var In=-1;var wn;var Vn;var Ln;var An;var kn=0;Vn=0;Ln=0;An=0;if(Yn<0){var Bn;var Pn;var Tn;var Sn;var Cn;var qn;var Rn;var En;var jn=t;Pn=jn.x;Tn=jn.y;Sn=jn.z;var Nn=a;qn=Nn.x;Rn=Nn.y;En=Nn.z;var Dn;var Fn;var On;var Wn;Fn=qn-Pn;On=Rn-Tn;Wn=En-Sn;var Gn=Fn*Fn+On*On+Wn*Wn;var Hn=Fn*Pn+On*Tn+Wn*Sn;Hn=-Hn/Gn;var Un;if(Hn<0){var Jn=o;Jn.x=Pn;Jn.y=Tn;Jn.z=Sn;Un=1}else if(Hn>1){var Qn=o;Qn.x=qn;Qn.y=Rn;Qn.z=En;Un=2}else{var $n;var Kn;var te;var ae;Kn=Pn+Fn*Hn;te=Tn+On*Hn;ae=Sn+Wn*Hn;var ie=o;ie.x=Kn;ie.y=te;ie.z=ae;Un=3}var re=o.x*o.x+o.y*o.y+o.z*o.z;kn=Un;In=re;var oe=o;Vn=oe.x;Ln=oe.y;An=oe.z}if(Zn<0){var se;var ne;var ee;var _e;var ve;var he;var le;var ce;var pe=a;ne=pe.x;ee=pe.y;_e=pe.z;var fe=r;he=fe.x;le=fe.y;ce=fe.z;var me;var be;var ue;var xe;be=he-ne;ue=le-ee;xe=ce-_e;var ye=be*be+ue*ue+xe*xe;var ge=be*ne+ue*ee+xe*_e;ge=-ge/ye;var Xe;if(ge<0){var ze=o;ze.x=ne;ze.y=ee;ze.z=_e;Xe=1}else if(ge>1){var Me=o;Me.x=he;Me.y=le;Me.z=ce;Xe=2}else{var Ye;var Ze;var de;var Ie;Ze=ne+be*ge;de=ee+ue*ge;Ie=_e+xe*ge;var we=o;we.x=Ze;we.y=de;we.z=Ie;Xe=3}var Ve=o.x*o.x+o.y*o.y+o.z*o.z;if(In<0||Ve<In){kn=Xe<<1;In=Ve;var Le=o;Vn=Le.x;Ln=Le.y;An=Le.z}}if(dn<0){var Ae;var ke;var Be;var Pe;var Te;var Se;var Ce;var qe;var Re=t;ke=Re.x;Be=Re.y;Pe=Re.z;var Ee=r;Se=Ee.x;Ce=Ee.y;qe=Ee.z;var je;var Ne;var De;var Fe;Ne=Se-ke;De=Ce-Be;Fe=qe-Pe;var Oe=Ne*Ne+De*De+Fe*Fe;var We=Ne*ke+De*Be+Fe*Pe;We=-We/Oe;var Ge;if(We<0){var He=o;He.x=ke;He.y=Be;He.z=Pe;Ge=1}else if(We>1){var Ue=o;Ue.x=Se;Ue.y=Ce;Ue.z=qe;Ge=2}else{var Je;var Qe;var $e;var Ke;Qe=ke+Ne*We;$e=Be+De*We;Ke=Pe+Fe*We;var t_=o;t_.x=Qe;t_.y=$e;t_.z=Ke;Ge=3}var a_=o.x*o.x+o.y*o.y+o.z*o.z;if(In<0||a_<In){kn=Ge&1|(Ge&2)<<1;In=a_;var i_=o;Vn=i_.x;Ln=i_.y;An=i_.z}}var r_;if(In>0){var o_=o;o_.x=Vn;o_.y=Ln;o_.z=An;r_=kn}else{var s_=vn*vn+hn*hn+ln*ln;if(s_>0){s_=1/Math.sqrt(s_)}vn*=s_;hn*=s_;ln*=s_;var n_=Ts*vn+Ss*hn+Cs*ln;var e_=vn*vn+hn*hn+ln*ln;e_=n_/e_;Vn=vn*e_;Ln=hn*e_;An=ln*e_;var __=o;__.x=Vn;__.y=Ln;__.z=An;r_=7}var v_=o.x*o.x+o.y*o.y+o.z*o.z;if(Xt<0||v_<Xt){dt=r_&3|(r_&4)<<1;Xt=v_;var h_=o;Mt=h_.x;Yt=h_.y;Zt=h_.z}}if(gt*bt<0){var l_;var c_;var p_;var f_;var m_;var b_;var u_;var x_;var y_;var g_;var X_;var z_;var M_;var Y_;var Z_;var d_;var I_;var w_;var V_;var L_;var A_;var k_;var B_;var P_;var T_=a;c_=T_.x;p_=T_.y;f_=T_.z;var S_=i;b_=S_.x;u_=S_.y;x_=S_.z;var C_=r;g_=C_.x;X_=C_.y;z_=C_.z;Y_=b_-c_;Z_=u_-p_;d_=x_-f_;w_=g_-b_;V_=X_-u_;L_=z_-x_;k_=c_-g_;B_=p_-X_;P_=f_-z_;var q_;var R_;var E_;var j_;R_=Z_*L_-d_*V_;E_=d_*w_-Y_*L_;j_=Y_*V_-Z_*w_;var N_;var D_;var F_;var O_;var W_;var G_;var H_;var U_;var J_;var Q_;var $_;var K_;D_=Z_*j_-d_*E_;F_=d_*R_-Y_*j_;O_=Y_*E_-Z_*R_;G_=V_*j_-L_*E_;H_=L_*R_-w_*j_;U_=w_*E_-V_*R_;Q_=B_*j_-P_*E_;$_=P_*R_-k_*j_;K_=k_*E_-B_*R_;var tv=c_*D_+p_*F_+f_*O_;var av=b_*G_+u_*H_+x_*U_;var iv=g_*Q_+X_*$_+z_*K_;var rv=-1;var ov;var sv;var nv;var ev;var _v=0;sv=0;nv=0;ev=0;if(tv<0){var vv;var hv;var lv;var cv;var pv;var fv;var mv;var bv;var uv=a;hv=uv.x;lv=uv.y;cv=uv.z;var xv=i;fv=xv.x;mv=xv.y;bv=xv.z;var yv;var gv;var Xv;var zv;gv=fv-hv;Xv=mv-lv;zv=bv-cv;var Mv=gv*gv+Xv*Xv+zv*zv;var Yv=gv*hv+Xv*lv+zv*cv;Yv=-Yv/Mv;var Zv;if(Yv<0){var dv=o;dv.x=hv;dv.y=lv;dv.z=cv;Zv=1}else if(Yv>1){var Iv=o;Iv.x=fv;Iv.y=mv;Iv.z=bv;Zv=2}else{var wv;var Vv;var Lv;var Av;Vv=hv+gv*Yv;Lv=lv+Xv*Yv;Av=cv+zv*Yv;var kv=o;kv.x=Vv;kv.y=Lv;kv.z=Av;Zv=3}var Bv=o.x*o.x+o.y*o.y+o.z*o.z;_v=Zv;rv=Bv;var Pv=o;sv=Pv.x;nv=Pv.y;ev=Pv.z}if(av<0){var Tv;var Sv;var Cv;var qv;var Rv;var Ev;var jv;var Nv;var Dv=i;Sv=Dv.x;Cv=Dv.y;qv=Dv.z;var Fv=r;Ev=Fv.x;jv=Fv.y;Nv=Fv.z;var Ov;var Wv;var Gv;var Hv;Wv=Ev-Sv;Gv=jv-Cv;Hv=Nv-qv;var Uv=Wv*Wv+Gv*Gv+Hv*Hv;var Jv=Wv*Sv+Gv*Cv+Hv*qv;Jv=-Jv/Uv;var Qv;if(Jv<0){var $v=o;$v.x=Sv;$v.y=Cv;$v.z=qv;Qv=1}else if(Jv>1){var Kv=o;Kv.x=Ev;Kv.y=jv;Kv.z=Nv;Qv=2}else{var th;var ah;var ih;var rh;ah=Sv+Wv*Jv;ih=Cv+Gv*Jv;rh=qv+Hv*Jv;var oh=o;oh.x=ah;oh.y=ih;oh.z=rh;Qv=3}var sh=o.x*o.x+o.y*o.y+o.z*o.z;if(rv<0||sh<rv){_v=Qv<<1;rv=sh;var nh=o;sv=nh.x;nv=nh.y;ev=nh.z}}if(iv<0){var eh;var _h;var vh;var hh;var lh;var ch;var ph;var fh;var mh=a;_h=mh.x;vh=mh.y;hh=mh.z;var bh=r;ch=bh.x;ph=bh.y;fh=bh.z;var uh;var xh;var yh;var gh;xh=ch-_h;yh=ph-vh;gh=fh-hh;var Xh=xh*xh+yh*yh+gh*gh;var zh=xh*_h+yh*vh+gh*hh;zh=-zh/Xh;var Mh;if(zh<0){var Yh=o;Yh.x=_h;Yh.y=vh;Yh.z=hh;Mh=1}else if(zh>1){var Zh=o;Zh.x=ch;Zh.y=ph;Zh.z=fh;Mh=2}else{var dh;var Ih;var wh;var Vh;Ih=_h+xh*zh;wh=vh+yh*zh;Vh=hh+gh*zh;var Lh=o;Lh.x=Ih;Lh.y=wh;Lh.z=Vh;Mh=3}var Ah=o.x*o.x+o.y*o.y+o.z*o.z;if(rv<0||Ah<rv){_v=Mh&1|(Mh&2)<<1;rv=Ah;var kh=o;sv=kh.x;nv=kh.y;ev=kh.z}}var Bh;if(rv>0){var Ph=o;Ph.x=sv;Ph.y=nv;Ph.z=ev;Bh=_v}else{var Th=R_*R_+E_*E_+j_*j_;if(Th>0){Th=1/Math.sqrt(Th)}R_*=Th;E_*=Th;j_*=Th;var Sh=c_*R_+p_*E_+f_*j_;var Ch=R_*R_+E_*E_+j_*j_;Ch=Sh/Ch;sv=R_*Ch;nv=E_*Ch;ev=j_*Ch;var qh=o;qh.x=sv;qh.y=nv;qh.z=ev;Bh=7}var Rh=o.x*o.x+o.y*o.y+o.z*o.z;if(Xt<0||Rh<Xt){dt=Bh<<1;Xt=Rh;var Eh=o;Mt=Eh.x;Yt=Eh.y;Zt=Eh.z}}if(Xt>0){var jh=o;jh.x=Mt;jh.y=Yt;jh.z=Zt;return dt}o.zero();return 15};var ws=function(t,a,i,r,o,s,n,e,_){if(_==null){_=1}if(e==null){e=0}if(n==null){n=0}if(s==null){s=0}if(o==null){o=1}if(r==null){r=0}if(i==null){i=0}if(a==null){a=0}if(t==null){t=1}this.e00=t;this.e01=a;this.e02=i;this.e10=r;this.e11=o;this.e12=s;this.e20=n;this.e21=e;this.e22=_;ws.numCreations++};ws.prototype={init:function(t,a,i,r,o,s,n,e,_){this.e00=t;this.e01=a;this.e02=i;this.e10=r;this.e11=o;this.e12=s;this.e20=n;this.e21=e;this.e22=_;return this},identity:function(){var t=1;var a=0;var i=0;var r=0;var o=1;var s=0;var n=0;var e=0;var _=1;this.e00=t;this.e01=a;this.e02=i;this.e10=r;this.e11=o;this.e12=s;this.e20=n;this.e21=e;this.e22=_;return this},add:function(t){return new ws(this.e00+t.e00,this.e01+t.e01,this.e02+t.e02,this.e10+t.e10,this.e11+t.e11,this.e12+t.e12,this.e20+t.e20,this.e21+t.e21,this.e22+t.e22)},sub:function(t){return new ws(this.e00-t.e00,this.e01-t.e01,this.e02-t.e02,this.e10-t.e10,this.e11-t.e11,this.e12-t.e12,this.e20-t.e20,this.e21-t.e21,this.e22-t.e22)},scale:function(t){return new ws(this.e00*t,this.e01*t,this.e02*t,this.e10*t,this.e11*t,this.e12*t,this.e20*t,this.e21*t,this.e22*t)},mul:function(t){return new ws(this.e00*t.e00+this.e01*t.e10+this.e02*t.e20,this.e00*t.e01+this.e01*t.e11+this.e02*t.e21,this.e00*t.e02+this.e01*t.e12+this.e02*t.e22,this.e10*t.e00+this.e11*t.e10+this.e12*t.e20,this.e10*t.e01+this.e11*t.e11+this.e12*t.e21,this.e10*t.e02+this.e11*t.e12+this.e12*t.e22,this.e20*t.e00+this.e21*t.e10+this.e22*t.e20,this.e20*t.e01+this.e21*t.e11+this.e22*t.e21,this.e20*t.e02+this.e21*t.e12+this.e22*t.e22)},addEq:function(t){var a=this.e00+t.e00;var i=this.e01+t.e01;var r=this.e02+t.e02;var o=this.e10+t.e10;var s=this.e11+t.e11;var n=this.e12+t.e12;var e=this.e20+t.e20;var _=this.e21+t.e21;var v=this.e22+t.e22;this.e00=a;this.e01=i;this.e02=r;this.e10=o;this.e11=s;this.e12=n;this.e20=e;this.e21=_;this.e22=v;return this},subEq:function(t){var a=this.e00-t.e00;var i=this.e01-t.e01;var r=this.e02-t.e02;var o=this.e10-t.e10;var s=this.e11-t.e11;var n=this.e12-t.e12;var e=this.e20-t.e20;var _=this.e21-t.e21;var v=this.e22-t.e22;this.e00=a;this.e01=i;this.e02=r;this.e10=o;this.e11=s;this.e12=n;this.e20=e;this.e21=_;this.e22=v;return this},scaleEq:function(t){var a=this.e00*t;var i=this.e01*t;var r=this.e02*t;var o=this.e10*t;var s=this.e11*t;var n=this.e12*t;var e=this.e20*t;var _=this.e21*t;var v=this.e22*t;this.e00=a;this.e01=i;this.e02=r;this.e10=o;this.e11=s;this.e12=n;this.e20=e;this.e21=_;this.e22=v;return this},mulEq:function(t){var a=this.e00*t.e00+this.e01*t.e10+this.e02*t.e20;var i=this.e00*t.e01+this.e01*t.e11+this.e02*t.e21;var r=this.e00*t.e02+this.e01*t.e12+this.e02*t.e22;var o=this.e10*t.e00+this.e11*t.e10+this.e12*t.e20;var s=this.e10*t.e01+this.e11*t.e11+this.e12*t.e21;var n=this.e10*t.e02+this.e11*t.e12+this.e12*t.e22;var e=this.e20*t.e00+this.e21*t.e10+this.e22*t.e20;var _=this.e20*t.e01+this.e21*t.e11+this.e22*t.e21;var v=this.e20*t.e02+this.e21*t.e12+this.e22*t.e22;this.e00=a;this.e01=i;this.e02=r;this.e10=o;this.e11=s;this.e12=n;this.e20=e;this.e21=_;this.e22=v;return this},prependScale:function(t,a,i){return new ws(this.e00*t,this.e01*t,this.e02*t,this.e10*a,this.e11*a,this.e12*a,this.e20*i,this.e21*i,this.e22*i)},appendScale:function(t,a,i){return new ws(this.e00*t,this.e01*a,this.e02*i,this.e10*t,this.e11*a,this.e12*i,this.e20*t,this.e21*a,this.e22*i)},prependRotation:function(t,a,i,r){var o=Math.sin(t);var s=Math.cos(t);var n=1-s;var e=a*a*n+s;var _=a*i*n-r*o;var v=a*r*n+i*o;var h=i*a*n+r*o;var l=i*i*n+s;var c=i*r*n-a*o;var p=r*a*n-i*o;var f=r*i*n+a*o;var m=r*r*n+s;return new ws(e*this.e00+_*this.e10+v*this.e20,e*this.e01+_*this.e11+v*this.e21,e*this.e02+_*this.e12+v*this.e22,h*this.e00+l*this.e10+c*this.e20,h*this.e01+l*this.e11+c*this.e21,h*this.e02+l*this.e12+c*this.e22,p*this.e00+f*this.e10+m*this.e20,p*this.e01+f*this.e11+m*this.e21,p*this.e02+f*this.e12+m*this.e22)},appendRotation:function(t,a,i,r){var o=Math.sin(t);var s=Math.cos(t);var n=1-s;var e=a*a*n+s;var _=a*i*n-r*o;var v=a*r*n+i*o;var h=i*a*n+r*o;var l=i*i*n+s;var c=i*r*n-a*o;var p=r*a*n-i*o;var f=r*i*n+a*o;var m=r*r*n+s;return new ws(this.e00*e+this.e01*h+this.e02*p,this.e00*_+this.e01*l+this.e02*f,this.e00*v+this.e01*c+this.e02*m,this.e10*e+this.e11*h+this.e12*p,this.e10*_+this.e11*l+this.e12*f,this.e10*v+this.e11*c+this.e12*m,this.e20*e+this.e21*h+this.e22*p,this.e20*_+this.e21*l+this.e22*f,this.e20*v+this.e21*c+this.e22*m)},prependScaleEq:function(t,a,i){var r=this.e00*t;var o=this.e01*t;var s=this.e02*t;var n=this.e10*a;var e=this.e11*a;var _=this.e12*a;var v=this.e20*i;var h=this.e21*i;var l=this.e22*i;this.e00=r;this.e01=o;this.e02=s;this.e10=n;this.e11=e;this.e12=_;this.e20=v;this.e21=h;this.e22=l;return this},appendScaleEq:function(t,a,i){var r=this.e00*t;var o=this.e01*a;var s=this.e02*i;var n=this.e10*t;var e=this.e11*a;var _=this.e12*i;var v=this.e20*t;var h=this.e21*a;var l=this.e22*i;this.e00=r;this.e01=o;this.e02=s;this.e10=n;this.e11=e;this.e12=_;this.e20=v;this.e21=h;this.e22=l;return this},prependRotationEq:function(t,a,i,r){var o=Math.sin(t);var s=Math.cos(t);var n=1-s;var e=a*a*n+s;var _=a*i*n-r*o;var v=a*r*n+i*o;var h=i*a*n+r*o;var l=i*i*n+s;var c=i*r*n-a*o;var p=r*a*n-i*o;var f=r*i*n+a*o;var m=r*r*n+s;var b=e*this.e00+_*this.e10+v*this.e20;var u=e*this.e01+_*this.e11+v*this.e21;var x=e*this.e02+_*this.e12+v*this.e22;var y=h*this.e00+l*this.e10+c*this.e20;var g=h*this.e01+l*this.e11+c*this.e21;var X=h*this.e02+l*this.e12+c*this.e22;var z=p*this.e00+f*this.e10+m*this.e20;var M=p*this.e01+f*this.e11+m*this.e21;var Y=p*this.e02+f*this.e12+m*this.e22;this.e00=b;this.e01=u;this.e02=x;this.e10=y;this.e11=g;this.e12=X;this.e20=z;this.e21=M;this.e22=Y;return this},appendRotationEq:function(t,a,i,r){var o=Math.sin(t);var s=Math.cos(t);var n=1-s;var e=a*a*n+s;var _=a*i*n-r*o;var v=a*r*n+i*o;var h=i*a*n+r*o;var l=i*i*n+s;var c=i*r*n-a*o;var p=r*a*n-i*o;var f=r*i*n+a*o;var m=r*r*n+s;var b=this.e00*e+this.e01*h+this.e02*p;var u=this.e00*_+this.e01*l+this.e02*f;var x=this.e00*v+this.e01*c+this.e02*m;var y=this.e10*e+this.e11*h+this.e12*p;var g=this.e10*_+this.e11*l+this.e12*f;var X=this.e10*v+this.e11*c+this.e12*m;var z=this.e20*e+this.e21*h+this.e22*p;var M=this.e20*_+this.e21*l+this.e22*f;var Y=this.e20*v+this.e21*c+this.e22*m;this.e00=b;this.e01=u;this.e02=x;this.e10=y;this.e11=g;this.e12=X;this.e20=z;this.e21=M;this.e22=Y;return this},transpose:function(){return new ws(this.e00,this.e10,this.e20,this.e01,this.e11,this.e21,this.e02,this.e12,this.e22)},transposeEq:function(){var t=this.e00;var a=this.e10;var i=this.e20;var r=this.e01;var o=this.e11;var s=this.e21;var n=this.e02;var e=this.e12;var _=this.e22;this.e00=t;this.e01=a;this.e02=i;this.e10=r;this.e11=o;this.e12=s;this.e20=n;this.e21=e;this.e22=_;return this},determinant:function(){return this.e00*(this.e11*this.e22-this.e12*this.e21)-this.e01*(this.e10*this.e22-this.e12*this.e20)+this.e02*(this.e10*this.e21-this.e11*this.e20)},trace:function(){return this.e00+this.e11+this.e22},inverse:function(){var t=this.e11*this.e22-this.e12*this.e21;var a=this.e10*this.e22-this.e12*this.e20;var i=this.e10*this.e21-this.e11*this.e20;var r=this.e01*this.e22-this.e02*this.e21;var o=this.e00*this.e22-this.e02*this.e20;var s=this.e00*this.e21-this.e01*this.e20;var n=this.e01*this.e12-this.e02*this.e11;var e=this.e00*this.e12-this.e02*this.e10;var _=this.e00*this.e11-this.e01*this.e10;var v=this.e00*t-this.e01*a+this.e02*i;if(v!=0){v=1/v}return new ws(t*v,-r*v,n*v,-a*v,o*v,-e*v,i*v,-s*v,_*v)},inverseEq:function(){var t=this.e11*this.e22-this.e12*this.e21;var a=this.e10*this.e22-this.e12*this.e20;var i=this.e10*this.e21-this.e11*this.e20;var r=this.e01*this.e22-this.e02*this.e21;var o=this.e00*this.e22-this.e02*this.e20;var s=this.e00*this.e21-this.e01*this.e20;var n=this.e01*this.e12-this.e02*this.e11;var e=this.e00*this.e12-this.e02*this.e10;var _=this.e00*this.e11-this.e01*this.e10;var v=this.e00*t-this.e01*a+this.e02*i;if(v!=0){v=1/v}var h=t*v;var l=-r*v;var c=n*v;var p=-a*v;var f=o*v;var m=-e*v;var b=i*v;var u=-s*v;var x=_*v;this.e00=h;this.e01=l;this.e02=c;this.e10=p;this.e11=f;this.e12=m;this.e20=b;this.e21=u;this.e22=x;return this},toArray:function(t){if(t==null){t=false}if(t){return[this.e00,this.e10,this.e20,this.e01,this.e11,this.e21,this.e02,this.e12,this.e22]}else{return[this.e00,this.e01,this.e02,this.e10,this.e11,this.e12,this.e20,this.e21,this.e22]}},copyFrom:function(t){this.e00=t.e00;this.e01=t.e01;this.e02=t.e02;this.e10=t.e10;this.e11=t.e11;this.e12=t.e12;this.e20=t.e20;this.e21=t.e21;this.e22=t.e22;return this},clone:function(){return new ws(this.e00,this.e01,this.e02,this.e10,this.e11,this.e12,this.e20,this.e21,this.e22)},fromQuat:function(t){var a=t.x;var i=t.y;var r=t.z;var o=t.w;var s=2*a;var n=2*i;var e=2*r;var _=a*s;var v=i*n;var h=r*e;var l=a*n;var c=i*e;var p=a*e;var f=o*s;var m=o*n;var b=o*e;this.e00=1-v-h;this.e01=l-b;this.e02=p+m;this.e10=l+b;this.e11=1-_-h;this.e12=c-f;this.e20=p-m;this.e21=c+f;this.e22=1-_-v;return this},toQuat:function(){var t=new va;var a=this.e00;var i=this.e11;var r=this.e22;var o=a+i+r;var s;if(o>0){s=Math.sqrt(o+1);t.w=.5*s;s=.5/s;t.x=(this.e21-this.e12)*s;t.y=(this.e02-this.e20)*s;t.z=(this.e10-this.e01)*s}else if(a>i){if(a>r){s=Math.sqrt(a-i-r+1);t.x=.5*s;s=.5/s;t.y=(this.e01+this.e10)*s;t.z=(this.e02+this.e20)*s;t.w=(this.e21-this.e12)*s}else{s=Math.sqrt(r-a-i+1);t.z=.5*s;s=.5/s;t.x=(this.e02+this.e20)*s;t.y=(this.e12+this.e21)*s;t.w=(this.e10-this.e01)*s}}else if(i>r){s=Math.sqrt(i-r-a+1);t.y=.5*s;s=.5/s;t.x=(this.e01+this.e10)*s;t.z=(this.e12+this.e21)*s;t.w=(this.e02-this.e20)*s}else{s=Math.sqrt(r-a-i+1);t.z=.5*s;s=.5/s;t.x=(this.e02+this.e20)*s;t.y=(this.e12+this.e21)*s;t.w=(this.e10-this.e01)*s}return t},fromEulerXyz:function(t){var a=Math.sin(t.x);var i=Math.sin(t.y);var r=Math.sin(t.z);var o=Math.cos(t.x);var s=Math.cos(t.y);var n=Math.cos(t.z);var e=s*n;var _=-s*r;var v=i;var h=o*r+n*a*i;var l=o*n-a*i*r;var c=-s*a;var p=a*r-o*n*i;var f=n*a+o*i*r;var m=o*s;this.e00=e;this.e01=_;this.e02=v;this.e10=h;this.e11=l;this.e12=c;this.e20=p;this.e21=f;this.e22=m;return this},toEulerXyz:function(){var t=this.e02;if(t<=-1){var a=Math.atan2(this.e21,this.e11);return new Is(a*.5,-1.570796326794895,-a*.5)}if(t>=1){var i=Math.atan2(this.e21,this.e11);return new Is(i*.5,1.570796326794895,i*.5)}var r=Math.asin(t);var o=Math.atan2(-this.e12,this.e22);var s=Math.atan2(-this.e01,this.e00);return new Is(o,r,s)},getRow:function(t){if(t==0){return new Is(this.e00,this.e01,this.e02)}else if(t==1){return new Is(this.e10,this.e11,this.e12)}else if(t==2){return new Is(this.e20,this.e21,this.e22)}else{return null}},getCol:function(t){if(t==0){return new Is(this.e00,this.e10,this.e20)}else if(t==1){return new Is(this.e01,this.e11,this.e21)}else if(t==2){return new Is(this.e02,this.e12,this.e22)}else{return null}},getRowTo:function(t,a){if(t==0){a.init(this.e00,this.e01,this.e02)}else if(t==1){a.init(this.e10,this.e11,this.e12)}else if(t==2){a.init(this.e20,this.e21,this.e22)}else{a.zero()}},getColTo:function(t,a){if(t==0){a.init(this.e00,this.e10,this.e20)}else if(t==1){a.init(this.e01,this.e11,this.e21)}else if(t==2){a.init(this.e02,this.e12,this.e22)}else{a.zero()}},fromRows:function(t,a,i){var r=t.x;var o=t.y;var s=t.z;var n=a.x;var e=a.y;var _=a.z;var v=i.x;var h=i.y;var l=i.z;this.e00=r;this.e01=o;this.e02=s;this.e10=n;this.e11=e;this.e12=_;this.e20=v;this.e21=h;this.e22=l;return this},fromCols:function(t,a,i){var r=t.x;var o=a.x;var s=i.x;var n=t.y;var e=a.y;var _=i.y;var v=t.z;var h=a.z;var l=i.z;this.e00=r;this.e01=o;this.e02=s;this.e10=n;this.e11=e;this.e12=_;this.e20=v;this.e21=h;this.e22=l;return this},toString:function(){return"Mat3["+(this.e00>0?(this.e00*1e7+.5|0)/1e7:(this.e00*1e7-.5|0)/1e7)+", "+(this.e01>0?(this.e01*1e7+.5|0)/1e7:(this.e01*1e7-.5|0)/1e7)+", "+(this.e02>0?(this.e02*1e7+.5|0)/1e7:(this.e02*1e7-.5|0)/1e7)+",\n"+"     "+(this.e10>0?(this.e10*1e7+.5|0)/1e7:(this.e10*1e7-.5|0)/1e7)+", "+(this.e11>0?(this.e11*1e7+.5|0)/1e7:(this.e11*1e7-.5|0)/1e7)+", "+(this.e12>0?(this.e12*1e7+.5|0)/1e7:(this.e12*1e7-.5|0)/1e7)+",\n"+"     "+(this.e20>0?(this.e20*1e7+.5|0)/1e7:(this.e20*1e7-.5|0)/1e7)+", "+(this.e21>0?(this.e21*1e7+.5|0)/1e7:(this.e21*1e7-.5|0)/1e7)+", "+(this.e22>0?(this.e22*1e7+.5|0)/1e7:(this.e22*1e7-.5|0)/1e7)+"]"}};var O=function(t,a,i,r,o,s,n,e,_,v,h,l,c,p,f,m){if(m==null){m=1}if(f==null){f=0}if(p==null){p=0}if(c==null){c=0}if(l==null){l=0}if(h==null){h=1}if(v==null){v=0}if(_==null){_=0}if(e==null){e=0}if(n==null){n=0}if(s==null){s=1}if(o==null){o=0}if(r==null){r=0}if(i==null){i=0}if(a==null){a=0}if(t==null){t=1}this.e00=t;this.e01=a;this.e02=i;this.e03=r;this.e10=o;this.e11=s;this.e12=n;this.e13=e;this.e20=_;this.e21=v;this.e22=h;this.e23=l;this.e30=c;this.e31=p;this.e32=f;this.e33=m;O.numCreations++};O.prototype={init:function(t,a,i,r,o,s,n,e,_,v,h,l,c,p,f,m){this.e00=t;this.e01=a;this.e02=i;this.e03=r;this.e10=o;this.e11=s;this.e12=n;this.e13=e;this.e20=_;this.e21=v;this.e22=h;this.e23=l;this.e30=c;this.e31=p;this.e32=f;this.e33=m;return this},identity:function(){var t=1;var a=0;var i=0;var r=0;var o=0;var s=1;var n=0;var e=0;var _=0;var v=0;var h=1;var l=0;var c=0;var p=0;var f=0;var m=1;this.e00=t;this.e01=a;this.e02=i;this.e03=r;this.e10=o;this.e11=s;this.e12=n;this.e13=e;this.e20=_;this.e21=v;this.e22=h;this.e23=l;this.e30=c;this.e31=p;this.e32=f;this.e33=m;return this},add:function(t){return new O(this.e00+t.e00,this.e01+t.e01,this.e02+t.e02,this.e03+t.e03,this.e10+t.e10,this.e11+t.e11,this.e12+t.e12,this.e13+t.e13,this.e20+t.e20,this.e21+t.e21,this.e22+t.e22,this.e23+t.e23,this.e30+t.e30,this.e31+t.e31,this.e32+t.e32,this.e33+t.e33)},sub:function(t){return new O(this.e00-t.e00,this.e01-t.e01,this.e02-t.e02,this.e03-t.e03,this.e10-t.e10,this.e11-t.e11,this.e12-t.e12,this.e13-t.e13,this.e20-t.e20,this.e21-t.e21,this.e22-t.e22,this.e23-t.e23,this.e30-t.e30,this.e31-t.e31,this.e32-t.e32,this.e33-t.e33)},scale:function(t){return new O(this.e00*t,this.e01*t,this.e02*t,this.e03*t,this.e10*t,this.e11*t,this.e12*t,this.e13*t,this.e20*t,this.e21*t,this.e22*t,this.e23*t,this.e30*t,this.e31*t,this.e32*t,this.e33*t)},mul:function(t){return new O(this.e00*t.e00+this.e01*t.e10+this.e02*t.e20+this.e03*t.e30,this.e00*t.e01+this.e01*t.e11+this.e02*t.e21+this.e03*t.e31,this.e00*t.e02+this.e01*t.e12+this.e02*t.e22+this.e03*t.e32,this.e00*t.e03+this.e01*t.e13+this.e02*t.e23+this.e03*t.e33,this.e10*t.e00+this.e11*t.e10+this.e12*t.e20+this.e13*t.e30,this.e10*t.e01+this.e11*t.e11+this.e12*t.e21+this.e13*t.e31,this.e10*t.e02+this.e11*t.e12+this.e12*t.e22+this.e13*t.e32,this.e10*t.e03+this.e11*t.e13+this.e12*t.e23+this.e13*t.e33,this.e20*t.e00+this.e21*t.e10+this.e22*t.e20+this.e23*t.e30,this.e20*t.e01+this.e21*t.e11+this.e22*t.e21+this.e23*t.e31,this.e20*t.e02+this.e21*t.e12+this.e22*t.e22+this.e23*t.e32,this.e20*t.e03+this.e21*t.e13+this.e22*t.e23+this.e23*t.e33,this.e30*t.e00+this.e31*t.e10+this.e32*t.e20+this.e33*t.e30,this.e30*t.e01+this.e31*t.e11+this.e32*t.e21+this.e33*t.e31,this.e30*t.e02+this.e31*t.e12+this.e32*t.e22+this.e33*t.e32,this.e30*t.e03+this.e31*t.e13+this.e32*t.e23+this.e33*t.e33)},addEq:function(t){var a=this.e00+t.e00;var i=this.e01+t.e01;var r=this.e02+t.e02;var o=this.e03+t.e03;var s=this.e10+t.e10;var n=this.e11+t.e11;var e=this.e12+t.e12;var _=this.e13+t.e13;var v=this.e20+t.e20;var h=this.e21+t.e21;var l=this.e22+t.e22;var c=this.e23+t.e23;var p=this.e30+t.e30;var f=this.e31+t.e31;var m=this.e32+t.e32;var b=this.e33+t.e33;this.e00=a;this.e01=i;this.e02=r;this.e03=o;this.e10=s;this.e11=n;this.e12=e;this.e13=_;this.e20=v;this.e21=h;this.e22=l;this.e23=c;this.e30=p;this.e31=f;this.e32=m;this.e33=b;return this},subEq:function(t){var a=this.e00-t.e00;var i=this.e01-t.e01;var r=this.e02-t.e02;var o=this.e03-t.e03;var s=this.e10-t.e10;var n=this.e11-t.e11;var e=this.e12-t.e12;var _=this.e13-t.e13;var v=this.e20-t.e20;var h=this.e21-t.e21;var l=this.e22-t.e22;var c=this.e23-t.e23;var p=this.e30-t.e30;var f=this.e31-t.e31;var m=this.e32-t.e32;var b=this.e33-t.e33;this.e00=a;this.e01=i;this.e02=r;this.e03=o;this.e10=s;this.e11=n;this.e12=e;this.e13=_;this.e20=v;this.e21=h;this.e22=l;this.e23=c;this.e30=p;this.e31=f;this.e32=m;this.e33=b;return this},scaleEq:function(t){var a=this.e00*t;var i=this.e01*t;var r=this.e02*t;var o=this.e03*t;var s=this.e10*t;var n=this.e11*t;var e=this.e12*t;var _=this.e13*t;var v=this.e20*t;var h=this.e21*t;var l=this.e22*t;var c=this.e23*t;var p=this.e30*t;var f=this.e31*t;var m=this.e32*t;var b=this.e33*t;this.e00=a;this.e01=i;this.e02=r;this.e03=o;this.e10=s;this.e11=n;this.e12=e;this.e13=_;this.e20=v;this.e21=h;this.e22=l;this.e23=c;this.e30=p;this.e31=f;this.e32=m;this.e33=b;return this},mulEq:function(t){var a=this.e00*t.e00+this.e01*t.e10+this.e02*t.e20+this.e03*t.e30;var i=this.e00*t.e01+this.e01*t.e11+this.e02*t.e21+this.e03*t.e31;var r=this.e00*t.e02+this.e01*t.e12+this.e02*t.e22+this.e03*t.e32;var o=this.e00*t.e03+this.e01*t.e13+this.e02*t.e23+this.e03*t.e33;var s=this.e10*t.e00+this.e11*t.e10+this.e12*t.e20+this.e13*t.e30;var n=this.e10*t.e01+this.e11*t.e11+this.e12*t.e21+this.e13*t.e31;var e=this.e10*t.e02+this.e11*t.e12+this.e12*t.e22+this.e13*t.e32;var _=this.e10*t.e03+this.e11*t.e13+this.e12*t.e23+this.e13*t.e33;var v=this.e20*t.e00+this.e21*t.e10+this.e22*t.e20+this.e23*t.e30;var h=this.e20*t.e01+this.e21*t.e11+this.e22*t.e21+this.e23*t.e31;var l=this.e20*t.e02+this.e21*t.e12+this.e22*t.e22+this.e23*t.e32;var c=this.e20*t.e03+this.e21*t.e13+this.e22*t.e23+this.e23*t.e33;var p=this.e30*t.e00+this.e31*t.e10+this.e32*t.e20+this.e33*t.e30;var f=this.e30*t.e01+this.e31*t.e11+this.e32*t.e21+this.e33*t.e31;var m=this.e30*t.e02+this.e31*t.e12+this.e32*t.e22+this.e33*t.e32;var b=this.e30*t.e03+this.e31*t.e13+this.e32*t.e23+this.e33*t.e33;this.e00=a;this.e01=i;this.e02=r;this.e03=o;this.e10=s;this.e11=n;this.e12=e;this.e13=_;this.e20=v;this.e21=h;this.e22=l;this.e23=c;this.e30=p;this.e31=f;this.e32=m;this.e33=b;return this},prependScale:function(t,a,i){return new O(this.e00*t,this.e01*t,this.e02*t,this.e03*t,this.e10*a,this.e11*a,this.e12*a,this.e13*a,this.e20*i,this.e21*i,this.e22*i,this.e23*i,this.e30,this.e31,this.e32,this.e33)},appendScale:function(t,a,i){return new O(this.e00*t,this.e01*a,this.e02*i,this.e03,this.e10*t,this.e11*a,this.e12*i,this.e13,this.e20*t,this.e21*a,this.e22*i,this.e23,this.e30*t,this.e31*a,this.e32*i,this.e33)},prependRotation:function(t,a,i,r){var o=Math.sin(t);var s=Math.cos(t);var n=1-s;var e=a*a*n+s;var _=a*i*n-r*o;var v=a*r*n+i*o;var h=i*a*n+r*o;var l=i*i*n+s;var c=i*r*n-a*o;var p=r*a*n-i*o;var f=r*i*n+a*o;var m=r*r*n+s;return new O(e*this.e00+_*this.e10+v*this.e20,e*this.e01+_*this.e11+v*this.e21,e*this.e02+_*this.e12+v*this.e22,e*this.e03+_*this.e13+v*this.e23,h*this.e00+l*this.e10+c*this.e20,h*this.e01+l*this.e11+c*this.e21,h*this.e02+l*this.e12+c*this.e22,h*this.e03+l*this.e13+c*this.e23,p*this.e00+f*this.e10+m*this.e20,p*this.e01+f*this.e11+m*this.e21,p*this.e02+f*this.e12+m*this.e22,p*this.e03+f*this.e13+m*this.e23,this.e30,this.e31,this.e32,this.e33)},appendRotation:function(t,a,i,r){var o=Math.sin(t);var s=Math.cos(t);var n=1-s;var e=a*a*n+s;var _=a*i*n-r*o;var v=a*r*n+i*o;var h=i*a*n+r*o;var l=i*i*n+s;var c=i*r*n-a*o;var p=r*a*n-i*o;var f=r*i*n+a*o;var m=r*r*n+s;return new O(this.e00*e+this.e01*h+this.e02*p,this.e00*_+this.e01*l+this.e02*f,this.e00*v+this.e01*c+this.e02*m,this.e03,this.e10*e+this.e11*h+this.e12*p,this.e10*_+this.e11*l+this.e12*f,this.e10*v+this.e11*c+this.e12*m,this.e13,this.e20*e+this.e21*h+this.e22*p,this.e20*_+this.e21*l+this.e22*f,this.e20*v+this.e21*c+this.e22*m,this.e23,this.e30*e+this.e31*h+this.e32*p,this.e30*_+this.e31*l+this.e32*f,this.e30*v+this.e31*c+this.e32*m,this.e33)},prependTranslation:function(t,a,i){return new O(this.e00+t*this.e30,this.e01+t*this.e31,this.e02+t*this.e32,this.e03+t*this.e33,this.e10+a*this.e30,this.e11+a*this.e31,this.e12+a*this.e32,this.e13+a*this.e33,this.e20+i*this.e30,this.e21+i*this.e31,this.e22+i*this.e32,this.e23+i*this.e33,this.e30,this.e31,this.e32,this.e33)},appendTranslation:function(t,a,i){return new O(this.e00,this.e01,this.e02,this.e00*t+this.e01*a+this.e02*i+this.e03,this.e10,this.e11,this.e12,this.e10*t+this.e11*a+this.e12*i+this.e13,this.e20,this.e21,this.e22,this.e20*t+this.e21*a+this.e22*i+this.e23,this.e30,this.e31,this.e32,this.e30*t+this.e31*a+this.e32*i+this.e33)},prependScaleEq:function(t,a,i){var r=this.e00*t;var o=this.e01*t;var s=this.e02*t;var n=this.e03*t;var e=this.e10*a;var _=this.e11*a;var v=this.e12*a;var h=this.e13*a;var l=this.e20*i;var c=this.e21*i;var p=this.e22*i;var f=this.e23*i;var m=this.e30;var b=this.e31;var u=this.e32;var x=this.e33;this.e00=r;this.e01=o;this.e02=s;this.e03=n;this.e10=e;this.e11=_;this.e12=v;this.e13=h;this.e20=l;this.e21=c;this.e22=p;this.e23=f;this.e30=m;this.e31=b;this.e32=u;this.e33=x;return this},appendScaleEq:function(t,a,i){var r=this.e00*t;var o=this.e01*a;var s=this.e02*i;var n=this.e03;var e=this.e10*t;var _=this.e11*a;var v=this.e12*i;var h=this.e13;var l=this.e20*t;var c=this.e21*a;var p=this.e22*i;var f=this.e23;var m=this.e30*t;var b=this.e31*a;var u=this.e32*i;var x=this.e33;this.e00=r;this.e01=o;this.e02=s;this.e03=n;this.e10=e;this.e11=_;this.e12=v;this.e13=h;this.e20=l;this.e21=c;this.e22=p;this.e23=f;this.e30=m;this.e31=b;this.e32=u;this.e33=x;return this},prependRotationEq:function(t,a,i,r){var o=Math.sin(t);var s=Math.cos(t);var n=1-s;var e=a*a*n+s;var _=a*i*n-r*o;var v=a*r*n+i*o;var h=i*a*n+r*o;var l=i*i*n+s;var c=i*r*n-a*o;var p=r*a*n-i*o;var f=r*i*n+a*o;var m=r*r*n+s;var b=e*this.e00+_*this.e10+v*this.e20;var u=e*this.e01+_*this.e11+v*this.e21;var x=e*this.e02+_*this.e12+v*this.e22;var y=e*this.e03+_*this.e13+v*this.e23;var g=h*this.e00+l*this.e10+c*this.e20;var X=h*this.e01+l*this.e11+c*this.e21;var z=h*this.e02+l*this.e12+c*this.e22;var M=h*this.e03+l*this.e13+c*this.e23;var Y=p*this.e00+f*this.e10+m*this.e20;var Z=p*this.e01+f*this.e11+m*this.e21;var d=p*this.e02+f*this.e12+m*this.e22;var I=p*this.e03+f*this.e13+m*this.e23;var w=this.e30;var V=this.e31;var L=this.e32;var A=this.e33;this.e00=b;this.e01=u;this.e02=x;this.e03=y;this.e10=g;this.e11=X;this.e12=z;this.e13=M;this.e20=Y;this.e21=Z;this.e22=d;this.e23=I;this.e30=w;this.e31=V;this.e32=L;this.e33=A;return this},appendRotationEq:function(t,a,i,r){var o=Math.sin(t);var s=Math.cos(t);var n=1-s;var e=a*a*n+s;var _=a*i*n-r*o;var v=a*r*n+i*o;var h=i*a*n+r*o;var l=i*i*n+s;var c=i*r*n-a*o;var p=r*a*n-i*o;var f=r*i*n+a*o;var m=r*r*n+s;var b=this.e00*e+this.e01*h+this.e02*p;var u=this.e00*_+this.e01*l+this.e02*f;var x=this.e00*v+this.e01*c+this.e02*m;var y=this.e03;var g=this.e10*e+this.e11*h+this.e12*p;var X=this.e10*_+this.e11*l+this.e12*f;var z=this.e10*v+this.e11*c+this.e12*m;var M=this.e13;var Y=this.e20*e+this.e21*h+this.e22*p;var Z=this.e20*_+this.e21*l+this.e22*f;var d=this.e20*v+this.e21*c+this.e22*m;var I=this.e23;var w=this.e30*e+this.e31*h+this.e32*p;var V=this.e30*_+this.e31*l+this.e32*f;var L=this.e30*v+this.e31*c+this.e32*m;var A=this.e33;this.e00=b;this.e01=u;this.e02=x;this.e03=y;this.e10=g;this.e11=X;this.e12=z;this.e13=M;this.e20=Y;this.e21=Z;this.e22=d;this.e23=I;this.e30=w;this.e31=V;this.e32=L;this.e33=A;return this},prependTranslationEq:function(t,a,i){var r=this.e00+t*this.e30;var o=this.e01+t*this.e31;var s=this.e02+t*this.e32;var n=this.e03+t*this.e33;var e=this.e10+a*this.e30;var _=this.e11+a*this.e31;var v=this.e12+a*this.e32;var h=this.e13+a*this.e33;var l=this.e20+i*this.e30;var c=this.e21+i*this.e31;var p=this.e22+i*this.e32;var f=this.e23+i*this.e33;var m=this.e30;var b=this.e31;var u=this.e32;var x=this.e33;this.e00=r;this.e01=o;this.e02=s;this.e03=n;this.e10=e;this.e11=_;this.e12=v;this.e13=h;this.e20=l;this.e21=c;this.e22=p;this.e23=f;this.e30=m;this.e31=b;this.e32=u;this.e33=x;return this},appendTranslationEq:function(t,a,i){var r=this.e00;var o=this.e01;var s=this.e02;var n=this.e00*t+this.e01*a+this.e02*i+this.e03;var e=this.e10;var _=this.e11;var v=this.e12;var h=this.e10*t+this.e11*a+this.e12*i+this.e13;var l=this.e20;var c=this.e21;var p=this.e22;var f=this.e20*t+this.e21*a+this.e22*i+this.e23;var m=this.e30;var b=this.e31;var u=this.e32;var x=this.e30*t+this.e31*a+this.e32*i+this.e33;this.e00=r;this.e01=o;this.e02=s;this.e03=n;this.e10=e;this.e11=_;this.e12=v;this.e13=h;this.e20=l;this.e21=c;this.e22=p;this.e23=f;this.e30=m;this.e31=b;this.e32=u;this.e33=x;return this},transpose:function(){return new O(this.e00,this.e10,this.e20,this.e30,this.e01,this.e11,this.e21,this.e31,this.e02,this.e12,this.e22,this.e32,this.e03,this.e13,this.e23,this.e33)},transposeEq:function(){var t=this.e00;var a=this.e10;var i=this.e20;var r=this.e30;var o=this.e01;var s=this.e11;var n=this.e21;var e=this.e31;var _=this.e02;var v=this.e12;var h=this.e22;var l=this.e32;var c=this.e03;var p=this.e13;var f=this.e23;var m=this.e33;this.e00=t;this.e01=a;this.e02=i;this.e03=r;this.e10=o;this.e11=s;this.e12=n;this.e13=e;this.e20=_;this.e21=v;this.e22=h;this.e23=l;this.e30=c;this.e31=p;this.e32=f;this.e33=m;return this},determinant:function(){var t=this.e20*this.e31-this.e21*this.e30;var a=this.e20*this.e32-this.e22*this.e30;var i=this.e20*this.e33-this.e23*this.e30;var r=this.e21*this.e32-this.e22*this.e31;var o=this.e21*this.e33-this.e23*this.e31;var s=this.e22*this.e33-this.e23*this.e32;return this.e00*(this.e11*s-this.e12*o+this.e13*r)-this.e01*(this.e10*s-this.e12*i+this.e13*a)+this.e02*(this.e10*o-this.e11*i+this.e13*t)-this.e03*(this.e10*r-this.e11*a+this.e12*t)},trace:function(){return this.e00+this.e11+this.e22+this.e33},inverse:function(){var t=this.e00*this.e11-this.e01*this.e10;var a=this.e00*this.e12-this.e02*this.e10;var i=this.e00*this.e13-this.e03*this.e10;var r=this.e01*this.e12-this.e02*this.e11;var o=this.e01*this.e13-this.e03*this.e11;var s=this.e02*this.e13-this.e03*this.e12;var n=this.e20*this.e31-this.e21*this.e30;var e=this.e20*this.e32-this.e22*this.e30;var _=this.e20*this.e33-this.e23*this.e30;var v=this.e21*this.e32-this.e22*this.e31;var h=this.e21*this.e33-this.e23*this.e31;var l=this.e22*this.e33-this.e23*this.e32;var c=this.e11*l-this.e12*h+this.e13*v;var p=this.e10*l-this.e12*_+this.e13*e;var f=this.e10*h-this.e11*_+this.e13*n;var m=this.e10*v-this.e11*e+this.e12*n;var b=this.e01*l-this.e02*h+this.e03*v;var u=this.e00*l-this.e02*_+this.e03*e;var x=this.e00*h-this.e01*_+this.e03*n;var y=this.e00*v-this.e01*e+this.e02*n;var g=this.e31*s-this.e32*o+this.e33*r;var X=this.e30*s-this.e32*i+this.e33*a;var z=this.e30*o-this.e31*i+this.e33*t;var M=this.e30*r-this.e31*a+this.e32*t;var Y=this.e21*s-this.e22*o+this.e23*r;var Z=this.e20*s-this.e22*i+this.e23*a;var d=this.e20*o-this.e21*i+this.e23*t;var I=this.e20*r-this.e21*a+this.e22*t;var w=this.e00*c-this.e01*p+this.e02*f-this.e03*m;if(w!=0){w=1/w}return new O(c*w,-b*w,g*w,-Y*w,-p*w,u*w,-X*w,Z*w,f*w,-x*w,z*w,-d*w,-m*w,y*w,-M*w,I*w)},inverseEq:function(){var t=this.e00*this.e11-this.e01*this.e10;var a=this.e00*this.e12-this.e02*this.e10;var i=this.e00*this.e13-this.e03*this.e10;var r=this.e01*this.e12-this.e02*this.e11;var o=this.e01*this.e13-this.e03*this.e11;var s=this.e02*this.e13-this.e03*this.e12;var n=this.e20*this.e31-this.e21*this.e30;var e=this.e20*this.e32-this.e22*this.e30;var _=this.e20*this.e33-this.e23*this.e30;var v=this.e21*this.e32-this.e22*this.e31;var h=this.e21*this.e33-this.e23*this.e31;var l=this.e22*this.e33-this.e23*this.e32;var c=this.e11*l-this.e12*h+this.e13*v;var p=this.e10*l-this.e12*_+this.e13*e;var f=this.e10*h-this.e11*_+this.e13*n;var m=this.e10*v-this.e11*e+this.e12*n;var b=this.e01*l-this.e02*h+this.e03*v;var u=this.e00*l-this.e02*_+this.e03*e;var x=this.e00*h-this.e01*_+this.e03*n;var y=this.e00*v-this.e01*e+this.e02*n;var g=this.e31*s-this.e32*o+this.e33*r;var X=this.e30*s-this.e32*i+this.e33*a;var z=this.e30*o-this.e31*i+this.e33*t;var M=this.e30*r-this.e31*a+this.e32*t;var Y=this.e21*s-this.e22*o+this.e23*r;var Z=this.e20*s-this.e22*i+this.e23*a;var d=this.e20*o-this.e21*i+this.e23*t;var I=this.e20*r-this.e21*a+this.e22*t;var w=this.e00*c-this.e01*p+this.e02*f-this.e03*m;if(w!=0){w=1/w}var V=c*w;var L=-b*w;var A=g*w;var k=-Y*w;var B=-p*w;var P=u*w;var T=-X*w;var S=Z*w;var C=f*w;var q=-x*w;var R=z*w;var E=-d*w;var j=-m*w;var N=y*w;var D=-M*w;var F=I*w;this.e00=V;this.e01=L;this.e02=A;this.e03=k;this.e10=B;this.e11=P;this.e12=T;this.e13=S;this.e20=C;this.e21=q;this.e22=R;this.e23=E;this.e30=j;this.e31=N;this.e32=D;this.e33=F;return this},lookAt:function(t,a,i,r,o,s,n,e,_){var v=t-r;var h=a-o;var l=i-s;var c=1/Math.sqrt(v*v+h*h+l*l);v*=c;h*=c;l*=c;var p=e*l-_*h;var f=_*v-n*l;var m=n*h-e*v;c=1/Math.sqrt(p*p+f*f+m*m);p*=c;f*=c;m*=c;var b=h*m-l*f;var u=l*p-v*m;var x=v*f-h*p;this.e00=p;this.e01=f;this.e02=m;this.e03=-(p*t+f*a+m*i);this.e10=b;this.e11=u;this.e12=x;this.e13=-(b*t+u*a+x*i);this.e20=v;this.e21=h;this.e22=l;this.e23=-(v*t+h*a+l*i);this.e30=0;this.e31=0;this.e32=0;this.e33=1;return this},perspective:function(t,a,i,r){var o=1/Math.tan(t*.5);var s=r/(i-r);this.e00=o/a;this.e01=0;this.e02=0;this.e03=0;this.e10=0;this.e11=o;this.e12=0;this.e13=0;this.e20=0;this.e21=0;this.e22=s;this.e23=i*s;this.e30=0;this.e31=0;this.e32=-1;this.e33=0;return this},ortho:function(t,a,i,r){var o=1/(i-r);this.e00=2/t;this.e01=0;this.e02=0;this.e03=0;this.e10=0;this.e11=2/a;this.e12=0;this.e13=0;this.e20=0;this.e21=0;this.e22=o;this.e23=i*o;this.e30=0;this.e31=0;this.e32=0;this.e33=1;return this},toArray:function(t){if(t==null){t=false}if(t){return[this.e00,this.e10,this.e20,this.e30,this.e01,this.e11,this.e21,this.e31,this.e02,this.e12,this.e22,this.e32,this.e03,this.e13,this.e23,this.e33]}else{return[this.e00,this.e01,this.e02,this.e03,this.e10,this.e11,this.e12,this.e13,this.e20,this.e21,this.e22,this.e23,this.e30,this.e31,this.e32,this.e33]}},copyFrom:function(t){this.e00=t.e00;this.e01=t.e01;this.e02=t.e02;this.e03=t.e03;this.e10=t.e10;this.e11=t.e11;this.e12=t.e12;this.e13=t.e13;this.e20=t.e20;this.e21=t.e21;this.e22=t.e22;this.e23=t.e23;this.e30=t.e30;this.e31=t.e31;this.e32=t.e32;this.e33=t.e33;return this},fromMat3:function(t){var a=t.e00;var i=t.e01;var r=t.e02;var o=0;var s=t.e10;var n=t.e11;var e=t.e12;var _=0;var v=t.e20;var h=t.e21;var l=t.e22;var c=0;var p=0;var f=0;var m=0;var b=1;this.e00=a;this.e01=i;this.e02=r;this.e03=o;this.e10=s;this.e11=n;this.e12=e;this.e13=_;this.e20=v;this.e21=h;this.e22=l;this.e23=c;this.e30=p;this.e31=f;this.e32=m;this.e33=b;return this},fromTransform:function(t){var a=this;a.e00=t._rotation00;a.e01=t._rotation01;a.e02=t._rotation02;a.e10=t._rotation10;a.e11=t._rotation11;a.e12=t._rotation12;a.e20=t._rotation20;a.e21=t._rotation21;a.e22=t._rotation22;a.e03=t._positionX;a.e13=t._positionY;a.e23=t._positionZ;a.e30=0;a.e31=0;a.e32=0;a.e33=1;return this},clone:function(){return new O(this.e00,this.e01,this.e02,this.e03,this.e10,this.e11,this.e12,this.e13,this.e20,this.e21,this.e22,this.e23,this.e30,this.e31,this.e32,this.e33)},toString:function(){return"Mat4["+(this.e00>0?(this.e00*1e7+.5|0)/1e7:(this.e00*1e7-.5|0)/1e7)+", "+(this.e01>0?(this.e01*1e7+.5|0)/1e7:(this.e01*1e7-.5|0)/1e7)+", "+(this.e02>0?(this.e02*1e7+.5|0)/1e7:(this.e02*1e7-.5|0)/1e7)+", "+(this.e03>0?(this.e03*1e7+.5|0)/1e7:(this.e03*1e7-.5|0)/1e7)+",\n"+"    "+(this.e10>0?(this.e10*1e7+.5|0)/1e7:(this.e10*1e7-.5|0)/1e7)+", "+(this.e11>0?(this.e11*1e7+.5|0)/1e7:(this.e11*1e7-.5|0)/1e7)+", "+(this.e12>0?(this.e12*1e7+.5|0)/1e7:(this.e12*1e7-.5|0)/1e7)+", "+(this.e13>0?(this.e13*1e7+.5|0)/1e7:(this.e13*1e7-.5|0)/1e7)+",\n"+"    "+(this.e20>0?(this.e20*1e7+.5|0)/1e7:(this.e20*1e7-.5|0)/1e7)+", "+(this.e21>0?(this.e21*1e7+.5|0)/1e7:(this.e21*1e7-.5|0)/1e7)+", "+(this.e22>0?(this.e22*1e7+.5|0)/1e7:(this.e22*1e7-.5|0)/1e7)+", "+(this.e23>0?(this.e23*1e7+.5|0)/1e7:(this.e23*1e7-.5|0)/1e7)+",\n"+"    "+(this.e30>0?(this.e30*1e7+.5|0)/1e7:(this.e30*1e7-.5|0)/1e7)+", "+(this.e31>0?(this.e31*1e7+.5|0)/1e7:(this.e31*1e7-.5|0)/1e7)+", "+(this.e32>0?(this.e32*1e7+.5|0)/1e7:(this.e32*1e7-.5|0)/1e7)+", "+(this.e33>0?(this.e33*1e7+.5|0)/1e7:(this.e33*1e7-.5|0)/1e7)+"]"}};var W=function(){};W.abs=function(t){if(t>0){return t}else{return-t}};W.sin=function(t){return Math.sin(t)};W.cos=function(t){return Math.cos(t)};W.tan=function(t){return Math.tan(t)};W.asin=function(t){return Math.asin(t)};W.acos=function(t){return Math.acos(t)};W.atan=function(t){return Math.atan(t)};W.safeAsin=function(t){if(t<=-1){return-1.570796326794895}if(t>=1){return 1.570796326794895}return Math.asin(t)};W.safeAcos=function(t){if(t<=-1){return 3.14159265358979}if(t>=1){return 0}return Math.acos(t)};W.atan2=function(t,a){return Math.atan2(t,a)};W.sqrt=function(t){return Math.sqrt(t)};W.clamp=function(t,a,i){if(t<a){return a}else if(t>i){return i}else{return t}};W.rand=function(){return Math.random()};W.randIn=function(t,a){return t+Math.random()*(a-t)};W.randVec3In=function(t,a){return new Is(t+Math.random()*(a-t),t+Math.random()*(a-t),t+Math.random()*(a-t))};W.randVec3=function(){return new Is(-1+Math.random()*2,-1+Math.random()*2,-1+Math.random()*2)};var G=function(){var t=new Array(256);this.stackVec3=t;this.sizeVec3=0;var a=new Array(256);this.stackMat3=a;this.sizeMat3=0;var i=new Array(256);this.stackMat4=i;this.sizeMat4=0;var r=new Array(256);this.stackQuat=r;this.sizeQuat=0};G.prototype={vec3:function(){if(this.sizeVec3==0){return new Is}else{return this.stackVec3[--this.sizeVec3]}},mat3:function(){if(this.sizeMat3==0){return new ws}else{return this.stackMat3[--this.sizeMat3]}},mat4:function(){if(this.sizeMat4==0){return new O}else{return this.stackMat4[--this.sizeMat4]}},quat:function(){if(this.sizeQuat==0){return new va}else{return this.stackQuat[--this.sizeQuat]}},dispose:function(t,a,i,r){if(t!=null){t.zero();if(this.sizeVec3==this.stackVec3.length){var o=this.sizeVec3<<1;var s=new Array(o);var n=s;var e=0;var _=this.sizeVec3;while(e<_){var v=e++;n[v]=this.stackVec3[v];this.stackVec3[v]=null}this.stackVec3=n}this.stackVec3[this.sizeVec3++]=t}if(a!=null){var h=1;var l=0;var c=0;var p=0;var f=1;var m=0;var b=0;var u=0;var x=1;a.e00=h;a.e01=l;a.e02=c;a.e10=p;a.e11=f;a.e12=m;a.e20=b;a.e21=u;a.e22=x;if(this.sizeMat3==this.stackMat3.length){var y=this.sizeMat3<<1;var g=new Array(y);var X=g;var z=0;var M=this.sizeMat3;while(z<M){var Y=z++;X[Y]=this.stackMat3[Y];this.stackMat3[Y]=null}this.stackMat3=X}this.stackMat3[this.sizeMat3++]=a}if(i!=null){var Z=1;var d=0;var I=0;var w=0;var V=0;var L=1;var A=0;var k=0;var B=0;var P=0;var T=1;var S=0;var C=0;var q=0;var R=0;var E=1;i.e00=Z;i.e01=d;i.e02=I;i.e03=w;i.e10=V;i.e11=L;i.e12=A;i.e13=k;i.e20=B;i.e21=P;i.e22=T;i.e23=S;i.e30=C;i.e31=q;i.e32=R;i.e33=E;if(this.sizeMat4==this.stackMat4.length){var j=this.sizeMat4<<1;var N=new Array(j);var D=N;var F=0;var O=this.sizeMat4;while(F<O){var W=F++;D[W]=this.stackMat4[W];this.stackMat4[W]=null}this.stackMat4=D}this.stackMat4[this.sizeMat4++]=i}if(r!=null){var G=0;var H=0;var U=0;var J=1;r.x=G;r.y=H;r.z=U;r.w=J;if(this.sizeQuat==this.stackQuat.length){var Q=this.sizeQuat<<1;var $=new Array(Q);var K=$;var tt=0;var at=this.sizeQuat;while(tt<at){var it=tt++;K[it]=this.stackQuat[it];this.stackQuat[it]=null}this.stackQuat=K}this.stackQuat[this.sizeQuat++]=r}},disposeVec3:function(t){t.zero();if(this.sizeVec3==this.stackVec3.length){var a=this.sizeVec3<<1;var i=new Array(a);var r=i;var o=0;var s=this.sizeVec3;while(o<s){var n=o++;r[n]=this.stackVec3[n];this.stackVec3[n]=null}this.stackVec3=r}this.stackVec3[this.sizeVec3++]=t},disposeMat3:function(t){var a=1;var i=0;var r=0;var o=0;var s=1;var n=0;var e=0;var _=0;var v=1;t.e00=a;t.e01=i;t.e02=r;t.e10=o;t.e11=s;t.e12=n;t.e20=e;t.e21=_;t.e22=v;if(this.sizeMat3==this.stackMat3.length){var h=this.sizeMat3<<1;var l=new Array(h);var c=l;var p=0;var f=this.sizeMat3;while(p<f){var m=p++;c[m]=this.stackMat3[m];this.stackMat3[m]=null}this.stackMat3=c}this.stackMat3[this.sizeMat3++]=t},disposeMat4:function(t){var a=1;var i=0;var r=0;var o=0;var s=0;var n=1;var e=0;var _=0;var v=0;var h=0;var l=1;var c=0;var p=0;var f=0;var m=0;var b=1;t.e00=a;t.e01=i;t.e02=r;t.e03=o;t.e10=s;t.e11=n;t.e12=e;t.e13=_;t.e20=v;t.e21=h;t.e22=l;t.e23=c;t.e30=p;t.e31=f;t.e32=m;t.e33=b;if(this.sizeMat4==this.stackMat4.length){var u=this.sizeMat4<<1;var x=new Array(u);var y=x;var g=0;var X=this.sizeMat4;while(g<X){var z=g++;y[z]=this.stackMat4[z];this.stackMat4[z]=null}this.stackMat4=y}this.stackMat4[this.sizeMat4++]=t},disposeQuat:function(t){var a=0;var i=0;var r=0;var o=1;t.x=a;t.y=i;t.z=r;t.w=o;if(this.sizeQuat==this.stackQuat.length){var s=this.sizeQuat<<1;var n=new Array(s);var e=n;var _=0;var v=this.sizeQuat;while(_<v){var h=_++;e[h]=this.stackQuat[h];this.stackQuat[h]=null}this.stackQuat=e}this.stackQuat[this.sizeQuat++]=t}};var va=function(t,a,i,r){if(r==null){r=1}if(i==null){i=0}if(a==null){a=0}if(t==null){t=0}this.x=t;this.y=a;this.z=i;this.w=r;va.numCreations++};va.prototype={identity:function(){var t=0;var a=0;var i=0;var r=1;this.x=t;this.y=a;this.z=i;this.w=r;return this},init:function(t,a,i,r){this.x=t;this.y=a;this.z=i;this.w=r;return this},add:function(t){return new va(this.x+t.x,this.y+t.y,this.z+t.z,this.w+t.w)},sub:function(t){return new va(this.x-t.x,this.y-t.y,this.z-t.z,this.w-t.w)},scale:function(t){return new va(this.x*t,this.y*t,this.z*t,this.w*t)},addEq:function(t){var a=this.x+t.x;var i=this.y+t.y;var r=this.z+t.z;var o=this.w+t.w;this.x=a;this.y=i;this.z=r;this.w=o;return this},subEq:function(t){var a=this.x-t.x;var i=this.y-t.y;var r=this.z-t.z;var o=this.w-t.w;this.x=a;this.y=i;this.z=r;this.w=o;return this},scaleEq:function(t){var a=this.x*t;var i=this.y*t;var r=this.z*t;var o=this.w*t;this.x=a;this.y=i;this.z=r;this.w=o;return this},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},dot:function(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w},normalized:function(){var t=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);if(t>0){t=1/t}return new va(this.x*t,this.y*t,this.z*t,this.w*t)},normalize:function(){var t=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);if(t>0){t=1/t}var a=this.x*t;var i=this.y*t;var r=this.z*t;var o=this.w*t;this.x=a;this.y=i;this.z=r;this.w=o;return this},setArc:function(t,a){var i=t.x;var r=t.y;var o=t.z;var s=a.x;var n=a.y;var e=a.z;var _=i*s+r*n+o*e;this.w=Math.sqrt((1+_)*.5);if(this.w==0){s=i*i;n=r*r;e=o*o;if(s<n){if(s<e){_=1/Math.sqrt(n+e);this.x=0;this.y=o*_;this.z=-r*_}else{_=1/Math.sqrt(s+n);this.z=0;this.x=r*_;this.y=-i*_}}else if(n<e){_=1/Math.sqrt(e+s);this.y=0;this.z=i*_;this.x=-o*_}else{_=1/Math.sqrt(s+n);this.z=0;this.x=r*_;this.y=-i*_}return this}_=.5/this.w;var v=r*e-o*n;var h=o*s-i*e;var l=i*n-r*s;this.x=v*_;this.y=h*_;this.z=l*_;return this},slerp:function(t,a){var i;var r;var o;var s;var n=this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w;if(n<0){n=-n;i=-t.x;r=-t.y;o=-t.z;s=-t.w}else{i=t.x;r=t.y;o=t.z;s=t.w}if(n>.999999){var e=new va(this.x+(i-this.x)*a,this.y+(r-this.y)*a,this.z+(o-this.z)*a,this.w+(s-this.w)*a);var _=Math.sqrt(e.x*e.x+e.y*e.y+e.z*e.z+e.w*e.w);if(_>0){_=1/_}var v=e.x*_;var h=e.y*_;var l=e.z*_;var c=e.w*_;e.x=v;e.y=h;e.z=l;e.w=c;return e}var p=a*Math.acos(n);i-=this.x*n;r-=this.y*n;o-=this.z*n;s-=this.w*n;var f=1/Math.sqrt(i*i+r*r+o*o+s*s);i*=f;r*=f;o*=f;s*=f;var m=Math.sin(p);var b=Math.cos(p);return new va(this.x*b+i*m,this.y*b+r*m,this.z*b+o*m,this.w*b+s*m)},copyFrom:function(t){this.x=t.x;this.y=t.y;this.z=t.z;this.w=t.w;return this},clone:function(){return new va(this.x,this.y,this.z,this.w)},fromMat3:function(t){var a=t.e00;var i=t.e11;var r=t.e22;var o=a+i+r;var s;if(o>0){s=Math.sqrt(o+1);this.w=.5*s;s=.5/s;this.x=(t.e21-t.e12)*s;this.y=(t.e02-t.e20)*s;this.z=(t.e10-t.e01)*s}else if(a>i){if(a>r){s=Math.sqrt(a-i-r+1);this.x=.5*s;s=.5/s;this.y=(t.e01+t.e10)*s;this.z=(t.e02+t.e20)*s;this.w=(t.e21-t.e12)*s}else{s=Math.sqrt(r-a-i+1);this.z=.5*s;s=.5/s;this.x=(t.e02+t.e20)*s;this.y=(t.e12+t.e21)*s;this.w=(t.e10-t.e01)*s}}else if(i>r){s=Math.sqrt(i-r-a+1);this.y=.5*s;s=.5/s;this.x=(t.e01+t.e10)*s;this.z=(t.e12+t.e21)*s;this.w=(t.e02-t.e20)*s}else{s=Math.sqrt(r-a-i+1);this.z=.5*s;s=.5/s;this.x=(t.e02+t.e20)*s;this.y=(t.e12+t.e21)*s;this.w=(t.e10-t.e01)*s}return this},toMat3:function(){var t=new ws;var a=this.x;var i=this.y;var r=this.z;var o=this.w;var s=2*a;var n=2*i;var e=2*r;var _=a*s;var v=i*n;var h=r*e;var l=a*n;var c=i*e;var p=a*e;var f=o*s;var m=o*n;var b=o*e;t.e00=1-v-h;t.e01=l-b;t.e02=p+m;t.e10=l+b;t.e11=1-_-h;t.e12=c-f;t.e20=p-m;t.e21=c+f;t.e22=1-_-v;return t},toString:function(){return"Quat["+(this.x>0?(this.x*1e7+.5|0)/1e7:(this.x*1e7-.5|0)/1e7)+" i,\n"+"    "+(this.y>0?(this.y*1e7+.5|0)/1e7:(this.y*1e7-.5|0)/1e7)+" j,\n"+"    "+(this.z>0?(this.z*1e7+.5|0)/1e7:(this.z*1e7-.5|0)/1e7)+" k,\n"+"    "+(this.w>0?(this.w*1e7+.5|0)/1e7:(this.w*1e7-.5|0)/1e7)+"]"}};var H=function(){this._next=null;this._prev=null;this._link1=new U;this._link2=new U;this._s1=null;this._s2=null;this._b1=null;this._b2=null;this._detector=null;this._cachedDetectorData=new k;this._detectorResult=new Z;this._latest=false;this._shouldBeSkipped=false;this._manifold=new pt;this._updater=new mt(this._manifold);this._contactConstraint=new lt(this._manifold);this._touching=false};H.prototype={_updateManifold:function(){if(this._detector==null){return}var t=this._touching;var a=this._detectorResult;this._detector.detect(a,this._s1._geom,this._s2._geom,this._s1._transform,this._s2._transform,this._cachedDetectorData);var i=a.numPoints;this._touching=i>0;if(this._touching){this._manifold._buildBasis(a.normal);if(a.getMaxDepth()>ys.contactUseAlternativePositionCorrectionAlgorithmDepthThreshold){this._contactConstraint._positionCorrectionAlgorithm=ys.alternativeContactPositionCorrectionAlgorithm}else{this._contactConstraint._positionCorrectionAlgorithm=ys.defaultContactPositionCorrectionAlgorithm}if(a.incremental){this._updater.incrementalUpdate(a,this._b1._transform,this._b2._transform)}else{this._updater.totalUpdate(a,this._b1._transform,this._b2._transform)}}else{this._manifold._clear()}if(this._touching&&!t){var r=this._s1._contactCallback;var o=this._s2._contactCallback;if(r==o){o=null}if(r!=null){r.beginContact(this)}if(o!=null){o.beginContact(this)}}if(!this._touching&&t){var s=this._s1._contactCallback;var n=this._s2._contactCallback;if(s==n){n=null}if(s!=null){s.endContact(this)}if(n!=null){n.endContact(this)}}if(this._touching){var e=this._s1._contactCallback;var _=this._s2._contactCallback;if(e==_){_=null}if(e!=null){e.preSolve(this)}if(_!=null){_.preSolve(this)}}},_postSolve:function(){var t=this._s1._contactCallback;var a=this._s2._contactCallback;if(t==a){a=null}if(t!=null){t.postSolve(this)}if(a!=null){a.postSolve(this)}},getShape1:function(){return this._s1},getShape2:function(){return this._s2},isTouching:function(){return this._touching},getManifold:function(){return this._manifold},getContactConstraint:function(){return this._contactConstraint},getPrev:function(){return this._prev},getNext:function(){return this._next}};var U=function(){this._prev=null;this._next=null;this._contact=null;this._other=null};U.prototype={getContact:function(){return this._contact},getOther:function(){return this._other},getPrev:function(){return this._prev},getNext:function(){return this._next}};var J=function(t){this._broadPhase=t;this._collisionMatrix=new Y;this._numContacts=0};J.prototype={createContacts:function(){var t=this._broadPhase._proxyPairList;while(t!=null){var a=t._next;while(true){var i;var r;if(t._p1._id<t._p2._id){i=t._p1.userData;r=t._p2.userData}else{i=t._p2.userData;r=t._p1.userData}if(!this.shouldCollide(i,r)){break}var o=i._rigidBody;var s=r._rigidBody;var n=o._numContactLinks;var e=s._numContactLinks;var _;if(n<e){_=o._contactLinkList}else{_=s._contactLinkList}var v=i._id;var h=r._id;var l=false;while(_!=null){var c=_._next;var p=_._contact;if(p._s1._id==v&&p._s2._id==h){p._latest=true;l=true;break}_=c}if(!l){var f=this._contactPool;if(f!=null){this._contactPool=f._next;f._next=null}else{f=new H}var m=f;if(this._contactList==null){this._contactList=m;this._contactListLast=m}else{this._contactListLast._next=m;m._prev=this._contactListLast;this._contactListLast=m}m._latest=true;var b=this._collisionMatrix.detectors[i._geom._type][r._geom._type];m._s1=i;m._s2=r;m._b1=i._rigidBody;m._b2=r._rigidBody;m._touching=false;if(m._b1._contactLinkList==null){m._b1._contactLinkList=m._link1;m._b1._contactLinkListLast=m._link1}else{m._b1._contactLinkListLast._next=m._link1;m._link1._prev=m._b1._contactLinkListLast;m._b1._contactLinkListLast=m._link1}if(m._b2._contactLinkList==null){m._b2._contactLinkList=m._link2;m._b2._contactLinkListLast=m._link2}else{m._b2._contactLinkListLast._next=m._link2;m._link2._prev=m._b2._contactLinkListLast;m._b2._contactLinkListLast=m._link2}m._b1._numContactLinks++;m._b2._numContactLinks++;m._link1._other=m._b2;m._link2._other=m._b1;m._link1._contact=m;m._link2._contact=m;m._detector=b;var u=m._contactConstraint;u._s1=i;u._s2=r;u._b1=u._s1._rigidBody;u._b2=u._s2._rigidBody;u._tf1=u._b1._transform;u._tf2=u._b2._transform;this._numContacts++}if(!false){break}}t=a}},destroyOutdatedContacts:function(){var t=this._broadPhase._incremental;var a=this._contactList;while(a!=null){var i=a._next;while(true){if(a._latest){a._latest=false;a._shouldBeSkipped=false;break}if(!t){var r=a._prev;var o=a._next;if(r!=null){r._next=o}if(o!=null){o._prev=r}if(a==this._contactList){this._contactList=this._contactList._next}if(a==this._contactListLast){this._contactListLast=this._contactListLast._prev}a._next=null;a._prev=null;if(a._touching){var s=a._s1._contactCallback;var n=a._s2._contactCallback;if(s==n){n=null}if(s!=null){s.endContact(a)}if(n!=null){n.endContact(a)}}var e=a._link1._prev;var _=a._link1._next;if(e!=null){e._next=_}if(_!=null){_._prev=e}if(a._link1==a._b1._contactLinkList){a._b1._contactLinkList=a._b1._contactLinkList._next}if(a._link1==a._b1._contactLinkListLast){a._b1._contactLinkListLast=a._b1._contactLinkListLast._prev}a._link1._next=null;a._link1._prev=null;var v=a._link2._prev;var h=a._link2._next;if(v!=null){v._next=h}if(h!=null){h._prev=v}if(a._link2==a._b2._contactLinkList){a._b2._contactLinkList=a._b2._contactLinkList._next}if(a._link2==a._b2._contactLinkListLast){a._b2._contactLinkListLast=a._b2._contactLinkListLast._prev}a._link2._next=null;a._link2._prev=null;a._b1._numContactLinks--;a._b2._numContactLinks--;a._link1._other=null;a._link2._other=null;a._link1._contact=null;a._link2._contact=null;a._s1=null;a._s2=null;a._b1=null;a._b2=null;a._touching=false;a._cachedDetectorData._clear();a._manifold._clear();a._detector=null;var l=a._contactConstraint;l._s1=null;l._s2=null;l._b1=null;l._b2=null;l._tf1=null;l._tf2=null;a._next=this._contactPool;this._contactPool=a;this._numContacts--;break}var c=a._s1;var p=a._s2;var f=c._rigidBody;var m=p._rigidBody;var b=!f._sleeping&&f._type!=1;var u=!m._sleeping&&m._type!=1;if(!b&&!u){a._shouldBeSkipped=true;break}var x=c._aabb;var y=p._aabb;var g=c._proxy;var X=p._proxy;if(!(g._aabbMinX<X._aabbMaxX&&g._aabbMaxX>X._aabbMinX&&g._aabbMinY<X._aabbMaxY&&g._aabbMaxY>X._aabbMinY&&g._aabbMinZ<X._aabbMaxZ&&g._aabbMaxZ>X._aabbMinZ)||!this.shouldCollide(c,p)){var z=a._prev;var M=a._next;if(z!=null){z._next=M}if(M!=null){M._prev=z}if(a==this._contactList){this._contactList=this._contactList._next}if(a==this._contactListLast){this._contactListLast=this._contactListLast._prev}a._next=null;a._prev=null;if(a._touching){var Y=a._s1._contactCallback;var Z=a._s2._contactCallback;if(Y==Z){Z=null}if(Y!=null){Y.endContact(a)}if(Z!=null){Z.endContact(a)}}var d=a._link1._prev;var I=a._link1._next;if(d!=null){d._next=I}if(I!=null){I._prev=d}if(a._link1==a._b1._contactLinkList){a._b1._contactLinkList=a._b1._contactLinkList._next}if(a._link1==a._b1._contactLinkListLast){a._b1._contactLinkListLast=a._b1._contactLinkListLast._prev}a._link1._next=null;a._link1._prev=null;var w=a._link2._prev;var V=a._link2._next;if(w!=null){w._next=V}if(V!=null){V._prev=w}if(a._link2==a._b2._contactLinkList){a._b2._contactLinkList=a._b2._contactLinkList._next}if(a._link2==a._b2._contactLinkListLast){a._b2._contactLinkListLast=a._b2._contactLinkListLast._prev}a._link2._next=null;a._link2._prev=null;a._b1._numContactLinks--;a._b2._numContactLinks--;a._link1._other=null;a._link2._other=null;a._link1._contact=null;a._link2._contact=null;a._s1=null;a._s2=null;a._b1=null;a._b2=null;a._touching=false;a._cachedDetectorData._clear();a._manifold._clear();a._detector=null;var L=a._contactConstraint;L._s1=null;L._s2=null;L._b1=null;L._b2=null;L._tf1=null;L._tf2=null;a._next=this._contactPool;this._contactPool=a;this._numContacts--;break}var A=x._minX<y._maxX&&x._maxX>y._minX&&x._minY<y._maxY&&x._maxY>y._minY&&x._minZ<y._maxZ&&x._maxZ>y._minZ;a._shouldBeSkipped=!A;if(!false){break}}a=i}},shouldCollide:function(t,a){var i=t._rigidBody;var r=a._rigidBody;if(i==r){return false}if(i._type!=0&&r._type!=0){return false}if((t._collisionGroup&a._collisionMask)==0||(a._collisionGroup&t._collisionMask)==0){return false}var o;var s;if(i._numJointLinks<r._numJointLinks){o=i._jointLinkList;s=r}else{o=r._jointLinkList;s=i}while(o!=null){var n=o._next;if(o._other==s&&!o._joint._allowCollision){return false}o=n}return true},_updateContacts:function(){this._broadPhase.collectPairs();this.createContacts();this.destroyOutdatedContacts()},_postSolve:function(){var t=this._contactList;while(t!=null){var a=t._next;if(t._touching){t._postSolve()}t=a}},getNumContacts:function(){return this._numContacts},getContactList:function(){return this._contactList}};var Q=function(){var t=ys.islandInitialRigidBodyArraySize;var a=new Array(t);this.rigidBodies=a;var i=ys.islandInitialConstraintArraySize;var r=new Array(i);this.solvers=r;var o=ys.islandInitialConstraintArraySize;var s=new Array(o);this.solversSi=s;var n=ys.islandInitialConstraintArraySize;var e=new Array(n);this.solversNgs=e;this.numRigidBodies=0;this.numSolvers=0;this.numSolversSi=0;this.numSolversNgs=0};Q.prototype={_clear:function(){while(this.numRigidBodies>0)this.rigidBodies[--this.numRigidBodies]=null;while(this.numSolvers>0)this.solvers[--this.numSolvers]=null;while(this.numSolversSi>0)this.solversSi[--this.numSolversSi]=null;while(this.numSolversNgs>0)this.solversNgs[--this.numSolversNgs]=null},_addRigidBody:function(t){if(this.numRigidBodies==this.rigidBodies.length){var a=this.numRigidBodies<<1;var i=new Array(a);var r=i;var o=0;var s=this.numRigidBodies;while(o<s){var n=o++;r[n]=this.rigidBodies[n];this.rigidBodies[n]=null}this.rigidBodies=r}t._addedToIsland=true;this.rigidBodies[this.numRigidBodies++]=t},_addConstraintSolver:function(t,a){if(this.numSolvers==this.solvers.length){var i=this.numSolvers<<1;var r=new Array(i);var o=r;var s=0;var n=this.numSolvers;while(s<n){var e=s++;o[e]=this.solvers[e];this.solvers[e]=null}this.solvers=o}t._addedToIsland=true;this.solvers[this.numSolvers++]=t;if(a==ka.SPLIT_IMPULSE){if(this.numSolversSi==this.solversSi.length){var _=this.numSolversSi<<1;var v=new Array(_);var h=v;var l=0;var c=this.numSolversSi;while(l<c){var p=l++;h[p]=this.solversSi[p];this.solversSi[p]=null}this.solversSi=h}this.solversSi[this.numSolversSi++]=t}if(a==ka.NGS){if(this.numSolversNgs==this.solversNgs.length){var f=this.numSolversNgs<<1;var m=new Array(f);var b=m;var u=0;var x=this.numSolversNgs;while(u<x){var y=u++;b[y]=this.solversNgs[y];this.solversNgs[y]=null}this.solversNgs=b}this.solversNgs[this.numSolversNgs++]=t}},_stepSingleRigidBody:function(t,a){var i=t.dt;var r=a._ptransform;var o=a._transform;r._positionX=o._positionX;r._positionY=o._positionY;r._positionZ=o._positionZ;r._rotation00=o._rotation00;r._rotation01=o._rotation01;r._rotation02=o._rotation02;r._rotation10=o._rotation10;r._rotation11=o._rotation11;r._rotation12=o._rotation12;r._rotation20=o._rotation20;r._rotation21=o._rotation21;r._rotation22=o._rotation22;if(a._autoSleep&&a._velX*a._velX+a._velY*a._velY+a._velZ*a._velZ<ys.sleepingVelocityThreshold*ys.sleepingVelocityThreshold&&a._angVelX*a._angVelX+a._angVelY*a._angVelY+a._angVelZ*a._angVelZ<ys.sleepingAngularVelocityThreshold*ys.sleepingAngularVelocityThreshold){a._sleepTime+=i;if(a._sleepTime>ys.sleepingTimeThreshold){a._sleeping=true;a._sleepTime=0}}else{a._sleepTime=0}if(!a._sleeping){if(a._type==0){var s=i*a._linearDamping;var n=s*s;var e=1/(1+s+n*(.5+s*.16666666666666666+n*.041666666666666664));var _=i*a._angularDamping;var v=_*_;var h=1/(1+_+v*(.5+_*.16666666666666666+v*.041666666666666664));var l;var c;var p;var f;var m;var b;var u;var x;c=this.gravityX*a._gravityScale;p=this.gravityY*a._gravityScale;f=this.gravityZ*a._gravityScale;c+=a._forceX*a._invMass;p+=a._forceY*a._invMass;f+=a._forceZ*a._invMass;var y;var g;var X;y=a._invInertia00*a._torqueX+a._invInertia01*a._torqueY+a._invInertia02*a._torqueZ;g=a._invInertia10*a._torqueX+a._invInertia11*a._torqueY+a._invInertia12*a._torqueZ;X=a._invInertia20*a._torqueX+a._invInertia21*a._torqueY+a._invInertia22*a._torqueZ;b=y;u=g;x=X;a._velX+=c*i;a._velY+=p*i;a._velZ+=f*i;a._velX*=e;a._velY*=e;a._velZ*=e;a._angVelX+=b*i;a._angVelY+=u*i;a._angVelZ+=x*i;a._angVelX*=h;a._angVelY*=h;a._angVelZ*=h}a._integrate(i);var z=a._shapeList;while(z!=null){var M=z._next;var Y=z._ptransform;var Z=z._localTransform;var d=a._ptransform;var I;var w;var V;var L;var A;var k;var B;var P;var T;I=d._rotation00*Z._rotation00+d._rotation01*Z._rotation10+d._rotation02*Z._rotation20;w=d._rotation00*Z._rotation01+d._rotation01*Z._rotation11+d._rotation02*Z._rotation21;V=d._rotation00*Z._rotation02+d._rotation01*Z._rotation12+d._rotation02*Z._rotation22;L=d._rotation10*Z._rotation00+d._rotation11*Z._rotation10+d._rotation12*Z._rotation20;A=d._rotation10*Z._rotation01+d._rotation11*Z._rotation11+d._rotation12*Z._rotation21;k=d._rotation10*Z._rotation02+d._rotation11*Z._rotation12+d._rotation12*Z._rotation22;B=d._rotation20*Z._rotation00+d._rotation21*Z._rotation10+d._rotation22*Z._rotation20;P=d._rotation20*Z._rotation01+d._rotation21*Z._rotation11+d._rotation22*Z._rotation21;T=d._rotation20*Z._rotation02+d._rotation21*Z._rotation12+d._rotation22*Z._rotation22;Y._rotation00=I;Y._rotation01=w;Y._rotation02=V;Y._rotation10=L;Y._rotation11=A;Y._rotation12=k;Y._rotation20=B;Y._rotation21=P;Y._rotation22=T;var S;var C;var q;S=d._rotation00*Z._positionX+d._rotation01*Z._positionY+d._rotation02*Z._positionZ;C=d._rotation10*Z._positionX+d._rotation11*Z._positionY+d._rotation12*Z._positionZ;q=d._rotation20*Z._positionX+d._rotation21*Z._positionY+d._rotation22*Z._positionZ;Y._positionX=S;Y._positionY=C;Y._positionZ=q;Y._positionX+=d._positionX;Y._positionY+=d._positionY;Y._positionZ+=d._positionZ;var R=z._transform;var E=z._localTransform;var j=a._transform;var N;var D;var F;var O;var W;var G;var H;var U;var J;N=j._rotation00*E._rotation00+j._rotation01*E._rotation10+j._rotation02*E._rotation20;D=j._rotation00*E._rotation01+j._rotation01*E._rotation11+j._rotation02*E._rotation21;F=j._rotation00*E._rotation02+j._rotation01*E._rotation12+j._rotation02*E._rotation22;O=j._rotation10*E._rotation00+j._rotation11*E._rotation10+j._rotation12*E._rotation20;W=j._rotation10*E._rotation01+j._rotation11*E._rotation11+j._rotation12*E._rotation21;G=j._rotation10*E._rotation02+j._rotation11*E._rotation12+j._rotation12*E._rotation22;H=j._rotation20*E._rotation00+j._rotation21*E._rotation10+j._rotation22*E._rotation20;U=j._rotation20*E._rotation01+j._rotation21*E._rotation11+j._rotation22*E._rotation21;J=j._rotation20*E._rotation02+j._rotation21*E._rotation12+j._rotation22*E._rotation22;R._rotation00=N;R._rotation01=D;R._rotation02=F;R._rotation10=O;R._rotation11=W;R._rotation12=G;R._rotation20=H;R._rotation21=U;R._rotation22=J;var Q;var $;var K;Q=j._rotation00*E._positionX+j._rotation01*E._positionY+j._rotation02*E._positionZ;$=j._rotation10*E._positionX+j._rotation11*E._positionY+j._rotation12*E._positionZ;K=j._rotation20*E._positionX+j._rotation21*E._positionY+j._rotation22*E._positionZ;R._positionX=Q;R._positionY=$;R._positionZ=K;R._positionX+=j._positionX;R._positionY+=j._positionY;R._positionZ+=j._positionZ;var tt;var at;var it;var rt;var ot;var st;var nt;var et;z._geom._computeAabb(z._aabb,z._ptransform);at=z._aabb._minX;it=z._aabb._minY;rt=z._aabb._minZ;st=z._aabb._maxX;nt=z._aabb._maxY;et=z._aabb._maxZ;z._geom._computeAabb(z._aabb,z._transform);z._aabb._minX=at<z._aabb._minX?at:z._aabb._minX;z._aabb._minY=it<z._aabb._minY?it:z._aabb._minY;z._aabb._minZ=rt<z._aabb._minZ?rt:z._aabb._minZ;z._aabb._maxX=st>z._aabb._maxX?st:z._aabb._maxX;z._aabb._maxY=nt>z._aabb._maxY?nt:z._aabb._maxY;z._aabb._maxZ=et>z._aabb._maxZ?et:z._aabb._maxZ;if(z._proxy!=null){var _t;var vt;var ht;var lt;vt=z._transform._positionX-z._ptransform._positionX;ht=z._transform._positionY-z._ptransform._positionY;lt=z._transform._positionZ-z._ptransform._positionZ;var ct=z.displacement;ct.x=vt;ct.y=ht;ct.z=lt;z._rigidBody._world._broadPhase.moveProxy(z._proxy,z._aabb,z.displacement)}z=M}}},_step:function(t,a,i){var r=t.dt;var o=true;var s=0;var n=this.numRigidBodies;while(s<n){var e=s++;var _=this.rigidBodies[e];var v=_._ptransform;var h=_._transform;v._positionX=h._positionX;v._positionY=h._positionY;v._positionZ=h._positionZ;v._rotation00=h._rotation00;v._rotation01=h._rotation01;v._rotation02=h._rotation02;v._rotation10=h._rotation10;v._rotation11=h._rotation11;v._rotation12=h._rotation12;v._rotation20=h._rotation20;v._rotation21=h._rotation21;v._rotation22=h._rotation22;_._sleeping=false;if(_._autoSleep&&_._velX*_._velX+_._velY*_._velY+_._velZ*_._velZ<ys.sleepingVelocityThreshold*ys.sleepingVelocityThreshold&&_._angVelX*_._angVelX+_._angVelY*_._angVelY+_._angVelZ*_._angVelZ<ys.sleepingAngularVelocityThreshold*ys.sleepingAngularVelocityThreshold){_._sleepTime+=r}else{_._sleepTime=0}if(_._sleepTime<ys.sleepingTimeThreshold){o=false}if(_._type==0){var l=r*_._linearDamping;var c=l*l;var p=1/(1+l+c*(.5+l*.16666666666666666+c*.041666666666666664));var f=r*_._angularDamping;var m=f*f;var b=1/(1+f+m*(.5+f*.16666666666666666+m*.041666666666666664));var u;var x;var y;var g;var X;var z;var M;var Y;x=this.gravityX*_._gravityScale;y=this.gravityY*_._gravityScale;g=this.gravityZ*_._gravityScale;x+=_._forceX*_._invMass;y+=_._forceY*_._invMass;g+=_._forceZ*_._invMass;var Z;var d;var I;Z=_._invInertia00*_._torqueX+_._invInertia01*_._torqueY+_._invInertia02*_._torqueZ;d=_._invInertia10*_._torqueX+_._invInertia11*_._torqueY+_._invInertia12*_._torqueZ;I=_._invInertia20*_._torqueX+_._invInertia21*_._torqueY+_._invInertia22*_._torqueZ;z=Z;M=d;Y=I;_._velX+=x*r;_._velY+=y*r;_._velZ+=g*r;_._velX*=p;_._velY*=p;_._velZ*=p;_._angVelX+=z*r;_._angVelY+=M*r;_._angVelZ+=Y*r;_._angVelX*=b;_._angVelY*=b;_._angVelZ*=b}}if(o){var w=0;var V=this.numRigidBodies;while(w<V){var L=w++;var A=this.rigidBodies[L];A._sleeping=true;A._sleepTime=0}return}var k=0;var B=this.numSolvers;while(k<B){var P=k++;var T=this.solvers[P];T.preSolveVelocity(t)}var S=0;var C=this.numSolvers;while(S<C){var q=S++;var R=this.solvers[q];R.warmStart(t)}var E=0;var j=a;while(E<j){var N=E++;var D=0;var F=this.numSolvers;while(D<F){var O=D++;var W=this.solvers[O];W.solveVelocity()}}var G=0;var H=this.numSolvers;while(G<H){var U=G++;var J=this.solvers[U];J.postSolveVelocity(t)}var Q=0;var $=this.numRigidBodies;while(Q<$){var K=Q++;var tt=this.rigidBodies[K];tt._integrate(r)}var at=0;var it=this.numSolversSi;while(at<it){var rt=at++;var ot=this.solversSi[rt];ot.preSolvePosition(t)}var st=0;var nt=i;while(st<nt){var et=st++;var _t=0;var vt=this.numSolversSi;while(_t<vt){var ht=_t++;var lt=this.solversSi[ht];lt.solvePositionSplitImpulse()}}var ct=0;var pt=this.numRigidBodies;while(ct<pt){var ft=ct++;var mt=this.rigidBodies[ft];mt._integratePseudoVelocity()}var bt=0;var ut=this.numSolversNgs;while(bt<ut){var xt=bt++;var yt=this.solversNgs[xt];yt.preSolvePosition(t)}var gt=0;var Xt=i;while(gt<Xt){var zt=gt++;var Mt=0;var Yt=this.numSolversNgs;while(Mt<Yt){var Zt=Mt++;var dt=this.solversNgs[Zt];dt.solvePositionNgs(t)}}var It=0;var wt=this.numSolvers;while(It<wt){var Vt=It++;var Lt=this.solvers[Vt];Lt.postSolve()}var At=0;var kt=this.numRigidBodies;while(At<kt){var Bt=At++;var Pt=this.rigidBodies[Bt];var Tt=Pt._shapeList;while(Tt!=null){var St=Tt._next;var Ct=Tt._ptransform;var qt=Tt._localTransform;var Rt=Pt._ptransform;var Et;var jt;var Nt;var Dt;var Ft;var Ot;var Wt;var Gt;var Ht;Et=Rt._rotation00*qt._rotation00+Rt._rotation01*qt._rotation10+Rt._rotation02*qt._rotation20;jt=Rt._rotation00*qt._rotation01+Rt._rotation01*qt._rotation11+Rt._rotation02*qt._rotation21;Nt=Rt._rotation00*qt._rotation02+Rt._rotation01*qt._rotation12+Rt._rotation02*qt._rotation22;Dt=Rt._rotation10*qt._rotation00+Rt._rotation11*qt._rotation10+Rt._rotation12*qt._rotation20;Ft=Rt._rotation10*qt._rotation01+Rt._rotation11*qt._rotation11+Rt._rotation12*qt._rotation21;Ot=Rt._rotation10*qt._rotation02+Rt._rotation11*qt._rotation12+Rt._rotation12*qt._rotation22;Wt=Rt._rotation20*qt._rotation00+Rt._rotation21*qt._rotation10+Rt._rotation22*qt._rotation20;Gt=Rt._rotation20*qt._rotation01+Rt._rotation21*qt._rotation11+Rt._rotation22*qt._rotation21;Ht=Rt._rotation20*qt._rotation02+Rt._rotation21*qt._rotation12+Rt._rotation22*qt._rotation22;Ct._rotation00=Et;Ct._rotation01=jt;Ct._rotation02=Nt;Ct._rotation10=Dt;Ct._rotation11=Ft;Ct._rotation12=Ot;Ct._rotation20=Wt;Ct._rotation21=Gt;Ct._rotation22=Ht;var Ut;var Jt;var Qt;Ut=Rt._rotation00*qt._positionX+Rt._rotation01*qt._positionY+Rt._rotation02*qt._positionZ;Jt=Rt._rotation10*qt._positionX+Rt._rotation11*qt._positionY+Rt._rotation12*qt._positionZ;Qt=Rt._rotation20*qt._positionX+Rt._rotation21*qt._positionY+Rt._rotation22*qt._positionZ;Ct._positionX=Ut;Ct._positionY=Jt;Ct._positionZ=Qt;Ct._positionX+=Rt._positionX;Ct._positionY+=Rt._positionY;Ct._positionZ+=Rt._positionZ;var $t=Tt._transform;var Kt=Tt._localTransform;var ta=Pt._transform;var aa;var ia;var ra;var oa;var sa;var na;var ea;var _a;var va;aa=ta._rotation00*Kt._rotation00+ta._rotation01*Kt._rotation10+ta._rotation02*Kt._rotation20;ia=ta._rotation00*Kt._rotation01+ta._rotation01*Kt._rotation11+ta._rotation02*Kt._rotation21;ra=ta._rotation00*Kt._rotation02+ta._rotation01*Kt._rotation12+ta._rotation02*Kt._rotation22;oa=ta._rotation10*Kt._rotation00+ta._rotation11*Kt._rotation10+ta._rotation12*Kt._rotation20;sa=ta._rotation10*Kt._rotation01+ta._rotation11*Kt._rotation11+ta._rotation12*Kt._rotation21;na=ta._rotation10*Kt._rotation02+ta._rotation11*Kt._rotation12+ta._rotation12*Kt._rotation22;ea=ta._rotation20*Kt._rotation00+ta._rotation21*Kt._rotation10+ta._rotation22*Kt._rotation20;_a=ta._rotation20*Kt._rotation01+ta._rotation21*Kt._rotation11+ta._rotation22*Kt._rotation21;va=ta._rotation20*Kt._rotation02+ta._rotation21*Kt._rotation12+ta._rotation22*Kt._rotation22;$t._rotation00=aa;$t._rotation01=ia;$t._rotation02=ra;$t._rotation10=oa;$t._rotation11=sa;$t._rotation12=na;$t._rotation20=ea;$t._rotation21=_a;$t._rotation22=va;var ha;var la;var ca;ha=ta._rotation00*Kt._positionX+ta._rotation01*Kt._positionY+ta._rotation02*Kt._positionZ;la=ta._rotation10*Kt._positionX+ta._rotation11*Kt._positionY+ta._rotation12*Kt._positionZ;ca=ta._rotation20*Kt._positionX+ta._rotation21*Kt._positionY+ta._rotation22*Kt._positionZ;$t._positionX=ha;$t._positionY=la;$t._positionZ=ca;$t._positionX+=ta._positionX;$t._positionY+=ta._positionY;$t._positionZ+=ta._positionZ;var pa;var fa;var ma;var ba;var ua;var xa;var ya;var ga;Tt._geom._computeAabb(Tt._aabb,Tt._ptransform);fa=Tt._aabb._minX;ma=Tt._aabb._minY;ba=Tt._aabb._minZ;xa=Tt._aabb._maxX;ya=Tt._aabb._maxY;ga=Tt._aabb._maxZ;Tt._geom._computeAabb(Tt._aabb,Tt._transform);Tt._aabb._minX=fa<Tt._aabb._minX?fa:Tt._aabb._minX;Tt._aabb._minY=ma<Tt._aabb._minY?ma:Tt._aabb._minY;Tt._aabb._minZ=ba<Tt._aabb._minZ?ba:Tt._aabb._minZ;Tt._aabb._maxX=xa>Tt._aabb._maxX?xa:Tt._aabb._maxX;Tt._aabb._maxY=ya>Tt._aabb._maxY?ya:Tt._aabb._maxY;Tt._aabb._maxZ=ga>Tt._aabb._maxZ?ga:Tt._aabb._maxZ;if(Tt._proxy!=null){var Xa;var za;var Ma;var Ya;za=Tt._transform._positionX-Tt._ptransform._positionX;Ma=Tt._transform._positionY-Tt._ptransform._positionY;Ya=Tt._transform._positionZ-Tt._ptransform._positionZ;var Za=Tt.displacement;Za.x=za;Za.y=Ma;Za.z=Ya;Tt._rigidBody._world._broadPhase.moveProxy(Tt._proxy,Tt._aabb,Tt.displacement)}Tt=St}}}};var $=function(){this.dt=0;this.invDt=0;this.dtRatio=1};var K=function(t,a){if(t==null){t=2}switch(t){case 1:this._broadPhase=new h;break;case 2:this._broadPhase=new l;break}this._contactManager=new J(this._broadPhase);if(a==null){a=new Is(0,-9.80665,0)}this._gravity=new Is(a.x,a.y,a.z);this._rigidBodyList=null;this._rigidBodyListLast=null;this._jointList=null;this._jointListLast=null;this._numRigidBodies=0;this._numShapes=0;this._numJoints=0;this._numIslands=0;this._numVelocityIterations=10;this._numPositionIterations=5;this._rayCastWrapper=new tt;this._convexCastWrapper=new at;this._aabbTestWrapper=new it;this._island=new Q;var i=ys.islandInitialConstraintArraySize;var r=new Array(i);this._solversInIslands=r;var o=ys.islandInitialRigidBodyArraySize;var s=new Array(o);this._rigidBodyStack=s;this._timeStep=new $;this._pool=new G;this._shapeIdCount=0};K.prototype={_updateContacts:function(){var t=(new Date).getTime()/1e3;this._contactManager._updateContacts();var a=(new Date).getTime()/1e3;vt.broadPhaseCollisionTime=(a-t)*1e3;var i=(new Date).getTime()/1e3;var r=this._contactManager._contactList;while(r!=null){var o=r._next;if(!r._shouldBeSkipped){r._updateManifold()}r=o}var s=(new Date).getTime()/1e3;vt.narrowPhaseCollisionTime=(s-i)*1e3},_solveIslands:function(){var t=(new Date).getTime()/1e3;if(ys.disableSleeping){var a=this._rigidBodyList;while(a!=null){var i=a._next;a._sleeping=false;a._sleepTime=0;a=i}}if(this._rigidBodyStack.length<this._numRigidBodies){var r=this._rigidBodyStack.length<<1;while(r<this._numRigidBodies)r<<=1;var o=new Array(r);this._rigidBodyStack=o}this._numIslands=0;var s=this._island;var n=this._gravity;s.gravityX=n.x;s.gravityY=n.y;s.gravityZ=n.z;var e=this._rigidBodyList;this._numSolversInIslands=0;while(e!=null){var _=e._next;while(!(e._addedToIsland||e._sleeping||e._type==1)){if(e._numContactLinks==0&&e._numJointLinks==0){this._island._stepSingleRigidBody(this._timeStep,e);this._numIslands++;break}this.buildIsland(e);this._island._step(this._timeStep,this._numVelocityIterations,this._numPositionIterations);this._island._clear();this._numIslands++;if(!false){break}}e=_}this._contactManager._postSolve();e=this._rigidBodyList;while(e!=null){var v=e._next;e._addedToIsland=false;e=v}e=this._rigidBodyList;while(e!=null){var h=e._next;e._forceX=0;e._forceY=0;e._forceZ=0;e._torqueX=0;e._torqueY=0;e._torqueZ=0;e=h}while(this._numSolversInIslands>0){this._solversInIslands[--this._numSolversInIslands]._addedToIsland=false;this._solversInIslands[this._numSolversInIslands]=null}var l=(new Date).getTime()/1e3;vt.dynamicsTime=(l-t)*1e3},buildIsland:function(t){var a=1;this._island._addRigidBody(t);this._rigidBodyStack[0]=t;while(a>0){var i=this._rigidBodyStack[--a];this._rigidBodyStack[a]=null;if(i._type==1){continue}var r=i._contactLinkList;while(r!=null){var o=r._next;var s=r._contact._contactConstraint;var n=r._contact._contactConstraint._solver;if(s.isTouching()&&!n._addedToIsland){if(this._solversInIslands.length==this._numSolversInIslands){var e=this._numSolversInIslands<<1;var _=new Array(e);var v=_;var h=0;var l=this._numSolversInIslands;while(h<l){var c=h++;v[c]=this._solversInIslands[c];this._solversInIslands[c]=null}this._solversInIslands=v}this._solversInIslands[this._numSolversInIslands++]=n;this._island._addConstraintSolver(n,s._positionCorrectionAlgorithm);var p=r._other;if(!p._addedToIsland){this._island._addRigidBody(p);this._rigidBodyStack[a++]=p}}r=o}var f=i._jointLinkList;while(f!=null){var m=f._next;var b=f._joint;var u=b._solver;if(!u._addedToIsland){if(this._solversInIslands.length==this._numSolversInIslands){var x=this._numSolversInIslands<<1;var y=new Array(x);var g=y;var X=0;var z=this._numSolversInIslands;while(X<z){var M=X++;g[M]=this._solversInIslands[M];this._solversInIslands[M]=null}this._solversInIslands=g}this._solversInIslands[this._numSolversInIslands++]=u;this._island._addConstraintSolver(u,b._positionCorrectionAlgorithm);var Y=f._other;if(!Y._addedToIsland){this._island._addRigidBody(Y);this._rigidBodyStack[a++]=Y}}f=m}}},_drawBvh:function(t,a){if(t.drawBvh){this._drawBvhNode(t,a._root,0,t.style.bvhNodeColor)}},_drawBvhNode:function(t,a,i,r){if(a==null){return}if(i>=t.drawBvhMinLevel&&i<=t.drawBvhMaxLevel){var o=this._pool;var s=o.sizeVec3==0?new Is:o.stackVec3[--o.sizeVec3];var n=this._pool;var e=n.sizeVec3==0?new Is:n.stackVec3[--n.sizeVec3];var _=s;_.x=a._aabbMinX;_.y=a._aabbMinY;_.z=a._aabbMinZ;var v=e;v.x=a._aabbMaxX;v.y=a._aabbMaxY;v.z=a._aabbMaxZ;t.aabb(s,e,r);var h=this._pool;if(s!=null){s.zero();if(h.sizeVec3==h.stackVec3.length){var l=h.sizeVec3<<1;var c=new Array(l);var p=c;var f=0;var m=h.sizeVec3;while(f<m){var b=f++;p[b]=h.stackVec3[b];h.stackVec3[b]=null}h.stackVec3=p}h.stackVec3[h.sizeVec3++]=s}var u=this._pool;if(e!=null){e.zero();if(u.sizeVec3==u.stackVec3.length){var x=u.sizeVec3<<1;var y=new Array(x);var g=y;var X=0;var z=u.sizeVec3;while(X<z){var M=X++;g[M]=u.stackVec3[M];u.stackVec3[M]=null}u.stackVec3=g}u.stackVec3[u.sizeVec3++]=e}}this._drawBvhNode(t,a._children[0],i+1,r);this._drawBvhNode(t,a._children[1],i+1,r)},_drawRigidBodies:function(t){var a=t.style;var i=this._rigidBodyList;while(i!=null){var r=i._next;if(t.drawBases){var o=t.style;t.basis(i._transform,o.basisLength,o.basisColorX,o.basisColorY,o.basisColorZ)}var s=null;var n=i._type==0;if(!n){s=i._type==2?a.kinematicShapeColor:a.staticShapeColor}var e=i._shapeList;while(e!=null){var _=e._next;if(n){if((e._id&1)==0){s=i._sleeping?a.sleepingShapeColor1:i._sleepTime>ys.sleepingTimeThreshold?a.sleepyShapeColor1:a.shapeColor1}else{s=i._sleeping?a.sleepingShapeColor2:i._sleepTime>ys.sleepingTimeThreshold?a.sleepyShapeColor2:a.shapeColor2}}if(t.drawShapes){var v=e._geom;var h=e._transform;var l=v._type;switch(l){case 0:t.sphere(h,v._radius,s);break;case 1:var c=v;var p=this._pool;var f=p.sizeVec3==0?new Is:p.stackVec3[--p.sizeVec3];var m=f;m.x=c._halfExtentsX;m.y=c._halfExtentsY;m.z=c._halfExtentsZ;t.box(h,f,s);var b=this._pool;if(f!=null){f.zero();if(b.sizeVec3==b.stackVec3.length){var u=b.sizeVec3<<1;var x=new Array(u);var y=x;var g=0;var X=b.sizeVec3;while(g<X){var z=g++;y[z]=b.stackVec3[z];b.stackVec3[z]=null}b.stackVec3=y}b.stackVec3[b.sizeVec3++]=f}break;case 2:var M=v;t.cylinder(h,M._radius,M._halfHeight,s);break;case 3:var Y=v;t.cone(h,Y._radius,Y._halfHeight,s);break;case 4:var Z=v;t.capsule(h,Z._radius,Z._halfHeight,s);break;case 5:var d=v;var I=d._numVertices;var w=this._pool;var V=w.sizeVec3==0?new Is:w.stackVec3[--w.sizeVec3];var L=this._pool;var A=L.sizeVec3==0?new Is:L.stackVec3[--L.sizeVec3];var k=this._pool;var B=k.sizeVec3==0?new Is:k.stackVec3[--k.sizeVec3];var P=this._pool;var T=P.sizeVec3==0?new Is:P.stackVec3[--P.sizeVec3];var S=this._pool;var C=S.sizeVec3==0?new Is:S.stackVec3[--S.sizeVec3];var q=this._pool;var R=q.sizeVec3==0?new Is:q.stackVec3[--q.sizeVec3];var E=this._pool;var j=E.sizeMat3==0?new ws:E.stackMat3[--E.sizeMat3];var N=this._pool;var D=N.sizeVec3==0?new Is:N.stackVec3[--N.sizeVec3];var F=j;F.e00=h._rotation00;F.e01=h._rotation01;F.e02=h._rotation02;F.e10=h._rotation10;F.e11=h._rotation11;F.e12=h._rotation12;F.e20=h._rotation20;F.e21=h._rotation21;F.e22=h._rotation22;var O=D;O.x=h._positionX;O.y=h._positionY;O.z=h._positionZ;var W=0;var G=I;while(W<G){var H=W++;var U=d._tmpVertices[H];var J=d._vertices[H];U.x=J.x;U.y=J.y;U.z=J.z;var Q=U;var $=Q.x*j.e00+Q.y*j.e01+Q.z*j.e02;var K=Q.x*j.e10+Q.y*j.e11+Q.z*j.e12;var tt=Q.x*j.e20+Q.y*j.e21+Q.z*j.e22;Q.x=$;Q.y=K;Q.z=tt;var at=Q;var it=at.x+D.x;var rt=at.y+D.y;var ot=at.z+D.z;at.x=it;at.y=rt;at.z=ot}if(I>30){var st=0;var nt=I;while(st<nt){var et=st++;var _t=d._tmpVertices[et];V.x=_t.x;V.y=_t.y;V.z=_t.z;var vt=d._tmpVertices[(et+1)%I];A.x=vt.x;A.y=vt.y;A.z=vt.z;t.line(V,A,s)}}else if(this._debugDraw.wireframe||I>10){var ht=0;var lt=I;while(ht<lt){var ct=ht++;var pt=d._tmpVertices[ct];V.x=pt.x;V.y=pt.y;V.z=pt.z;var ft=0;var mt=ct;while(ft<mt){var bt=ft++;var ut=d._tmpVertices[bt];A.x=ut.x;A.y=ut.y;A.z=ut.z;t.line(V,A,s)}}}else{var xt=0;var yt=I;while(xt<yt){var gt=xt++;var Xt=d._tmpVertices[gt];V.x=Xt.x;V.y=Xt.y;V.z=Xt.z;var zt=0;var Mt=gt;while(zt<Mt){var Yt=zt++;var Zt=d._tmpVertices[Yt];A.x=Zt.x;A.y=Zt.y;A.z=Zt.z;var dt=0;var It=Yt;while(dt<It){var wt=dt++;var Vt=d._tmpVertices[wt];B.x=Vt.x;B.y=Vt.y;B.z=Vt.z;T.x=A.x;T.y=A.y;T.z=A.z;var Lt=T;var At=Lt.x-V.x;var kt=Lt.y-V.y;var Bt=Lt.z-V.z;Lt.x=At;Lt.y=kt;Lt.z=Bt;C.x=B.x;C.y=B.y;C.z=B.z;var Pt=C;var Tt=Pt.x-V.x;var St=Pt.y-V.y;var Ct=Pt.z-V.z;Pt.x=Tt;Pt.y=St;Pt.z=Ct;R.x=T.x;R.y=T.y;R.z=T.z;var qt=R;var Rt=qt.y*C.z-qt.z*C.y;var Et=qt.z*C.x-qt.x*C.z;var jt=qt.x*C.y-qt.y*C.x;qt.x=Rt;qt.y=Et;qt.z=jt;var Nt=qt;var Dt=Math.sqrt(Nt.x*Nt.x+Nt.y*Nt.y+Nt.z*Nt.z);if(Dt>0){Dt=1/Dt}var Ft=Nt.x*Dt;var Ot=Nt.y*Dt;var Wt=Nt.z*Dt;Nt.x=Ft;Nt.y=Ot;Nt.z=Wt;t.triangle(V,A,B,R,R,R,s);var Gt=-R.x;var Ht=-R.y;var Ut=-R.z;R.x=Gt;R.y=Ht;R.z=Ut;t.triangle(V,B,A,R,R,R,s)}}}}var Jt=this._pool;if(V!=null){V.zero();if(Jt.sizeVec3==Jt.stackVec3.length){var Qt=Jt.sizeVec3<<1;var $t=new Array(Qt);var Kt=$t;var ta=0;var aa=Jt.sizeVec3;while(ta<aa){var ia=ta++;Kt[ia]=Jt.stackVec3[ia];Jt.stackVec3[ia]=null}Jt.stackVec3=Kt}Jt.stackVec3[Jt.sizeVec3++]=V}var ra=this._pool;if(A!=null){A.zero();if(ra.sizeVec3==ra.stackVec3.length){var oa=ra.sizeVec3<<1;var sa=new Array(oa);var na=sa;var ea=0;var _a=ra.sizeVec3;while(ea<_a){var va=ea++;na[va]=ra.stackVec3[va];ra.stackVec3[va]=null}ra.stackVec3=na}ra.stackVec3[ra.sizeVec3++]=A}var ha=this._pool;if(B!=null){B.zero();if(ha.sizeVec3==ha.stackVec3.length){var la=ha.sizeVec3<<1;var ca=new Array(la);var pa=ca;var fa=0;var ma=ha.sizeVec3;while(fa<ma){var ba=fa++;pa[ba]=ha.stackVec3[ba];ha.stackVec3[ba]=null}ha.stackVec3=pa}ha.stackVec3[ha.sizeVec3++]=B}var ua=this._pool;if(T!=null){T.zero();if(ua.sizeVec3==ua.stackVec3.length){var xa=ua.sizeVec3<<1;var ya=new Array(xa);var ga=ya;var Xa=0;var za=ua.sizeVec3;while(Xa<za){var Ma=Xa++;ga[Ma]=ua.stackVec3[Ma];ua.stackVec3[Ma]=null}ua.stackVec3=ga}ua.stackVec3[ua.sizeVec3++]=T}var Ya=this._pool;if(C!=null){C.zero();if(Ya.sizeVec3==Ya.stackVec3.length){var Za=Ya.sizeVec3<<1;var da=new Array(Za);var Ia=da;var wa=0;var Va=Ya.sizeVec3;while(wa<Va){var La=wa++;Ia[La]=Ya.stackVec3[La];Ya.stackVec3[La]=null}Ya.stackVec3=Ia}Ya.stackVec3[Ya.sizeVec3++]=C}var Aa=this._pool;if(R!=null){R.zero();if(Aa.sizeVec3==Aa.stackVec3.length){var ka=Aa.sizeVec3<<1;var Ba=new Array(ka);var Pa=Ba;var Ta=0;var Sa=Aa.sizeVec3;while(Ta<Sa){var Ca=Ta++;Pa[Ca]=Aa.stackVec3[Ca];Aa.stackVec3[Ca]=null}Aa.stackVec3=Pa}Aa.stackVec3[Aa.sizeVec3++]=R}var qa=this._pool;if(j!=null){var Ra=1;var Ea=0;var ja=0;var Na=0;var Da=1;var Fa=0;var Oa=0;var Wa=0;var Ga=1;j.e00=Ra;j.e01=Ea;j.e02=ja;j.e10=Na;j.e11=Da;j.e12=Fa;j.e20=Oa;j.e21=Wa;j.e22=Ga;if(qa.sizeMat3==qa.stackMat3.length){var Ha=qa.sizeMat3<<1;var Ua=new Array(Ha);var Ja=Ua;var Qa=0;var $a=qa.sizeMat3;while(Qa<$a){var Ka=Qa++;Ja[Ka]=qa.stackMat3[Ka];qa.stackMat3[Ka]=null}qa.stackMat3=Ja}qa.stackMat3[qa.sizeMat3++]=j}var ti=this._pool;if(D!=null){D.zero();if(ti.sizeVec3==ti.stackVec3.length){var ai=ti.sizeVec3<<1;var ii=new Array(ai);var ri=ii;var oi=0;var si=ti.sizeVec3;while(oi<si){var ni=oi++;ri[ni]=ti.stackVec3[ni];ti.stackVec3[ni]=null}ti.stackVec3=ri}ti.stackVec3[ti.sizeVec3++]=D}break}}if(t.drawAabbs){var ei=e._aabb;var _i=a.aabbColor;var vi=this._pool;var hi=vi.sizeVec3==0?new Is:vi.stackVec3[--vi.sizeVec3];var li=this._pool;var ci=li.sizeVec3==0?new Is:li.stackVec3[--li.sizeVec3];var pi=hi;pi.x=ei._minX;pi.y=ei._minY;pi.z=ei._minZ;var fi=ci;fi.x=ei._maxX;fi.y=ei._maxY;fi.z=ei._maxZ;t.aabb(hi,ci,_i);var mi=this._pool;if(hi!=null){hi.zero();if(mi.sizeVec3==mi.stackVec3.length){var bi=mi.sizeVec3<<1;var ui=new Array(bi);var xi=ui;var yi=0;var gi=mi.sizeVec3;while(yi<gi){var Xi=yi++;xi[Xi]=mi.stackVec3[Xi];mi.stackVec3[Xi]=null}mi.stackVec3=xi}mi.stackVec3[mi.sizeVec3++]=hi}var zi=this._pool;if(ci!=null){ci.zero();if(zi.sizeVec3==zi.stackVec3.length){var Mi=zi.sizeVec3<<1;var Yi=new Array(Mi);var Zi=Yi;var di=0;var Ii=zi.sizeVec3;while(di<Ii){var wi=di++;Zi[wi]=zi.stackVec3[wi];zi.stackVec3[wi]=null}zi.stackVec3=Zi}zi.stackVec3[zi.sizeVec3++]=ci}}e=_}i=r}},_drawConstraints:function(t){var a=t.style;if(t.drawPairs||t.drawContacts){var i=this._contactManager._contactList;while(i!=null){var r=i._next;if(t.drawPairs){var o=a.pairColor;var s=this._pool;var n=s.sizeVec3==0?new Is:s.stackVec3[--s.sizeVec3];var e=this._pool;var _=e.sizeVec3==0?new Is:e.stackVec3[--e.sizeVec3];var v=n;v.x=i._s1._transform._positionX;v.y=i._s1._transform._positionY;v.z=i._s1._transform._positionZ;var h=_;h.x=i._s2._transform._positionX;h.y=i._s2._transform._positionY;h.z=i._s2._transform._positionZ;t.line(n,_,o);var l=this._pool;if(n!=null){n.zero();if(l.sizeVec3==l.stackVec3.length){var c=l.sizeVec3<<1;var p=new Array(c);var f=p;var m=0;var b=l.sizeVec3;while(m<b){var u=m++;f[u]=l.stackVec3[u];l.stackVec3[u]=null}l.stackVec3=f}l.stackVec3[l.sizeVec3++]=n}var x=this._pool;if(_!=null){_.zero();if(x.sizeVec3==x.stackVec3.length){var y=x.sizeVec3<<1;var g=new Array(y);var X=g;var z=0;var M=x.sizeVec3;while(z<M){var Y=z++;X[Y]=x.stackVec3[Y];x.stackVec3[Y]=null}x.stackVec3=X}x.stackVec3[x.sizeVec3++]=_}}if(t.drawContacts){var Z=i._contactConstraint;var d=i._contactConstraint._manifold._points;var I=0;var w=i._contactConstraint._manifold._numPoints;while(I<w){var V=I++;var L=d[V];var A=t.style;var k=Z._s1._transform;var B=Z._s2._transform;var P=this._pool;var T=P.sizeVec3==0?new Is:P.stackVec3[--P.sizeVec3];var S=this._pool;var C=S.sizeVec3==0?new Is:S.stackVec3[--S.sizeVec3];var q=this._pool;var R=q.sizeVec3==0?new Is:q.stackVec3[--q.sizeVec3];var E=this._pool;var j=E.sizeVec3==0?new Is:E.stackVec3[--E.sizeVec3];var N=this._pool;var D=N.sizeVec3==0?new Is:N.stackVec3[--N.sizeVec3];var F=T;F.x=L._pos1X;F.y=L._pos1Y;F.z=L._pos1Z;var O=C;O.x=L._pos2X;O.y=L._pos2Y;O.z=L._pos2Z;var W=R;W.x=Z._manifold._normalX;W.y=Z._manifold._normalY;W.z=Z._manifold._normalZ;var G=j;G.x=Z._manifold._tangentX;G.y=Z._manifold._tangentY;G.z=Z._manifold._tangentZ;var H=D;H.x=Z._manifold._binormalX;H.y=Z._manifold._binormalY;H.z=Z._manifold._binormalZ;if(L._disabled){t.point(T,A.disabledContactColor);t.point(C,A.disabledContactColor);t.line(T,C,A.disabledContactColor)}else if(L._warmStarted){var U;var J=L._id&3;switch(J){case 0:U=A.contactColor;break;case 1:U=A.contactColor2;break;case 2:U=A.contactColor3;break;default:U=A.contactColor4}t.point(T,U);t.point(C,U);t.line(T,C,A.contactColor)}else{t.point(T,A.newContactColor);t.point(C,A.newContactColor);t.line(T,C,A.newContactColor)}C.x=T.x;C.y=T.y;C.z=T.z;var Q=C;var $=A.contactNormalLength;var K=Q.x+R.x*$;var tt=Q.y+R.y*$;var at=Q.z+R.z*$;Q.x=K;Q.y=tt;Q.z=at;t.line(T,C,A.contactNormalColor);if(t.drawContactBases){C.x=T.x;C.y=T.y;C.z=T.z;var it=C;var rt=A.contactTangentLength;var ot=it.x+j.x*rt;var st=it.y+j.y*rt;var nt=it.z+j.z*rt;it.x=ot;it.y=st;it.z=nt;t.line(T,C,A.contactTangentColor);C.x=T.x;C.y=T.y;C.z=T.z;var et=C;var _t=A.contactBinormalLength;var vt=et.x+D.x*_t;var ht=et.y+D.y*_t;var lt=et.z+D.z*_t;et.x=vt;et.y=ht;et.z=lt;t.line(T,C,A.contactBinormalColor)}var ct=this._pool;if(T!=null){T.zero();if(ct.sizeVec3==ct.stackVec3.length){var pt=ct.sizeVec3<<1;var ft=new Array(pt);var mt=ft;var bt=0;var ut=ct.sizeVec3;while(bt<ut){var xt=bt++;mt[xt]=ct.stackVec3[xt];ct.stackVec3[xt]=null}ct.stackVec3=mt}ct.stackVec3[ct.sizeVec3++]=T}var yt=this._pool;if(C!=null){C.zero();if(yt.sizeVec3==yt.stackVec3.length){var gt=yt.sizeVec3<<1;var Xt=new Array(gt);var zt=Xt;var Mt=0;var Yt=yt.sizeVec3;while(Mt<Yt){var Zt=Mt++;zt[Zt]=yt.stackVec3[Zt];yt.stackVec3[Zt]=null}yt.stackVec3=zt}yt.stackVec3[yt.sizeVec3++]=C}var dt=this._pool;if(R!=null){R.zero();if(dt.sizeVec3==dt.stackVec3.length){var It=dt.sizeVec3<<1;var wt=new Array(It);var Vt=wt;var Lt=0;var At=dt.sizeVec3;while(Lt<At){var kt=Lt++;Vt[kt]=dt.stackVec3[kt];dt.stackVec3[kt]=null}dt.stackVec3=Vt}dt.stackVec3[dt.sizeVec3++]=R}var Bt=this._pool;if(j!=null){j.zero();if(Bt.sizeVec3==Bt.stackVec3.length){var Pt=Bt.sizeVec3<<1;var Tt=new Array(Pt);var St=Tt;var Ct=0;var qt=Bt.sizeVec3;while(Ct<qt){var Rt=Ct++;St[Rt]=Bt.stackVec3[Rt];Bt.stackVec3[Rt]=null}Bt.stackVec3=St}Bt.stackVec3[Bt.sizeVec3++]=j}var Et=this._pool;if(D!=null){D.zero();if(Et.sizeVec3==Et.stackVec3.length){var jt=Et.sizeVec3<<1;var Nt=new Array(jt);var Dt=Nt;var Ft=0;var Ot=Et.sizeVec3;while(Ft<Ot){var Wt=Ft++;Dt[Wt]=Et.stackVec3[Wt];Et.stackVec3[Wt]=null}Et.stackVec3=Dt}Et.stackVec3[Et.sizeVec3++]=D}}}i=r}}if(t.drawJoints){var Gt=this._jointList;while(Gt!=null){var Ht=Gt._next;var Ut=this._pool;var Jt=Ut.sizeVec3==0?new Is:Ut.stackVec3[--Ut.sizeVec3];var Qt=this._pool;var $t=Qt.sizeVec3==0?new Is:Qt.stackVec3[--Qt.sizeVec3];var Kt=Jt;Kt.x=Gt._b1._transform._positionX;Kt.y=Gt._b1._transform._positionY;Kt.z=Gt._b1._transform._positionZ;var ta=$t;ta.x=Gt._b2._transform._positionX;ta.y=Gt._b2._transform._positionY;ta.z=Gt._b2._transform._positionZ;var aa=this._pool;var ia=aa.sizeVec3==0?new Is:aa.stackVec3[--aa.sizeVec3];var ra=this._pool;var oa=ra.sizeVec3==0?new Is:ra.stackVec3[--ra.sizeVec3];var sa=this._pool;var na=sa.sizeVec3==0?new Is:sa.stackVec3[--sa.sizeVec3];var ea=this._pool;var _a=ea.sizeVec3==0?new Is:ea.stackVec3[--ea.sizeVec3];var va=this._pool;var ha=va.sizeVec3==0?new Is:va.stackVec3[--va.sizeVec3];var la=this._pool;var ca=la.sizeVec3==0?new Is:la.stackVec3[--la.sizeVec3];var pa=this._pool;var fa=pa.sizeVec3==0?new Is:pa.stackVec3[--pa.sizeVec3];var ma=this._pool;var ba=ma.sizeVec3==0?new Is:ma.stackVec3[--ma.sizeVec3];var ua=ia;ua.x=Gt._anchor1X;ua.y=Gt._anchor1Y;ua.z=Gt._anchor1Z;var xa=oa;xa.x=Gt._anchor2X;xa.y=Gt._anchor2Y;xa.z=Gt._anchor2Z;var ya=na;ya.x=Gt._basisX1X;ya.y=Gt._basisX1Y;ya.z=Gt._basisX1Z;var ga=_a;ga.x=Gt._basisY1X;ga.y=Gt._basisY1Y;ga.z=Gt._basisY1Z;var Xa=ha;Xa.x=Gt._basisZ1X;Xa.y=Gt._basisZ1Y;Xa.z=Gt._basisZ1Z;var za=ca;za.x=Gt._basisX2X;za.y=Gt._basisX2Y;za.z=Gt._basisX2Z;var Ma=fa;Ma.x=Gt._basisY2X;Ma.y=Gt._basisY2Y;Ma.z=Gt._basisY2Z;var Ya=ba;Ya.x=Gt._basisZ2X;Ya.y=Gt._basisZ2Y;Ya.z=Gt._basisZ2Z;t.line(Jt,ia,t.style.jointLineColor);t.line($t,oa,t.style.jointLineColor);if(t.drawJointLimits){var Za=Gt._type;switch(Za){case 0:break;case 1:var da=t.style.jointRotationalConstraintRadius;var Ia=t.style.jointLineColor;var wa=Gt._lm;this._drawRotationalLimit(t,ia,_a,ha,fa,da,wa.lowerLimit,wa.upperLimit,Ia);break;case 2:var Va=Gt;var La=t.style.jointRotationalConstraintRadius;var Aa=t.style.jointLineColor;var ka=Va._rotLm;var Ba=Va._translLm;this._drawRotationalLimit(t,oa,_a,ha,fa,La,ka.lowerLimit,ka.upperLimit,Aa);this._drawTranslationalLimit(t,ia,na,Ba.lowerLimit,Ba.upperLimit,Aa);break;case 3:var Pa=t.style.jointRotationalConstraintRadius;var Ta=t.style.jointLineColor;var Sa=Gt._lm;this._drawTranslationalLimit(t,ia,na,Sa.lowerLimit,Sa.upperLimit,Ta);break;case 4:var Ca=Gt;var qa=t.style.jointRotationalConstraintRadius;var Ra=t.style.jointLineColor;var Ea=Ca._lm1;var ja=Ca._lm2;this._drawRotationalLimit(t,ia,_a,ha,_a,qa,Ca._angleX-Ea.upperLimit,Ca._angleX-Ea.lowerLimit,Ra);this._drawRotationalLimit(t,oa,ca,fa,ca,qa,ja.lowerLimit-Ca._angleZ,ja.upperLimit-Ca._angleZ,Ra);break;case 5:var Na=Gt;var Da=t.style.jointRotationalConstraintRadius;var Fa=t.style.jointLineColor;var Oa=Na._twistLm;this._drawRotationalLimit(t,oa,fa,ba,fa,Da,Oa.lowerLimit-Na._twistAngle,Oa.upperLimit-Na._twistAngle,Fa);this._drawEllipseOnSphere(t,ia,na,_a,ha,Na._maxSwingAngle1,Na._maxSwingAngle2,Da,Fa);var Wa=this._pool;var Ga=Wa.sizeVec3==0?new Is:Wa.stackVec3[--Wa.sizeVec3];Ga.x=oa.x;Ga.y=oa.y;Ga.z=oa.z;var Ha=Ga;var Ua=Ha.x+ca.x*Da;var Ja=Ha.y+ca.y*Da;var Qa=Ha.z+ca.z*Da;Ha.x=Ua;Ha.y=Ja;Ha.z=Qa;var $a=Ha;t.line(oa,$a,Fa);var Ka=this._pool;if($a!=null){$a.zero();if(Ka.sizeVec3==Ka.stackVec3.length){var ti=Ka.sizeVec3<<1;var ai=new Array(ti);var ii=ai;var ri=0;var oi=Ka.sizeVec3;while(ri<oi){var si=ri++;ii[si]=Ka.stackVec3[si];Ka.stackVec3[si]=null}Ka.stackVec3=ii}Ka.stackVec3[Ka.sizeVec3++]=$a}break}}t.line(ia,oa,t.style.jointErrorColor);var ni=this._pool;if(Jt!=null){Jt.zero();if(ni.sizeVec3==ni.stackVec3.length){var ei=ni.sizeVec3<<1;var _i=new Array(ei);var vi=_i;var hi=0;var li=ni.sizeVec3;while(hi<li){var ci=hi++;vi[ci]=ni.stackVec3[ci];ni.stackVec3[ci]=null}ni.stackVec3=vi}ni.stackVec3[ni.sizeVec3++]=Jt}var pi=this._pool;if($t!=null){$t.zero();if(pi.sizeVec3==pi.stackVec3.length){var fi=pi.sizeVec3<<1;var mi=new Array(fi);var bi=mi;var ui=0;var xi=pi.sizeVec3;while(ui<xi){var yi=ui++;bi[yi]=pi.stackVec3[yi];pi.stackVec3[yi]=null}pi.stackVec3=bi}pi.stackVec3[pi.sizeVec3++]=$t}var gi=this._pool;if(ia!=null){ia.zero();if(gi.sizeVec3==gi.stackVec3.length){var Xi=gi.sizeVec3<<1;var zi=new Array(Xi);var Mi=zi;var Yi=0;var Zi=gi.sizeVec3;while(Yi<Zi){var di=Yi++;Mi[di]=gi.stackVec3[di];gi.stackVec3[di]=null}gi.stackVec3=Mi}gi.stackVec3[gi.sizeVec3++]=ia}var Ii=this._pool;if(oa!=null){oa.zero();if(Ii.sizeVec3==Ii.stackVec3.length){var wi=Ii.sizeVec3<<1;var Vi=new Array(wi);var Li=Vi;var Ai=0;var ki=Ii.sizeVec3;while(Ai<ki){var Bi=Ai++;Li[Bi]=Ii.stackVec3[Bi];Ii.stackVec3[Bi]=null}Ii.stackVec3=Li}Ii.stackVec3[Ii.sizeVec3++]=oa}var Pi=this._pool;if(na!=null){na.zero();if(Pi.sizeVec3==Pi.stackVec3.length){var Ti=Pi.sizeVec3<<1;var Si=new Array(Ti);var Ci=Si;var qi=0;var Ri=Pi.sizeVec3;while(qi<Ri){var Ei=qi++;Ci[Ei]=Pi.stackVec3[Ei];Pi.stackVec3[Ei]=null}Pi.stackVec3=Ci}Pi.stackVec3[Pi.sizeVec3++]=na}var ji=this._pool;if(_a!=null){_a.zero();if(ji.sizeVec3==ji.stackVec3.length){var Ni=ji.sizeVec3<<1;var Di=new Array(Ni);var Fi=Di;var Oi=0;var Wi=ji.sizeVec3;while(Oi<Wi){var Gi=Oi++;Fi[Gi]=ji.stackVec3[Gi];ji.stackVec3[Gi]=null}ji.stackVec3=Fi}ji.stackVec3[ji.sizeVec3++]=_a}var Hi=this._pool;if(ha!=null){ha.zero();if(Hi.sizeVec3==Hi.stackVec3.length){var Ui=Hi.sizeVec3<<1;var Ji=new Array(Ui);var Qi=Ji;var $i=0;var Ki=Hi.sizeVec3;while($i<Ki){var tr=$i++;Qi[tr]=Hi.stackVec3[tr];Hi.stackVec3[tr]=null}Hi.stackVec3=Qi}Hi.stackVec3[Hi.sizeVec3++]=ha}var ar=this._pool;if(ca!=null){ca.zero();if(ar.sizeVec3==ar.stackVec3.length){var ir=ar.sizeVec3<<1;var rr=new Array(ir);var or=rr;var sr=0;var nr=ar.sizeVec3;while(sr<nr){var er=sr++;or[er]=ar.stackVec3[er];ar.stackVec3[er]=null}ar.stackVec3=or}ar.stackVec3[ar.sizeVec3++]=ca}var _r=this._pool;if(fa!=null){fa.zero();if(_r.sizeVec3==_r.stackVec3.length){var vr=_r.sizeVec3<<1;var hr=new Array(vr);var lr=hr;var cr=0;var pr=_r.sizeVec3;while(cr<pr){var fr=cr++;lr[fr]=_r.stackVec3[fr];_r.stackVec3[fr]=null}_r.stackVec3=lr}_r.stackVec3[_r.sizeVec3++]=fa}var mr=this._pool;if(ba!=null){ba.zero();if(mr.sizeVec3==mr.stackVec3.length){var br=mr.sizeVec3<<1;var ur=new Array(br);var xr=ur;var yr=0;var gr=mr.sizeVec3;while(yr<gr){var Xr=yr++;xr[Xr]=mr.stackVec3[Xr];mr.stackVec3[Xr]=null}mr.stackVec3=xr}mr.stackVec3[mr.sizeVec3++]=ba}Gt=Ht}}},_drawRotationalLimit:function(t,a,i,r,o,s,n,e,_){if(n!=e){var v=this._pool;var h=v.sizeVec3==0?new Is:v.stackVec3[--v.sizeVec3];h.x=a.x;h.y=a.y;h.z=a.z;var l=h;var c=l.x+o.x*s;var p=l.y+o.y*s;var f=l.z+o.z*s;l.x=c;l.y=p;l.z=f;var m=l;t.line(a,m,_);var b=this._pool;if(m!=null){m.zero();if(b.sizeVec3==b.stackVec3.length){var u=b.sizeVec3<<1;var x=new Array(u);var y=x;var g=0;var X=b.sizeVec3;while(g<X){var z=g++;y[z]=b.stackVec3[z];b.stackVec3[z]=null}b.stackVec3=y}b.stackVec3[b.sizeVec3++]=m}}if(n>e){t.ellipse(a,i,r,s,s,_)}else{t.arc(a,i,r,s,s,n,e,true,_)}},_drawTranslationalLimit:function(t,a,i,r,o,s){if(r<o){var n=this._pool;var e=n.sizeVec3==0?new Is:n.stackVec3[--n.sizeVec3];e.x=a.x;e.y=a.y;e.z=a.z;var _=e;var v=_.x+i.x*r;var h=_.y+i.y*r;var l=_.z+i.z*r;_.x=v;_.y=h;_.z=l;var c=_;var p=this._pool;var f=p.sizeVec3==0?new Is:p.stackVec3[--p.sizeVec3];f.x=a.x;f.y=a.y;f.z=a.z;var m=f;var b=m.x+i.x*o;var u=m.y+i.y*o;var x=m.z+i.z*o;m.x=b;m.y=u;m.z=x;var y=m;t.line(c,y,s);var g=this._pool;if(c!=null){c.zero();if(g.sizeVec3==g.stackVec3.length){var X=g.sizeVec3<<1;var z=new Array(X);var M=z;var Y=0;var Z=g.sizeVec3;while(Y<Z){var d=Y++;M[d]=g.stackVec3[d];g.stackVec3[d]=null}g.stackVec3=M}g.stackVec3[g.sizeVec3++]=c}var I=this._pool;if(y!=null){y.zero();if(I.sizeVec3==I.stackVec3.length){var w=I.sizeVec3<<1;var V=new Array(w);var L=V;var A=0;var k=I.sizeVec3;while(A<k){var B=A++;L[B]=I.stackVec3[B];I.stackVec3[B]=null}I.stackVec3=L}I.stackVec3[I.sizeVec3++]=y}}},_drawEllipseOnSphere:function(t,a,i,r,o,s,n,e,_){var v=16;var h=0;var l=6.28318530717958/v;var c=this._pool;var p=c.sizeVec3==0?new Is:c.stackVec3[--c.sizeVec3];var f=this._pool;var m=f.sizeQuat==0?new va:f.stackQuat[--f.sizeQuat];var b=this._pool;var u=b.sizeMat3==0?new ws:b.stackMat3[--b.sizeMat3];var x=this._pool;var y=x.sizeVec3==0?new Is:x.stackVec3[--x.sizeVec3];var g=0;var X=v+1;while(g<X){var z=g++;var M=Math.cos(h)*s;var Y=Math.sin(h)*n;var Z=Math.sqrt(M*M+Y*Y);var d=Math.sin(Z*.5);var I=Math.cos(Z*.5);var w=p.zero();var V=w.x+r.x*M;var L=w.y+r.y*M;var A=w.z+r.z*M;w.x=V;w.y=L;w.z=A;var k=w;var B=k.x+o.x*Y;var P=k.y+o.y*Y;var T=k.z+o.z*Y;k.x=B;k.y=P;k.z=T;var S=1/Z*d;var C=p.x*S;var q=p.y*S;var R=p.z*S;p.x=C;p.y=q;p.z=R;m.x=p.x;m.y=p.y;m.z=p.z;m.w=I;var E=m.x;var j=m.y;var N=m.z;var D=m.w;var F=2*E;var O=2*j;var W=2*N;var G=E*F;var H=j*O;var U=N*W;var J=E*O;var Q=j*W;var $=E*W;var K=D*F;var tt=D*O;var at=D*W;u.e00=1-H-U;u.e01=J-at;u.e02=$+tt;u.e10=J+at;u.e11=1-G-U;u.e12=Q-K;u.e20=$-tt;u.e21=Q+K;u.e22=1-G-H;var it=this._pool;var rt=it.sizeVec3==0?new Is:it.stackVec3[--it.sizeVec3];var ot=rt.x+i.x*e;var st=rt.y+i.y*e;var nt=rt.z+i.z*e;rt.x=ot;rt.y=st;rt.z=nt;var et=rt;var _t=et.x*u.e00+et.y*u.e01+et.z*u.e02;var vt=et.x*u.e10+et.y*u.e11+et.z*u.e12;var ht=et.x*u.e20+et.y*u.e21+et.z*u.e22;et.x=_t;et.y=vt;et.z=ht;var lt=et;var ct=lt.x+a.x;var pt=lt.y+a.y;var ft=lt.z+a.z;lt.x=ct;lt.y=pt;lt.z=ft;if(z>=1){t.line(y,et,_)}var mt=this._pool;if(y!=null){y.zero();if(mt.sizeVec3==mt.stackVec3.length){var bt=mt.sizeVec3<<1;var ut=new Array(bt);var xt=ut;var yt=0;var gt=mt.sizeVec3;while(yt<gt){var Xt=yt++;xt[Xt]=mt.stackVec3[Xt];mt.stackVec3[Xt]=null}mt.stackVec3=xt}mt.stackVec3[mt.sizeVec3++]=y}y=et;h+=l}var zt=this._pool;if(p!=null){p.zero();if(zt.sizeVec3==zt.stackVec3.length){var Mt=zt.sizeVec3<<1;var Yt=new Array(Mt);var Zt=Yt;var dt=0;var It=zt.sizeVec3;while(dt<It){var wt=dt++;Zt[wt]=zt.stackVec3[wt];zt.stackVec3[wt]=null}zt.stackVec3=Zt}zt.stackVec3[zt.sizeVec3++]=p}var Vt=this._pool;if(m!=null){var Lt=0;var At=0;var kt=0;var Bt=1;m.x=Lt;m.y=At;m.z=kt;m.w=Bt;if(Vt.sizeQuat==Vt.stackQuat.length){var Pt=Vt.sizeQuat<<1;var Tt=new Array(Pt);var St=Tt;var Ct=0;var qt=Vt.sizeQuat;while(Ct<qt){var Rt=Ct++;St[Rt]=Vt.stackQuat[Rt];Vt.stackQuat[Rt]=null}Vt.stackQuat=St}Vt.stackQuat[Vt.sizeQuat++]=m}var Et=this._pool;if(u!=null){var jt=1;var Nt=0;var Dt=0;var Ft=0;var Ot=1;var Wt=0;var Gt=0;var Ht=0;var Ut=1;u.e00=jt;u.e01=Nt;u.e02=Dt;u.e10=Ft;u.e11=Ot;u.e12=Wt;u.e20=Gt;u.e21=Ht;u.e22=Ut;if(Et.sizeMat3==Et.stackMat3.length){var Jt=Et.sizeMat3<<1;var Qt=new Array(Jt);var $t=Qt;var Kt=0;var ta=Et.sizeMat3;while(Kt<ta){var aa=Kt++;$t[aa]=Et.stackMat3[aa];Et.stackMat3[aa]=null}Et.stackMat3=$t}Et.stackMat3[Et.sizeMat3++]=u}var ia=this._pool;if(y!=null){y.zero();if(ia.sizeVec3==ia.stackVec3.length){var ra=ia.sizeVec3<<1;var oa=new Array(ra);var sa=oa;var na=0;var ea=ia.sizeVec3;while(na<ea){var _a=na++;sa[_a]=ia.stackVec3[_a];ia.stackVec3[_a]=null}ia.stackVec3=sa}ia.stackVec3[ia.sizeVec3++]=y}},step:function(t){if(this._timeStep.dt>0){this._timeStep.dtRatio=t/this._timeStep.dt}this._timeStep.dt=t;this._timeStep.invDt=1/t;var a=(new Date).getTime()/1e3;this._updateContacts();this._solveIslands();var i=(new Date).getTime()/1e3;vt.totalTime=(i-a)*1e3},addRigidBody:function(t){if(t._world!=null){throw new Error("A rigid body cannot belong to multiple worlds.")}if(this._rigidBodyList==null){this._rigidBodyList=t;this._rigidBodyListLast=t}else{this._rigidBodyListLast._next=t;t._prev=this._rigidBodyListLast;this._rigidBodyListLast=t}t._world=this;var a=t._shapeList;while(a!=null){var i=a._next;a._proxy=this._broadPhase.createProxy(a,a._aabb);a._id=this._shapeIdCount++;this._numShapes++;a=i}this._numRigidBodies++},removeRigidBody:function(t){if(t._world!=this){throw new Error("The rigid body doesn't belong to the world.")}var a=t._prev;var i=t._next;if(a!=null){a._next=i}if(i!=null){i._prev=a}if(t==this._rigidBodyList){this._rigidBodyList=this._rigidBodyList._next}if(t==this._rigidBodyListLast){this._rigidBodyListLast=this._rigidBodyListLast._prev}t._next=null;t._prev=null;t._world=null;var r=t._shapeList;while(r!=null){var o=r._next;this._broadPhase.destroyProxy(r._proxy);r._proxy=null;r._id=-1;var s=r._rigidBody._contactLinkList;while(s!=null){var n=s._next;var e=s._contact;if(e._s1==r||e._s2==r){var _=s._other;_._sleeping=false;_._sleepTime=0;var v=this._contactManager;var h=e._prev;var l=e._next;if(h!=null){h._next=l}if(l!=null){l._prev=h}if(e==v._contactList){v._contactList=v._contactList._next}if(e==v._contactListLast){v._contactListLast=v._contactListLast._prev}e._next=null;e._prev=null;if(e._touching){var c=e._s1._contactCallback;var p=e._s2._contactCallback;if(c==p){p=null}if(c!=null){c.endContact(e)}if(p!=null){p.endContact(e)}}var f=e._link1._prev;var m=e._link1._next;if(f!=null){f._next=m}if(m!=null){m._prev=f}if(e._link1==e._b1._contactLinkList){e._b1._contactLinkList=e._b1._contactLinkList._next}if(e._link1==e._b1._contactLinkListLast){e._b1._contactLinkListLast=e._b1._contactLinkListLast._prev}e._link1._next=null;e._link1._prev=null;var b=e._link2._prev;var u=e._link2._next;if(b!=null){b._next=u}if(u!=null){u._prev=b}if(e._link2==e._b2._contactLinkList){e._b2._contactLinkList=e._b2._contactLinkList._next}if(e._link2==e._b2._contactLinkListLast){e._b2._contactLinkListLast=e._b2._contactLinkListLast._prev}e._link2._next=null;e._link2._prev=null;e._b1._numContactLinks--;e._b2._numContactLinks--;e._link1._other=null;e._link2._other=null;e._link1._contact=null;e._link2._contact=null;e._s1=null;e._s2=null;e._b1=null;e._b2=null;e._touching=false;e._cachedDetectorData._clear();e._manifold._clear();e._detector=null;var x=e._contactConstraint;x._s1=null;x._s2=null;x._b1=null;x._b2=null;x._tf1=null;x._tf2=null;e._next=v._contactPool;v._contactPool=e;v._numContacts--}s=n}this._numShapes--;r=o}this._numRigidBodies--},addJoint:function(t){if(t._world!=null){throw new Error("A joint cannot belong to multiple worlds.")}if(this._jointList==null){this._jointList=t;this._jointListLast=t}else{this._jointListLast._next=t;t._prev=this._jointListLast;this._jointListLast=t}t._world=this;t._link1._other=t._b2;t._link2._other=t._b1;if(t._b1._jointLinkList==null){t._b1._jointLinkList=t._link1;t._b1._jointLinkListLast=t._link1}else{t._b1._jointLinkListLast._next=t._link1;t._link1._prev=t._b1._jointLinkListLast;t._b1._jointLinkListLast=t._link1}if(t._b2._jointLinkList==null){t._b2._jointLinkList=t._link2;t._b2._jointLinkListLast=t._link2}else{t._b2._jointLinkListLast._next=t._link2;t._link2._prev=t._b2._jointLinkListLast;t._b2._jointLinkListLast=t._link2}t._b1._numJointLinks++;t._b2._numJointLinks++;var a=t._b1;a._sleeping=false;a._sleepTime=0;var i=t._b2;i._sleeping=false;i._sleepTime=0;t._syncAnchors();this._numJoints++},removeJoint:function(t){if(t._world!=this){throw new Error("The joint doesn't belong to the world.")}var a=t._prev;var i=t._next;if(a!=null){a._next=i}if(i!=null){i._prev=a}if(t==this._jointList){this._jointList=this._jointList._next}if(t==this._jointListLast){this._jointListLast=this._jointListLast._prev}t._next=null;t._prev=null;t._world=null;var r=t._link1._prev;var o=t._link1._next;if(r!=null){r._next=o}if(o!=null){o._prev=r}if(t._link1==t._b1._jointLinkList){t._b1._jointLinkList=t._b1._jointLinkList._next}if(t._link1==t._b1._jointLinkListLast){t._b1._jointLinkListLast=t._b1._jointLinkListLast._prev}t._link1._next=null;t._link1._prev=null;var s=t._link2._prev;var n=t._link2._next;if(s!=null){s._next=n}if(n!=null){n._prev=s}if(t._link2==t._b2._jointLinkList){t._b2._jointLinkList=t._b2._jointLinkList._next}if(t._link2==t._b2._jointLinkListLast){t._b2._jointLinkListLast=t._b2._jointLinkListLast._prev}t._link2._next=null;t._link2._prev=null;t._link1._other=null;t._link2._other=null;t._b1._numJointLinks--;t._b2._numJointLinks--;var e=t._b1;e._sleeping=false;e._sleepTime=0;var _=t._b2;_._sleeping=false;_._sleepTime=0;this._numJoints--},setDebugDraw:function(t){this._debugDraw=t},getDebugDraw:function(){return this._debugDraw},debugDraw:function(){if(this._debugDraw!=null){if(this._broadPhase._type==2){var t=this._broadPhase;this._drawBvh(this._debugDraw,t._tree)}this._drawRigidBodies(this._debugDraw);this._drawConstraints(this._debugDraw)}},rayCast:function(t,a,i){var r=this._rayCastWrapper.begin;r.x=t.x;r.y=t.y;r.z=t.z;var o=this._rayCastWrapper.end;o.x=a.x;o.y=a.y;o.z=a.z;this._rayCastWrapper.callback=i;this._broadPhase.rayCast(t,a,this._rayCastWrapper)},convexCast:function(t,a,i,r){this._convexCastWrapper.convex=t;var o=this._convexCastWrapper.begin;o._positionX=a._positionX;o._positionY=a._positionY;o._positionZ=a._positionZ;o._rotation00=a._rotation00;o._rotation01=a._rotation01;o._rotation02=a._rotation02;o._rotation10=a._rotation10;o._rotation11=a._rotation11;o._rotation12=a._rotation12;o._rotation20=a._rotation20;o._rotation21=a._rotation21;o._rotation22=a._rotation22;var s=this._convexCastWrapper.translation;s.x=i.x;s.y=i.y;s.z=i.z;this._convexCastWrapper.callback=r;this._broadPhase.convexCast(t,a,i,this._convexCastWrapper)},aabbTest:function(t,a){this._aabbTestWrapper._aabb.copyFrom(t);this._aabbTestWrapper._callback=a;this._broadPhase.aabbTest(t,this._aabbTestWrapper)},getRigidBodyList:function(){return this._rigidBodyList},getJointList:function(){return this._jointList},getBroadPhase:function(){return this._broadPhase},getContactManager:function(){return this._contactManager},getNumRigidBodies:function(){return this._numRigidBodies},getNumJoints:function(){return this._numJoints},getNumShapes:function(){return this._numShapes},getNumIslands:function(){return this._numIslands},getNumVelocityIterations:function(){return this._numVelocityIterations},setNumVelocityIterations:function(t){this._numVelocityIterations=t},getNumPositionIterations:function(){return this._numPositionIterations},setNumPositionIterations:function(t){this._numPositionIterations=t},getGravity:function(){return this._gravity},setGravity:function(t){var a=this._gravity;a.x=t.x;a.y=t.y;a.z=t.z}};var tt=function(){s.call(this);this.rayCastHit=new z;this.begin=new Is;this.end=new Is;this.callback=null};tt.__super__=s;tt.prototype=$extend(s.prototype,{process:function(t){var a=t.userData;if(a._geom.rayCast(this.begin,this.end,a._transform,this.rayCastHit)){this.callback.process(a,this.rayCastHit)}}});var at=function(){s.call(this);this.rayCastHit=new z;this.begin=new j;this.translation=new Is;this.zero=new Is;this.callback=null;this.convex=null};at.__super__=s;at.prototype=$extend(s.prototype,{process:function(t){var a=t.userData;var i=a._geom._type;if(i<0||i>5){return}var r=a._geom;if(N.instance.convexCast(this.convex,r,this.begin,a._transform,this.translation,this.zero,this.rayCastHit)){this.callback.process(a,this.rayCastHit)}}});var it=function(){s.call(this);this._aabb=new m;this._callback=null};it.__super__=s;it.prototype=$extend(s.prototype,{process:function(t){var a=t.userData;var i=a._aabb;if(i._minX<this._aabb._maxX&&i._maxX>this._aabb._minX&&i._minY<this._aabb._maxY&&i._maxY>this._aabb._minY&&i._minZ<this._aabb._maxZ&&i._maxZ>this._aabb._minZ){this._callback.process(a)}}});var rt=function(){};rt.prototype={process:function(t){}};var ot=function(){};ot.prototype={beginContact:function(t){},preSolve:function(t){},postSolve:function(t){},endContact:function(t){}};var st=function(){};st.prototype={process:function(t,a){}};var nt=function(){st.call(this);this.position=new Is;this.normal=new Is;this.shape=null;this.fraction=1;this.position.zero();this.normal.zero();this.hit=false};nt.__super__=st;nt.prototype=$extend(st.prototype,{clear:function(){this.shape=null;this.fraction=1;this.position.zero();this.normal.zero();this.hit=false},process:function(t,a){if(a.fraction<this.fraction){this.shape=t;this.hit=true;this.fraction=a.fraction;var i=this.position;var r=a.position;i.x=r.x;i.y=r.y;i.z=r.z;var o=this.normal;var s=a.normal;o.x=s.x;o.y=s.y;o.z=s.z}}});var et=function(){this.p=new G;this.wireframe=false;this.drawShapes=true;this.drawBvh=false;this.drawBvhMinLevel=0;this.drawBvhMaxLevel=65536;this.drawAabbs=false;this.drawBases=false;this.drawPairs=false;this.drawContacts=false;this.drawJoints=true;this.drawJointLimits=false;var t=4;var a=3.14159265358979/t;var i=8;var r=6.28318530717958/i;var o=new Array(t+1);this.sphereCoords=o;var s=new Array(t+1);this.tmpSphereVerts=s;var n=new Array(t+1);this.tmpSphereNorms=n;var e=0;var _=t+1;while(e<_){var v=e++;var h=v==0||v==t?1:i;var l=this.sphereCoords;var c=new Array(h);l[v]=c;var p=this.tmpSphereVerts;var f=new Array(h);p[v]=f;var m=this.tmpSphereNorms;var b=new Array(h);m[v]=b;var u=0;var x=i;while(u<x){var y=u++;var g=v*a;var X=y*r;this.sphereCoords[v][y]=new Is(Math.sin(g)*Math.cos(X),Math.cos(g),-Math.sin(g)*Math.sin(X));this.tmpSphereVerts[v][y]=new Is;this.tmpSphereNorms[v][y]=new Is}}var z=new Array(8);this.circleCoords=z;var M=new Array(8);this.circleCoordsShift=M;var Y=new Array(8);this.tmpCircleVerts1=Y;var Z=new Array(8);this.tmpCircleVerts2=Z;var d=new Array(8);this.tmpCircleNorms=d;var I=.7853981633974475;var w=0;while(w<8){var V=w++;this.circleCoords[V]=new Is(Math.cos(V*I),0,-Math.sin(V*I));this.circleCoordsShift[V]=new Is(Math.cos((V+.5)*I),0,-Math.sin((V+.5)*I));this.tmpCircleVerts1[V]=new Is;this.tmpCircleVerts2[V]=new Is;this.tmpCircleNorms[V]=new Is}this.style=new _t};et.prototype={aabb:function(t,a,i){var r=this.p;var o=(r.sizeVec3==0?new Is:r.stackVec3[--r.sizeVec3]).init(t.x,t.y,t.z);var s=this.p;var n=(s.sizeVec3==0?new Is:s.stackVec3[--s.sizeVec3]).init(t.x,t.y,a.z);var e=this.p;var _=(e.sizeVec3==0?new Is:e.stackVec3[--e.sizeVec3]).init(t.x,a.y,t.z);var v=this.p;var h=(v.sizeVec3==0?new Is:v.stackVec3[--v.sizeVec3]).init(t.x,a.y,a.z);var l=this.p;var c=(l.sizeVec3==0?new Is:l.stackVec3[--l.sizeVec3]).init(a.x,t.y,t.z);var p=this.p;var f=(p.sizeVec3==0?new Is:p.stackVec3[--p.sizeVec3]).init(a.x,t.y,a.z);var m=this.p;var b=(m.sizeVec3==0?new Is:m.stackVec3[--m.sizeVec3]).init(a.x,a.y,t.z);var u=this.p;var x=(u.sizeVec3==0?new Is:u.stackVec3[--u.sizeVec3]).init(a.x,a.y,a.z);this.line(o,n,i);this.line(_,h,i);this.line(c,f,i);this.line(b,x,i);this.line(o,_,i);this.line(n,h,i);this.line(c,b,i);this.line(f,x,i);this.line(o,c,i);this.line(n,f,i);this.line(_,b,i);this.line(h,x,i);var y=this.p;if(o!=null){o.zero();if(y.sizeVec3==y.stackVec3.length){var g=y.sizeVec3<<1;var X=new Array(g);var z=X;var M=0;var Y=y.sizeVec3;while(M<Y){var Z=M++;z[Z]=y.stackVec3[Z];y.stackVec3[Z]=null}y.stackVec3=z}y.stackVec3[y.sizeVec3++]=o}var d=this.p;if(n!=null){n.zero();if(d.sizeVec3==d.stackVec3.length){var I=d.sizeVec3<<1;var w=new Array(I);var V=w;var L=0;var A=d.sizeVec3;while(L<A){var k=L++;V[k]=d.stackVec3[k];d.stackVec3[k]=null}d.stackVec3=V}d.stackVec3[d.sizeVec3++]=n}var B=this.p;if(_!=null){_.zero();if(B.sizeVec3==B.stackVec3.length){var P=B.sizeVec3<<1;var T=new Array(P);var S=T;var C=0;var q=B.sizeVec3;while(C<q){var R=C++;S[R]=B.stackVec3[R];B.stackVec3[R]=null}B.stackVec3=S}B.stackVec3[B.sizeVec3++]=_}var E=this.p;if(h!=null){h.zero();if(E.sizeVec3==E.stackVec3.length){var j=E.sizeVec3<<1;var N=new Array(j);var D=N;var F=0;var O=E.sizeVec3;while(F<O){var W=F++;D[W]=E.stackVec3[W];E.stackVec3[W]=null}E.stackVec3=D}E.stackVec3[E.sizeVec3++]=h}var G=this.p;if(c!=null){c.zero();if(G.sizeVec3==G.stackVec3.length){var H=G.sizeVec3<<1;var U=new Array(H);var J=U;var Q=0;var $=G.sizeVec3;while(Q<$){var K=Q++;J[K]=G.stackVec3[K];G.stackVec3[K]=null}G.stackVec3=J}G.stackVec3[G.sizeVec3++]=c}var tt=this.p;if(f!=null){f.zero();if(tt.sizeVec3==tt.stackVec3.length){var at=tt.sizeVec3<<1;var it=new Array(at);var rt=it;var ot=0;var st=tt.sizeVec3;while(ot<st){var nt=ot++;rt[nt]=tt.stackVec3[nt];tt.stackVec3[nt]=null}tt.stackVec3=rt}tt.stackVec3[tt.sizeVec3++]=f}var et=this.p;if(b!=null){b.zero();if(et.sizeVec3==et.stackVec3.length){var _t=et.sizeVec3<<1;var vt=new Array(_t);var ht=vt;var lt=0;var ct=et.sizeVec3;while(lt<ct){var pt=lt++;ht[pt]=et.stackVec3[pt];et.stackVec3[pt]=null}et.stackVec3=ht}et.stackVec3[et.sizeVec3++]=b}var ft=this.p;if(x!=null){x.zero();if(ft.sizeVec3==ft.stackVec3.length){var mt=ft.sizeVec3<<1;var bt=new Array(mt);var ut=bt;var xt=0;var yt=ft.sizeVec3;while(xt<yt){var gt=xt++;ut[gt]=ft.stackVec3[gt];ft.stackVec3[gt]=null}ft.stackVec3=ut}ft.stackVec3[ft.sizeVec3++]=x}},basis:function(t,a,i,r,o){var s=this.p;var n=s.sizeVec3==0?new Is:s.stackVec3[--s.sizeVec3];var e=this.p;var _=e.sizeMat3==0?new ws:e.stackMat3[--e.sizeMat3];var v=this.p;var h=v.sizeVec3==0?new Is:v.stackVec3[--v.sizeVec3];var l=this.p;var c=l.sizeVec3==0?new Is:l.stackVec3[--l.sizeVec3];var p=this.p;var f=p.sizeVec3==0?new Is:p.stackVec3[--p.sizeVec3];var m=n;m.x=t._positionX;m.y=t._positionY;m.z=t._positionZ;var b=_;b.e00=t._rotation00;b.e01=t._rotation01;b.e02=t._rotation02;b.e10=t._rotation10;b.e11=t._rotation11;b.e12=t._rotation12;b.e20=t._rotation20;b.e21=t._rotation21;b.e22=t._rotation22;h.init(_.e00,_.e10,_.e20);c.init(_.e01,_.e11,_.e21);f.init(_.e02,_.e12,_.e22);var u=h.x*a;var x=h.y*a;var y=h.z*a;h.x=u;h.y=x;h.z=y;var g=h;var X=g.x+n.x;var z=g.y+n.y;var M=g.z+n.z;g.x=X;g.y=z;g.z=M;var Y=c.x*a;var Z=c.y*a;var d=c.z*a;c.x=Y;c.y=Z;c.z=d;var I=c;var w=I.x+n.x;var V=I.y+n.y;var L=I.z+n.z;I.x=w;I.y=V;I.z=L;var A=f.x*a;var k=f.y*a;var B=f.z*a;f.x=A;f.y=k;f.z=B;var P=f;var T=P.x+n.x;var S=P.y+n.y;var C=P.z+n.z;P.x=T;P.y=S;P.z=C;this.line(n,h,i);this.line(n,c,r);this.line(n,f,o);var q=this.p;if(n!=null){n.zero();if(q.sizeVec3==q.stackVec3.length){var R=q.sizeVec3<<1;var E=new Array(R);var j=E;var N=0;var D=q.sizeVec3;while(N<D){var F=N++;j[F]=q.stackVec3[F];q.stackVec3[F]=null}q.stackVec3=j}q.stackVec3[q.sizeVec3++]=n}var O=this.p;if(_!=null){var W=1;var G=0;var H=0;var U=0;var J=1;var Q=0;var $=0;var K=0;var tt=1;_.e00=W;_.e01=G;_.e02=H;_.e10=U;_.e11=J;_.e12=Q;_.e20=$;_.e21=K;_.e22=tt;if(O.sizeMat3==O.stackMat3.length){var at=O.sizeMat3<<1;var it=new Array(at);var rt=it;var ot=0;var st=O.sizeMat3;while(ot<st){var nt=ot++;rt[nt]=O.stackMat3[nt];O.stackMat3[nt]=null}O.stackMat3=rt}O.stackMat3[O.sizeMat3++]=_}var et=this.p;if(h!=null){h.zero();if(et.sizeVec3==et.stackVec3.length){var _t=et.sizeVec3<<1;var vt=new Array(_t);var ht=vt;var lt=0;var ct=et.sizeVec3;while(lt<ct){var pt=lt++;ht[pt]=et.stackVec3[pt];et.stackVec3[pt]=null}et.stackVec3=ht}et.stackVec3[et.sizeVec3++]=h}var ft=this.p;if(c!=null){c.zero();if(ft.sizeVec3==ft.stackVec3.length){var mt=ft.sizeVec3<<1;var bt=new Array(mt);var ut=bt;var xt=0;var yt=ft.sizeVec3;while(xt<yt){var gt=xt++;ut[gt]=ft.stackVec3[gt];ft.stackVec3[gt]=null}ft.stackVec3=ut}ft.stackVec3[ft.sizeVec3++]=c}var Xt=this.p;if(f!=null){f.zero();if(Xt.sizeVec3==Xt.stackVec3.length){var zt=Xt.sizeVec3<<1;var Mt=new Array(zt);var Yt=Mt;var Zt=0;var dt=Xt.sizeVec3;while(Zt<dt){var It=Zt++;Yt[It]=Xt.stackVec3[It];Xt.stackVec3[It]=null}Xt.stackVec3=Yt}Xt.stackVec3[Xt.sizeVec3++]=f}},ellipse:function(t,a,i,r,o,s){this.arc(t,a,i,r,o,0,6.28318530717958,false,s)},arc:function(t,a,i,r,o,s,n,e,_){var v=this.p;var h=v.sizeVec3==0?new Is:v.stackVec3[--v.sizeVec3];h.x=a.x;h.y=a.y;h.z=a.z;var l=h;var c=l.x*r;var p=l.y*r;var f=l.z*r;l.x=c;l.y=p;l.z=f;a=l;var m=this.p;var b=m.sizeVec3==0?new Is:m.stackVec3[--m.sizeVec3];b.x=i.x;b.y=i.y;b.z=i.z;var u=b;var x=u.x*o;var y=u.y*o;var g=u.z*o;u.x=x;u.y=y;u.z=g;i=u;var X=.5235987755982984;var z=n-s;if(z<0){z=-z}var M=z/X+.5|0;if(M==0){M=1}var Y=s;var Z=(n-s)/M;var d=this.p;var I=d.sizeVec3==0?new Is:d.stackVec3[--d.sizeVec3];I.x=t.x;I.y=t.y;I.z=t.z;var w=I;var V=Math.cos(Y);var L=w.x+a.x*V;var A=w.y+a.y*V;var k=w.z+a.z*V;w.x=L;w.y=A;w.z=k;var B=w;var P=Math.sin(Y);var T=B.x+i.x*P;var S=B.y+i.y*P;var C=B.z+i.z*P;B.x=T;B.y=S;B.z=C;var q=B;var R=q;if(e){this.line(t,R,_)}var E=0;var j=M;while(E<j){var N=E++;Y+=Z;var D=this.p;var F=D.sizeVec3==0?new Is:D.stackVec3[--D.sizeVec3];F.x=t.x;F.y=t.y;F.z=t.z;var O=F;var W=Math.cos(Y);var G=O.x+a.x*W;var H=O.y+a.y*W;var U=O.z+a.z*W;O.x=G;O.y=H;O.z=U;var J=O;var Q=Math.sin(Y);var $=J.x+i.x*Q;var K=J.y+i.y*Q;var tt=J.z+i.z*Q;J.x=$;J.y=K;J.z=tt;var at=J;var it=at;this.line(R,it,_);var rt=this.p;if(R!=null){R.zero();if(rt.sizeVec3==rt.stackVec3.length){var ot=rt.sizeVec3<<1;var st=new Array(ot);var nt=st;var et=0;var _t=rt.sizeVec3;while(et<_t){var vt=et++;nt[vt]=rt.stackVec3[vt];rt.stackVec3[vt]=null}rt.stackVec3=nt}rt.stackVec3[rt.sizeVec3++]=R}R=it}if(e){this.line(t,R,_)}var ht=this.p;if(R!=null){R.zero();if(ht.sizeVec3==ht.stackVec3.length){var lt=ht.sizeVec3<<1;var ct=new Array(lt);var pt=ct;var ft=0;var mt=ht.sizeVec3;while(ft<mt){var bt=ft++;pt[bt]=ht.stackVec3[bt];ht.stackVec3[bt]=null}ht.stackVec3=pt}ht.stackVec3[ht.sizeVec3++]=R}var ut=this.p;if(a!=null){a.zero();if(ut.sizeVec3==ut.stackVec3.length){var xt=ut.sizeVec3<<1;var yt=new Array(xt);var gt=yt;var Xt=0;var zt=ut.sizeVec3;while(Xt<zt){var Mt=Xt++;gt[Mt]=ut.stackVec3[Mt];ut.stackVec3[Mt]=null}ut.stackVec3=gt}ut.stackVec3[ut.sizeVec3++]=a}var Yt=this.p;if(i!=null){i.zero();if(Yt.sizeVec3==Yt.stackVec3.length){var Zt=Yt.sizeVec3<<1;var dt=new Array(Zt);var It=dt;var wt=0;var Vt=Yt.sizeVec3;while(wt<Vt){var Lt=wt++;It[Lt]=Yt.stackVec3[Lt];Yt.stackVec3[Lt]=null}Yt.stackVec3=It}Yt.stackVec3[Yt.sizeVec3++]=i}},cone:function(t,a,i,r){var o=this.p;var s=o.sizeVec3==0?new Is:o.stackVec3[--o.sizeVec3];var n=this.p;var e=n.sizeVec3==0?new Is:n.stackVec3[--n.sizeVec3];var _=this.p;var v=_.sizeVec3==0?new Is:_.stackVec3[--_.sizeVec3];var h=this.p;var l=h.sizeVec3==0?new Is:h.stackVec3[--h.sizeVec3];var c=this.p;var p=c.sizeMat3==0?new ws:c.stackMat3[--c.sizeMat3];var f=l;f.x=t._positionX;f.y=t._positionY;f.z=t._positionZ;var m=p;m.e00=t._rotation00;m.e01=t._rotation01;m.e02=t._rotation02;m.e10=t._rotation10;m.e11=t._rotation11;m.e12=t._rotation12;m.e20=t._rotation20;m.e21=t._rotation21;m.e22=t._rotation22;s.init(p.e00,p.e10,p.e20);e.init(p.e01,p.e11,p.e21);v.init(p.e02,p.e12,p.e22);var b=this.p;var u=b.sizeVec3==0?new Is:b.stackVec3[--b.sizeVec3];u.x=l.x;u.y=l.y;u.z=l.z;var x=u;var y=x.x+e.x*i;var g=x.y+e.y*i;var X=x.z+e.z*i;x.x=y;x.y=g;x.z=X;var z=x;var M=this.p;var Y=M.sizeVec3==0?new Is:M.stackVec3[--M.sizeVec3];Y.x=l.x;Y.y=l.y;Y.z=l.z;var Z=Y;var d=-i;var I=Z.x+e.x*d;var w=Z.y+e.y*d;var V=Z.z+e.z*d;Z.x=I;Z.y=w;Z.z=V;var L=Z;if(this.wireframe){var A=this.p;var k=A.sizeVec3==0?new Is:A.stackVec3[--A.sizeVec3];k.x=L.x;k.y=L.y;k.z=L.z;var B=k;var P=-a;var T=B.x+s.x*P;var S=B.y+s.y*P;var C=B.z+s.z*P;B.x=T;B.y=S;B.z=C;var q=B;var R=q.x+v.x*0;var E=q.y+v.y*0;var j=q.z+v.z*0;q.x=R;q.y=E;q.z=j;var N=q;var D=this.p;var F=D.sizeVec3==0?new Is:D.stackVec3[--D.sizeVec3];F.x=L.x;F.y=L.y;F.z=L.z;var O=F;var W=O.x+s.x*a;var G=O.y+s.y*a;var H=O.z+s.z*a;O.x=W;O.y=G;O.z=H;var U=O;var J=U.x+v.x*0;var Q=U.y+v.y*0;var $=U.z+v.z*0;U.x=J;U.y=Q;U.z=$;var K=U;var tt=this.p;var at=tt.sizeVec3==0?new Is:tt.stackVec3[--tt.sizeVec3];at.x=L.x;at.y=L.y;at.z=L.z;var it=at;var rt=it.x+s.x*0;var ot=it.y+s.y*0;var st=it.z+s.z*0;it.x=rt;it.y=ot;it.z=st;var nt=it;var et=-a;var _t=nt.x+v.x*et;var vt=nt.y+v.y*et;var ht=nt.z+v.z*et;nt.x=_t;nt.y=vt;nt.z=ht;var lt=nt;var ct=this.p;var pt=ct.sizeVec3==0?new Is:ct.stackVec3[--ct.sizeVec3];pt.x=L.x;pt.y=L.y;pt.z=L.z;var ft=pt;var mt=ft.x+s.x*0;var bt=ft.y+s.y*0;var ut=ft.z+s.z*0;ft.x=mt;ft.y=bt;ft.z=ut;var xt=ft;var yt=xt.x+v.x*a;var gt=xt.y+v.y*a;var Xt=xt.z+v.z*a;xt.x=yt;xt.y=gt;xt.z=Xt;var zt=xt;this.ellipse(L,s,v,a,a,r);this.line(z,N,r);this.line(z,K,r);this.line(z,lt,r);this.line(z,zt,r);var Mt=this.p;if(N!=null){N.zero();if(Mt.sizeVec3==Mt.stackVec3.length){var Yt=Mt.sizeVec3<<1;var Zt=new Array(Yt);var dt=Zt;var It=0;var wt=Mt.sizeVec3;while(It<wt){var Vt=It++;dt[Vt]=Mt.stackVec3[Vt];Mt.stackVec3[Vt]=null}Mt.stackVec3=dt}Mt.stackVec3[Mt.sizeVec3++]=N}var Lt=this.p;if(K!=null){K.zero();if(Lt.sizeVec3==Lt.stackVec3.length){var At=Lt.sizeVec3<<1;var kt=new Array(At);var Bt=kt;var Pt=0;var Tt=Lt.sizeVec3;while(Pt<Tt){var St=Pt++;Bt[St]=Lt.stackVec3[St];Lt.stackVec3[St]=null}Lt.stackVec3=Bt}Lt.stackVec3[Lt.sizeVec3++]=K}var Ct=this.p;if(lt!=null){lt.zero();if(Ct.sizeVec3==Ct.stackVec3.length){var qt=Ct.sizeVec3<<1;var Rt=new Array(qt);var Et=Rt;var jt=0;var Nt=Ct.sizeVec3;while(jt<Nt){var Dt=jt++;Et[Dt]=Ct.stackVec3[Dt];Ct.stackVec3[Dt]=null}Ct.stackVec3=Et}Ct.stackVec3[Ct.sizeVec3++]=lt}var Ft=this.p;if(zt!=null){zt.zero();if(Ft.sizeVec3==Ft.stackVec3.length){var Ot=Ft.sizeVec3<<1;var Wt=new Array(Ot);var Gt=Wt;var Ht=0;var Ut=Ft.sizeVec3;while(Ht<Ut){var Jt=Ht++;Gt[Jt]=Ft.stackVec3[Jt];Ft.stackVec3[Jt]=null}Ft.stackVec3=Gt}Ft.stackVec3[Ft.sizeVec3++]=zt}}else{var Qt=1/Math.sqrt(a*a+4*i*i);var $t=2*i*Qt;var Kt=a*Qt;var ta=1/Math.sqrt(2*(1+$t));var aa=0;while(aa<8){var ia=aa++;var ra=this.tmpCircleNorms[ia];var oa=this.circleCoords[ia];ra.x=oa.x;ra.y=oa.y;ra.z=oa.z;var sa=ra;var na=sa.x*$t;var ea=sa.y*$t;var _a=sa.z*$t;sa.x=na;sa.y=ea;sa.z=_a;sa.y+=Kt;var va=this.tmpCircleNorms[ia];var ha=va.x*p.e00+va.y*p.e01+va.z*p.e02;var la=va.x*p.e10+va.y*p.e11+va.z*p.e12;var ca=va.x*p.e20+va.y*p.e21+va.z*p.e22;va.x=ha;va.y=la;va.z=ca;var pa=this.tmpCircleVerts1[ia];var fa=this.circleCoordsShift[ia];pa.x=fa.x;pa.y=fa.y;pa.z=fa.z;var ma=pa;var ba=ma.x*$t;var ua=ma.y*$t;var xa=ma.z*$t;ma.x=ba;ma.y=ua;ma.z=xa;ma.y+=Kt;var ya=this.tmpCircleVerts1[ia];var ga=ya.x*p.e00+ya.y*p.e01+ya.z*p.e02;var Xa=ya.x*p.e10+ya.y*p.e11+ya.z*p.e12;var za=ya.x*p.e20+ya.y*p.e21+ya.z*p.e22;ya.x=ga;ya.y=Xa;ya.z=za;var Ma=this.tmpCircleVerts2[ia];var Ya=this.circleCoords[ia];Ma.x=Ya.x;Ma.y=Ya.y;Ma.z=Ya.z;var Za=Ma;var da=Za.x*p.e00+Za.y*p.e01+Za.z*p.e02;var Ia=Za.x*p.e10+Za.y*p.e11+Za.z*p.e12;var wa=Za.x*p.e20+Za.y*p.e21+Za.z*p.e22;Za.x=da;Za.y=Ia;Za.z=wa;var Va=Za;var La=Va.x*a;var Aa=Va.y*a;var ka=Va.z*a;Va.x=La;Va.y=Aa;Va.z=ka;var Ba=Va;var Pa=Ba.x+l.x;var Ta=Ba.y+l.y;var Sa=Ba.z+l.z;Ba.x=Pa;Ba.y=Ta;Ba.z=Sa;var Ca=this.tmpCircleVerts2[ia];var qa=-i;var Ra=Ca.x+e.x*qa;var Ea=Ca.y+e.y*qa;var ja=Ca.z+e.z*qa;Ca.x=Ra;Ca.y=Ea;Ca.z=ja}var Na=0;while(Na<8){var Da=Na++;var Fa=z;var Oa=this.tmpCircleVerts2[Da];var Wa=this.tmpCircleVerts2[(Da+1)%8];var Ga=this.tmpCircleVerts1[Da];var Ha=this.tmpCircleNorms[Da];var Ua=this.tmpCircleNorms[(Da+1)%8];this.triangle(Fa,Oa,Wa,Ga,Ha,Ua,r);Fa=L;Oa=this.tmpCircleVerts2[(Da+1)%8];Wa=this.tmpCircleVerts2[Da];var Ja=this.p;var Qa=Ja.sizeVec3==0?new Is:Ja.stackVec3[--Ja.sizeVec3];Qa.x=e.x;Qa.y=e.y;Qa.z=e.z;var $a=Qa;var Ka=-$a.x;var ti=-$a.y;var ai=-$a.z;$a.x=Ka;$a.y=ti;$a.z=ai;Ga=$a;this.triangle(Fa,Oa,Wa,Ga,Ga,Ga,r);var ii=this.p;if(Ga!=null){Ga.zero();if(ii.sizeVec3==ii.stackVec3.length){var ri=ii.sizeVec3<<1;var oi=new Array(ri);var si=oi;var ni=0;var ei=ii.sizeVec3;while(ni<ei){var _i=ni++;si[_i]=ii.stackVec3[_i];ii.stackVec3[_i]=null}ii.stackVec3=si}ii.stackVec3[ii.sizeVec3++]=Ga}}}var vi=this.p;if(z!=null){z.zero();if(vi.sizeVec3==vi.stackVec3.length){var hi=vi.sizeVec3<<1;var li=new Array(hi);var ci=li;var pi=0;var fi=vi.sizeVec3;while(pi<fi){var mi=pi++;ci[mi]=vi.stackVec3[mi];vi.stackVec3[mi]=null}vi.stackVec3=ci}vi.stackVec3[vi.sizeVec3++]=z}var bi=this.p;if(L!=null){L.zero();if(bi.sizeVec3==bi.stackVec3.length){var ui=bi.sizeVec3<<1;var xi=new Array(ui);var yi=xi;var gi=0;var Xi=bi.sizeVec3;while(gi<Xi){var zi=gi++;yi[zi]=bi.stackVec3[zi];bi.stackVec3[zi]=null}bi.stackVec3=yi}bi.stackVec3[bi.sizeVec3++]=L}var Mi=this.p;if(l!=null){l.zero();if(Mi.sizeVec3==Mi.stackVec3.length){var Yi=Mi.sizeVec3<<1;var Zi=new Array(Yi);var di=Zi;var Ii=0;var wi=Mi.sizeVec3;while(Ii<wi){var Vi=Ii++;di[Vi]=Mi.stackVec3[Vi];Mi.stackVec3[Vi]=null}Mi.stackVec3=di}Mi.stackVec3[Mi.sizeVec3++]=l}var Li=this.p;if(p!=null){var Ai=1;var ki=0;var Bi=0;var Pi=0;var Ti=1;var Si=0;var Ci=0;var qi=0;var Ri=1;p.e00=Ai;p.e01=ki;p.e02=Bi;p.e10=Pi;p.e11=Ti;p.e12=Si;p.e20=Ci;p.e21=qi;p.e22=Ri;if(Li.sizeMat3==Li.stackMat3.length){var Ei=Li.sizeMat3<<1;var ji=new Array(Ei);var Ni=ji;var Di=0;var Fi=Li.sizeMat3;while(Di<Fi){var Oi=Di++;Ni[Oi]=Li.stackMat3[Oi];Li.stackMat3[Oi]=null}Li.stackMat3=Ni}Li.stackMat3[Li.sizeMat3++]=p}var Wi=this.p;if(s!=null){s.zero();if(Wi.sizeVec3==Wi.stackVec3.length){var Gi=Wi.sizeVec3<<1;var Hi=new Array(Gi);var Ui=Hi;var Ji=0;var Qi=Wi.sizeVec3;while(Ji<Qi){var $i=Ji++;Ui[$i]=Wi.stackVec3[$i];Wi.stackVec3[$i]=null}Wi.stackVec3=Ui}Wi.stackVec3[Wi.sizeVec3++]=s}var Ki=this.p;if(e!=null){e.zero();if(Ki.sizeVec3==Ki.stackVec3.length){var tr=Ki.sizeVec3<<1;var ar=new Array(tr);var ir=ar;var rr=0;var or=Ki.sizeVec3;while(rr<or){var sr=rr++;ir[sr]=Ki.stackVec3[sr];Ki.stackVec3[sr]=null}Ki.stackVec3=ir}Ki.stackVec3[Ki.sizeVec3++]=e}var nr=this.p;if(v!=null){v.zero();if(nr.sizeVec3==nr.stackVec3.length){var er=nr.sizeVec3<<1;var _r=new Array(er);var vr=_r;var hr=0;var lr=nr.sizeVec3;while(hr<lr){var cr=hr++;vr[cr]=nr.stackVec3[cr];nr.stackVec3[cr]=null}nr.stackVec3=vr}nr.stackVec3[nr.sizeVec3++]=v}},cylinder:function(t,a,i,r){var o=this.p;var s=o.sizeVec3==0?new Is:o.stackVec3[--o.sizeVec3];var n=this.p;var e=n.sizeVec3==0?new Is:n.stackVec3[--n.sizeVec3];var _=this.p;var v=_.sizeVec3==0?new Is:_.stackVec3[--_.sizeVec3];var h=this.p;var l=h.sizeVec3==0?new Is:h.stackVec3[--h.sizeVec3];var c=this.p;var p=c.sizeMat3==0?new ws:c.stackMat3[--c.sizeMat3];var f=l;f.x=t._positionX;f.y=t._positionY;f.z=t._positionZ;var m=p;m.e00=t._rotation00;m.e01=t._rotation01;m.e02=t._rotation02;m.e10=t._rotation10;m.e11=t._rotation11;m.e12=t._rotation12;m.e20=t._rotation20;m.e21=t._rotation21;m.e22=t._rotation22;s.init(p.e00,p.e10,p.e20);e.init(p.e01,p.e11,p.e21);v.init(p.e02,p.e12,p.e22);var b=this.p;var u=b.sizeVec3==0?new Is:b.stackVec3[--b.sizeVec3];u.x=l.x;u.y=l.y;u.z=l.z;var x=u;var y=x.x+e.x*i;var g=x.y+e.y*i;var X=x.z+e.z*i;x.x=y;x.y=g;x.z=X;var z=x;var M=this.p;var Y=M.sizeVec3==0?new Is:M.stackVec3[--M.sizeVec3];Y.x=l.x;Y.y=l.y;Y.z=l.z;var Z=Y;var d=-i;var I=Z.x+e.x*d;var w=Z.y+e.y*d;var V=Z.z+e.z*d;Z.x=I;Z.y=w;Z.z=V;var L=Z;if(this.wireframe){var A=this.p;var k=A.sizeVec3==0?new Is:A.stackVec3[--A.sizeVec3];k.x=z.x;k.y=z.y;k.z=z.z;var B=k;var P=-a;var T=B.x+s.x*P;var S=B.y+s.y*P;var C=B.z+s.z*P;B.x=T;B.y=S;B.z=C;var q=B;var R=q.x+v.x*0;var E=q.y+v.y*0;var j=q.z+v.z*0;q.x=R;q.y=E;q.z=j;var N=q;var D=this.p;var F=D.sizeVec3==0?new Is:D.stackVec3[--D.sizeVec3];F.x=z.x;F.y=z.y;F.z=z.z;var O=F;var W=O.x+s.x*a;var G=O.y+s.y*a;var H=O.z+s.z*a;O.x=W;O.y=G;O.z=H;var U=O;var J=U.x+v.x*0;var Q=U.y+v.y*0;var $=U.z+v.z*0;U.x=J;U.y=Q;U.z=$;var K=U;var tt=this.p;var at=tt.sizeVec3==0?new Is:tt.stackVec3[--tt.sizeVec3];at.x=z.x;at.y=z.y;at.z=z.z;var it=at;var rt=it.x+s.x*0;var ot=it.y+s.y*0;var st=it.z+s.z*0;it.x=rt;it.y=ot;it.z=st;var nt=it;var et=-a;var _t=nt.x+v.x*et;var vt=nt.y+v.y*et;var ht=nt.z+v.z*et;nt.x=_t;nt.y=vt;nt.z=ht;var lt=nt;var ct=this.p;var pt=ct.sizeVec3==0?new Is:ct.stackVec3[--ct.sizeVec3];pt.x=z.x;pt.y=z.y;pt.z=z.z;var ft=pt;var mt=ft.x+s.x*0;var bt=ft.y+s.y*0;var ut=ft.z+s.z*0;ft.x=mt;ft.y=bt;ft.z=ut;var xt=ft;var yt=xt.x+v.x*a;var gt=xt.y+v.y*a;var Xt=xt.z+v.z*a;xt.x=yt;xt.y=gt;xt.z=Xt;var zt=xt;var Mt=this.p;var Yt=Mt.sizeVec3==0?new Is:Mt.stackVec3[--Mt.sizeVec3];Yt.x=L.x;Yt.y=L.y;Yt.z=L.z;var Zt=Yt;var dt=-a;var It=Zt.x+s.x*dt;var wt=Zt.y+s.y*dt;var Vt=Zt.z+s.z*dt;Zt.x=It;Zt.y=wt;Zt.z=Vt;var Lt=Zt;var At=Lt.x+v.x*0;var kt=Lt.y+v.y*0;var Bt=Lt.z+v.z*0;Lt.x=At;Lt.y=kt;Lt.z=Bt;var Pt=Lt;var Tt=this.p;var St=Tt.sizeVec3==0?new Is:Tt.stackVec3[--Tt.sizeVec3];St.x=L.x;St.y=L.y;St.z=L.z;var Ct=St;var qt=Ct.x+s.x*a;var Rt=Ct.y+s.y*a;var Et=Ct.z+s.z*a;Ct.x=qt;Ct.y=Rt;Ct.z=Et;var jt=Ct;var Nt=jt.x+v.x*0;var Dt=jt.y+v.y*0;var Ft=jt.z+v.z*0;jt.x=Nt;jt.y=Dt;jt.z=Ft;var Ot=jt;var Wt=this.p;var Gt=Wt.sizeVec3==0?new Is:Wt.stackVec3[--Wt.sizeVec3];Gt.x=L.x;Gt.y=L.y;Gt.z=L.z;var Ht=Gt;var Ut=Ht.x+s.x*0;var Jt=Ht.y+s.y*0;var Qt=Ht.z+s.z*0;Ht.x=Ut;Ht.y=Jt;Ht.z=Qt;var $t=Ht;var Kt=-a;var ta=$t.x+v.x*Kt;var aa=$t.y+v.y*Kt;var ia=$t.z+v.z*Kt;$t.x=ta;$t.y=aa;$t.z=ia;var ra=$t;var oa=this.p;var sa=oa.sizeVec3==0?new Is:oa.stackVec3[--oa.sizeVec3];sa.x=L.x;sa.y=L.y;sa.z=L.z;var na=sa;var ea=na.x+s.x*0;var _a=na.y+s.y*0;var va=na.z+s.z*0;na.x=ea;na.y=_a;na.z=va;var ha=na;var la=ha.x+v.x*a;var ca=ha.y+v.y*a;var pa=ha.z+v.z*a;ha.x=la;ha.y=ca;ha.z=pa;var fa=ha;this.ellipse(z,s,v,a,a,r);this.ellipse(L,s,v,a,a,r);this.line(N,Pt,r);this.line(K,Ot,r);this.line(lt,ra,r);this.line(zt,fa,r);var ma=this.p;if(N!=null){N.zero();if(ma.sizeVec3==ma.stackVec3.length){var ba=ma.sizeVec3<<1;var ua=new Array(ba);var xa=ua;var ya=0;var ga=ma.sizeVec3;while(ya<ga){var Xa=ya++;xa[Xa]=ma.stackVec3[Xa];ma.stackVec3[Xa]=null}ma.stackVec3=xa}ma.stackVec3[ma.sizeVec3++]=N}var za=this.p;if(K!=null){K.zero();if(za.sizeVec3==za.stackVec3.length){var Ma=za.sizeVec3<<1;var Ya=new Array(Ma);var Za=Ya;var da=0;var Ia=za.sizeVec3;while(da<Ia){var wa=da++;Za[wa]=za.stackVec3[wa];za.stackVec3[wa]=null}za.stackVec3=Za}za.stackVec3[za.sizeVec3++]=K}var Va=this.p;if(lt!=null){lt.zero();if(Va.sizeVec3==Va.stackVec3.length){var La=Va.sizeVec3<<1;var Aa=new Array(La);var ka=Aa;var Ba=0;var Pa=Va.sizeVec3;while(Ba<Pa){var Ta=Ba++;ka[Ta]=Va.stackVec3[Ta];Va.stackVec3[Ta]=null}Va.stackVec3=ka}Va.stackVec3[Va.sizeVec3++]=lt}var Sa=this.p;if(zt!=null){zt.zero();if(Sa.sizeVec3==Sa.stackVec3.length){var Ca=Sa.sizeVec3<<1;var qa=new Array(Ca);var Ra=qa;var Ea=0;var ja=Sa.sizeVec3;while(Ea<ja){var Na=Ea++;Ra[Na]=Sa.stackVec3[Na];Sa.stackVec3[Na]=null}Sa.stackVec3=Ra}Sa.stackVec3[Sa.sizeVec3++]=zt}var Da=this.p;if(Pt!=null){Pt.zero();if(Da.sizeVec3==Da.stackVec3.length){var Fa=Da.sizeVec3<<1;var Oa=new Array(Fa);var Wa=Oa;var Ga=0;var Ha=Da.sizeVec3;while(Ga<Ha){var Ua=Ga++;Wa[Ua]=Da.stackVec3[Ua];Da.stackVec3[Ua]=null}Da.stackVec3=Wa}Da.stackVec3[Da.sizeVec3++]=Pt}var Ja=this.p;if(Ot!=null){Ot.zero();if(Ja.sizeVec3==Ja.stackVec3.length){var Qa=Ja.sizeVec3<<1;var $a=new Array(Qa);var Ka=$a;var ti=0;var ai=Ja.sizeVec3;while(ti<ai){var ii=ti++;Ka[ii]=Ja.stackVec3[ii];Ja.stackVec3[ii]=null}Ja.stackVec3=Ka}Ja.stackVec3[Ja.sizeVec3++]=Ot}var ri=this.p;if(ra!=null){ra.zero();if(ri.sizeVec3==ri.stackVec3.length){var oi=ri.sizeVec3<<1;var si=new Array(oi);var ni=si;var ei=0;var _i=ri.sizeVec3;while(ei<_i){var vi=ei++;ni[vi]=ri.stackVec3[vi];ri.stackVec3[vi]=null}ri.stackVec3=ni}ri.stackVec3[ri.sizeVec3++]=ra}var hi=this.p;if(fa!=null){fa.zero();if(hi.sizeVec3==hi.stackVec3.length){var li=hi.sizeVec3<<1;var ci=new Array(li);var pi=ci;var fi=0;var mi=hi.sizeVec3;while(fi<mi){var bi=fi++;pi[bi]=hi.stackVec3[bi];hi.stackVec3[bi]=null}hi.stackVec3=pi}hi.stackVec3[hi.sizeVec3++]=fa}}else{var ui=0;while(ui<8){var xi=ui++;var yi=this.tmpCircleNorms[xi];var gi=this.circleCoords[xi];yi.x=gi.x;yi.y=gi.y;yi.z=gi.z;var Xi=yi;var zi=Xi.x*p.e00+Xi.y*p.e01+Xi.z*p.e02;var Mi=Xi.x*p.e10+Xi.y*p.e11+Xi.z*p.e12;var Yi=Xi.x*p.e20+Xi.y*p.e21+Xi.z*p.e22;Xi.x=zi;Xi.y=Mi;Xi.z=Yi;var Zi=this.tmpCircleVerts1[xi];var di=this.tmpCircleNorms[xi];Zi.x=di.x;Zi.y=di.y;Zi.z=di.z;var Ii=Zi;var wi=Ii.x*a;var Vi=Ii.y*a;var Li=Ii.z*a;Ii.x=wi;Ii.y=Vi;Ii.z=Li;var Ai=Ii;var ki=Ai.x+l.x;var Bi=Ai.y+l.y;var Pi=Ai.z+l.z;Ai.x=ki;Ai.y=Bi;Ai.z=Pi;var Ti=this.tmpCircleVerts2[xi];var Si=this.tmpCircleVerts1[xi];Ti.x=Si.x;Ti.y=Si.y;Ti.z=Si.z;var Ci=this.tmpCircleVerts1[xi];var qi=Ci.x+e.x*i;var Ri=Ci.y+e.y*i;var Ei=Ci.z+e.z*i;Ci.x=qi;Ci.y=Ri;Ci.z=Ei;var ji=this.tmpCircleVerts2[xi];var Ni=-i;var Di=ji.x+e.x*Ni;var Fi=ji.y+e.y*Ni;var Oi=ji.z+e.z*Ni;ji.x=Di;ji.y=Fi;ji.z=Oi}var Wi=0;while(Wi<8){var Gi=Wi++;var Hi;var Ui;var Ji=z;var Qi=this.tmpCircleVerts1[Gi];var $i=this.tmpCircleVerts1[(Gi+1)%8];var Ki=e;this.triangle(Ji,Qi,$i,Ki,Ki,Ki,r);Ji=L;Qi=this.tmpCircleVerts2[(Gi+1)%8];$i=this.tmpCircleVerts2[Gi];var tr=this.p;var ar=tr.sizeVec3==0?new Is:tr.stackVec3[--tr.sizeVec3];ar.x=e.x;ar.y=e.y;ar.z=e.z;var ir=ar;var rr=-ir.x;var or=-ir.y;var sr=-ir.z;ir.x=rr;ir.y=or;ir.z=sr;Ki=ir;this.triangle(Ji,Qi,$i,Ki,Ki,Ki,r);var nr=this.p;if(Ki!=null){Ki.zero();if(nr.sizeVec3==nr.stackVec3.length){var er=nr.sizeVec3<<1;var _r=new Array(er);var vr=_r;var hr=0;var lr=nr.sizeVec3;while(hr<lr){var cr=hr++;vr[cr]=nr.stackVec3[cr];nr.stackVec3[cr]=null}nr.stackVec3=vr}nr.stackVec3[nr.sizeVec3++]=Ki}Ji=this.tmpCircleVerts1[Gi];Qi=this.tmpCircleVerts2[Gi];$i=this.tmpCircleVerts2[(Gi+1)%8];var pr=this.tmpCircleVerts1[(Gi+1)%8];Ki=this.tmpCircleNorms[Gi];var fr=this.tmpCircleNorms[(Gi+1)%8];this.rect(Ji,Qi,$i,pr,Ki,Ki,fr,fr,r)}}var mr=this.p;if(z!=null){z.zero();if(mr.sizeVec3==mr.stackVec3.length){var br=mr.sizeVec3<<1;var ur=new Array(br);var xr=ur;var yr=0;var gr=mr.sizeVec3;while(yr<gr){var Xr=yr++;xr[Xr]=mr.stackVec3[Xr];mr.stackVec3[Xr]=null}mr.stackVec3=xr}mr.stackVec3[mr.sizeVec3++]=z}var zr=this.p;if(L!=null){L.zero();if(zr.sizeVec3==zr.stackVec3.length){var Mr=zr.sizeVec3<<1;var Yr=new Array(Mr);var Zr=Yr;var dr=0;var Ir=zr.sizeVec3;while(dr<Ir){var wr=dr++;Zr[wr]=zr.stackVec3[wr];zr.stackVec3[wr]=null}zr.stackVec3=Zr}zr.stackVec3[zr.sizeVec3++]=L}var Vr=this.p;if(l!=null){l.zero();if(Vr.sizeVec3==Vr.stackVec3.length){var Lr=Vr.sizeVec3<<1;var Ar=new Array(Lr);var kr=Ar;var Br=0;var Pr=Vr.sizeVec3;while(Br<Pr){var Tr=Br++;kr[Tr]=Vr.stackVec3[Tr];Vr.stackVec3[Tr]=null}Vr.stackVec3=kr}Vr.stackVec3[Vr.sizeVec3++]=l}var Sr=this.p;if(p!=null){var Cr=1;var qr=0;var Rr=0;var Er=0;var jr=1;var Nr=0;var Dr=0;var Fr=0;var Or=1;p.e00=Cr;p.e01=qr;p.e02=Rr;p.e10=Er;p.e11=jr;p.e12=Nr;p.e20=Dr;p.e21=Fr;p.e22=Or;if(Sr.sizeMat3==Sr.stackMat3.length){var Wr=Sr.sizeMat3<<1;var Gr=new Array(Wr);var Hr=Gr;var Ur=0;var Jr=Sr.sizeMat3;while(Ur<Jr){var Qr=Ur++;Hr[Qr]=Sr.stackMat3[Qr];Sr.stackMat3[Qr]=null}Sr.stackMat3=Hr}Sr.stackMat3[Sr.sizeMat3++]=p}var $r=this.p;if(s!=null){s.zero();if($r.sizeVec3==$r.stackVec3.length){var Kr=$r.sizeVec3<<1;var to=new Array(Kr);var ao=to;var io=0;var ro=$r.sizeVec3;while(io<ro){var oo=io++;ao[oo]=$r.stackVec3[oo];$r.stackVec3[oo]=null}$r.stackVec3=ao}$r.stackVec3[$r.sizeVec3++]=s}var so=this.p;if(e!=null){e.zero();if(so.sizeVec3==so.stackVec3.length){var no=so.sizeVec3<<1;var eo=new Array(no);var _o=eo;var vo=0;var ho=so.sizeVec3;while(vo<ho){var lo=vo++;_o[lo]=so.stackVec3[lo];so.stackVec3[lo]=null}so.stackVec3=_o}so.stackVec3[so.sizeVec3++]=e}var co=this.p;if(v!=null){v.zero();if(co.sizeVec3==co.stackVec3.length){var po=co.sizeVec3<<1;var fo=new Array(po);var mo=fo;var bo=0;var uo=co.sizeVec3;while(bo<uo){var xo=bo++;mo[xo]=co.stackVec3[xo];co.stackVec3[xo]=null}co.stackVec3=mo}co.stackVec3[co.sizeVec3++]=v}},capsule:function(t,a,i,r){var o=this.p;var s=o.sizeVec3==0?new Is:o.stackVec3[--o.sizeVec3];var n=this.p;var e=n.sizeVec3==0?new Is:n.stackVec3[--n.sizeVec3];var _=this.p;var v=_.sizeVec3==0?new Is:_.stackVec3[--_.sizeVec3];var h=this.p;var l=h.sizeVec3==0?new Is:h.stackVec3[--h.sizeVec3];var c=this.p;var p=c.sizeMat3==0?new ws:c.stackMat3[--c.sizeMat3];var f=l;f.x=t._positionX;f.y=t._positionY;f.z=t._positionZ;var m=p;m.e00=t._rotation00;m.e01=t._rotation01;m.e02=t._rotation02;m.e10=t._rotation10;m.e11=t._rotation11;m.e12=t._rotation12;m.e20=t._rotation20;m.e21=t._rotation21;m.e22=t._rotation22;s.init(p.e00,p.e10,p.e20);e.init(p.e01,p.e11,p.e21);v.init(p.e02,p.e12,p.e22);var b=4;var u=8;var x=this.tmpSphereVerts;var y=this.tmpSphereNorms;var g=0;var X=b+1;while(g<X){var z=g++;var M=this.tmpSphereVerts[z].length;var Y=0;var Z=M;while(Y<Z){var d=Y++;var I=y[z][d];var w=this.sphereCoords[z][d];I.x=w.x;I.y=w.y;I.z=w.z;var V=I;var L=V.x*p.e00+V.y*p.e01+V.z*p.e02;var A=V.x*p.e10+V.y*p.e11+V.z*p.e12;var k=V.x*p.e20+V.y*p.e21+V.z*p.e22;V.x=L;V.y=A;V.z=k}}var B=0;var P=b;while(B<P){var T=B++;if(T==0){var S=b>>1;var C=0;var q=S+1;while(C<q){var R=C++;var E=this.tmpSphereVerts[R].length;var j=0;var N=E;while(j<N){var D=j++;var F=x[R][D];var O=y[R][D];F.x=O.x;F.y=O.y;F.z=O.z;var W=F;var G=W.x*a;var H=W.y*a;var U=W.z*a;W.x=G;W.y=H;W.z=U;var J=W;var Q=J.x+l.x;var $=J.y+l.y;var K=J.z+l.z;J.x=Q;J.y=$;J.z=K;var tt=J;var at=tt.x+e.x*i;var it=tt.y+e.y*i;var rt=tt.z+e.z*i;tt.x=at;tt.y=it;tt.z=rt}}}if(T==b>>1){var ot=b>>1;var st=ot;var nt=b+1;while(st<nt){var et=st++;var _t=this.tmpSphereVerts[et].length;var vt=0;var ht=_t;while(vt<ht){var lt=vt++;var ct=x[et][lt];var pt=y[et][lt];ct.x=pt.x;ct.y=pt.y;ct.z=pt.z;var ft=ct;var mt=ft.x*a;var bt=ft.y*a;var ut=ft.z*a;ft.x=mt;ft.y=bt;ft.z=ut;var xt=ft;var yt=xt.x+l.x;var gt=xt.y+l.y;var Xt=xt.z+l.z;xt.x=yt;xt.y=gt;xt.z=Xt;var zt=xt;var Mt=-i;var Yt=zt.x+e.x*Mt;var Zt=zt.y+e.y*Mt;var dt=zt.z+e.z*Mt;zt.x=Yt;zt.y=Zt;zt.z=dt}}}var It=0;var wt=u;while(It<wt){var Vt=It++;var Lt;var At;var kt;var Bt;var Pt;var Tt;var St;var Ct;if(T==0){if(this.wireframe){Lt=x[0][0];At=x[1][Vt];this.line(Lt,At,r)}else{Lt=x[0][0];At=x[1][Vt];kt=x[1][(Vt+1)%u];Pt=y[0][0];Tt=y[1][Vt];St=y[1][(Vt+1)%u];this.triangle(Lt,At,kt,Pt,Tt,St,r)}}else if(T==b-1){if(this.wireframe){Lt=x[b][0];At=x[T][(Vt+1)%u];kt=x[T][Vt];this.line(Lt,At,r);this.line(At,kt,r)}else{Lt=x[b][0];At=x[T][(Vt+1)%u];kt=x[T][Vt];Pt=y[b][0];Tt=y[T][(Vt+1)%u];St=y[T][Vt];this.triangle(Lt,At,kt,Pt,Tt,St,r)}}else if(this.wireframe){Lt=x[T][Vt];At=x[T][(Vt+1)%u];kt=x[T+1][Vt];this.line(Lt,At,r);this.line(Lt,kt,r)}else{Lt=x[T][Vt];At=x[T][(Vt+1)%u];kt=x[T+1][Vt];Bt=x[T+1][(Vt+1)%u];Pt=y[T][Vt];Tt=y[T][(Vt+1)%u];St=y[T+1][Vt];Ct=y[T+1][(Vt+1)%u];this.rect(Lt,kt,Bt,At,Pt,St,Ct,Tt,r)}}}var qt=this.p;var Rt=qt.sizeVec3==0?new Is:qt.stackVec3[--qt.sizeVec3];Rt.x=l.x;Rt.y=l.y;Rt.z=l.z;var Et=Rt;var jt=Et.x+e.x*i;var Nt=Et.y+e.y*i;var Dt=Et.z+e.z*i;Et.x=jt;Et.y=Nt;Et.z=Dt;var Ft=Et;var Ot=this.p;var Wt=Ot.sizeVec3==0?new Is:Ot.stackVec3[--Ot.sizeVec3];Wt.x=l.x;Wt.y=l.y;Wt.z=l.z;var Gt=Wt;var Ht=-i;var Ut=Gt.x+e.x*Ht;var Jt=Gt.y+e.y*Ht;var Qt=Gt.z+e.z*Ht;Gt.x=Ut;Gt.y=Jt;Gt.z=Qt;var $t=Gt;if(this.wireframe){var Kt=this.p;var ta=Kt.sizeVec3==0?new Is:Kt.stackVec3[--Kt.sizeVec3];ta.x=Ft.x;ta.y=Ft.y;ta.z=Ft.z;var aa=ta;var ia=-a;var ra=aa.x+s.x*ia;var oa=aa.y+s.y*ia;var sa=aa.z+s.z*ia;aa.x=ra;aa.y=oa;aa.z=sa;var na=aa;var ea=na.x+v.x*0;var _a=na.y+v.y*0;var va=na.z+v.z*0;na.x=ea;na.y=_a;na.z=va;var ha=na;var la=this.p;var ca=la.sizeVec3==0?new Is:la.stackVec3[--la.sizeVec3];ca.x=Ft.x;ca.y=Ft.y;ca.z=Ft.z;var pa=ca;var fa=pa.x+s.x*a;var ma=pa.y+s.y*a;var ba=pa.z+s.z*a;pa.x=fa;pa.y=ma;pa.z=ba;var ua=pa;var xa=ua.x+v.x*0;var ya=ua.y+v.y*0;var ga=ua.z+v.z*0;ua.x=xa;ua.y=ya;ua.z=ga;var Xa=ua;var za=this.p;var Ma=za.sizeVec3==0?new Is:za.stackVec3[--za.sizeVec3];Ma.x=Ft.x;Ma.y=Ft.y;Ma.z=Ft.z;var Ya=Ma;var Za=Ya.x+s.x*0;var da=Ya.y+s.y*0;var Ia=Ya.z+s.z*0;Ya.x=Za;Ya.y=da;Ya.z=Ia;var wa=Ya;var Va=-a;var La=wa.x+v.x*Va;var Aa=wa.y+v.y*Va;var ka=wa.z+v.z*Va;wa.x=La;wa.y=Aa;wa.z=ka;var Ba=wa;var Pa=this.p;var Ta=Pa.sizeVec3==0?new Is:Pa.stackVec3[--Pa.sizeVec3];Ta.x=Ft.x;Ta.y=Ft.y;Ta.z=Ft.z;var Sa=Ta;var Ca=Sa.x+s.x*0;var qa=Sa.y+s.y*0;var Ra=Sa.z+s.z*0;Sa.x=Ca;Sa.y=qa;Sa.z=Ra;var Ea=Sa;var ja=Ea.x+v.x*a;var Na=Ea.y+v.y*a;var Da=Ea.z+v.z*a;Ea.x=ja;Ea.y=Na;Ea.z=Da;var Fa=Ea;var Oa=this.p;var Wa=Oa.sizeVec3==0?new Is:Oa.stackVec3[--Oa.sizeVec3];Wa.x=$t.x;Wa.y=$t.y;Wa.z=$t.z;var Ga=Wa;var Ha=-a;var Ua=Ga.x+s.x*Ha;var Ja=Ga.y+s.y*Ha;var Qa=Ga.z+s.z*Ha;Ga.x=Ua;Ga.y=Ja;Ga.z=Qa;var $a=Ga;var Ka=$a.x+v.x*0;var ti=$a.y+v.y*0;var ai=$a.z+v.z*0;$a.x=Ka;$a.y=ti;$a.z=ai;var ii=$a;var ri=this.p;var oi=ri.sizeVec3==0?new Is:ri.stackVec3[--ri.sizeVec3];oi.x=$t.x;oi.y=$t.y;oi.z=$t.z;var si=oi;var ni=si.x+s.x*a;var ei=si.y+s.y*a;var _i=si.z+s.z*a;si.x=ni;si.y=ei;si.z=_i;var vi=si;var hi=vi.x+v.x*0;var li=vi.y+v.y*0;var ci=vi.z+v.z*0;vi.x=hi;vi.y=li;vi.z=ci;var pi=vi;var fi=this.p;var mi=fi.sizeVec3==0?new Is:fi.stackVec3[--fi.sizeVec3];mi.x=$t.x;mi.y=$t.y;mi.z=$t.z;var bi=mi;var ui=bi.x+s.x*0;var xi=bi.y+s.y*0;var yi=bi.z+s.z*0;bi.x=ui;bi.y=xi;bi.z=yi;var gi=bi;var Xi=-a;var zi=gi.x+v.x*Xi;var Mi=gi.y+v.y*Xi;var Yi=gi.z+v.z*Xi;gi.x=zi;gi.y=Mi;gi.z=Yi;var Zi=gi;var di=this.p;var Ii=di.sizeVec3==0?new Is:di.stackVec3[--di.sizeVec3];Ii.x=$t.x;Ii.y=$t.y;Ii.z=$t.z;var wi=Ii;var Vi=wi.x+s.x*0;var Li=wi.y+s.y*0;var Ai=wi.z+s.z*0;wi.x=Vi;wi.y=Li;wi.z=Ai;var ki=wi;var Bi=ki.x+v.x*a;var Pi=ki.y+v.y*a;var Ti=ki.z+v.z*a;ki.x=Bi;ki.y=Pi;ki.z=Ti;var Si=ki;this.ellipse(Ft,s,v,a,a,r);this.ellipse($t,s,v,a,a,r);this.line(ha,ii,r);this.line(Xa,pi,r);this.line(Ba,Zi,r);this.line(Fa,Si,r);var Ci=this.p;if(ha!=null){ha.zero();if(Ci.sizeVec3==Ci.stackVec3.length){var qi=Ci.sizeVec3<<1;var Ri=new Array(qi);var Ei=Ri;var ji=0;var Ni=Ci.sizeVec3;while(ji<Ni){var Di=ji++;Ei[Di]=Ci.stackVec3[Di];Ci.stackVec3[Di]=null}Ci.stackVec3=Ei}Ci.stackVec3[Ci.sizeVec3++]=ha}var Fi=this.p;if(Xa!=null){Xa.zero();if(Fi.sizeVec3==Fi.stackVec3.length){var Oi=Fi.sizeVec3<<1;var Wi=new Array(Oi);var Gi=Wi;var Hi=0;var Ui=Fi.sizeVec3;while(Hi<Ui){var Ji=Hi++;Gi[Ji]=Fi.stackVec3[Ji];Fi.stackVec3[Ji]=null}Fi.stackVec3=Gi}Fi.stackVec3[Fi.sizeVec3++]=Xa}var Qi=this.p;if(Ba!=null){Ba.zero();if(Qi.sizeVec3==Qi.stackVec3.length){var $i=Qi.sizeVec3<<1;var Ki=new Array($i);var tr=Ki;var ar=0;var ir=Qi.sizeVec3;while(ar<ir){var rr=ar++;tr[rr]=Qi.stackVec3[rr];Qi.stackVec3[rr]=null}Qi.stackVec3=tr}Qi.stackVec3[Qi.sizeVec3++]=Ba}var or=this.p;if(Fa!=null){Fa.zero();if(or.sizeVec3==or.stackVec3.length){var sr=or.sizeVec3<<1;var nr=new Array(sr);var er=nr;var _r=0;var vr=or.sizeVec3;while(_r<vr){var hr=_r++;er[hr]=or.stackVec3[hr];or.stackVec3[hr]=null}or.stackVec3=er}or.stackVec3[or.sizeVec3++]=Fa}var lr=this.p;if(ii!=null){ii.zero();if(lr.sizeVec3==lr.stackVec3.length){var cr=lr.sizeVec3<<1;var pr=new Array(cr);var fr=pr;var mr=0;var br=lr.sizeVec3;while(mr<br){var ur=mr++;fr[ur]=lr.stackVec3[ur];lr.stackVec3[ur]=null}lr.stackVec3=fr}lr.stackVec3[lr.sizeVec3++]=ii}var xr=this.p;if(pi!=null){pi.zero();if(xr.sizeVec3==xr.stackVec3.length){var yr=xr.sizeVec3<<1;var gr=new Array(yr);var Xr=gr;var zr=0;var Mr=xr.sizeVec3;while(zr<Mr){var Yr=zr++;Xr[Yr]=xr.stackVec3[Yr];xr.stackVec3[Yr]=null}xr.stackVec3=Xr}xr.stackVec3[xr.sizeVec3++]=pi}var Zr=this.p;if(Zi!=null){Zi.zero();if(Zr.sizeVec3==Zr.stackVec3.length){var dr=Zr.sizeVec3<<1;var Ir=new Array(dr);var wr=Ir;var Vr=0;var Lr=Zr.sizeVec3;while(Vr<Lr){var Ar=Vr++;wr[Ar]=Zr.stackVec3[Ar];Zr.stackVec3[Ar]=null}Zr.stackVec3=wr}Zr.stackVec3[Zr.sizeVec3++]=Zi}var kr=this.p;if(Si!=null){Si.zero();if(kr.sizeVec3==kr.stackVec3.length){var Br=kr.sizeVec3<<1;var Pr=new Array(Br);var Tr=Pr;var Sr=0;var Cr=kr.sizeVec3;while(Sr<Cr){var qr=Sr++;Tr[qr]=kr.stackVec3[qr];kr.stackVec3[qr]=null}kr.stackVec3=Tr}kr.stackVec3[kr.sizeVec3++]=Si}}else{var Rr=0;while(Rr<8){var Er=Rr++;var jr=this.tmpCircleNorms[Er];var Nr=this.circleCoords[Er];jr.x=Nr.x;jr.y=Nr.y;jr.z=Nr.z;var Dr=jr;var Fr=Dr.x*p.e00+Dr.y*p.e01+Dr.z*p.e02;var Or=Dr.x*p.e10+Dr.y*p.e11+Dr.z*p.e12;var Wr=Dr.x*p.e20+Dr.y*p.e21+Dr.z*p.e22;Dr.x=Fr;Dr.y=Or;Dr.z=Wr;var Gr=this.tmpCircleVerts1[Er];var Hr=this.tmpCircleNorms[Er];Gr.x=Hr.x;Gr.y=Hr.y;Gr.z=Hr.z;var Ur=Gr;var Jr=Ur.x*a;var Qr=Ur.y*a;var $r=Ur.z*a;Ur.x=Jr;Ur.y=Qr;Ur.z=$r;var Kr=Ur;var to=Kr.x+l.x;var ao=Kr.y+l.y;var io=Kr.z+l.z;Kr.x=to;Kr.y=ao;Kr.z=io;var ro=this.tmpCircleVerts2[Er];var oo=this.tmpCircleVerts1[Er];ro.x=oo.x;ro.y=oo.y;ro.z=oo.z;var so=this.tmpCircleVerts1[Er];var no=so.x+e.x*i;var eo=so.y+e.y*i;var _o=so.z+e.z*i;so.x=no;so.y=eo;so.z=_o;var vo=this.tmpCircleVerts2[Er];var ho=-i;var lo=vo.x+e.x*ho;var co=vo.y+e.y*ho;var po=vo.z+e.z*ho;vo.x=lo;vo.y=co;vo.z=po}var fo=0;while(fo<8){var mo=fo++;var bo=this.tmpCircleVerts1[mo];var uo=this.tmpCircleVerts2[mo];var xo=this.tmpCircleVerts2[(mo+1)%8];var yo=this.tmpCircleVerts1[(mo+1)%8];var go=this.tmpCircleNorms[mo];var Xo=this.tmpCircleNorms[(mo+1)%8];this.rect(bo,uo,xo,yo,go,go,Xo,Xo,r)}}var zo=this.p;if(Ft!=null){Ft.zero();if(zo.sizeVec3==zo.stackVec3.length){var Mo=zo.sizeVec3<<1;var Yo=new Array(Mo);var Zo=Yo;var Io=0;var wo=zo.sizeVec3;while(Io<wo){var Vo=Io++;Zo[Vo]=zo.stackVec3[Vo];zo.stackVec3[Vo]=null}zo.stackVec3=Zo}zo.stackVec3[zo.sizeVec3++]=Ft}var Lo=this.p;if($t!=null){$t.zero();if(Lo.sizeVec3==Lo.stackVec3.length){var Ao=Lo.sizeVec3<<1;var ko=new Array(Ao);var Bo=ko;var Po=0;var To=Lo.sizeVec3;while(Po<To){var So=Po++;Bo[So]=Lo.stackVec3[So];Lo.stackVec3[So]=null}Lo.stackVec3=Bo}Lo.stackVec3[Lo.sizeVec3++]=$t}var Co=this.p;if(l!=null){l.zero();if(Co.sizeVec3==Co.stackVec3.length){var qo=Co.sizeVec3<<1;var Ro=new Array(qo);var Eo=Ro;var jo=0;var No=Co.sizeVec3;while(jo<No){var Do=jo++;Eo[Do]=Co.stackVec3[Do];Co.stackVec3[Do]=null}Co.stackVec3=Eo}Co.stackVec3[Co.sizeVec3++]=l}var Fo=this.p;if(p!=null){var Oo=1;var Wo=0;var Go=0;var Ho=0;var Uo=1;var Jo=0;var Qo=0;var $o=0;var Ko=1;p.e00=Oo;p.e01=Wo;p.e02=Go;p.e10=Ho;p.e11=Uo;p.e12=Jo;p.e20=Qo;p.e21=$o;p.e22=Ko;if(Fo.sizeMat3==Fo.stackMat3.length){var ts=Fo.sizeMat3<<1;var as=new Array(ts);var is=as;var rs=0;var os=Fo.sizeMat3;while(rs<os){var ss=rs++;is[ss]=Fo.stackMat3[ss];Fo.stackMat3[ss]=null}Fo.stackMat3=is}Fo.stackMat3[Fo.sizeMat3++]=p}var ns=this.p;if(s!=null){s.zero();if(ns.sizeVec3==ns.stackVec3.length){var es=ns.sizeVec3<<1;var _s=new Array(es);var vs=_s;var hs=0;var ls=ns.sizeVec3;while(hs<ls){var cs=hs++;vs[cs]=ns.stackVec3[cs];ns.stackVec3[cs]=null}ns.stackVec3=vs}ns.stackVec3[ns.sizeVec3++]=s}var ps=this.p;if(e!=null){e.zero();if(ps.sizeVec3==ps.stackVec3.length){var fs=ps.sizeVec3<<1;var ms=new Array(fs);var bs=ms;var us=0;var xs=ps.sizeVec3;while(us<xs){var ys=us++;bs[ys]=ps.stackVec3[ys];ps.stackVec3[ys]=null}ps.stackVec3=bs}ps.stackVec3[ps.sizeVec3++]=e}var gs=this.p;if(v!=null){v.zero();if(gs.sizeVec3==gs.stackVec3.length){var Xs=gs.sizeVec3<<1;var zs=new Array(Xs);var Ms=zs;var Ys=0;var Zs=gs.sizeVec3;while(Ys<Zs){var ds=Ys++;Ms[ds]=gs.stackVec3[ds];gs.stackVec3[ds]=null}gs.stackVec3=Ms}gs.stackVec3[gs.sizeVec3++]=v}},sphere:function(t,a,i){var r=this.p;var o=r.sizeVec3==0?new Is:r.stackVec3[--r.sizeVec3];var s=this.p;var n=s.sizeMat3==0?new ws:s.stackMat3[--s.sizeMat3];var e=o;e.x=t._positionX;e.y=t._positionY;e.z=t._positionZ;var _=n;_.e00=t._rotation00;_.e01=t._rotation01;_.e02=t._rotation02;_.e10=t._rotation10;_.e11=t._rotation11;_.e12=t._rotation12;_.e20=t._rotation20;_.e21=t._rotation21;_.e22=t._rotation22;var v=4;var h=8;var l=this.tmpSphereVerts;var c=this.tmpSphereNorms;var p=0;var f=v+1;while(p<f){var m=p++;var b=this.tmpSphereVerts[m].length;var u=0;var x=b;while(u<x){var y=u++;var g=c[m][y];var X=this.sphereCoords[m][y];g.x=X.x;g.y=X.y;g.z=X.z;var z=g;var M=z.x*n.e00+z.y*n.e01+z.z*n.e02;var Y=z.x*n.e10+z.y*n.e11+z.z*n.e12;var Z=z.x*n.e20+z.y*n.e21+z.z*n.e22;z.x=M;z.y=Y;z.z=Z;var d=l[m][y];var I=c[m][y];d.x=I.x;d.y=I.y;d.z=I.z;var w=d;var V=w.x*a;var L=w.y*a;var A=w.z*a;w.x=V;w.y=L;w.z=A;var k=w;var B=k.x+o.x;var P=k.y+o.y;var T=k.z+o.z;k.x=B;k.y=P;k.z=T}}var S=0;var C=v;while(S<C){var q=S++;var R=0;var E=h;while(R<E){var j=R++;var N;var D;var F;var O;var W;var G;var H;var U;if(q==0){if(this.wireframe){N=l[0][0];D=l[1][j];this.line(N,D,i)}else{N=l[0][0];D=l[1][j];F=l[1][(j+1)%h];W=c[0][0];G=c[1][j];H=c[1][(j+1)%h];this.triangle(N,D,F,W,G,H,i)}}else if(q==v-1){if(this.wireframe){N=l[v][0];D=l[q][(j+1)%h];F=l[q][j];this.line(N,D,i);this.line(D,F,i)}else{N=l[v][0];D=l[q][(j+1)%h];F=l[q][j];W=c[v][0];G=c[q][(j+1)%h];H=c[q][j];this.triangle(N,D,F,W,G,H,i)}}else if(this.wireframe){N=l[q][j];D=l[q][(j+1)%h];F=l[q+1][j];this.line(N,D,i);this.line(N,F,i)}else{N=l[q][j];D=l[q][(j+1)%h];F=l[q+1][j];O=l[q+1][(j+1)%h];W=c[q][j];G=c[q][(j+1)%h];H=c[q+1][j];U=c[q+1][(j+1)%h];this.rect(N,F,O,D,W,H,U,G,i)}}}var J=this.p;if(o!=null){o.zero();if(J.sizeVec3==J.stackVec3.length){var Q=J.sizeVec3<<1;var $=new Array(Q);var K=$;var tt=0;var at=J.sizeVec3;while(tt<at){var it=tt++;K[it]=J.stackVec3[it];J.stackVec3[it]=null}J.stackVec3=K}J.stackVec3[J.sizeVec3++]=o}var rt=this.p;if(n!=null){var ot=1;var st=0;var nt=0;var et=0;var _t=1;var vt=0;var ht=0;var lt=0;var ct=1;n.e00=ot;n.e01=st;n.e02=nt;n.e10=et;n.e11=_t;n.e12=vt;n.e20=ht;n.e21=lt;n.e22=ct;if(rt.sizeMat3==rt.stackMat3.length){var pt=rt.sizeMat3<<1;var ft=new Array(pt);var mt=ft;var bt=0;var ut=rt.sizeMat3;while(bt<ut){var xt=bt++;mt[xt]=rt.stackMat3[xt];rt.stackMat3[xt]=null}rt.stackMat3=mt}rt.stackMat3[rt.sizeMat3++]=n}},box:function(t,a,i){var r=this.p;var o=r.sizeVec3==0?new Is:r.stackVec3[--r.sizeVec3];var s=this.p;var n=s.sizeVec3==0?new Is:s.stackVec3[--s.sizeVec3];var e=this.p;var _=e.sizeVec3==0?new Is:e.stackVec3[--e.sizeVec3];var v=this.p;var h=v.sizeVec3==0?new Is:v.stackVec3[--v.sizeVec3];var l=this.p;var c=l.sizeMat3==0?new ws:l.stackMat3[--l.sizeMat3];var p=h;p.x=t._positionX;p.y=t._positionY;p.z=t._positionZ;var f=c;f.e00=t._rotation00;f.e01=t._rotation01;f.e02=t._rotation02;f.e10=t._rotation10;f.e11=t._rotation11;f.e12=t._rotation12;f.e20=t._rotation20;f.e21=t._rotation21;f.e22=t._rotation22;o.init(c.e00,c.e10,c.e20);n.init(c.e01,c.e11,c.e21);_.init(c.e02,c.e12,c.e22);var m=a.x;var b=a.y;var u=a.z;var x=this.p;var y=x.sizeVec3==0?new Is:x.stackVec3[--x.sizeVec3];y.x=h.x;y.y=h.y;y.z=h.z;var g=y;var X=-m;var z=g.x+o.x*X;var M=g.y+o.y*X;var Y=g.z+o.z*X;g.x=z;g.y=M;g.z=Y;var Z=g;var d=-b;var I=Z.x+n.x*d;var w=Z.y+n.y*d;var V=Z.z+n.z*d;Z.x=I;Z.y=w;Z.z=V;var L=Z;var A=-u;var k=L.x+_.x*A;var B=L.y+_.y*A;var P=L.z+_.z*A;L.x=k;L.y=B;L.z=P;var T=L;var S=this.p;var C=S.sizeVec3==0?new Is:S.stackVec3[--S.sizeVec3];C.x=h.x;C.y=h.y;C.z=h.z;var q=C;var R=-m;var E=q.x+o.x*R;var j=q.y+o.y*R;var N=q.z+o.z*R;q.x=E;q.y=j;q.z=N;var D=q;var F=-b;var O=D.x+n.x*F;var W=D.y+n.y*F;var G=D.z+n.z*F;D.x=O;D.y=W;D.z=G;var H=D;var U=H.x+_.x*u;var J=H.y+_.y*u;var Q=H.z+_.z*u;H.x=U;H.y=J;H.z=Q;var $=H;var K=this.p;var tt=K.sizeVec3==0?new Is:K.stackVec3[--K.sizeVec3];tt.x=h.x;tt.y=h.y;tt.z=h.z;var at=tt;var it=-m;var rt=at.x+o.x*it;var ot=at.y+o.y*it;var st=at.z+o.z*it;at.x=rt;at.y=ot;at.z=st;var nt=at;var et=nt.x+n.x*b;var _t=nt.y+n.y*b;var vt=nt.z+n.z*b;nt.x=et;nt.y=_t;nt.z=vt;var ht=nt;var lt=-u;var ct=ht.x+_.x*lt;var pt=ht.y+_.y*lt;var ft=ht.z+_.z*lt;ht.x=ct;ht.y=pt;ht.z=ft;var mt=ht;var bt=this.p;var ut=bt.sizeVec3==0?new Is:bt.stackVec3[--bt.sizeVec3];ut.x=h.x;ut.y=h.y;ut.z=h.z;var xt=ut;var yt=-m;var gt=xt.x+o.x*yt;var Xt=xt.y+o.y*yt;var zt=xt.z+o.z*yt;xt.x=gt;xt.y=Xt;xt.z=zt;var Mt=xt;var Yt=Mt.x+n.x*b;var Zt=Mt.y+n.y*b;var dt=Mt.z+n.z*b;Mt.x=Yt;Mt.y=Zt;Mt.z=dt;var It=Mt;var wt=It.x+_.x*u;var Vt=It.y+_.y*u;var Lt=It.z+_.z*u;It.x=wt;It.y=Vt;It.z=Lt;var At=It;var kt=this.p;var Bt=kt.sizeVec3==0?new Is:kt.stackVec3[--kt.sizeVec3];Bt.x=h.x;Bt.y=h.y;Bt.z=h.z;var Pt=Bt;var Tt=Pt.x+o.x*m;var St=Pt.y+o.y*m;var Ct=Pt.z+o.z*m;Pt.x=Tt;Pt.y=St;Pt.z=Ct;var qt=Pt;var Rt=-b;var Et=qt.x+n.x*Rt;var jt=qt.y+n.y*Rt;var Nt=qt.z+n.z*Rt;qt.x=Et;qt.y=jt;qt.z=Nt;var Dt=qt;var Ft=-u;var Ot=Dt.x+_.x*Ft;var Wt=Dt.y+_.y*Ft;var Gt=Dt.z+_.z*Ft;Dt.x=Ot;Dt.y=Wt;Dt.z=Gt;var Ht=Dt;var Ut=this.p;var Jt=Ut.sizeVec3==0?new Is:Ut.stackVec3[--Ut.sizeVec3];Jt.x=h.x;Jt.y=h.y;Jt.z=h.z;var Qt=Jt;var $t=Qt.x+o.x*m;var Kt=Qt.y+o.y*m;var ta=Qt.z+o.z*m;Qt.x=$t;Qt.y=Kt;Qt.z=ta;var aa=Qt;var ia=-b;var ra=aa.x+n.x*ia;var oa=aa.y+n.y*ia;var sa=aa.z+n.z*ia;aa.x=ra;aa.y=oa;aa.z=sa;var na=aa;var ea=na.x+_.x*u;var _a=na.y+_.y*u;var va=na.z+_.z*u;na.x=ea;na.y=_a;na.z=va;var ha=na;var la=this.p;var ca=la.sizeVec3==0?new Is:la.stackVec3[--la.sizeVec3];ca.x=h.x;ca.y=h.y;ca.z=h.z;var pa=ca;var fa=pa.x+o.x*m;var ma=pa.y+o.y*m;var ba=pa.z+o.z*m;pa.x=fa;pa.y=ma;pa.z=ba;var ua=pa;var xa=ua.x+n.x*b;var ya=ua.y+n.y*b;var ga=ua.z+n.z*b;ua.x=xa;ua.y=ya;ua.z=ga;var Xa=ua;var za=-u;var Ma=Xa.x+_.x*za;var Ya=Xa.y+_.y*za;var Za=Xa.z+_.z*za;Xa.x=Ma;Xa.y=Ya;Xa.z=Za;var da=Xa;var Ia=this.p;var wa=Ia.sizeVec3==0?new Is:Ia.stackVec3[--Ia.sizeVec3];wa.x=h.x;wa.y=h.y;wa.z=h.z;var Va=wa;var La=Va.x+o.x*m;var Aa=Va.y+o.y*m;var ka=Va.z+o.z*m;Va.x=La;Va.y=Aa;Va.z=ka;var Ba=Va;var Pa=Ba.x+n.x*b;var Ta=Ba.y+n.y*b;var Sa=Ba.z+n.z*b;Ba.x=Pa;Ba.y=Ta;Ba.z=Sa;var Ca=Ba;var qa=Ca.x+_.x*u;var Ra=Ca.y+_.y*u;var Ea=Ca.z+_.z*u;Ca.x=qa;Ca.y=Ra;Ca.z=Ea;var ja=Ca;if(this.wireframe){this.line(T,$,i);this.line(mt,At,i);this.line(Ht,ha,i);this.line(da,ja,i);this.line(T,mt,i);this.line($,At,i);this.line(Ht,da,i);this.line(ha,ja,i);this.line(T,Ht,i);this.line($,ha,i);this.line(mt,da,i);this.line(At,ja,i)}else{var Na=this.p;var Da=Na.sizeVec3==0?new Is:Na.stackVec3[--Na.sizeVec3];Da.x=o.x;Da.y=o.y;Da.z=o.z;var Fa=Da;var Oa=-Fa.x;var Wa=-Fa.y;var Ga=-Fa.z;Fa.x=Oa;Fa.y=Wa;Fa.z=Ga;var Ha=Fa;var Ua=this.p;var Ja=Ua.sizeVec3==0?new Is:Ua.stackVec3[--Ua.sizeVec3];Ja.x=n.x;Ja.y=n.y;Ja.z=n.z;var Qa=Ja;var $a=-Qa.x;var Ka=-Qa.y;var ti=-Qa.z;Qa.x=$a;Qa.y=Ka;Qa.z=ti;var ai=Qa;var ii=this.p;var ri=ii.sizeVec3==0?new Is:ii.stackVec3[--ii.sizeVec3];ri.x=_.x;ri.y=_.y;ri.z=_.z;var oi=ri;var si=-oi.x;var ni=-oi.y;var ei=-oi.z;oi.x=si;oi.y=ni;oi.z=ei;var _i=oi;this.rect(T,$,At,mt,Ha,Ha,Ha,Ha,i);this.rect(Ht,da,ja,ha,o,o,o,o,i);this.rect(T,Ht,ha,$,ai,ai,ai,ai,i);this.rect(mt,At,ja,da,n,n,n,n,i);this.rect(T,mt,da,Ht,_i,_i,_i,_i,i);this.rect($,ha,ja,At,_,_,_,_,i);var vi=this.p;if(Ha!=null){Ha.zero();if(vi.sizeVec3==vi.stackVec3.length){var hi=vi.sizeVec3<<1;var li=new Array(hi);var ci=li;var pi=0;var fi=vi.sizeVec3;while(pi<fi){var mi=pi++;ci[mi]=vi.stackVec3[mi];vi.stackVec3[mi]=null}vi.stackVec3=ci}vi.stackVec3[vi.sizeVec3++]=Ha}var bi=this.p;if(ai!=null){ai.zero();if(bi.sizeVec3==bi.stackVec3.length){var ui=bi.sizeVec3<<1;var xi=new Array(ui);var yi=xi;var gi=0;var Xi=bi.sizeVec3;while(gi<Xi){var zi=gi++;yi[zi]=bi.stackVec3[zi];bi.stackVec3[zi]=null}bi.stackVec3=yi}bi.stackVec3[bi.sizeVec3++]=ai}var Mi=this.p;if(_i!=null){_i.zero();if(Mi.sizeVec3==Mi.stackVec3.length){var Yi=Mi.sizeVec3<<1;var Zi=new Array(Yi);var di=Zi;var Ii=0;var wi=Mi.sizeVec3;while(Ii<wi){var Vi=Ii++;di[Vi]=Mi.stackVec3[Vi];Mi.stackVec3[Vi]=null}Mi.stackVec3=di}Mi.stackVec3[Mi.sizeVec3++]=_i}}var Li=this.p;if(T!=null){T.zero();if(Li.sizeVec3==Li.stackVec3.length){var Ai=Li.sizeVec3<<1;var ki=new Array(Ai);var Bi=ki;var Pi=0;var Ti=Li.sizeVec3;while(Pi<Ti){var Si=Pi++;Bi[Si]=Li.stackVec3[Si];Li.stackVec3[Si]=null}Li.stackVec3=Bi}Li.stackVec3[Li.sizeVec3++]=T}var Ci=this.p;if($!=null){$.zero();if(Ci.sizeVec3==Ci.stackVec3.length){var qi=Ci.sizeVec3<<1;var Ri=new Array(qi);var Ei=Ri;var ji=0;var Ni=Ci.sizeVec3;while(ji<Ni){var Di=ji++;Ei[Di]=Ci.stackVec3[Di];Ci.stackVec3[Di]=null}Ci.stackVec3=Ei}Ci.stackVec3[Ci.sizeVec3++]=$}var Fi=this.p;if(mt!=null){mt.zero();if(Fi.sizeVec3==Fi.stackVec3.length){var Oi=Fi.sizeVec3<<1;var Wi=new Array(Oi);var Gi=Wi;var Hi=0;var Ui=Fi.sizeVec3;while(Hi<Ui){var Ji=Hi++;Gi[Ji]=Fi.stackVec3[Ji];Fi.stackVec3[Ji]=null}Fi.stackVec3=Gi}Fi.stackVec3[Fi.sizeVec3++]=mt}var Qi=this.p;if(At!=null){At.zero();if(Qi.sizeVec3==Qi.stackVec3.length){var $i=Qi.sizeVec3<<1;var Ki=new Array($i);var tr=Ki;var ar=0;var ir=Qi.sizeVec3;while(ar<ir){var rr=ar++;tr[rr]=Qi.stackVec3[rr];Qi.stackVec3[rr]=null}Qi.stackVec3=tr}Qi.stackVec3[Qi.sizeVec3++]=At}var or=this.p;if(Ht!=null){Ht.zero();if(or.sizeVec3==or.stackVec3.length){var sr=or.sizeVec3<<1;var nr=new Array(sr);var er=nr;var _r=0;var vr=or.sizeVec3;while(_r<vr){var hr=_r++;er[hr]=or.stackVec3[hr];or.stackVec3[hr]=null}or.stackVec3=er}or.stackVec3[or.sizeVec3++]=Ht}var lr=this.p;if(ha!=null){ha.zero();if(lr.sizeVec3==lr.stackVec3.length){var cr=lr.sizeVec3<<1;var pr=new Array(cr);var fr=pr;var mr=0;var br=lr.sizeVec3;while(mr<br){var ur=mr++;fr[ur]=lr.stackVec3[ur];lr.stackVec3[ur]=null}lr.stackVec3=fr}lr.stackVec3[lr.sizeVec3++]=ha}var xr=this.p;if(da!=null){da.zero();if(xr.sizeVec3==xr.stackVec3.length){var yr=xr.sizeVec3<<1;var gr=new Array(yr);var Xr=gr;var zr=0;var Mr=xr.sizeVec3;while(zr<Mr){var Yr=zr++;Xr[Yr]=xr.stackVec3[Yr];xr.stackVec3[Yr]=null}xr.stackVec3=Xr}xr.stackVec3[xr.sizeVec3++]=da}var Zr=this.p;if(ja!=null){ja.zero();if(Zr.sizeVec3==Zr.stackVec3.length){var dr=Zr.sizeVec3<<1;var Ir=new Array(dr);var wr=Ir;var Vr=0;var Lr=Zr.sizeVec3;while(Vr<Lr){var Ar=Vr++;wr[Ar]=Zr.stackVec3[Ar];Zr.stackVec3[Ar]=null}Zr.stackVec3=wr}Zr.stackVec3[Zr.sizeVec3++]=ja}var kr=this.p;if(h!=null){h.zero();if(kr.sizeVec3==kr.stackVec3.length){var Br=kr.sizeVec3<<1;var Pr=new Array(Br);var Tr=Pr;var Sr=0;var Cr=kr.sizeVec3;while(Sr<Cr){var qr=Sr++;Tr[qr]=kr.stackVec3[qr];kr.stackVec3[qr]=null}kr.stackVec3=Tr}kr.stackVec3[kr.sizeVec3++]=h}var Rr=this.p;if(c!=null){var Er=1;var jr=0;var Nr=0;var Dr=0;var Fr=1;var Or=0;var Wr=0;var Gr=0;var Hr=1;c.e00=Er;c.e01=jr;c.e02=Nr;c.e10=Dr;c.e11=Fr;c.e12=Or;c.e20=Wr;c.e21=Gr;c.e22=Hr;if(Rr.sizeMat3==Rr.stackMat3.length){var Ur=Rr.sizeMat3<<1;var Jr=new Array(Ur);var Qr=Jr;var $r=0;var Kr=Rr.sizeMat3;while($r<Kr){var to=$r++;Qr[to]=Rr.stackMat3[to];Rr.stackMat3[to]=null}Rr.stackMat3=Qr}Rr.stackMat3[Rr.sizeMat3++]=c}var ao=this.p;if(o!=null){o.zero();if(ao.sizeVec3==ao.stackVec3.length){var io=ao.sizeVec3<<1;var ro=new Array(io);var oo=ro;var so=0;var no=ao.sizeVec3;while(so<no){var eo=so++;oo[eo]=ao.stackVec3[eo];ao.stackVec3[eo]=null}ao.stackVec3=oo}ao.stackVec3[ao.sizeVec3++]=o}var _o=this.p;if(n!=null){n.zero();if(_o.sizeVec3==_o.stackVec3.length){var vo=_o.sizeVec3<<1;var ho=new Array(vo);var lo=ho;var co=0;var po=_o.sizeVec3;while(co<po){var fo=co++;lo[fo]=_o.stackVec3[fo];_o.stackVec3[fo]=null}_o.stackVec3=lo}_o.stackVec3[_o.sizeVec3++]=n}var mo=this.p;if(_!=null){_.zero();if(mo.sizeVec3==mo.stackVec3.length){var bo=mo.sizeVec3<<1;var uo=new Array(bo);var xo=uo;var yo=0;var go=mo.sizeVec3;while(yo<go){var Xo=yo++;xo[Xo]=mo.stackVec3[Xo];mo.stackVec3[Xo]=null}mo.stackVec3=xo}mo.stackVec3[mo.sizeVec3++]=_}},rect:function(t,a,i,r,o,s,n,e,_){this.triangle(t,a,i,o,s,n,_);this.triangle(t,i,r,o,n,e,_)},point:function(t,a){},triangle:function(t,a,i,r,o,s,n){},line:function(t,a,i){}};var _t=function(){this.basisColorZ=new Is(0,0,1);this.basisColorY=new Is(0,1,0);this.basisColorX=new Is(1,0,0);this.basisLength=.5;this.jointRotationalConstraintRadius=.3;this.jointErrorColor=new Is(1,.1,.1);this.jointLineColor=new Is(.8,.8,.8);this.contactBinormalLength=.5;this.contactTangentLength=.5;this.contactNormalLength=.5;this.contactBinormalColor=new Is(.2,.2,1);this.contactTangentColor=new Is(.1,.8,.1);this.contactNormalColor=new Is(1,.1,.1);this.disabledContactColor=new Is(.5,.1,.1);this.newContactColor=new Is(1,1,.1);this.contactColor4=new Is(.8,.1,1);this.contactColor3=new Is(.1,.8,.6);this.contactColor2=new Is(1,.6,.1);this.contactColor=new Is(1,.1,.1);this.pairColor=new Is(1,1,.1);this.bvhNodeColor=new Is(.4,.4,.4);this.aabbColor=new Is(1,.1,.1);this.kinematicShapeColor=new Is(1,.5,.1);this.staticShapeColor=new Is(.7,.7,.7);this.sleepingShapeColor2=new Is(.2,.8,.5);this.sleepingShapeColor1=new Is(.3,.3,.8);this.sleepyShapeColor2=new Is(.6,.8,.3);this.sleepyShapeColor1=new Is(.5,.25,.6);this.shapeColor2=new Is(1,.8,.1);this.shapeColor1=new Is(.7,.2,.4)};var vt=function(){};var ht=function(){this._b1=null;this._b2=null;this._addedToIsland=false};ht.prototype={preSolveVelocity:function(t){},warmStart:function(t){},solveVelocity:function(){},postSolveVelocity:function(t){},preSolvePosition:function(t){},solvePositionSplitImpulse:function(){},solvePositionNgs:function(t){},postSolve:function(){}};var ka=function(){};var lt=function(t){this._solver=new $t(this);this._manifold=t};lt.prototype={_getVelocitySolverInfo:function(t,a){a.b1=this._b1;a.b2=this._b2;var i;var r;var o;var s;var n;var e;var _;var v;var h;var l;var c;var p;r=this._manifold._normalX;o=this._manifold._normalY;s=this._manifold._normalZ;e=this._manifold._tangentX;_=this._manifold._tangentY;v=this._manifold._tangentZ;l=this._manifold._binormalX;c=this._manifold._binormalY;p=this._manifold._binormalZ;var f=Math.sqrt(this._s1._friction*this._s2._friction);var m=Math.sqrt(this._s1._restitution*this._s2._restitution);var b=this._manifold._numPoints;a.numRows=0;var u;var x;var y;var g;x=this._tf1._positionX-this._tf2._positionX;y=this._tf1._positionY-this._tf2._positionY;g=this._tf1._positionZ-this._tf2._positionZ;var X=0;var z=b;while(X<z){var M=X++;var Y=this._manifold._points[M];if(Y._depth<0){Y._disabled=true;var Z=Y._impulse;Z.impulseN=0;Z.impulseT=0;Z.impulseB=0;Z.impulseP=0;Z.impulseLX=0;Z.impulseLY=0;Z.impulseLZ=0;continue}else{Y._disabled=false}var d=a.rows[a.numRows++];d.friction=f;d.cfm=0;var I=d.jacobianN;I.lin1X=r;I.lin1Y=o;I.lin1Z=s;I.lin2X=r;I.lin2Y=o;I.lin2Z=s;I.ang1X=Y._relPos1Y*s-Y._relPos1Z*o;I.ang1Y=Y._relPos1Z*r-Y._relPos1X*s;I.ang1Z=Y._relPos1X*o-Y._relPos1Y*r;I.ang2X=Y._relPos2Y*s-Y._relPos2Z*o;I.ang2Y=Y._relPos2Z*r-Y._relPos2X*s;I.ang2Z=Y._relPos2X*o-Y._relPos2Y*r;I=d.jacobianT;I.lin1X=e;I.lin1Y=_;I.lin1Z=v;I.lin2X=e;I.lin2Y=_;I.lin2Z=v;I.ang1X=Y._relPos1Y*v-Y._relPos1Z*_;I.ang1Y=Y._relPos1Z*e-Y._relPos1X*v;I.ang1Z=Y._relPos1X*_-Y._relPos1Y*e;I.ang2X=Y._relPos2Y*v-Y._relPos2Z*_;I.ang2Y=Y._relPos2Z*e-Y._relPos2X*v;I.ang2Z=Y._relPos2X*_-Y._relPos2Y*e;I=d.jacobianB;I.lin1X=l;I.lin1Y=c;I.lin1Z=p;I.lin2X=l;I.lin2Y=c;I.lin2Z=p;I.ang1X=Y._relPos1Y*p-Y._relPos1Z*c;I.ang1Y=Y._relPos1Z*l-Y._relPos1X*p;I.ang1Z=Y._relPos1X*c-Y._relPos1Y*l;I.ang2X=Y._relPos2Y*p-Y._relPos2Z*c;I.ang2Y=Y._relPos2Z*l-Y._relPos2X*p;I.ang2Z=Y._relPos2X*c-Y._relPos2Y*l;I=d.jacobianN;var w=I.lin1X*this._b1._velX+I.lin1Y*this._b1._velY+I.lin1Z*this._b1._velZ+(I.ang1X*this._b1._angVelX+I.ang1Y*this._b1._angVelY+I.ang1Z*this._b1._angVelZ)-(I.lin2X*this._b2._velX+I.lin2Y*this._b2._velY+I.lin2Z*this._b2._velZ+(I.ang2X*this._b2._angVelX+I.ang2Y*this._b2._angVelY+I.ang2Z*this._b2._angVelZ));if(w<-ys.contactEnableBounceThreshold&&!Y._warmStarted){d.rhs=-w*m}else{d.rhs=0}if(this._positionCorrectionAlgorithm==ka.BAUMGARTE){if(Y._depth>ys.linearSlop){var V=(Y._depth-ys.linearSlop)*ys.velocityBaumgarte*t.invDt;if(d.rhs<V){d.rhs=V}}}if(!Y._warmStarted){var L=Y._impulse;L.impulseN=0;L.impulseT=0;L.impulseB=0;L.impulseP=0;L.impulseLX=0;L.impulseLY=0;L.impulseLZ=0}d.impulse=Y._impulse}},_getPositionSolverInfo:function(t){t.b1=this._b1;t.b2=this._b2;var a;var i;var r;var o;i=this._manifold._normalX;r=this._manifold._normalY;o=this._manifold._normalZ;var s=this._manifold._numPoints;t.numRows=0;var n=0;var e=s;while(n<e){var _=n++;var v=this._manifold._points[_];if(v._disabled){continue}var h=t.rows[t.numRows++];var l=h.jacobianN;l.lin1X=i;l.lin1Y=r;l.lin1Z=o;l.lin2X=i;l.lin2Y=r;l.lin2Z=o;l.ang1X=v._relPos1Y*o-v._relPos1Z*r;l.ang1Y=v._relPos1Z*i-v._relPos1X*o;l.ang1Z=v._relPos1X*r-v._relPos1Y*i;l.ang2X=v._relPos2Y*o-v._relPos2Z*r;l.ang2Y=v._relPos2Z*i-v._relPos2X*o;l.ang2Z=v._relPos2X*r-v._relPos2Y*i;h.rhs=v._depth-ys.linearSlop;if(h.rhs<0){h.rhs=0}h.impulse=v._impulse}},_syncManifold:function(){this._manifold._updateDepthsAndPositions(this._tf1,this._tf2)},getShape1:function(){return this._s1},getShape2:function(){return this._s2},getManifold:function(){return this._manifold},isTouching:function(){var t=0;var a=this._manifold._numPoints;while(t<a){var i=t++;if(this._manifold._points[i]._depth>=0){return true}}return false}};var ct=function(){this.impulseN=0;this.impulseT=0;this.impulseB=0;this.impulseP=0;this.impulseLX=0;this.impulseLY=0;this.impulseLZ=0};ct.prototype={copyFrom:function(t){this.impulseN=t.impulseN;this.impulseT=t.impulseT;this.impulseB=t.impulseB;this.impulseLX=t.impulseLX;this.impulseLY=t.impulseLY;this.impulseLZ=t.impulseLZ}};var pt=function(){this._normalX=0;this._normalY=0;this._normalZ=0;this._tangentX=0;this._tangentY=0;this._tangentZ=0;this._binormalX=0;this._binormalY=0;this._binormalZ=0;this._numPoints=0;var t=ys.maxManifoldPoints;var a=new Array(t);this._points=a;var i=0;var r=ys.maxManifoldPoints;while(i<r){var o=i++;this._points[o]=new ft}};pt.prototype={_clear:function(){var t=0;var a=this._numPoints;while(t<a){var i=t++;var r=this._points[i];r._localPos1X=0;r._localPos1Y=0;r._localPos1Z=0;r._localPos2X=0;r._localPos2Y=0;r._localPos2Z=0;r._relPos1X=0;r._relPos1Y=0;r._relPos1Z=0;r._relPos2X=0;r._relPos2Y=0;r._relPos2Z=0;r._pos1X=0;r._pos1Y=0;r._pos1Z=0;r._pos2X=0;r._pos2Y=0;r._pos2Z=0;r._depth=0;var o=r._impulse;o.impulseN=0;o.impulseT=0;o.impulseB=0;o.impulseP=0;o.impulseLX=0;o.impulseLY=0;o.impulseLZ=0;r._warmStarted=false;r._disabled=false;r._id=-1}this._numPoints=0},_buildBasis:function(t){var a=t;this._normalX=a.x;this._normalY=a.y;this._normalZ=a.z;var i=t.x;var r=t.y;var o=t.z;var s=i*i;var n=r*r;var e=o*o;var _;var v;var h;var l;var c;var p;if(s<n){if(s<e){var f=1/Math.sqrt(n+e);_=0;v=-o*f;h=r*f;l=r*h-o*v;c=-i*h;p=i*v}else{var m=1/Math.sqrt(s+n);_=-r*m;v=i*m;h=0;l=-o*v;c=o*_;p=i*v-r*_}}else if(n<e){var b=1/Math.sqrt(s+e);_=o*b;v=0;h=-i*b;l=r*h;c=o*_-i*h;p=-r*_}else{var u=1/Math.sqrt(s+n);_=-r*u;v=i*u;h=0;l=-o*v;c=o*_;p=i*v-r*_}this._tangentX=_;this._tangentY=v;this._tangentZ=h;this._binormalX=l;this._binormalY=c;this._binormalZ=p},_updateDepthsAndPositions:function(t,a){var i=0;var r=this._numPoints;while(i<r){var o=i++;var s=this._points[o];var n;var e;var _;n=t._rotation00*s._localPos1X+t._rotation01*s._localPos1Y+t._rotation02*s._localPos1Z;e=t._rotation10*s._localPos1X+t._rotation11*s._localPos1Y+t._rotation12*s._localPos1Z;_=t._rotation20*s._localPos1X+t._rotation21*s._localPos1Y+t._rotation22*s._localPos1Z;s._relPos1X=n;s._relPos1Y=e;s._relPos1Z=_;var v;var h;var l;v=a._rotation00*s._localPos2X+a._rotation01*s._localPos2Y+a._rotation02*s._localPos2Z;h=a._rotation10*s._localPos2X+a._rotation11*s._localPos2Y+a._rotation12*s._localPos2Z;l=a._rotation20*s._localPos2X+a._rotation21*s._localPos2Y+a._rotation22*s._localPos2Z;s._relPos2X=v;s._relPos2Y=h;s._relPos2Z=l;s._pos1X=s._relPos1X+t._positionX;s._pos1Y=s._relPos1Y+t._positionY;s._pos1Z=s._relPos1Z+t._positionZ;s._pos2X=s._relPos2X+a._positionX;s._pos2Y=s._relPos2Y+a._positionY;s._pos2Z=s._relPos2Z+a._positionZ;var c;var p;var f;var m;p=s._pos1X-s._pos2X;f=s._pos1Y-s._pos2Y;m=s._pos1Z-s._pos2Z;var b=p*this._normalX+f*this._normalY+m*this._normalZ;s._depth=-b}},getNormal:function(){var t=new Is;var a=t;a.x=this._normalX;a.y=this._normalY;a.z=this._normalZ;return t},getNormalTo:function(t){var a=t;a.x=this._normalX;a.y=this._normalY;a.z=this._normalZ},getTangent:function(){var t=new Is;var a=t;a.x=this._tangentX;a.y=this._tangentY;a.z=this._tangentZ;return t},getTangentTo:function(t){var a=t;a.x=this._tangentX;a.y=this._tangentY;a.z=this._tangentZ},getBinormal:function(){var t=new Is;var a=t;a.x=this._binormalX;a.y=this._binormalY;a.z=this._binormalZ;return t},getBinormalTo:function(t){var a=t;a.x=this._binormalX;a.y=this._binormalY;a.z=this._binormalZ},getPoints:function(){return this._points},getNumPoints:function(){return this._numPoints}};var ft=function(){this._localPos1X=0;this._localPos1Y=0;this._localPos1Z=0;this._localPos2X=0;this._localPos2Y=0;this._localPos2Z=0;this._relPos1X=0;this._relPos1Y=0;this._relPos1Z=0;this._relPos2X=0;this._relPos2Y=0;this._relPos2Z=0;this._pos1X=0;this._pos1Y=0;this._pos1Z=0;this._pos2X=0;this._pos2Y=0;this._pos2Z=0;this._depth=0;this._impulse=new ct;this._warmStarted=false;this._disabled=false;this._id=-1};ft.prototype={getPosition1:function(){var t=new Is;var a=t;a.x=this._pos1X;a.y=this._pos1Y;a.z=this._pos1Z;return t},getPosition1To:function(t){var a=t;a.x=this._pos1X;a.y=this._pos1Y;a.z=this._pos1Z},getPosition2:function(){var t=new Is;var a=t;a.x=this._pos2X;a.y=this._pos2Y;a.z=this._pos2Z;return t},getPosition2To:function(t){var a=t;a.x=this._pos2X;a.y=this._pos2Y;a.z=this._pos2Z},getDepth:function(){return this._depth},isWarmStarted:function(){return this._warmStarted},getNormalImpulse:function(){return this._impulse.impulseN},getTangentImpulse:function(){return this._impulse.impulseT},getBinormalImpulse:function(){return this._impulse.impulseB},isEnabled:function(){return!this._disabled}};var mt=function(t){this._manifold=t;this.numOldPoints=0;var a=ys.maxManifoldPoints;var i=new Array(a);this.oldPoints=i;var r=0;var o=ys.maxManifoldPoints;while(r<o){var s=r++;this.oldPoints[s]=new ft}};mt.prototype={removeOutdatedPoints:function(){var t=this._manifold._numPoints;var a=t;while(--a>=0){var i=this._manifold._points[a];var r;var o;var s;var n;o=i._pos1X-i._pos2X;s=i._pos1Y-i._pos2Y;n=i._pos1Z-i._pos2Z;var e=this._manifold._normalX*o+this._manifold._normalY*s+this._manifold._normalZ*n;if(e>ys.contactPersistenceThreshold){this.removeManifoldPoint(a);continue}o+=this._manifold._normalX*-e;s+=this._manifold._normalY*-e;n+=this._manifold._normalZ*-e;if(o*o+s*s+n*n>ys.contactPersistenceThreshold*ys.contactPersistenceThreshold){this.removeManifoldPoint(a);continue}}},removeManifoldPoint:function(t){var a=--this._manifold._numPoints;if(t!=a){var i=this._manifold._points[t];this._manifold._points[t]=this._manifold._points[a];this._manifold._points[a]=i}var r=this._manifold._points[a];r._localPos1X=0;r._localPos1Y=0;r._localPos1Z=0;r._localPos2X=0;r._localPos2Y=0;r._localPos2Z=0;r._relPos1X=0;r._relPos1Y=0;r._relPos1Z=0;r._relPos2X=0;r._relPos2Y=0;r._relPos2Z=0;r._pos1X=0;r._pos1Y=0;r._pos1Z=0;r._pos2X=0;r._pos2Y=0;r._pos2Z=0;r._depth=0;var o=r._impulse;o.impulseN=0;o.impulseT=0;o.impulseB=0;o.impulseP=0;o.impulseLX=0;o.impulseLY=0;o.impulseLZ=0;r._warmStarted=false;r._disabled=false;r._id=-1},addManifoldPoint:function(t,a,i){var r=this._manifold._numPoints;if(r==ys.maxManifoldPoints){var o=this.computeTargetIndex(t,a,i);var s=this._manifold._points[o];var n=t.position1;s._pos1X=n.x;s._pos1Y=n.y;s._pos1Z=n.z;var e=t.position2;s._pos2X=e.x;s._pos2Y=e.y;s._pos2Z=e.z;s._relPos1X=s._pos1X-a._positionX;s._relPos1Y=s._pos1Y-a._positionY;s._relPos1Z=s._pos1Z-a._positionZ;s._relPos2X=s._pos2X-i._positionX;s._relPos2Y=s._pos2Y-i._positionY;s._relPos2Z=s._pos2Z-i._positionZ;var _;var v;var h;_=a._rotation00*s._relPos1X+a._rotation10*s._relPos1Y+a._rotation20*s._relPos1Z;v=a._rotation01*s._relPos1X+a._rotation11*s._relPos1Y+a._rotation21*s._relPos1Z;h=a._rotation02*s._relPos1X+a._rotation12*s._relPos1Y+a._rotation22*s._relPos1Z;s._localPos1X=_;s._localPos1Y=v;s._localPos1Z=h;var l;var c;var p;l=i._rotation00*s._relPos2X+i._rotation10*s._relPos2Y+i._rotation20*s._relPos2Z;c=i._rotation01*s._relPos2X+i._rotation11*s._relPos2Y+i._rotation21*s._relPos2Z;p=i._rotation02*s._relPos2X+i._rotation12*s._relPos2Y+i._rotation22*s._relPos2Z;s._localPos2X=l;s._localPos2Y=c;s._localPos2Z=p;s._depth=t.depth;var f=s._impulse;f.impulseN=0;f.impulseT=0;f.impulseB=0;f.impulseP=0;f.impulseLX=0;f.impulseLY=0;f.impulseLZ=0;s._id=t.id;s._warmStarted=false;s._disabled=false;return}var m=this._manifold._points[r];var b=t.position1;m._pos1X=b.x;m._pos1Y=b.y;m._pos1Z=b.z;var u=t.position2;m._pos2X=u.x;m._pos2Y=u.y;m._pos2Z=u.z;m._relPos1X=m._pos1X-a._positionX;m._relPos1Y=m._pos1Y-a._positionY;m._relPos1Z=m._pos1Z-a._positionZ;m._relPos2X=m._pos2X-i._positionX;m._relPos2Y=m._pos2Y-i._positionY;m._relPos2Z=m._pos2Z-i._positionZ;var x;var y;var g;x=a._rotation00*m._relPos1X+a._rotation10*m._relPos1Y+a._rotation20*m._relPos1Z;y=a._rotation01*m._relPos1X+a._rotation11*m._relPos1Y+a._rotation21*m._relPos1Z;g=a._rotation02*m._relPos1X+a._rotation12*m._relPos1Y+a._rotation22*m._relPos1Z;m._localPos1X=x;m._localPos1Y=y;m._localPos1Z=g;var X;var z;var M;X=i._rotation00*m._relPos2X+i._rotation10*m._relPos2Y+i._rotation20*m._relPos2Z;z=i._rotation01*m._relPos2X+i._rotation11*m._relPos2Y+i._rotation21*m._relPos2Z;M=i._rotation02*m._relPos2X+i._rotation12*m._relPos2Y+i._rotation22*m._relPos2Z;m._localPos2X=X;m._localPos2Y=z;m._localPos2Z=M;m._depth=t.depth;var Y=m._impulse;Y.impulseN=0;Y.impulseT=0;Y.impulseB=0;Y.impulseP=0;Y.impulseLX=0;Y.impulseLY=0;Y.impulseLZ=0;m._id=t.id;m._warmStarted=false;m._disabled=false;this._manifold._numPoints++},computeTargetIndex:function(t,a,i){var r=this._manifold._points[0];var o=this._manifold._points[1];var s=this._manifold._points[2];var n=this._manifold._points[3];var e=r._depth;var _=0;if(o._depth>e){e=o._depth;_=1}if(s._depth>e){e=s._depth;_=2}if(n._depth>e){e=n._depth;_=3}var v;var h;var l;var c;var p=t.position1;h=p.x;l=p.y;c=p.z;h-=a._positionX;l-=a._positionY;c-=a._positionZ;var f=o._relPos1X;var m=o._relPos1Y;var b=o._relPos1Z;var u=s._relPos1X;var x=s._relPos1Y;var y=s._relPos1Z;var g=n._relPos1X;var X=n._relPos1Y;var z=n._relPos1Z;var M;var Y;var Z;var d;var I;var w;var V;var L;var A;var k;var B;var P;var T;var S;var C;var q;var R;var E;var j;var N;var D;var F;var O;var W;Y=u-f;Z=x-m;d=y-b;w=h-g;V=l-X;L=c-z;k=g-f;B=X-m;P=z-b;S=h-u;C=l-x;q=c-y;E=h-f;j=l-m;N=c-b;F=g-u;O=X-x;W=z-y;var G;var H;var U;var J;var Q;var $;var K;var tt;var at;var it;var rt;var ot;H=Z*L-d*V;U=d*w-Y*L;J=Y*V-Z*w;$=B*q-P*C;K=P*S-k*q;tt=k*C-B*S;it=j*W-N*O;rt=N*F-E*W;ot=E*O-j*F;var st=H*H+U*U+J*J;var nt=$*$+K*K+tt*tt;var et=it*it+rt*rt+ot*ot;var _t=st>nt?st>et?st:et:nt>et?nt:et;var vt=r._relPos1X;var ht=r._relPos1Y;var lt=r._relPos1Z;var ct=s._relPos1X;var pt=s._relPos1Y;var ft=s._relPos1Z;var mt=n._relPos1X;var bt=n._relPos1Y;var ut=n._relPos1Z;var xt;var yt;var gt;var Xt;var zt;var Mt;var Yt;var Zt;var dt;var It;var wt;var Vt;var Lt;var At;var kt;var Bt;var Pt;var Tt;var St;var Ct;var qt;var Rt;var Et;var jt;yt=ct-vt;gt=pt-ht;Xt=ft-lt;Mt=h-mt;Yt=l-bt;Zt=c-ut;It=mt-vt;wt=bt-ht;Vt=ut-lt;At=h-ct;kt=l-pt;Bt=c-ft;Tt=h-vt;St=l-ht;Ct=c-lt;Rt=mt-ct;Et=bt-pt;jt=ut-ft;var Nt;var Dt;var Ft;var Ot;var Wt;var Gt;var Ht;var Ut;var Jt;var Qt;var $t;var Kt;Dt=gt*Zt-Xt*Yt;Ft=Xt*Mt-yt*Zt;Ot=yt*Yt-gt*Mt;Gt=wt*Bt-Vt*kt;Ht=Vt*At-It*Bt;Ut=It*kt-wt*At;Qt=St*jt-Ct*Et;$t=Ct*Rt-Tt*jt;Kt=Tt*Et-St*Rt;var ta=Dt*Dt+Ft*Ft+Ot*Ot;var aa=Gt*Gt+Ht*Ht+Ut*Ut;var ia=Qt*Qt+$t*$t+Kt*Kt;var ra=ta>aa?ta>ia?ta:ia:aa>ia?aa:ia;var oa=r._relPos1X;var sa=r._relPos1Y;var na=r._relPos1Z;var ea=o._relPos1X;var _a=o._relPos1Y;var va=o._relPos1Z;var ha=n._relPos1X;var la=n._relPos1Y;var ca=n._relPos1Z;var pa;var fa;var ma;var ba;var ua;var xa;var ya;var ga;var Xa;var za;var Ma;var Ya;var Za;var da;var Ia;var wa;var Va;var La;var Aa;var ka;var Ba;var Pa;var Ta;var Sa;fa=ea-oa;ma=_a-sa;ba=va-na;xa=h-ha;ya=l-la;ga=c-ca;za=ha-oa;Ma=la-sa;Ya=ca-na;da=h-ea;Ia=l-_a;wa=c-va;La=h-oa;Aa=l-sa;ka=c-na;Pa=ha-ea;Ta=la-_a;Sa=ca-va;var Ca;var qa;var Ra;var Ea;var ja;var Na;var Da;var Fa;var Oa;var Wa;var Ga;var Ha;qa=ma*ga-ba*ya;Ra=ba*xa-fa*ga;Ea=fa*ya-ma*xa;Na=Ma*wa-Ya*Ia;Da=Ya*da-za*wa;Fa=za*Ia-Ma*da;Wa=Aa*Sa-ka*Ta;Ga=ka*Pa-La*Sa;Ha=La*Ta-Aa*Pa;var Ua=qa*qa+Ra*Ra+Ea*Ea;var Ja=Na*Na+Da*Da+Fa*Fa;var Qa=Wa*Wa+Ga*Ga+Ha*Ha;var $a=Ua>Ja?Ua>Qa?Ua:Qa:Ja>Qa?Ja:Qa;var Ka=r._relPos1X;var ti=r._relPos1Y;var ai=r._relPos1Z;var ii=o._relPos1X;var ri=o._relPos1Y;var oi=o._relPos1Z;var si=s._relPos1X;var ni=s._relPos1Y;var ei=s._relPos1Z;var _i;var vi;var hi;var li;var ci;var pi;var fi;var mi;var bi;var ui;var xi;var yi;var gi;var Xi;var zi;var Mi;var Yi;var Zi;var di;var Ii;var wi;var Vi;var Li;var Ai;vi=ii-Ka;hi=ri-ti;li=oi-ai;pi=h-si;fi=l-ni;mi=c-ei;ui=si-Ka;xi=ni-ti;yi=ei-ai;Xi=h-ii;zi=l-ri;Mi=c-oi;Zi=h-Ka;di=l-ti;Ii=c-ai;Vi=si-ii;Li=ni-ri;Ai=ei-oi;var ki;var Bi;var Pi;var Ti;var Si;var Ci;var qi;var Ri;var Ei;var ji;var Ni;var Di;Bi=hi*mi-li*fi;Pi=li*pi-vi*mi;Ti=vi*fi-hi*pi;Ci=xi*Mi-yi*zi;qi=yi*Xi-ui*Mi;Ri=ui*zi-xi*Xi;ji=di*Ai-Ii*Li;Ni=Ii*Vi-Zi*Ai;Di=Zi*Li-di*Vi;var Fi=Bi*Bi+Pi*Pi+Ti*Ti;var Oi=Ci*Ci+qi*qi+Ri*Ri;var Wi=ji*ji+Ni*Ni+Di*Di;var Gi=Fi>Oi?Fi>Wi?Fi:Wi:Oi>Wi?Oi:Wi;var Hi=_t;var Ui=0;if(ra>Hi&&_!=1||_==0){Hi=ra;Ui=1}if($a>Hi&&_!=2){Hi=$a;Ui=2}if(Gi>Hi&&_!=3){Hi=Gi;Ui=3}return Ui},computeRelativePositions:function(t,a){var i=this._manifold._numPoints;var r=0;var o=i;while(r<o){var s=r++;var n=this._manifold._points[s];var e;var _;var v;e=t._rotation00*n._localPos1X+t._rotation01*n._localPos1Y+t._rotation02*n._localPos1Z;_=t._rotation10*n._localPos1X+t._rotation11*n._localPos1Y+t._rotation12*n._localPos1Z;v=t._rotation20*n._localPos1X+t._rotation21*n._localPos1Y+t._rotation22*n._localPos1Z;n._relPos1X=e;n._relPos1Y=_;n._relPos1Z=v;var h;var l;var c;h=a._rotation00*n._localPos2X+a._rotation01*n._localPos2Y+a._rotation02*n._localPos2Z;l=a._rotation10*n._localPos2X+a._rotation11*n._localPos2Y+a._rotation12*n._localPos2Z;c=a._rotation20*n._localPos2X+a._rotation21*n._localPos2Y+a._rotation22*n._localPos2Z;n._relPos2X=h;n._relPos2Y=l;n._relPos2Z=c;n._warmStarted=true}},findNearestContactPointIndex:function(t,a,i){var r=ys.contactPersistenceThreshold*ys.contactPersistenceThreshold;var o=-1;var s=0;var n=this._manifold._numPoints;while(s<n){var e=s++;var _=this._manifold._points[e];var v;var h;var l;var c;var p;var f;var m;var b;var u=t.position1;h=u.x;l=u.y;c=u.z;var x=t.position2;f=x.x;m=x.y;b=x.z;h-=a._positionX;l-=a._positionY;c-=a._positionZ;f-=i._positionX;m-=i._positionY;b-=i._positionZ;var y;var g;var X;var z;var M;var Y;var Z;var d;g=_._relPos1X-h;X=_._relPos1Y-l;z=_._relPos1Z-c;Y=_._relPos2X-f;Z=_._relPos2Y-m;d=_._relPos2Z-b;var I=g*g+X*X+z*z;var w=Y*Y+Z*Z+d*d;var V=I<w?I:w;if(V<r){r=V;o=e}}return o},totalUpdate:function(t,a,i){this.numOldPoints=this._manifold._numPoints;var r=0;var o=this.numOldPoints;while(r<o){var s=r++;var n=this.oldPoints[s];var e=this._manifold._points[s];n._localPos1X=e._localPos1X;n._localPos1Y=e._localPos1Y;n._localPos1Z=e._localPos1Z;n._localPos2X=e._localPos2X;n._localPos2Y=e._localPos2Y;n._localPos2Z=e._localPos2Z;n._relPos1X=e._relPos1X;n._relPos1Y=e._relPos1Y;n._relPos1Z=e._relPos1Z;n._relPos2X=e._relPos2X;n._relPos2Y=e._relPos2Y;n._relPos2Z=e._relPos2Z;n._pos1X=e._pos1X;n._pos1Y=e._pos1Y;n._pos1Z=e._pos1Z;n._pos2X=e._pos2X;n._pos2Y=e._pos2Y;n._pos2Z=e._pos2Z;n._depth=e._depth;n._impulse.copyFrom(e._impulse);n._id=e._id;n._warmStarted=e._warmStarted;n._disabled=false}var _=t.numPoints;this._manifold._numPoints=_;var v=0;var h=_;while(v<h){var l=v++;var c=this._manifold._points[l];var p=t.points[l];var f=p.position1;c._pos1X=f.x;c._pos1Y=f.y;c._pos1Z=f.z;var m=p.position2;c._pos2X=m.x;c._pos2Y=m.y;c._pos2Z=m.z;c._relPos1X=c._pos1X-a._positionX;c._relPos1Y=c._pos1Y-a._positionY;c._relPos1Z=c._pos1Z-a._positionZ;c._relPos2X=c._pos2X-i._positionX;c._relPos2Y=c._pos2Y-i._positionY;c._relPos2Z=c._pos2Z-i._positionZ;var b;var u;var x;b=a._rotation00*c._relPos1X+a._rotation10*c._relPos1Y+a._rotation20*c._relPos1Z;u=a._rotation01*c._relPos1X+a._rotation11*c._relPos1Y+a._rotation21*c._relPos1Z;x=a._rotation02*c._relPos1X+a._rotation12*c._relPos1Y+a._rotation22*c._relPos1Z;c._localPos1X=b;c._localPos1Y=u;c._localPos1Z=x;var y;var g;var X;y=i._rotation00*c._relPos2X+i._rotation10*c._relPos2Y+i._rotation20*c._relPos2Z;g=i._rotation01*c._relPos2X+i._rotation11*c._relPos2Y+i._rotation21*c._relPos2Z;X=i._rotation02*c._relPos2X+i._rotation12*c._relPos2Y+i._rotation22*c._relPos2Z;c._localPos2X=y;c._localPos2Y=g;c._localPos2Z=X;c._depth=p.depth;var z=c._impulse;z.impulseN=0;z.impulseT=0;z.impulseB=0;z.impulseP=0;z.impulseLX=0;z.impulseLY=0;z.impulseLZ=0;c._id=p.id;c._warmStarted=false;c._disabled=false;var M=0;var Y=this.numOldPoints;while(M<Y){var Z=M++;var d=this.oldPoints[Z];if(c._id==d._id){c._impulse.copyFrom(d._impulse);c._warmStarted=true;break}}}},incrementalUpdate:function(t,a,i){this._manifold._updateDepthsAndPositions(a,i);var r=0;var o=this._manifold._numPoints;while(r<o){var s=r++;this._manifold._points[s]._warmStarted=true}var n=t.points[0];var e=this.findNearestContactPointIndex(n,a,i);if(e==-1){this.addManifoldPoint(n,a,i)}else{var _=this._manifold._points[e];var v=n.position1;_._pos1X=v.x;_._pos1Y=v.y;_._pos1Z=v.z;var h=n.position2;_._pos2X=h.x;_._pos2Y=h.y;_._pos2Z=h.z;_._relPos1X=_._pos1X-a._positionX;_._relPos1Y=_._pos1Y-a._positionY;_._relPos1Z=_._pos1Z-a._positionZ;_._relPos2X=_._pos2X-i._positionX;_._relPos2Y=_._pos2Y-i._positionY;_._relPos2Z=_._pos2Z-i._positionZ;var l;var c;var p;l=a._rotation00*_._relPos1X+a._rotation10*_._relPos1Y+a._rotation20*_._relPos1Z;c=a._rotation01*_._relPos1X+a._rotation11*_._relPos1Y+a._rotation21*_._relPos1Z;p=a._rotation02*_._relPos1X+a._rotation12*_._relPos1Y+a._rotation22*_._relPos1Z;_._localPos1X=l;_._localPos1Y=c;_._localPos1Z=p;var f;var m;var b;f=i._rotation00*_._relPos2X+i._rotation10*_._relPos2Y+i._rotation20*_._relPos2Z;m=i._rotation01*_._relPos2X+i._rotation11*_._relPos2Y+i._rotation21*_._relPos2Z;b=i._rotation02*_._relPos2X+i._rotation12*_._relPos2Y+i._rotation22*_._relPos2Z;_._localPos2X=f;_._localPos2Y=m;_._localPos2Z=b;_._depth=n.depth}this.removeOutdatedPoints()}};var bt=function(){this.lin1X=0;this.lin1Y=0;this.lin1Z=0;this.lin2X=0;this.lin2Y=0;this.lin2Z=0;this.ang1X=0;this.ang1Y=0;this.ang1Z=0;this.ang2X=0;this.ang2Y=0;this.ang2Z=0;this.flag=0};bt.prototype={updateSparsity:function(){this.flag=0;if(!(this.lin1X==0&&this.lin1Y==0&&this.lin1Z==0)||!(this.lin2X==0&&this.lin2Y==0&&this.lin2Z==0)){this.flag|=1}if(!(this.ang1X==0&&this.ang1Y==0&&this.ang1Z==0)||!(this.ang2X==0&&this.ang2Y==0&&this.ang2Z==0)){this.flag|=2}}};var ut=function(){this.b1=null;this.b2=null;this.numRows=0;var t=ys.maxManifoldPoints;var a=new Array(t);this.rows=a;var i=0;var r=this.rows.length;while(i<r){var o=i++;this.rows[o]=new xt}};var xt=function(){this.jacobianN=new bt;this.jacobianT=new bt;this.jacobianB=new bt;this.rhs=0;this.cfm=0;this.friction=0;this.impulse=null};var yt=function(){this.b1=null;this.b2=null;this.numRows=0;var t=ys.maxJacobianRows;var a=new Array(t);this.rows=a;var i=0;var r=this.rows.length;while(i<r){var o=i++;this.rows[o]=new gt}};var gt=function(){this.jacobian=new bt;this.rhs=0;this.cfm=0;this.minImpulse=0;this.maxImpulse=0;this.motorSpeed=0;this.motorMaxImpulse=0;this.impulse=null};var Ei=function(t,a){this._link1=new It(this);this._link2=new It(this);this._positionCorrectionAlgorithm=ys.defaultJointPositionCorrectionAlgorithm;this._type=a;this._world=null;this._b1=t.rigidBody1;this._b2=t.rigidBody2;this._allowCollision=t.allowCollision;this._breakForce=t.breakForce;this._breakTorque=t.breakTorque;var i=t.solverType;switch(i){case 0:this._solver=new Kt(this);break;case 1:this._solver=new Jt(this);break}var r=t.localAnchor1;this._localAnchor1X=r.x;this._localAnchor1Y=r.y;this._localAnchor1Z=r.z;var o=t.localAnchor2;this._localAnchor2X=o.x;this._localAnchor2Y=o.y;this._localAnchor2Z=o.z;this._relativeAnchor1X=0;this._relativeAnchor1Y=0;this._relativeAnchor1Z=0;this._relativeAnchor2X=0;this._relativeAnchor2Y=0;this._relativeAnchor2Z=0;this._anchor1X=0;this._anchor1Y=0;this._anchor1Z=0;this._anchor2X=0;this._anchor2Y=0;this._anchor2Z=0;this._localBasisX1X=0;this._localBasisX1Y=0;this._localBasisX1Z=0;this._localBasisY1X=0;this._localBasisY1Y=0;this._localBasisY1Z=0;this._localBasisZ1X=0;this._localBasisZ1Y=0;this._localBasisZ1Z=0;this._localBasisX2X=0;this._localBasisX2Y=0;this._localBasisX2Z=0;this._localBasisY2X=0;this._localBasisY2Y=0;this._localBasisY2Z=0;this._localBasisZ2X=0;this._localBasisZ2Y=0;this._localBasisZ2Z=0;var s=ys.maxJacobianRows;var n=new Array(s);this._impulses=n;var e=0;var _=ys.maxJacobianRows;while(e<_){var v=e++;this._impulses[v]=new dt}};Ei.prototype={_syncAnchors:function(){var t=this._b1._transform;var a=this._b2._transform;var i;var r;var o;i=t._rotation00*this._localAnchor1X+t._rotation01*this._localAnchor1Y+t._rotation02*this._localAnchor1Z;r=t._rotation10*this._localAnchor1X+t._rotation11*this._localAnchor1Y+t._rotation12*this._localAnchor1Z;o=t._rotation20*this._localAnchor1X+t._rotation21*this._localAnchor1Y+t._rotation22*this._localAnchor1Z;this._relativeAnchor1X=i;this._relativeAnchor1Y=r;this._relativeAnchor1Z=o;var s;var n;var e;s=a._rotation00*this._localAnchor2X+a._rotation01*this._localAnchor2Y+a._rotation02*this._localAnchor2Z;n=a._rotation10*this._localAnchor2X+a._rotation11*this._localAnchor2Y+a._rotation12*this._localAnchor2Z;e=a._rotation20*this._localAnchor2X+a._rotation21*this._localAnchor2Y+a._rotation22*this._localAnchor2Z;this._relativeAnchor2X=s;this._relativeAnchor2Y=n;this._relativeAnchor2Z=e;this._anchor1X=this._relativeAnchor1X+t._positionX;this._anchor1Y=this._relativeAnchor1Y+t._positionY;this._anchor1Z=this._relativeAnchor1Z+t._positionZ;this._anchor2X=this._relativeAnchor2X+a._positionX;this._anchor2Y=this._relativeAnchor2Y+a._positionY;this._anchor2Z=this._relativeAnchor2Z+a._positionZ;var _;var v;var h;_=t._rotation00*this._localBasisX1X+t._rotation01*this._localBasisX1Y+t._rotation02*this._localBasisX1Z;v=t._rotation10*this._localBasisX1X+t._rotation11*this._localBasisX1Y+t._rotation12*this._localBasisX1Z;h=t._rotation20*this._localBasisX1X+t._rotation21*this._localBasisX1Y+t._rotation22*this._localBasisX1Z;this._basisX1X=_;this._basisX1Y=v;this._basisX1Z=h;var l;var c;var p;l=t._rotation00*this._localBasisY1X+t._rotation01*this._localBasisY1Y+t._rotation02*this._localBasisY1Z;c=t._rotation10*this._localBasisY1X+t._rotation11*this._localBasisY1Y+t._rotation12*this._localBasisY1Z;p=t._rotation20*this._localBasisY1X+t._rotation21*this._localBasisY1Y+t._rotation22*this._localBasisY1Z;this._basisY1X=l;this._basisY1Y=c;this._basisY1Z=p;var f;var m;var b;f=t._rotation00*this._localBasisZ1X+t._rotation01*this._localBasisZ1Y+t._rotation02*this._localBasisZ1Z;m=t._rotation10*this._localBasisZ1X+t._rotation11*this._localBasisZ1Y+t._rotation12*this._localBasisZ1Z;b=t._rotation20*this._localBasisZ1X+t._rotation21*this._localBasisZ1Y+t._rotation22*this._localBasisZ1Z;this._basisZ1X=f;this._basisZ1Y=m;this._basisZ1Z=b;var u;var x;var y;u=a._rotation00*this._localBasisX2X+a._rotation01*this._localBasisX2Y+a._rotation02*this._localBasisX2Z;x=a._rotation10*this._localBasisX2X+a._rotation11*this._localBasisX2Y+a._rotation12*this._localBasisX2Z;y=a._rotation20*this._localBasisX2X+a._rotation21*this._localBasisX2Y+a._rotation22*this._localBasisX2Z;this._basisX2X=u;this._basisX2Y=x;this._basisX2Z=y;var g;var X;var z;g=a._rotation00*this._localBasisY2X+a._rotation01*this._localBasisY2Y+a._rotation02*this._localBasisY2Z;X=a._rotation10*this._localBasisY2X+a._rotation11*this._localBasisY2Y+a._rotation12*this._localBasisY2Z;z=a._rotation20*this._localBasisY2X+a._rotation21*this._localBasisY2Y+a._rotation22*this._localBasisY2Z;this._basisY2X=g;this._basisY2Y=X;this._basisY2Z=z;var M;var Y;var Z;M=a._rotation00*this._localBasisZ2X+a._rotation01*this._localBasisZ2Y+a._rotation02*this._localBasisZ2Z;Y=a._rotation10*this._localBasisZ2X+a._rotation11*this._localBasisZ2Y+a._rotation12*this._localBasisZ2Z;Z=a._rotation20*this._localBasisZ2X+a._rotation21*this._localBasisZ2Y+a._rotation22*this._localBasisZ2Z;this._basisZ2X=M;this._basisZ2Y=Y;this._basisZ2Z=Z},_getVelocitySolverInfo:function(t,a){a.b1=this._b1;a.b2=this._b2;a.numRows=0},_getPositionSolverInfo:function(t){t.b1=this._b1;t.b2=this._b2;t.numRows=0},_checkDestruction:function(){var t=this._appliedForceX*this._appliedForceX+this._appliedForceY*this._appliedForceY+this._appliedForceZ*this._appliedForceZ;var a=this._appliedTorqueX*this._appliedTorqueX+this._appliedTorqueY*this._appliedTorqueY+this._appliedTorqueZ*this._appliedTorqueZ;if(this._breakForce>0&&t>this._breakForce*this._breakForce){this._world.removeJoint(this);return}if(this._breakTorque>0&&a>this._breakTorque*this._breakTorque){this._world.removeJoint(this);return}},getRigidBody1:function(){return this._b1},getRigidBody2:function(){return this._b2},getType:function(){return this._type},getAnchor1:function(){var t=new Is;var a=t;a.x=this._anchor1X;a.y=this._anchor1Y;a.z=this._anchor1Z;return t},getAnchor2:function(){var t=new Is;var a=t;a.x=this._anchor2X;a.y=this._anchor2Y;a.z=this._anchor2Z;return t},getAnchor1To:function(t){var a=t;a.x=this._anchor1X;a.y=this._anchor1Y;a.z=this._anchor1Z},getAnchor2To:function(t){var a=t;a.x=this._anchor2X;a.y=this._anchor2Y;a.z=this._anchor2Z},getLocalAnchor1:function(){var t=new Is;var a=t;a.x=this._localAnchor1X;a.y=this._localAnchor1Y;a.z=this._localAnchor1Z;return t},getLocalAnchor2:function(){var t=new Is;var a=t;a.x=this._localAnchor2X;a.y=this._localAnchor2Y;a.z=this._localAnchor2Z;return t},getLocalAnchor1To:function(t){var a=t;a.x=this._localAnchor1X;a.y=this._localAnchor1Y;a.z=this._localAnchor1Z},getLocalAnchor2To:function(t){var a=t;a.x=this._localAnchor2X;a.y=this._localAnchor2Y;a.z=this._localAnchor2Z},getBasis1:function(){var t=new ws;var a;var i;var r;var o;var s;var n;var e;var _;var v;var h;i=this._basisX1X;r=this._basisY1X;o=this._basisZ1X;s=this._basisX1Y;n=this._basisY1Y;e=this._basisZ1Y;_=this._basisX1Z;v=this._basisY1Z;h=this._basisZ1Z;var l=t;l.e00=i;l.e01=r;l.e02=o;l.e10=s;l.e11=n;l.e12=e;l.e20=_;l.e21=v;l.e22=h;return t},getBasis2:function(){var t=new ws;var a;var i;var r;var o;var s;var n;var e;var _;var v;var h;i=this._basisX2X;r=this._basisY2X;o=this._basisZ2X;s=this._basisX2Y;n=this._basisY2Y;e=this._basisZ2Y;_=this._basisX2Z;v=this._basisY2Z;h=this._basisZ2Z;var l=t;l.e00=i;l.e01=r;l.e02=o;l.e10=s;l.e11=n;l.e12=e;l.e20=_;l.e21=v;l.e22=h;return t},getBasis1To:function(t){var a;var i;var r;var o;var s;var n;var e;var _;var v;var h;i=this._basisX1X;r=this._basisY1X;o=this._basisZ1X;s=this._basisX1Y;n=this._basisY1Y;e=this._basisZ1Y;_=this._basisX1Z;v=this._basisY1Z;h=this._basisZ1Z;var l=t;l.e00=i;l.e01=r;l.e02=o;l.e10=s;l.e11=n;l.e12=e;l.e20=_;l.e21=v;l.e22=h},getBasis2To:function(t){var a;var i;var r;var o;var s;var n;var e;var _;var v;var h;i=this._basisX2X;r=this._basisY2X;o=this._basisZ2X;s=this._basisX2Y;n=this._basisY2Y;e=this._basisZ2Y;_=this._basisX2Z;v=this._basisY2Z;h=this._basisZ2Z;var l=t;l.e00=i;l.e01=r;l.e02=o;l.e10=s;l.e11=n;l.e12=e;l.e20=_;l.e21=v;l.e22=h},getAllowCollision:function(){return this._allowCollision},setAllowCollision:function(t){this._allowCollision=t},getBreakForce:function(){return this._breakForce},setBreakForce:function(t){this._breakForce=t},getBreakTorque:function(){return this._breakTorque},setBreakTorque:function(t){this._breakTorque=t},getPositionCorrectionAlgorithm:function(){return this._positionCorrectionAlgorithm},setPositionCorrectionAlgorithm:function(t){switch(t){case 0:case 1:case 2:break;default:throw new Error("invalid position correction algorithm id: "+t)}this._positionCorrectionAlgorithm=t},getAppliedForce:function(){var t=new Is;var a=t;a.x=this._appliedForceX;a.y=this._appliedForceY;a.z=this._appliedForceZ;return t},getAppliedForceTo:function(t){var a=t;a.x=this._appliedForceX;a.y=this._appliedForceY;a.z=this._appliedForceZ},getAppliedTorque:function(){var t=new Is;var a=t;a.x=this._appliedTorqueX;a.y=this._appliedTorqueY;a.z=this._appliedTorqueZ;return t},getAppliedTorqueTo:function(t){var a=t;a.x=this._appliedTorqueX;a.y=this._appliedTorqueY;a.z=this._appliedTorqueZ},getPrev:function(){return this._prev},getNext:function(){return this._next}};var Xt=function(t){Ei.call(this,t,2);var a=t.localAxis1;this._localBasisX1X=a.x;this._localBasisX1Y=a.y;this._localBasisX1Z=a.z;var i=t.localAxis2;this._localBasisX2X=i.x;this._localBasisX2Y=i.y;this._localBasisX2Z=i.z;if(this._localBasisX1X*this._localBasisX1X+this._localBasisX1Y*this._localBasisX1Y+this._localBasisX1Z*this._localBasisX1Z==0){this._localBasisX1X=1;this._localBasisX1Y=0;this._localBasisX1Z=0}else{var r=this._localBasisX1X*this._localBasisX1X+this._localBasisX1Y*this._localBasisX1Y+this._localBasisX1Z*this._localBasisX1Z;if(r>0){r=1/Math.sqrt(r)}this._localBasisX1X*=r;this._localBasisX1Y*=r;this._localBasisX1Z*=r}if(this._localBasisX2X*this._localBasisX2X+this._localBasisX2Y*this._localBasisX2Y+this._localBasisX2Z*this._localBasisX2Z==0){this._localBasisX2X=1;this._localBasisX2Y=0;this._localBasisX2Z=0}else{var o=this._localBasisX2X*this._localBasisX2X+this._localBasisX2Y*this._localBasisX2Y+this._localBasisX2Z*this._localBasisX2Z;if(o>0){o=1/Math.sqrt(o)}this._localBasisX2X*=o;this._localBasisX2Y*=o;this._localBasisX2Z*=o}var s;var n;var e;var _;var v;var h;var l;var c;var p;var f;var m;var b;var u;var x;var y;var g=this._localBasisX1X*this._localBasisX2X+this._localBasisX1Y*this._localBasisX2Y+this._localBasisX1Z*this._localBasisX2Z;if(g<-.999999999){var X;var z;var M;var Y=this._localBasisX1X;var Z=this._localBasisX1Y;var d=this._localBasisX1Z;var I=Y*Y;var w=Z*Z;var V=d*d;var L;if(I<w){if(I<V){L=1/Math.sqrt(w+V);X=0;z=d*L;M=-Z*L}else{L=1/Math.sqrt(I+w);X=Z*L;z=-Y*L;M=0}}else if(w<V){L=1/Math.sqrt(V+I);X=-d*L;z=0;M=Y*L}else{L=1/Math.sqrt(I+w);X=Z*L;z=-Y*L;M=0}n=X;e=z;_=M;v=0}else{var A;var k;var B;A=this._localBasisX1Y*this._localBasisX2Z-this._localBasisX1Z*this._localBasisX2Y;k=this._localBasisX1Z*this._localBasisX2X-this._localBasisX1X*this._localBasisX2Z;B=this._localBasisX1X*this._localBasisX2Y-this._localBasisX1Y*this._localBasisX2X;var P=Math.sqrt((1+g)*.5);g=.5/P;A*=g;k*=g;B*=g;n=A;e=k;_=B;v=P}var T=n;var S=e;var C=_;var q=v;var R=2*T;var E=2*S;var j=2*C;var N=T*R;var D=S*E;var F=C*j;var O=T*E;var W=S*j;var G=T*j;var H=q*R;var U=q*E;var J=q*j;l=1-D-F;c=O-J;p=G+U;f=O+J;m=1-N-F;b=W-H;u=G-U;x=W+H;y=1-N-D;var Q=this._localBasisX1X;var $=this._localBasisX1Y;var K=this._localBasisX1Z;var tt=Q*Q;var at=$*$;var it=K*K;var rt;if(tt<at){if(tt<it){rt=1/Math.sqrt(at+it);this._localBasisY1X=0;this._localBasisY1Y=K*rt;this._localBasisY1Z=-$*rt}else{rt=1/Math.sqrt(tt+at);this._localBasisY1X=$*rt;this._localBasisY1Y=-Q*rt;this._localBasisY1Z=0}}else if(at<it){rt=1/Math.sqrt(it+tt);this._localBasisY1X=-K*rt;this._localBasisY1Y=0;this._localBasisY1Z=Q*rt}else{rt=1/Math.sqrt(tt+at);this._localBasisY1X=$*rt;this._localBasisY1Y=-Q*rt;this._localBasisY1Z=0}this._localBasisZ1X=this._localBasisX1Y*this._localBasisY1Z-this._localBasisX1Z*this._localBasisY1Y;this._localBasisZ1Y=this._localBasisX1Z*this._localBasisY1X-this._localBasisX1X*this._localBasisY1Z;this._localBasisZ1Z=this._localBasisX1X*this._localBasisY1Y-this._localBasisX1Y*this._localBasisY1X;var ot;var st;var nt;ot=l*this._localBasisX1X+c*this._localBasisX1Y+p*this._localBasisX1Z;st=f*this._localBasisX1X+m*this._localBasisX1Y+b*this._localBasisX1Z;nt=u*this._localBasisX1X+x*this._localBasisX1Y+y*this._localBasisX1Z;this._localBasisX2X=ot;this._localBasisX2Y=st;this._localBasisX2Z=nt;var et;var _t;var vt;et=l*this._localBasisY1X+c*this._localBasisY1Y+p*this._localBasisY1Z;_t=f*this._localBasisY1X+m*this._localBasisY1Y+b*this._localBasisY1Z;vt=u*this._localBasisY1X+x*this._localBasisY1Y+y*this._localBasisY1Z;this._localBasisY2X=et;this._localBasisY2Y=_t;this._localBasisY2Z=vt;var ht;var lt;var ct;ht=l*this._localBasisZ1X+c*this._localBasisZ1Y+p*this._localBasisZ1Z;lt=f*this._localBasisZ1X+m*this._localBasisZ1Y+b*this._localBasisZ1Z;ct=u*this._localBasisZ1X+x*this._localBasisZ1Y+y*this._localBasisZ1Z;this._localBasisZ2X=ht;this._localBasisZ2Y=lt;this._localBasisZ2Z=ct;this.angle=0;this.angularErrorY=0;this.angularErrorZ=0;this.translation=0;this.linearErrorY=0;this.linearErrorZ=0;this._basis=new Zt(this);this._translSd=t.translationalSpringDamper.clone();this._translLm=t.translationalLimitMotor.clone();this._rotSd=t.rotationalSpringDamper.clone();this._rotLm=t.rotationalLimitMotor.clone()};Xt.__super__=Ei;Xt.prototype=$extend(Ei.prototype,{getInfo:function(t,a,i){var r=i?1:this._positionCorrectionAlgorithm==ka.BAUMGARTE?a.invDt*ys.velocityBaumgarte:0;var o=this.linearErrorY*r;var s=this.linearErrorZ*r;var n=this.angularErrorY*r;var e=this.angularErrorZ*r;var _;var v;var h;var l;var c;var p;var f;var m;var b;var u;var x;var y;var g;var X;var z;var M;var Y;var Z;var d;var I;v=0;h=-this._relativeAnchor1Z;l=this._relativeAnchor1Y;c=this._relativeAnchor1Z;p=0;f=-this._relativeAnchor1X;m=-this._relativeAnchor1Y;b=this._relativeAnchor1X;u=0;y=0;g=-this._relativeAnchor2Z;X=this._relativeAnchor2Y;z=this._relativeAnchor2Z;M=0;Y=-this._relativeAnchor2X;Z=-this._relativeAnchor2Y;d=this._relativeAnchor2X;I=0;v=-v;h=-h;l=-l;c=-c;p=-p;f=-f;m=-m;b=-b;u=-u;y=-y;g=-g;X=-X;z=-z;M=-M;Y=-Y;Z=-Z;d=-d;I=-I;var w;var V;var L=1/(this._b1._invMass+this._b2._invMass);var A=this._basis.xX;var k=this._basis.xY;var B=this._basis.xZ;var P;var T;var S;var C;var q;var R;var E;var j;var N;var D;var F;N=this._b1._invInertia00*A+this._b1._invInertia01*k+this._b1._invInertia02*B;D=this._b1._invInertia10*A+this._b1._invInertia11*k+this._b1._invInertia12*B;F=this._b1._invInertia20*A+this._b1._invInertia21*k+this._b1._invInertia22*B;T=N;S=D;C=F;var O;var W;var G;O=this._b2._invInertia00*A+this._b2._invInertia01*k+this._b2._invInertia02*B;W=this._b2._invInertia10*A+this._b2._invInertia11*k+this._b2._invInertia12*B;G=this._b2._invInertia20*A+this._b2._invInertia21*k+this._b2._invInertia22*B;R=O;E=W;j=G;var H=T*A+S*k+C*B;var U=R*A+E*k+j*B;if(H>0){var J=this._relativeAnchor1X*this._relativeAnchor1X+this._relativeAnchor1Y*this._relativeAnchor1Y+this._relativeAnchor1Z*this._relativeAnchor1Z;var Q=A*this._relativeAnchor1X+k*this._relativeAnchor1Y+B*this._relativeAnchor1Z;var $=J-Q*Q;if($>0){if(this._b1._invMass>0){H=1/(1/H+this._b1._mass*$)}else{H=0}}}if(U>0){var K=this._relativeAnchor2X*this._relativeAnchor2X+this._relativeAnchor2Y*this._relativeAnchor2Y+this._relativeAnchor2Z*this._relativeAnchor2Z;var tt=A*this._relativeAnchor2X+k*this._relativeAnchor2Y+B*this._relativeAnchor2Z;var at=K-tt*tt;if(at>0){if(this._b2._invMass>0){U=1/(1/U+this._b2._mass*at)}else{U=0}}}var it=H+U==0?0:1/(H+U);if(this._translSd.frequency<=0||!i){var rt=this._impulses[0];var ot=t.rows[t.numRows++];var st=ot.jacobian;st.lin1X=0;st.lin1Y=0;st.lin1Z=0;st.lin2X=0;st.lin2Y=0;st.lin2Z=0;st.ang1X=0;st.ang1Y=0;st.ang1Z=0;st.ang2X=0;st.ang2Y=0;st.ang2Z=0;ot.rhs=0;ot.cfm=0;ot.minImpulse=0;ot.maxImpulse=0;ot.motorSpeed=0;ot.motorMaxImpulse=0;ot.impulse=null;ot.impulse=rt;w=ot;var nt=this.translation;var et=this._translLm;var _t=this._translSd;var vt;var ht;var lt=ys.linearSlop;if(i){vt=0;ht=1}else{if(_t.frequency>0){lt=0;var ct=6.28318530717958*_t.frequency;var pt=_t.dampingRatio;if(pt<ys.minSpringDamperDampingRatio){pt=ys.minSpringDamperDampingRatio}var ft=a.dt;var mt=2*pt*ct;var bt=ct*ct;if(_t.useSymplecticEuler){vt=1/(ft*mt);ht=bt/mt}else{vt=1/(ft*(ft*bt+mt));ht=bt/(ft*bt+mt)}}else{vt=0;ht=this._positionCorrectionAlgorithm==ka.BAUMGARTE?a.invDt*ys.velocityBaumgarte:0}if(et.motorForce>0){w.motorSpeed=et.motorSpeed;w.motorMaxImpulse=et.motorForce*a.dt}else{w.motorSpeed=0;w.motorMaxImpulse=0}}var ut=et.lowerLimit;var xt=et.upperLimit;var yt;var gt;var Xt;if(ut>xt){yt=0;gt=0;Xt=0}else if(ut==xt){yt=-1/0;gt=1/0;Xt=nt-ut}else if(nt<ut){yt=-1/0;gt=0;Xt=nt-ut+lt;if(Xt>0){Xt=0}}else if(nt>xt){yt=0;gt=1/0;Xt=nt-xt-lt;if(Xt<0){Xt=0}}else{yt=0;gt=0;Xt=0}var zt=L==0?0:1/L;w.minImpulse=yt;w.maxImpulse=gt;w.cfm=vt*zt;w.rhs=Xt*ht;V=w.jacobian;V.lin1X=this._basis.xX;V.lin1Y=this._basis.xY;V.lin1Z=this._basis.xZ;V.lin2X=this._basis.xX;V.lin2Y=this._basis.xY;V.lin2Z=this._basis.xZ;V.ang1X=v;V.ang1Y=h;V.ang1Z=l;V.ang2X=y;V.ang2Y=g;V.ang2Z=X}var Mt=this._impulses[1];var Yt=t.rows[t.numRows++];var Zt=Yt.jacobian;Zt.lin1X=0;Zt.lin1Y=0;Zt.lin1Z=0;Zt.lin2X=0;Zt.lin2Y=0;Zt.lin2Z=0;Zt.ang1X=0;Zt.ang1Y=0;Zt.ang1Z=0;Zt.ang2X=0;Zt.ang2Y=0;Zt.ang2Z=0;Yt.rhs=0;Yt.cfm=0;Yt.minImpulse=0;Yt.maxImpulse=0;Yt.motorSpeed=0;Yt.motorMaxImpulse=0;Yt.impulse=null;Yt.impulse=Mt;w=Yt;w.rhs=o;w.cfm=0;w.minImpulse=-1/0;w.maxImpulse=1/0;V=w.jacobian;V.lin1X=this._basis.yX;V.lin1Y=this._basis.yY;V.lin1Z=this._basis.yZ;V.lin2X=this._basis.yX;V.lin2Y=this._basis.yY;V.lin2Z=this._basis.yZ;V.ang1X=c;V.ang1Y=p;V.ang1Z=f;V.ang2X=z;V.ang2Y=M;V.ang2Z=Y;var dt=this._impulses[2];var It=t.rows[t.numRows++];var wt=It.jacobian;wt.lin1X=0;wt.lin1Y=0;wt.lin1Z=0;wt.lin2X=0;wt.lin2Y=0;wt.lin2Z=0;wt.ang1X=0;wt.ang1Y=0;wt.ang1Z=0;wt.ang2X=0;wt.ang2Y=0;wt.ang2Z=0;It.rhs=0;It.cfm=0;It.minImpulse=0;It.maxImpulse=0;It.motorSpeed=0;It.motorMaxImpulse=0;It.impulse=null;It.impulse=dt;w=It;w.rhs=s;w.cfm=0;w.minImpulse=-1/0;w.maxImpulse=1/0;V=w.jacobian;V.lin1X=this._basis.zX;V.lin1Y=this._basis.zY;V.lin1Z=this._basis.zZ;V.lin2X=this._basis.zX;V.lin2Y=this._basis.zY;V.lin2Z=this._basis.zZ;V.ang1X=m;V.ang1Y=b;V.ang1Z=u;V.ang2X=Z;V.ang2Y=d;V.ang2Z=I;if(this._rotSd.frequency<=0||!i){var Vt=this._impulses[3];var Lt=t.rows[t.numRows++];var At=Lt.jacobian;At.lin1X=0;At.lin1Y=0;At.lin1Z=0;At.lin2X=0;At.lin2Y=0;At.lin2Z=0;At.ang1X=0;At.ang1Y=0;At.ang1Z=0;At.ang2X=0;At.ang2Y=0;At.ang2Z=0;Lt.rhs=0;Lt.cfm=0;Lt.minImpulse=0;Lt.maxImpulse=0;Lt.motorSpeed=0;Lt.motorMaxImpulse=0;Lt.impulse=null;Lt.impulse=Vt;w=Lt;var kt=this.angle;var Bt=this._rotLm;var Pt=this._rotSd;var Tt;var St;var Ct=ys.angularSlop;if(i){Tt=0;St=1}else{if(Pt.frequency>0){Ct=0;var qt=6.28318530717958*Pt.frequency;var Rt=Pt.dampingRatio;if(Rt<ys.minSpringDamperDampingRatio){Rt=ys.minSpringDamperDampingRatio}var Et=a.dt;var jt=2*Rt*qt;var Nt=qt*qt;if(Pt.useSymplecticEuler){Tt=1/(Et*jt);St=Nt/jt}else{Tt=1/(Et*(Et*Nt+jt));St=Nt/(Et*Nt+jt)}}else{Tt=0;St=this._positionCorrectionAlgorithm==ka.BAUMGARTE?a.invDt*ys.velocityBaumgarte:0}if(Bt.motorTorque>0){w.motorSpeed=Bt.motorSpeed;w.motorMaxImpulse=Bt.motorTorque*a.dt}else{w.motorSpeed=0;w.motorMaxImpulse=0}}var Dt=Bt.lowerLimit;var Ft=Bt.upperLimit;var Ot=(Dt+Ft)*.5;kt-=Ot;kt=((kt+3.14159265358979)%6.28318530717958+6.28318530717958)%6.28318530717958-3.14159265358979;kt+=Ot;var Wt;var Gt;var Ht;if(Dt>Ft){Wt=0;Gt=0;Ht=0}else if(Dt==Ft){Wt=-1/0;Gt=1/0;Ht=kt-Dt}else if(kt<Dt){Wt=-1/0;Gt=0;Ht=kt-Dt+Ct;if(Ht>0){Ht=0}}else if(kt>Ft){Wt=0;Gt=1/0;Ht=kt-Ft-Ct;if(Ht<0){Ht=0}}else{Wt=0;Gt=0;Ht=0}var Ut=it==0?0:1/it;w.minImpulse=Wt;w.maxImpulse=Gt;w.cfm=Tt*Ut;w.rhs=Ht*St;V=w.jacobian;V.ang1X=this._basis.xX;V.ang1Y=this._basis.xY;V.ang1Z=this._basis.xZ;V.ang2X=this._basis.xX;V.ang2Y=this._basis.xY;V.ang2Z=this._basis.xZ}var Jt=this._impulses[4];var Qt=t.rows[t.numRows++];var $t=Qt.jacobian;$t.lin1X=0;$t.lin1Y=0;$t.lin1Z=0;$t.lin2X=0;$t.lin2Y=0;$t.lin2Z=0;$t.ang1X=0;$t.ang1Y=0;$t.ang1Z=0;$t.ang2X=0;$t.ang2Y=0;$t.ang2Z=0;Qt.rhs=0;Qt.cfm=0;Qt.minImpulse=0;Qt.maxImpulse=0;Qt.motorSpeed=0;Qt.motorMaxImpulse=0;Qt.impulse=null;Qt.impulse=Jt;w=Qt;w.rhs=n;w.cfm=0;w.minImpulse=-1/0;w.maxImpulse=1/0;V=w.jacobian;V.ang1X=this._basis.yX;V.ang1Y=this._basis.yY;V.ang1Z=this._basis.yZ;V.ang2X=this._basis.yX;V.ang2Y=this._basis.yY;V.ang2Z=this._basis.yZ;var Kt=this._impulses[5];var ta=t.rows[t.numRows++];var aa=ta.jacobian;aa.lin1X=0;aa.lin1Y=0;aa.lin1Z=0;aa.lin2X=0;aa.lin2Y=0;aa.lin2Z=0;aa.ang1X=0;aa.ang1Y=0;aa.ang1Z=0;aa.ang2X=0;aa.ang2Y=0;aa.ang2Z=0;ta.rhs=0;ta.cfm=0;ta.minImpulse=0;ta.maxImpulse=0;ta.motorSpeed=0;ta.motorMaxImpulse=0;ta.impulse=null;ta.impulse=Kt;w=ta;w.rhs=e;w.cfm=0;w.minImpulse=-1/0;w.maxImpulse=1/0;V=w.jacobian;V.ang1X=this._basis.zX;V.ang1Y=this._basis.zY;V.ang1Z=this._basis.zZ;V.ang2X=this._basis.zX;V.ang2Y=this._basis.zY;V.ang2Z=this._basis.zZ},_syncAnchors:function(){Ei.prototype._syncAnchors.call(this);var t=this._basis;var a=t.joint._b1._invMass;var i=t.joint._b2._invMass;var r;var o;var s;var n;var e;var _;var v;var h;var l;var c;var p;var f;var m;var b;var u;var x;var y;var g;var X;var z;var M;var Y;var Z;var d;var I;var w;var V;var L;var A;var k;var B;var P;var T;var S;var C;var q;var R;var E;var j;var N;var D;var F;var O;var W;var G;var H=t.joint._basisX1X*t.joint._basisX2X+t.joint._basisX1Y*t.joint._basisX2Y+t.joint._basisX1Z*t.joint._basisX2Z;if(H<-.999999999){var U;var J;var Q;var $=t.joint._basisX1X;var K=t.joint._basisX1Y;var tt=t.joint._basisX1Z;var at=$*$;var it=K*K;var rt=tt*tt;var ot;if(at<it){if(at<rt){ot=1/Math.sqrt(it+rt);U=0;J=tt*ot;Q=-K*ot}else{ot=1/Math.sqrt(at+it);U=K*ot;J=-$*ot;Q=0}}else if(it<rt){ot=1/Math.sqrt(rt+at);U=-tt*ot;J=0;Q=$*ot}else{ot=1/Math.sqrt(at+it);U=K*ot;J=-$*ot;Q=0}o=U;s=J;n=Q;e=0}else{var st;var nt;var et;st=t.joint._basisX1Y*t.joint._basisX2Z-t.joint._basisX1Z*t.joint._basisX2Y;nt=t.joint._basisX1Z*t.joint._basisX2X-t.joint._basisX1X*t.joint._basisX2Z;et=t.joint._basisX1X*t.joint._basisX2Y-t.joint._basisX1Y*t.joint._basisX2X;var _t=Math.sqrt((1+H)*.5);H=.5/_t;st*=H;nt*=H;et*=H;o=st;s=nt;n=et;e=_t}v=0;h=0;l=0;c=1;var vt;var ht;var lt;var ct;var pt;var ft;var mt;var bt;var ut;var xt;var yt;var gt;pt=v;ft=h;mt=l;bt=c;ut=o;xt=s;yt=n;gt=e;var Xt=pt*ut+ft*xt+mt*yt+bt*gt;if(Xt<0){Xt=-Xt;ut=-ut;xt=-xt;yt=-yt;gt=-gt}if(Xt>.999999){var zt;var Mt;var Yt;var Zt;zt=ut-pt;Mt=xt-ft;Yt=yt-mt;Zt=gt-bt;ut=pt+zt*(a/(a+i));xt=ft+Mt*(a/(a+i));yt=mt+Yt*(a/(a+i));gt=bt+Zt*(a/(a+i));var dt=ut*ut+xt*xt+yt*yt+gt*gt;if(dt>1e-32){dt=1/Math.sqrt(dt)}f=ut*dt;m=xt*dt;b=yt*dt;u=gt*dt}else{var It=a/(a+i)*Math.acos(Xt);ut+=pt*-Xt;xt+=ft*-Xt;yt+=mt*-Xt;gt+=bt*-Xt;var wt=ut*ut+xt*xt+yt*yt+gt*gt;if(wt>1e-32){wt=1/Math.sqrt(wt)}ut*=wt;xt*=wt;yt*=wt;gt*=wt;var Vt=Math.sin(It);var Lt=Math.cos(It);pt*=Lt;ft*=Lt;mt*=Lt;bt*=Lt;f=pt+ut*Vt;m=ft+xt*Vt;b=mt+yt*Vt;u=bt+gt*Vt}var At=f;var kt=m;var Bt=b;var Pt=u;var Tt=2*At;var St=2*kt;var Ct=2*Bt;var qt=At*Tt;var Rt=kt*St;var Et=Bt*Ct;var jt=At*St;var Nt=kt*Ct;var Dt=At*Ct;var Ft=Pt*Tt;var Ot=Pt*St;var Wt=Pt*Ct;y=1-Rt-Et;g=jt-Wt;X=Dt+Ot;z=jt+Wt;M=1-qt-Et;Y=Nt-Ft;Z=Dt-Ot;d=Nt+Ft;I=1-qt-Rt;var Gt;var Ht;var Ut;Gt=y*t.joint._basisX1X+g*t.joint._basisX1Y+X*t.joint._basisX1Z;Ht=z*t.joint._basisX1X+M*t.joint._basisX1Y+Y*t.joint._basisX1Z;Ut=Z*t.joint._basisX1X+d*t.joint._basisX1Y+I*t.joint._basisX1Z;V=Gt;L=Ht;A=Ut;j=t.xX;N=t.xY;D=t.xZ;O=t.yX;W=t.yY;G=t.yZ;var Jt=j*V+N*L+D*A;if(Jt<-.999999999){var Qt;var $t;var Kt;var ta=j;var aa=N;var ia=D;var ra=ta*ta;var oa=aa*aa;var sa=ia*ia;var na;if(ra<oa){if(ra<sa){na=1/Math.sqrt(oa+sa);Qt=0;$t=ia*na;Kt=-aa*na}else{na=1/Math.sqrt(ra+oa);Qt=aa*na;$t=-ta*na;Kt=0}}else if(oa<sa){na=1/Math.sqrt(sa+ra);Qt=-ia*na;$t=0;Kt=ta*na}else{na=1/Math.sqrt(ra+oa);Qt=aa*na;$t=-ta*na;Kt=0}f=Qt;m=$t;b=Kt;u=0}else{var ea;var _a;var va;ea=N*A-D*L;_a=D*V-j*A;va=j*L-N*V;var ha=Math.sqrt((1+Jt)*.5);Jt=.5/ha;ea*=Jt;_a*=Jt;va*=Jt;f=ea;m=_a;b=va;u=ha}var la=f;var ca=m;var pa=b;var fa=u;var ma=2*la;var ba=2*ca;var ua=2*pa;var xa=la*ma;var ya=ca*ba;var ga=pa*ua;var Xa=la*ba;var za=ca*ua;var Ma=la*ua;var Ya=fa*ma;var Za=fa*ba;var da=fa*ua;y=1-ya-ga;g=Xa-da;X=Ma+Za;z=Xa+da;M=1-xa-ga;Y=za-Ya;Z=Ma-Za;d=za+Ya;I=1-xa-ya;var Ia;var wa;var Va;Ia=y*O+g*W+X*G;wa=z*O+M*W+Y*G;Va=Z*O+d*W+I*G;B=Ia;P=wa;T=Va;C=L*T-A*P;q=A*B-V*T;R=V*P-L*B;if(C*C+q*q+R*R>1e-6){var La=C*C+q*q+R*R;if(La>0){La=1/Math.sqrt(La)}C*=La;q*=La;R*=La}else{var Aa=V;var ka=L;var Ba=A;var Pa=Aa*Aa;var Ta=ka*ka;var Sa=Ba*Ba;var Ca;if(Pa<Ta){if(Pa<Sa){Ca=1/Math.sqrt(Ta+Sa);C=0;q=Ba*Ca;R=-ka*Ca}else{Ca=1/Math.sqrt(Pa+Ta);C=ka*Ca;q=-Aa*Ca;R=0}}else if(Ta<Sa){Ca=1/Math.sqrt(Sa+Pa);C=-Ba*Ca;q=0;R=Aa*Ca}else{Ca=1/Math.sqrt(Pa+Ta);C=ka*Ca;q=-Aa*Ca;R=0}}B=q*A-R*L;P=R*V-C*A;T=C*L-q*V;t.xX=V;t.xY=L;t.xZ=A;t.yX=B;t.yY=P;t.yZ=T;t.zX=C;t.zY=q;t.zZ=R;var qa;var Ra;var Ea;var ja;Ra=this._basisX1Y*this._basisX2Z-this._basisX1Z*this._basisX2Y;Ea=this._basisX1Z*this._basisX2X-this._basisX1X*this._basisX2Z;ja=this._basisX1X*this._basisX2Y-this._basisX1Y*this._basisX2X;var Na=this._basisX1X*this._basisX2X+this._basisX1Y*this._basisX2Y+this._basisX1Z*this._basisX2Z;var Da=Na<=-1?3.14159265358979:Na>=1?0:Math.acos(Na);var Fa=Ra*Ra+Ea*Ea+ja*ja;if(Fa>0){Fa=1/Math.sqrt(Fa)}Ra*=Fa;Ea*=Fa;ja*=Fa;Ra*=Da;Ea*=Da;ja*=Da;this.angularErrorY=Ra*this._basis.yX+Ea*this._basis.yY+ja*this._basis.yZ;this.angularErrorZ=Ra*this._basis.zX+Ea*this._basis.zY+ja*this._basis.zZ;var Oa;var Wa;var Ga;var Ha;Wa=this._basisY1Y*this._basisY2Z-this._basisY1Z*this._basisY2Y;Ga=this._basisY1Z*this._basisY2X-this._basisY1X*this._basisY2Z;Ha=this._basisY1X*this._basisY2Y-this._basisY1Y*this._basisY2X;Na=this._basisY1X*this._basisY2X+this._basisY1Y*this._basisY2Y+this._basisY1Z*this._basisY2Z;this.angle=Na<=-1?3.14159265358979:Na>=1?0:Math.acos(Na);if(Wa*this._basis.xX+Ga*this._basis.xY+Ha*this._basis.xZ<0){this.angle=-this.angle}var Ua;var Ja;var Qa;var $a;Ja=this._anchor2X-this._anchor1X;Qa=this._anchor2Y-this._anchor1Y;$a=this._anchor2Z-this._anchor1Z;this.translation=Ja*this._basis.xX+Qa*this._basis.xY+$a*this._basis.xZ;this.linearErrorY=Ja*this._basis.yX+Qa*this._basis.yY+$a*this._basis.yZ;this.linearErrorZ=Ja*this._basis.zX+Qa*this._basis.zY+$a*this._basis.zZ},_getVelocitySolverInfo:function(t,a){Ei.prototype._getVelocitySolverInfo.call(this,t,a);this.getInfo(a,t,false)},_getPositionSolverInfo:function(t){Ei.prototype._getPositionSolverInfo.call(this,t);this.getInfo(t,null,true)},getAxis1:function(){var t=new Is;var a=t;a.x=this._basisX1X;a.y=this._basisX1Y;a.z=this._basisX1Z;return t},getAxis2:function(){var t=new Is;var a=t;a.x=this._basisX2X;a.y=this._basisX2Y;a.z=this._basisX2Z;return t},getAxis1To:function(t){var a=t;a.x=this._basisX1X;a.y=this._basisX1Y;a.z=this._basisX1Z},getAxis2To:function(t){var a=t;a.x=this._basisX2X;a.y=this._basisX2Y;a.z=this._basisX2Z},getLocalAxis1:function(){var t=new Is;var a=t;a.x=this._localBasisX1X;a.y=this._localBasisX1Y;a.z=this._localBasisX1Z;return t},getLocalAxis2:function(){var t=new Is;var a=t;a.x=this._localBasisX2X;a.y=this._localBasisX2Y;a.z=this._localBasisX2Z;return t},getLocalAxis1To:function(t){var a=t;a.x=this._localBasisX1X;a.y=this._localBasisX1Y;a.z=this._localBasisX1Z},getLocalAxis2To:function(t){var a=t;a.x=this._localBasisX2X;a.y=this._localBasisX2Y;a.z=this._localBasisX2Z},getTranslationalSpringDamper:function(){return this._translSd},getRotationalSpringDamper:function(){return this._rotSd},getTranslationalLimitMotor:function(){return this._translLm},getRotationalLimitMotor:function(){return this._rotLm},getAngle:function(){return this.angle},getTranslation:function(){return this.translation}});var zt=function(){this.rigidBody1=null;this.rigidBody2=null;this.localAnchor1=new Is;this.localAnchor2=new Is;this.allowCollision=false;this.solverType=ys.defaultJointConstraintSolverType;this.positionCorrectionAlgorithm=ys.defaultJointPositionCorrectionAlgorithm;this.breakForce=0;this.breakTorque=0};zt.prototype={_init:function(t,a,i){this.rigidBody1=t;this.rigidBody2=a;var r=this.rigidBody1;var o;var s;var n;var e;var _=i;s=_.x;n=_.y;e=_.z;s-=r._transform._positionX;n-=r._transform._positionY;e-=r._transform._positionZ;var v;var h;var l;v=r._transform._rotation00*s+r._transform._rotation10*n+r._transform._rotation20*e;h=r._transform._rotation01*s+r._transform._rotation11*n+r._transform._rotation21*e;l=r._transform._rotation02*s+r._transform._rotation12*n+r._transform._rotation22*e;s=v;n=h;e=l;var c=this.localAnchor1;c.x=s;c.y=n;c.z=e;var p=this.rigidBody2;var f;var m;var b;var u;var x=i;m=x.x;b=x.y;u=x.z;m-=p._transform._positionX;b-=p._transform._positionY;u-=p._transform._positionZ;var y;var g;var X;y=p._transform._rotation00*m+p._transform._rotation10*b+p._transform._rotation20*u;g=p._transform._rotation01*m+p._transform._rotation11*b+p._transform._rotation21*u;X=p._transform._rotation02*m+p._transform._rotation12*b+p._transform._rotation22*u;m=y;b=g;u=X;var z=this.localAnchor2;z.x=m;z.y=b;z.z=u}};var Yt=function(){zt.call(this);this.localAxis1=new Is(1,0,0);this.localAxis2=new Is(1,0,0);this.translationalLimitMotor=new Et;this.translationalSpringDamper=new Rt;this.rotationalLimitMotor=new St;this.rotationalSpringDamper=new Rt};Yt.__super__=zt;Yt.prototype=$extend(zt.prototype,{init:function(t,a,i,r){this._init(t,a,i);var o;var s;var n;var e;var _=r;s=_.x;n=_.y;e=_.z;var v;var h;var l;v=t._transform._rotation00*s+t._transform._rotation10*n+t._transform._rotation20*e;h=t._transform._rotation01*s+t._transform._rotation11*n+t._transform._rotation21*e;l=t._transform._rotation02*s+t._transform._rotation12*n+t._transform._rotation22*e;s=v;n=h;e=l;var c=this.localAxis1;c.x=s;c.y=n;c.z=e;var p;var f;var m;var b;var u=r;f=u.x;m=u.y;b=u.z;var x;var y;var g;x=a._transform._rotation00*f+a._transform._rotation10*m+a._transform._rotation20*b;y=a._transform._rotation01*f+a._transform._rotation11*m+a._transform._rotation21*b;g=a._transform._rotation02*f+a._transform._rotation12*m+a._transform._rotation22*b;f=x;m=y;b=g;var X=this.localAxis2;X.x=f;X.y=m;X.z=b;return this}});var Zt=function(t){this.joint=t;this.xX=0;this.xY=0;this.xZ=0;this.yX=0;this.yY=0;this.yZ=0;this.zX=0;this.zY=0;this.zZ=0};var dt=function(){this.impulse=0;this.impulseM=0;this.impulseP=0};var It=function(t){this._joint=t};It.prototype={getContact:function(){return this._joint},getOther:function(){return this._other},getPrev:function(){return this._prev},getNext:function(){return this._next}};var wt=function(){};var Vt=function(){};var Lt=function(t){Ei.call(this,t,Vt.PRISMATIC);var a=t.localAxis1;this._localBasisX1X=a.x;this._localBasisX1Y=a.y;this._localBasisX1Z=a.z;var i=t.localAxis2;this._localBasisX2X=i.x;this._localBasisX2Y=i.y;this._localBasisX2Z=i.z;if(this._localBasisX1X*this._localBasisX1X+this._localBasisX1Y*this._localBasisX1Y+this._localBasisX1Z*this._localBasisX1Z==0){this._localBasisX1X=1;this._localBasisX1Y=0;this._localBasisX1Z=0}else{var r=this._localBasisX1X*this._localBasisX1X+this._localBasisX1Y*this._localBasisX1Y+this._localBasisX1Z*this._localBasisX1Z;if(r>0){r=1/Math.sqrt(r)}this._localBasisX1X*=r;this._localBasisX1Y*=r;this._localBasisX1Z*=r}if(this._localBasisX2X*this._localBasisX2X+this._localBasisX2Y*this._localBasisX2Y+this._localBasisX2Z*this._localBasisX2Z==0){this._localBasisX2X=1;this._localBasisX2Y=0;this._localBasisX2Z=0}else{var o=this._localBasisX2X*this._localBasisX2X+this._localBasisX2Y*this._localBasisX2Y+this._localBasisX2Z*this._localBasisX2Z;if(o>0){o=1/Math.sqrt(o)}this._localBasisX2X*=o;this._localBasisX2Y*=o;this._localBasisX2Z*=o}var s;var n;var e;var _;var v;var h;var l;var c;var p;var f;var m;var b;var u;var x;var y;var g=this._localBasisX1X*this._localBasisX2X+this._localBasisX1Y*this._localBasisX2Y+this._localBasisX1Z*this._localBasisX2Z;if(g<-.999999999){var X;var z;var M;var Y=this._localBasisX1X;var Z=this._localBasisX1Y;var d=this._localBasisX1Z;var I=Y*Y;var w=Z*Z;var V=d*d;var L;if(I<w){if(I<V){L=1/Math.sqrt(w+V);X=0;z=d*L;M=-Z*L}else{L=1/Math.sqrt(I+w);X=Z*L;z=-Y*L;M=0}}else if(w<V){L=1/Math.sqrt(V+I);X=-d*L;z=0;M=Y*L}else{L=1/Math.sqrt(I+w);X=Z*L;z=-Y*L;M=0}n=X;e=z;_=M;v=0}else{var A;var k;var B;A=this._localBasisX1Y*this._localBasisX2Z-this._localBasisX1Z*this._localBasisX2Y;k=this._localBasisX1Z*this._localBasisX2X-this._localBasisX1X*this._localBasisX2Z;B=this._localBasisX1X*this._localBasisX2Y-this._localBasisX1Y*this._localBasisX2X;var P=Math.sqrt((1+g)*.5);g=.5/P;A*=g;k*=g;B*=g;n=A;e=k;_=B;v=P}var T=n;var S=e;var C=_;var q=v;var R=2*T;var E=2*S;var j=2*C;var N=T*R;var D=S*E;var F=C*j;var O=T*E;var W=S*j;var G=T*j;var H=q*R;var U=q*E;var J=q*j;l=1-D-F;c=O-J;p=G+U;f=O+J;m=1-N-F;b=W-H;u=G-U;x=W+H;y=1-N-D;var Q=this._localBasisX1X;var $=this._localBasisX1Y;var K=this._localBasisX1Z;var tt=Q*Q;var at=$*$;var it=K*K;var rt;if(tt<at){if(tt<it){rt=1/Math.sqrt(at+it);this._localBasisY1X=0;this._localBasisY1Y=K*rt;this._localBasisY1Z=-$*rt}else{rt=1/Math.sqrt(tt+at);this._localBasisY1X=$*rt;this._localBasisY1Y=-Q*rt;this._localBasisY1Z=0}}else if(at<it){rt=1/Math.sqrt(it+tt);this._localBasisY1X=-K*rt;this._localBasisY1Y=0;this._localBasisY1Z=Q*rt}else{rt=1/Math.sqrt(tt+at);this._localBasisY1X=$*rt;this._localBasisY1Y=-Q*rt;this._localBasisY1Z=0}this._localBasisZ1X=this._localBasisX1Y*this._localBasisY1Z-this._localBasisX1Z*this._localBasisY1Y;this._localBasisZ1Y=this._localBasisX1Z*this._localBasisY1X-this._localBasisX1X*this._localBasisY1Z;this._localBasisZ1Z=this._localBasisX1X*this._localBasisY1Y-this._localBasisX1Y*this._localBasisY1X;var ot;var st;var nt;ot=l*this._localBasisX1X+c*this._localBasisX1Y+p*this._localBasisX1Z;st=f*this._localBasisX1X+m*this._localBasisX1Y+b*this._localBasisX1Z;nt=u*this._localBasisX1X+x*this._localBasisX1Y+y*this._localBasisX1Z;this._localBasisX2X=ot;this._localBasisX2Y=st;this._localBasisX2Z=nt;var et;var _t;var vt;et=l*this._localBasisY1X+c*this._localBasisY1Y+p*this._localBasisY1Z;_t=f*this._localBasisY1X+m*this._localBasisY1Y+b*this._localBasisY1Z;vt=u*this._localBasisY1X+x*this._localBasisY1Y+y*this._localBasisY1Z;this._localBasisY2X=et;this._localBasisY2Y=_t;this._localBasisY2Z=vt;var ht;var lt;var ct;ht=l*this._localBasisZ1X+c*this._localBasisZ1Y+p*this._localBasisZ1Z;lt=f*this._localBasisZ1X+m*this._localBasisZ1Y+b*this._localBasisZ1Z;ct=u*this._localBasisZ1X+x*this._localBasisZ1Y+y*this._localBasisZ1Z;this._localBasisZ2X=ht;this._localBasisZ2Y=lt;this._localBasisZ2Z=ct;this._basis=new Zt(this);this.translation=0;this.linearErrorY=0;this.linearErrorZ=0;this.angularErrorX=0;this.angularErrorY=0;this.angularErrorZ=0;this._sd=t.springDamper.clone();this._lm=t.limitMotor.clone()};Lt.__super__=Ei;Lt.prototype=$extend(Ei.prototype,{getInfo:function(t,a,i){var r=i?1:this._positionCorrectionAlgorithm==ka.BAUMGARTE?a.invDt*ys.velocityBaumgarte:0;var o=this.linearErrorY*r;var s=this.linearErrorZ*r;var n=this.angularErrorX*r;var e=this.angularErrorY*r;var _=this.angularErrorZ*r;var v;var h;var l;var c;var p;var f;var m;var b;var u;var x;var y;var g;var X;var z;var M;var Y;var Z;var d;var I;var w;h=0;l=-this._relativeAnchor1Z;c=this._relativeAnchor1Y;p=this._relativeAnchor1Z;f=0;m=-this._relativeAnchor1X;b=-this._relativeAnchor1Y;u=this._relativeAnchor1X;x=0;g=0;X=-this._relativeAnchor2Z;z=this._relativeAnchor2Y;M=this._relativeAnchor2Z;Y=0;Z=-this._relativeAnchor2X;d=-this._relativeAnchor2Y;I=this._relativeAnchor2X;w=0;h=-h;l=-l;c=-c;p=-p;f=-f;m=-m;b=-b;u=-u;x=-x;g=-g;X=-X;z=-z;M=-M;Y=-Y;Z=-Z;d=-d;I=-I;w=-w;var V;var L;var A=1/(this._b1._invMass+this._b2._invMass);if(this._sd.frequency<=0||!i){var k=this._impulses[0];var B=t.rows[t.numRows++];var P=B.jacobian;P.lin1X=0;P.lin1Y=0;P.lin1Z=0;P.lin2X=0;P.lin2Y=0;P.lin2Z=0;P.ang1X=0;P.ang1Y=0;P.ang1Z=0;P.ang2X=0;P.ang2Y=0;P.ang2Z=0;B.rhs=0;B.cfm=0;B.minImpulse=0;B.maxImpulse=0;B.motorSpeed=0;B.motorMaxImpulse=0;B.impulse=null;B.impulse=k;V=B;var T=this.translation;var S=this._lm;var C=this._sd;var q;var R;var E=ys.linearSlop;if(i){q=0;R=1}else{if(C.frequency>0){E=0;var j=6.28318530717958*C.frequency;var N=C.dampingRatio;if(N<ys.minSpringDamperDampingRatio){N=ys.minSpringDamperDampingRatio}var D=a.dt;var F=2*N*j;var O=j*j;if(C.useSymplecticEuler){q=1/(D*F);R=O/F}else{q=1/(D*(D*O+F));R=O/(D*O+F)}}else{q=0;R=this._positionCorrectionAlgorithm==ka.BAUMGARTE?a.invDt*ys.velocityBaumgarte:0}if(S.motorForce>0){V.motorSpeed=S.motorSpeed;V.motorMaxImpulse=S.motorForce*a.dt}else{V.motorSpeed=0;V.motorMaxImpulse=0}}var W=S.lowerLimit;var G=S.upperLimit;var H;var U;var J;if(W>G){H=0;U=0;J=0}else if(W==G){H=-1/0;U=1/0;J=T-W}else if(T<W){H=-1/0;U=0;J=T-W+E;if(J>0){J=0}}else if(T>G){H=0;U=1/0;J=T-G-E;if(J<0){J=0}}else{H=0;U=0;J=0}var Q=A==0?0:1/A;V.minImpulse=H;V.maxImpulse=U;V.cfm=q*Q;V.rhs=J*R;L=V.jacobian;L.lin1X=this._basis.xX;L.lin1Y=this._basis.xY;L.lin1Z=this._basis.xZ;L.lin2X=this._basis.xX;L.lin2Y=this._basis.xY;L.lin2Z=this._basis.xZ;L.ang1X=h;L.ang1Y=l;L.ang1Z=c;L.ang2X=g;L.ang2Y=X;L.ang2Z=z}var $=this._impulses[1];var K=t.rows[t.numRows++];var tt=K.jacobian;tt.lin1X=0;tt.lin1Y=0;tt.lin1Z=0;tt.lin2X=0;tt.lin2Y=0;tt.lin2Z=0;tt.ang1X=0;tt.ang1Y=0;tt.ang1Z=0;tt.ang2X=0;tt.ang2Y=0;tt.ang2Z=0;K.rhs=0;K.cfm=0;K.minImpulse=0;K.maxImpulse=0;K.motorSpeed=0;K.motorMaxImpulse=0;K.impulse=null;K.impulse=$;V=K;V.rhs=o;V.cfm=0;V.minImpulse=-1/0;V.maxImpulse=1/0;L=V.jacobian;L.lin1X=this._basis.yX;L.lin1Y=this._basis.yY;L.lin1Z=this._basis.yZ;L.lin2X=this._basis.yX;L.lin2Y=this._basis.yY;L.lin2Z=this._basis.yZ;L.ang1X=p;L.ang1Y=f;L.ang1Z=m;L.ang2X=M;L.ang2Y=Y;L.ang2Z=Z;var at=this._impulses[2];var it=t.rows[t.numRows++];var rt=it.jacobian;rt.lin1X=0;rt.lin1Y=0;rt.lin1Z=0;rt.lin2X=0;rt.lin2Y=0;rt.lin2Z=0;rt.ang1X=0;rt.ang1Y=0;rt.ang1Z=0;rt.ang2X=0;rt.ang2Y=0;rt.ang2Z=0;it.rhs=0;it.cfm=0;it.minImpulse=0;it.maxImpulse=0;it.motorSpeed=0;it.motorMaxImpulse=0;it.impulse=null;it.impulse=at;V=it;V.rhs=s;V.cfm=0;V.minImpulse=-1/0;V.maxImpulse=1/0;L=V.jacobian;L.lin1X=this._basis.zX;L.lin1Y=this._basis.zY;L.lin1Z=this._basis.zZ;L.lin2X=this._basis.zX;L.lin2Y=this._basis.zY;L.lin2Z=this._basis.zZ;L.ang1X=b;L.ang1Y=u;L.ang1Z=x;L.ang2X=d;L.ang2Y=I;L.ang2Z=w;var ot=this._impulses[3];var st=t.rows[t.numRows++];var nt=st.jacobian;nt.lin1X=0;nt.lin1Y=0;nt.lin1Z=0;nt.lin2X=0;nt.lin2Y=0;nt.lin2Z=0;nt.ang1X=0;nt.ang1Y=0;nt.ang1Z=0;nt.ang2X=0;nt.ang2Y=0;nt.ang2Z=0;st.rhs=0;st.cfm=0;st.minImpulse=0;st.maxImpulse=0;st.motorSpeed=0;st.motorMaxImpulse=0;st.impulse=null;st.impulse=ot;V=st;V.rhs=n;V.cfm=0;V.minImpulse=-1/0;V.maxImpulse=1/0;L=V.jacobian;L.ang1X=1;L.ang1Y=0;L.ang1Z=0;L.ang2X=1;L.ang2Y=0;L.ang2Z=0;var et=this._impulses[4];var _t=t.rows[t.numRows++];var vt=_t.jacobian;vt.lin1X=0;vt.lin1Y=0;vt.lin1Z=0;vt.lin2X=0;vt.lin2Y=0;vt.lin2Z=0;vt.ang1X=0;vt.ang1Y=0;vt.ang1Z=0;vt.ang2X=0;vt.ang2Y=0;vt.ang2Z=0;_t.rhs=0;_t.cfm=0;_t.minImpulse=0;_t.maxImpulse=0;_t.motorSpeed=0;_t.motorMaxImpulse=0;_t.impulse=null;_t.impulse=et;V=_t;V.rhs=e;V.cfm=0;V.minImpulse=-1/0;V.maxImpulse=1/0;L=V.jacobian;L.ang1X=0;L.ang1Y=1;L.ang1Z=0;L.ang2X=0;L.ang2Y=1;L.ang2Z=0;var ht=this._impulses[5];var lt=t.rows[t.numRows++];var ct=lt.jacobian;ct.lin1X=0;ct.lin1Y=0;ct.lin1Z=0;ct.lin2X=0;ct.lin2Y=0;ct.lin2Z=0;ct.ang1X=0;ct.ang1Y=0;ct.ang1Z=0;ct.ang2X=0;ct.ang2Y=0;ct.ang2Z=0;lt.rhs=0;lt.cfm=0;lt.minImpulse=0;lt.maxImpulse=0;lt.motorSpeed=0;lt.motorMaxImpulse=0;lt.impulse=null;lt.impulse=ht;V=lt;V.rhs=_;V.cfm=0;V.minImpulse=-1/0;V.maxImpulse=1/0;L=V.jacobian;L.ang1X=0;L.ang1Y=0;L.ang1Z=1;L.ang2X=0;L.ang2Y=0;L.ang2Z=1},_syncAnchors:function(){Ei.prototype._syncAnchors.call(this);var t=this._basis;var a=t.joint._b1._invMass;var i=t.joint._b2._invMass;var r;var o;var s;var n;var e;var _;var v;var h;var l;var c;var p;var f;var m;var b;var u;var x;var y;var g;var X;var z;var M;var Y;var Z;var d;var I;var w;var V;var L;var A;var k;var B;var P;var T;var S;var C;var q;var R;var E;var j;var N;var D;var F;var O;var W;var G;var H=t.joint._basisX1X*t.joint._basisX2X+t.joint._basisX1Y*t.joint._basisX2Y+t.joint._basisX1Z*t.joint._basisX2Z;if(H<-.999999999){var U;var J;var Q;var $=t.joint._basisX1X;var K=t.joint._basisX1Y;var tt=t.joint._basisX1Z;var at=$*$;var it=K*K;var rt=tt*tt;var ot;if(at<it){if(at<rt){ot=1/Math.sqrt(it+rt);U=0;J=tt*ot;Q=-K*ot}else{ot=1/Math.sqrt(at+it);U=K*ot;J=-$*ot;Q=0}}else if(it<rt){ot=1/Math.sqrt(rt+at);U=-tt*ot;J=0;Q=$*ot}else{ot=1/Math.sqrt(at+it);U=K*ot;J=-$*ot;Q=0}o=U;s=J;n=Q;e=0}else{var st;var nt;var et;st=t.joint._basisX1Y*t.joint._basisX2Z-t.joint._basisX1Z*t.joint._basisX2Y;nt=t.joint._basisX1Z*t.joint._basisX2X-t.joint._basisX1X*t.joint._basisX2Z;et=t.joint._basisX1X*t.joint._basisX2Y-t.joint._basisX1Y*t.joint._basisX2X;var _t=Math.sqrt((1+H)*.5);H=.5/_t;st*=H;nt*=H;et*=H;o=st;s=nt;n=et;e=_t}v=0;h=0;l=0;c=1;var vt;var ht;var lt;var ct;var pt;var ft;var mt;var bt;var ut;var xt;var yt;var gt;pt=v;ft=h;mt=l;bt=c;ut=o;xt=s;yt=n;gt=e;var Xt=pt*ut+ft*xt+mt*yt+bt*gt;if(Xt<0){Xt=-Xt;ut=-ut;xt=-xt;yt=-yt;gt=-gt}if(Xt>.999999){var zt;var Mt;var Yt;var Zt;zt=ut-pt;Mt=xt-ft;Yt=yt-mt;Zt=gt-bt;ut=pt+zt*(a/(a+i));xt=ft+Mt*(a/(a+i));yt=mt+Yt*(a/(a+i));gt=bt+Zt*(a/(a+i));var dt=ut*ut+xt*xt+yt*yt+gt*gt;if(dt>1e-32){dt=1/Math.sqrt(dt)}f=ut*dt;m=xt*dt;b=yt*dt;u=gt*dt}else{var It=a/(a+i)*Math.acos(Xt);ut+=pt*-Xt;xt+=ft*-Xt;yt+=mt*-Xt;gt+=bt*-Xt;var wt=ut*ut+xt*xt+yt*yt+gt*gt;if(wt>1e-32){wt=1/Math.sqrt(wt)}ut*=wt;xt*=wt;yt*=wt;gt*=wt;var Vt=Math.sin(It);var Lt=Math.cos(It);pt*=Lt;ft*=Lt;mt*=Lt;bt*=Lt;f=pt+ut*Vt;m=ft+xt*Vt;b=mt+yt*Vt;u=bt+gt*Vt}var At=f;var kt=m;var Bt=b;var Pt=u;var Tt=2*At;var St=2*kt;var Ct=2*Bt;var qt=At*Tt;var Rt=kt*St;var Et=Bt*Ct;var jt=At*St;var Nt=kt*Ct;var Dt=At*Ct;var Ft=Pt*Tt;var Ot=Pt*St;var Wt=Pt*Ct;y=1-Rt-Et;g=jt-Wt;X=Dt+Ot;z=jt+Wt;M=1-qt-Et;Y=Nt-Ft;Z=Dt-Ot;d=Nt+Ft;I=1-qt-Rt;var Gt;var Ht;var Ut;Gt=y*t.joint._basisX1X+g*t.joint._basisX1Y+X*t.joint._basisX1Z;Ht=z*t.joint._basisX1X+M*t.joint._basisX1Y+Y*t.joint._basisX1Z;Ut=Z*t.joint._basisX1X+d*t.joint._basisX1Y+I*t.joint._basisX1Z;V=Gt;L=Ht;A=Ut;j=t.xX;N=t.xY;D=t.xZ;O=t.yX;W=t.yY;G=t.yZ;var Jt=j*V+N*L+D*A;if(Jt<-.999999999){var Qt;var $t;var Kt;var ta=j;var aa=N;var ia=D;var ra=ta*ta;var oa=aa*aa;var sa=ia*ia;var na;if(ra<oa){if(ra<sa){na=1/Math.sqrt(oa+sa);Qt=0;$t=ia*na;Kt=-aa*na}else{na=1/Math.sqrt(ra+oa);Qt=aa*na;$t=-ta*na;Kt=0}}else if(oa<sa){na=1/Math.sqrt(sa+ra);Qt=-ia*na;$t=0;Kt=ta*na}else{na=1/Math.sqrt(ra+oa);Qt=aa*na;$t=-ta*na;Kt=0}f=Qt;m=$t;b=Kt;u=0}else{var ea;var _a;var va;ea=N*A-D*L;_a=D*V-j*A;va=j*L-N*V;var ha=Math.sqrt((1+Jt)*.5);Jt=.5/ha;ea*=Jt;_a*=Jt;va*=Jt;f=ea;m=_a;b=va;u=ha}var la=f;var ca=m;var pa=b;var fa=u;var ma=2*la;var ba=2*ca;var ua=2*pa;var xa=la*ma;var ya=ca*ba;var ga=pa*ua;var Xa=la*ba;var za=ca*ua;var Ma=la*ua;var Ya=fa*ma;var Za=fa*ba;var da=fa*ua;y=1-ya-ga;g=Xa-da;X=Ma+Za;z=Xa+da;M=1-xa-ga;Y=za-Ya;Z=Ma-Za;d=za+Ya;I=1-xa-ya;var Ia;var wa;var Va;Ia=y*O+g*W+X*G;wa=z*O+M*W+Y*G;Va=Z*O+d*W+I*G;B=Ia;P=wa;T=Va;C=L*T-A*P;q=A*B-V*T;R=V*P-L*B;if(C*C+q*q+R*R>1e-6){var La=C*C+q*q+R*R;if(La>0){La=1/Math.sqrt(La)}C*=La;q*=La;R*=La}else{var Aa=V;var ka=L;var Ba=A;var Pa=Aa*Aa;var Ta=ka*ka;var Sa=Ba*Ba;var Ca;if(Pa<Ta){if(Pa<Sa){Ca=1/Math.sqrt(Ta+Sa);C=0;q=Ba*Ca;R=-ka*Ca}else{Ca=1/Math.sqrt(Pa+Ta);C=ka*Ca;q=-Aa*Ca;R=0}}else if(Ta<Sa){Ca=1/Math.sqrt(Sa+Pa);C=-Ba*Ca;q=0;R=Aa*Ca}else{Ca=1/Math.sqrt(Pa+Ta);C=ka*Ca;q=-Aa*Ca;R=0}}B=q*A-R*L;P=R*V-C*A;T=C*L-q*V;t.xX=V;t.xY=L;t.xZ=A;t.yX=B;t.yY=P;t.yZ=T;t.zX=C;t.zY=q;t.zZ=R;var qa;var Ra;var Ea;var ja;var Na;var Da;var Fa;var Oa;var Wa;var Ga;var Ha;var Ua;var Ja;var Qa;var $a;var Ka;var ti;var ai;var ii;var ri;Ra=this._basisX1X;Ea=this._basisY1X;ja=this._basisZ1X;Na=this._basisX1Y;Da=this._basisY1Y;Fa=this._basisZ1Y;Oa=this._basisX1Z;Wa=this._basisY1Z;Ga=this._basisZ1Z;Ua=this._basisX2X;Ja=this._basisY2X;Qa=this._basisZ2X;$a=this._basisX2Y;Ka=this._basisY2Y;ti=this._basisZ2Y;ai=this._basisX2Z;ii=this._basisY2Z;ri=this._basisZ2Z;var oi;var si;var ni;var ei;var _i;var vi;var hi;var li;var ci;var pi;var fi;var mi;var bi;var ui;var xi;var yi;var gi;var Xi;var zi;fi=Ua*Ra+Ja*Ea+Qa*ja;mi=Ua*Na+Ja*Da+Qa*Fa;bi=Ua*Oa+Ja*Wa+Qa*Ga;ui=$a*Ra+Ka*Ea+ti*ja;xi=$a*Na+Ka*Da+ti*Fa;yi=$a*Oa+Ka*Wa+ti*Ga;gi=ai*Ra+ii*Ea+ri*ja;Xi=ai*Na+ii*Da+ri*Fa;zi=ai*Oa+ii*Wa+ri*Ga;si=fi;ni=mi;ei=bi;_i=ui;vi=xi;hi=yi;li=gi;ci=Xi;pi=zi;var Mi;var Yi;var Zi;var di;var Ii;var wi=si;var Vi=vi;var Li=pi;var Ai=wi+Vi+Li;var ki;if(Ai>0){ki=Math.sqrt(Ai+1);Ii=.5*ki;ki=.5/ki;Yi=(ci-hi)*ki;Zi=(ei-li)*ki;di=(_i-ni)*ki}else if(wi>Vi){if(wi>Li){ki=Math.sqrt(wi-Vi-Li+1);Yi=.5*ki;ki=.5/ki;Zi=(ni+_i)*ki;di=(ei+li)*ki;Ii=(ci-hi)*ki}else{ki=Math.sqrt(Li-wi-Vi+1);di=.5*ki;ki=.5/ki;Yi=(ei+li)*ki;Zi=(hi+ci)*ki;Ii=(_i-ni)*ki}}else if(Vi>Li){ki=Math.sqrt(Vi-Li-wi+1);Zi=.5*ki;ki=.5/ki;Yi=(ni+_i)*ki;di=(hi+ci)*ki;Ii=(ei-li)*ki}else{ki=Math.sqrt(Li-wi-Vi+1);di=.5*ki;ki=.5/ki;Yi=(ei+li)*ki;Zi=(hi+ci)*ki;Ii=(_i-ni)*ki}var Bi=Ii;var Pi=(Bi<=-1?3.14159265358979:Bi>=1?0:Math.acos(Bi))*2;this.angularErrorX=Yi;this.angularErrorY=Zi;this.angularErrorZ=di;var Ti=this.angularErrorX*this.angularErrorX+this.angularErrorY*this.angularErrorY+this.angularErrorZ*this.angularErrorZ;if(Ti>0){Ti=1/Math.sqrt(Ti)}this.angularErrorX*=Ti;this.angularErrorY*=Ti;this.angularErrorZ*=Ti;this.angularErrorX*=Pi;this.angularErrorY*=Pi;this.angularErrorZ*=Pi;var Si;var Ci;var qi;var Ri;Ci=this._anchor2X-this._anchor1X;qi=this._anchor2Y-this._anchor1Y;Ri=this._anchor2Z-this._anchor1Z;this.translation=Ci*this._basis.xX+qi*this._basis.xY+Ri*this._basis.xZ;this.linearErrorY=Ci*this._basis.yX+qi*this._basis.yY+Ri*this._basis.yZ;this.linearErrorZ=Ci*this._basis.zX+qi*this._basis.zY+Ri*this._basis.zZ},_getVelocitySolverInfo:function(t,a){Ei.prototype._getVelocitySolverInfo.call(this,t,a);this.getInfo(a,t,false)},_getPositionSolverInfo:function(t){Ei.prototype._getPositionSolverInfo.call(this,t);this.getInfo(t,null,true)},getAxis1:function(){var t=new Is;var a=t;a.x=this._basisX1X;a.y=this._basisX1Y;a.z=this._basisX1Z;return t},getAxis2:function(){var t=new Is;var a=t;a.x=this._basisX2X;a.y=this._basisX2Y;a.z=this._basisX2Z;return t},getAxis1To:function(t){var a=t;a.x=this._basisX1X;a.y=this._basisX1Y;a.z=this._basisX1Z},getAxis2To:function(t){var a=t;a.x=this._basisX2X;a.y=this._basisX2Y;a.z=this._basisX2Z},getLocalAxis1:function(){var t=new Is;var a=t;a.x=this._localBasisX1X;a.y=this._localBasisX1Y;a.z=this._localBasisX1Z;return t},getLocalAxis2:function(){var t=new Is;var a=t;a.x=this._localBasisX2X;a.y=this._localBasisX2Y;a.z=this._localBasisX2Z;return t},getLocalAxis1To:function(t){var a=t;a.x=this._localBasisX1X;a.y=this._localBasisX1Y;a.z=this._localBasisX1Z},getLocalAxis2To:function(t){var a=t;a.x=this._localBasisX2X;a.y=this._localBasisX2Y;a.z=this._localBasisX2Z},getSpringDamper:function(){return this._sd},getLimitMotor:function(){return this._lm},getTranslation:function(){return this.translation}});var At=function(){zt.call(this);this.localAxis1=new Is(1,0,0);this.localAxis2=new Is(1,0,0);this.limitMotor=new Et;this.springDamper=new Rt};At.__super__=zt;At.prototype=$extend(zt.prototype,{init:function(t,a,i,r){this._init(t,a,i);var o;var s;var n;var e;var _=r;s=_.x;n=_.y;e=_.z;var v;var h;var l;v=t._transform._rotation00*s+t._transform._rotation10*n+t._transform._rotation20*e;h=t._transform._rotation01*s+t._transform._rotation11*n+t._transform._rotation21*e;l=t._transform._rotation02*s+t._transform._rotation12*n+t._transform._rotation22*e;s=v;n=h;e=l;var c=this.localAxis1;c.x=s;c.y=n;c.z=e;var p;var f;var m;var b;var u=r;f=u.x;m=u.y;b=u.z;var x;var y;var g;x=a._transform._rotation00*f+a._transform._rotation10*m+a._transform._rotation20*b;y=a._transform._rotation01*f+a._transform._rotation11*m+a._transform._rotation21*b;g=a._transform._rotation02*f+a._transform._rotation12*m+a._transform._rotation22*b;f=x;m=y;b=g;var X=this.localAxis2;X.x=f;X.y=m;X.z=b;return this}});var kt=function(t){Ei.call(this,t,Vt.RAGDOLL);var a=t.localTwistAxis1;this._localBasisX1X=a.x;this._localBasisX1Y=a.y;this._localBasisX1Z=a.z;var i=t.localSwingAxis1;this._localBasisY1X=i.x;this._localBasisY1Y=i.y;this._localBasisY1Z=i.z;var r=t.localTwistAxis2;this._localBasisX2X=r.x;this._localBasisX2Y=r.y;this._localBasisX2Z=r.z;if(this._localBasisX1X*this._localBasisX1X+this._localBasisX1Y*this._localBasisX1Y+this._localBasisX1Z*this._localBasisX1Z==0){this._localBasisX1X=1;this._localBasisX1Y=0;this._localBasisX1Z=0}else{var o=this._localBasisX1X*this._localBasisX1X+this._localBasisX1Y*this._localBasisX1Y+this._localBasisX1Z*this._localBasisX1Z;if(o>0){o=1/Math.sqrt(o)}this._localBasisX1X*=o;this._localBasisX1Y*=o;this._localBasisX1Z*=o}this._localBasisZ1X=this._localBasisX1Y*this._localBasisY1Z-this._localBasisX1Z*this._localBasisY1Y;this._localBasisZ1Y=this._localBasisX1Z*this._localBasisY1X-this._localBasisX1X*this._localBasisY1Z;this._localBasisZ1Z=this._localBasisX1X*this._localBasisY1Y-this._localBasisX1Y*this._localBasisY1X;if(this._localBasisZ1X*this._localBasisZ1X+this._localBasisZ1Y*this._localBasisZ1Y+this._localBasisZ1Z*this._localBasisZ1Z==0){var s=this._localBasisX1X;var n=this._localBasisX1Y;var e=this._localBasisX1Z;var _=s*s;var v=n*n;var h=e*e;var l;if(_<v){if(_<h){l=1/Math.sqrt(v+h);this._localBasisY1X=0;this._localBasisY1Y=e*l;this._localBasisY1Z=-n*l}else{l=1/Math.sqrt(_+v);this._localBasisY1X=n*l;this._localBasisY1Y=-s*l;this._localBasisY1Z=0}}else if(v<h){l=1/Math.sqrt(h+_);this._localBasisY1X=-e*l;this._localBasisY1Y=0;this._localBasisY1Z=s*l}else{l=1/Math.sqrt(_+v);this._localBasisY1X=n*l;this._localBasisY1Y=-s*l;this._localBasisY1Z=0}this._localBasisZ1X=this._localBasisX1Y*this._localBasisY1Z-this._localBasisX1Z*this._localBasisY1Y;this._localBasisZ1Y=this._localBasisX1Z*this._localBasisY1X-this._localBasisX1X*this._localBasisY1Z;this._localBasisZ1Z=this._localBasisX1X*this._localBasisY1Y-this._localBasisX1Y*this._localBasisY1X}else{var c=this._localBasisZ1X*this._localBasisZ1X+this._localBasisZ1Y*this._localBasisZ1Y+this._localBasisZ1Z*this._localBasisZ1Z;if(c>0){c=1/Math.sqrt(c)}this._localBasisZ1X*=c;this._localBasisZ1Y*=c;this._localBasisZ1Z*=c;this._localBasisY1X=this._localBasisZ1Y*this._localBasisX1Z-this._localBasisZ1Z*this._localBasisX1Y;this._localBasisY1Y=this._localBasisZ1Z*this._localBasisX1X-this._localBasisZ1X*this._localBasisX1Z;this._localBasisY1Z=this._localBasisZ1X*this._localBasisX1Y-this._localBasisZ1Y*this._localBasisX1X}var p;var f;var m;var b;var u;var x;var y;var g;var X;var z;var M;var Y;var Z;var d;var I;var w=this._localBasisX1X*this._localBasisX2X+this._localBasisX1Y*this._localBasisX2Y+this._localBasisX1Z*this._localBasisX2Z;if(w<-.999999999){var V;var L;var A;var k=this._localBasisX1X;var B=this._localBasisX1Y;var P=this._localBasisX1Z;var T=k*k;var S=B*B;var C=P*P;var q;if(T<S){if(T<C){q=1/Math.sqrt(S+C);V=0;L=P*q;A=-B*q}else{q=1/Math.sqrt(T+S);V=B*q;L=-k*q;A=0}}else if(S<C){q=1/Math.sqrt(C+T);V=-P*q;L=0;A=k*q}else{q=1/Math.sqrt(T+S);V=B*q;L=-k*q;A=0}f=V;m=L;b=A;u=0}else{var R;var E;var j;R=this._localBasisX1Y*this._localBasisX2Z-this._localBasisX1Z*this._localBasisX2Y;E=this._localBasisX1Z*this._localBasisX2X-this._localBasisX1X*this._localBasisX2Z;j=this._localBasisX1X*this._localBasisX2Y-this._localBasisX1Y*this._localBasisX2X;var N=Math.sqrt((1+w)*.5);w=.5/N;R*=w;E*=w;j*=w;f=R;m=E;b=j;u=N}var D=f;var F=m;var O=b;var W=u;var G=2*D;var H=2*F;var U=2*O;var J=D*G;var Q=F*H;var $=O*U;var K=D*H;var tt=F*U;var at=D*U;var it=W*G;var rt=W*H;var ot=W*U;y=1-Q-$;g=K-ot;X=at+rt;z=K+ot;M=1-J-$;Y=tt-it;Z=at-rt;d=tt+it;I=1-J-Q;var st;var nt;var et;st=y*this._localBasisX1X+g*this._localBasisX1Y+X*this._localBasisX1Z;nt=z*this._localBasisX1X+M*this._localBasisX1Y+Y*this._localBasisX1Z;et=Z*this._localBasisX1X+d*this._localBasisX1Y+I*this._localBasisX1Z;this._localBasisX2X=st;this._localBasisX2Y=nt;this._localBasisX2Z=et;var _t;var vt;var ht;_t=y*this._localBasisY1X+g*this._localBasisY1Y+X*this._localBasisY1Z;vt=z*this._localBasisY1X+M*this._localBasisY1Y+Y*this._localBasisY1Z;ht=Z*this._localBasisY1X+d*this._localBasisY1Y+I*this._localBasisY1Z;this._localBasisY2X=_t;this._localBasisY2Y=vt;this._localBasisY2Z=ht;var lt;var ct;var pt;lt=y*this._localBasisZ1X+g*this._localBasisZ1Y+X*this._localBasisZ1Z;ct=z*this._localBasisZ1X+M*this._localBasisZ1Y+Y*this._localBasisZ1Z;pt=Z*this._localBasisZ1X+d*this._localBasisZ1Y+I*this._localBasisZ1Z;this._localBasisZ2X=lt;this._localBasisZ2Y=ct;this._localBasisZ2Z=pt;this._twistSd=t.twistSpringDamper.clone();this._twistLm=t.twistLimitMotor.clone();this._swingSd=t.swingSpringDamper.clone();this._maxSwingAngle1=t.maxSwingAngle1;this._maxSwingAngle2=t.maxSwingAngle2;if(this._maxSwingAngle1<ys.minRagdollMaxSwingAngle){this._maxSwingAngle1=ys.minRagdollMaxSwingAngle}if(this._maxSwingAngle2<ys.minRagdollMaxSwingAngle){this._maxSwingAngle2=ys.minRagdollMaxSwingAngle}this.dummySwingLm=new St;this.dummySwingLm.lowerLimit=-1;this.dummySwingLm.upperLimit=0;this._swingAngle=0;this._twistAngle=0;this.swingError=0;this.swingAxisX=0;this.swingAxisY=0;this.swingAxisZ=0;this.twistAxisX=0;this.twistAxisY=0;this.twistAxisZ=0};kt.__super__=Ei;kt.prototype=$extend(Ei.prototype,{getInfo:function(t,a,i){var r=i?1:this._positionCorrectionAlgorithm==ka.BAUMGARTE?a.invDt*ys.velocityBaumgarte:0;var o;var s;var n;var e;s=this.linearErrorX*r;n=this.linearErrorY*r;e=this.linearErrorZ*r;var _=s;var v=n;var h=e;var l;var c;var p;var f;var m;var b;var u;var x;var y;var g;var X;var z;var M;var Y;var Z;var d;var I;var w;var V;var L;c=0;p=-this._relativeAnchor1Z;f=this._relativeAnchor1Y;m=this._relativeAnchor1Z;b=0;u=-this._relativeAnchor1X;x=-this._relativeAnchor1Y;y=this._relativeAnchor1X;g=0;z=0;M=-this._relativeAnchor2Z;Y=this._relativeAnchor2Y;Z=this._relativeAnchor2Z;d=0;I=-this._relativeAnchor2X;w=-this._relativeAnchor2Y;V=this._relativeAnchor2X;L=0;c=-c;p=-p;f=-f;m=-m;b=-b;u=-u;x=-x;y=-y;g=-g;z=-z;M=-M;Y=-Y;Z=-Z;d=-d;I=-I;w=-w;V=-V;L=-L;var A=this.swingAxisX;var k=this.swingAxisY;var B=this.swingAxisZ;var P;var T;var S;var C;var q;var R;var E;var j;var N;var D;var F;N=this._b1._invInertia00*A+this._b1._invInertia01*k+this._b1._invInertia02*B;D=this._b1._invInertia10*A+this._b1._invInertia11*k+this._b1._invInertia12*B;F=this._b1._invInertia20*A+this._b1._invInertia21*k+this._b1._invInertia22*B;T=N;S=D;C=F;var O;var W;var G;O=this._b2._invInertia00*A+this._b2._invInertia01*k+this._b2._invInertia02*B;W=this._b2._invInertia10*A+this._b2._invInertia11*k+this._b2._invInertia12*B;G=this._b2._invInertia20*A+this._b2._invInertia21*k+this._b2._invInertia22*B;R=O;E=W;j=G;var H=T*A+S*k+C*B;var U=R*A+E*k+j*B;if(H>0){var J=this._relativeAnchor1X*this._relativeAnchor1X+this._relativeAnchor1Y*this._relativeAnchor1Y+this._relativeAnchor1Z*this._relativeAnchor1Z;var Q=A*this._relativeAnchor1X+k*this._relativeAnchor1Y+B*this._relativeAnchor1Z;var $=J-Q*Q;if($>0){if(this._b1._invMass>0){H=1/(1/H+this._b1._mass*$)}else{H=0}}}if(U>0){var K=this._relativeAnchor2X*this._relativeAnchor2X+this._relativeAnchor2Y*this._relativeAnchor2Y+this._relativeAnchor2Z*this._relativeAnchor2Z;var tt=A*this._relativeAnchor2X+k*this._relativeAnchor2Y+B*this._relativeAnchor2Z;var at=K-tt*tt;if(at>0){if(this._b2._invMass>0){U=1/(1/U+this._b2._mass*at)}else{U=0}}}var it=H+U==0?0:1/(H+U);var rt=this._basisX2X;var ot=this._basisX2Y;var st=this._basisX2Z;var nt;var et;var _t;var vt;var ht;var lt;var ct;var pt;var ft;var mt;var bt;ft=this._b1._invInertia00*rt+this._b1._invInertia01*ot+this._b1._invInertia02*st;mt=this._b1._invInertia10*rt+this._b1._invInertia11*ot+this._b1._invInertia12*st;bt=this._b1._invInertia20*rt+this._b1._invInertia21*ot+this._b1._invInertia22*st;et=ft;_t=mt;vt=bt;var ut;var xt;var yt;ut=this._b2._invInertia00*rt+this._b2._invInertia01*ot+this._b2._invInertia02*st;xt=this._b2._invInertia10*rt+this._b2._invInertia11*ot+this._b2._invInertia12*st;yt=this._b2._invInertia20*rt+this._b2._invInertia21*ot+this._b2._invInertia22*st;lt=ut;ct=xt;pt=yt;var gt=et*rt+_t*ot+vt*st;var Xt=lt*rt+ct*ot+pt*st;if(gt>0){var zt=this._relativeAnchor1X*this._relativeAnchor1X+this._relativeAnchor1Y*this._relativeAnchor1Y+this._relativeAnchor1Z*this._relativeAnchor1Z;var Mt=rt*this._relativeAnchor1X+ot*this._relativeAnchor1Y+st*this._relativeAnchor1Z;var Yt=zt-Mt*Mt;if(Yt>0){if(this._b1._invMass>0){gt=1/(1/gt+this._b1._mass*Yt)}else{gt=0}}}if(Xt>0){var Zt=this._relativeAnchor2X*this._relativeAnchor2X+this._relativeAnchor2Y*this._relativeAnchor2Y+this._relativeAnchor2Z*this._relativeAnchor2Z;var dt=rt*this._relativeAnchor2X+ot*this._relativeAnchor2Y+st*this._relativeAnchor2Z;var It=Zt-dt*dt;if(It>0){if(this._b2._invMass>0){Xt=1/(1/Xt+this._b2._mass*It)}else{Xt=0}}}var wt=gt+Xt==0?0:1/(gt+Xt);var Vt=this._impulses[0];var Lt=t.rows[t.numRows++];var At=Lt.jacobian;At.lin1X=0;At.lin1Y=0;At.lin1Z=0;At.lin2X=0;At.lin2Y=0;At.lin2Z=0;At.ang1X=0;At.ang1Y=0;At.ang1Z=0;At.ang2X=0;At.ang2Y=0;At.ang2Z=0;Lt.rhs=0;Lt.cfm=0;Lt.minImpulse=0;Lt.maxImpulse=0;Lt.motorSpeed=0;Lt.motorMaxImpulse=0;Lt.impulse=null;Lt.impulse=Vt;var kt=Lt;kt.rhs=_;kt.cfm=0;kt.minImpulse=-1/0;kt.maxImpulse=1/0;var Bt=kt.jacobian;Bt.lin1X=1;Bt.lin1Y=0;Bt.lin1Z=0;Bt.lin2X=1;Bt.lin2Y=0;Bt.lin2Z=0;Bt.ang1X=c;Bt.ang1Y=p;Bt.ang1Z=f;Bt.ang2X=z;Bt.ang2Y=M;Bt.ang2Z=Y;var Pt=this._impulses[1];var Tt=t.rows[t.numRows++];var St=Tt.jacobian;St.lin1X=0;St.lin1Y=0;St.lin1Z=0;St.lin2X=0;St.lin2Y=0;St.lin2Z=0;St.ang1X=0;St.ang1Y=0;St.ang1Z=0;St.ang2X=0;St.ang2Y=0;St.ang2Z=0;Tt.rhs=0;Tt.cfm=0;Tt.minImpulse=0;Tt.maxImpulse=0;Tt.motorSpeed=0;Tt.motorMaxImpulse=0;Tt.impulse=null;Tt.impulse=Pt;kt=Tt;kt.rhs=v;kt.cfm=0;kt.minImpulse=-1/0;kt.maxImpulse=1/0;Bt=kt.jacobian;Bt.lin1X=0;Bt.lin1Y=1;Bt.lin1Z=0;Bt.lin2X=0;Bt.lin2Y=1;Bt.lin2Z=0;Bt.ang1X=m;Bt.ang1Y=b;Bt.ang1Z=u;Bt.ang2X=Z;Bt.ang2Y=d;Bt.ang2Z=I;var Ct=this._impulses[2];var qt=t.rows[t.numRows++];var Rt=qt.jacobian;Rt.lin1X=0;Rt.lin1Y=0;Rt.lin1Z=0;Rt.lin2X=0;Rt.lin2Y=0;Rt.lin2Z=0;Rt.ang1X=0;Rt.ang1Y=0;Rt.ang1Z=0;Rt.ang2X=0;Rt.ang2Y=0;Rt.ang2Z=0;qt.rhs=0;qt.cfm=0;qt.minImpulse=0;qt.maxImpulse=0;qt.motorSpeed=0;qt.motorMaxImpulse=0;qt.impulse=null;qt.impulse=Ct;kt=qt;kt.rhs=h;kt.cfm=0;kt.minImpulse=-1/0;kt.maxImpulse=1/0;Bt=kt.jacobian;Bt.lin1X=0;Bt.lin1Y=0;Bt.lin1Z=1;Bt.lin2X=0;Bt.lin2Y=0;Bt.lin2Z=1;Bt.ang1X=x;Bt.ang1Y=y;Bt.ang1Z=g;Bt.ang2X=w;Bt.ang2Y=V;Bt.ang2Z=L;if(this.swingError>0&&(this._swingSd.frequency<=0||!i)){var Et=this._impulses[3];var jt=t.rows[t.numRows++];var Nt=jt.jacobian;Nt.lin1X=0;Nt.lin1Y=0;Nt.lin1Z=0;Nt.lin2X=0;Nt.lin2Y=0;Nt.lin2Z=0;Nt.ang1X=0;Nt.ang1Y=0;Nt.ang1Z=0;Nt.ang2X=0;Nt.ang2Y=0;Nt.ang2Z=0;jt.rhs=0;jt.cfm=0;jt.minImpulse=0;jt.maxImpulse=0;jt.motorSpeed=0;jt.motorMaxImpulse=0;jt.impulse=null;jt.impulse=Et;kt=jt;var Dt=this.swingError;var Ft=this.dummySwingLm;var Ot=this._swingSd;var Wt;var Gt;var Ht=ys.angularSlop;if(i){Wt=0;Gt=1}else{if(Ot.frequency>0){Ht=0;var Ut=6.28318530717958*Ot.frequency;var Jt=Ot.dampingRatio;if(Jt<ys.minSpringDamperDampingRatio){Jt=ys.minSpringDamperDampingRatio}var Qt=a.dt;var $t=2*Jt*Ut;var Kt=Ut*Ut;if(Ot.useSymplecticEuler){Wt=1/(Qt*$t);Gt=Kt/$t}else{Wt=1/(Qt*(Qt*Kt+$t));Gt=Kt/(Qt*Kt+$t)}}else{Wt=0;Gt=this._positionCorrectionAlgorithm==ka.BAUMGARTE?a.invDt*ys.velocityBaumgarte:0}if(Ft.motorTorque>0){kt.motorSpeed=Ft.motorSpeed;kt.motorMaxImpulse=Ft.motorTorque*a.dt}else{kt.motorSpeed=0;kt.motorMaxImpulse=0}}var ta=Ft.lowerLimit;var aa=Ft.upperLimit;var ia=(ta+aa)*.5;Dt-=ia;Dt=((Dt+3.14159265358979)%6.28318530717958+6.28318530717958)%6.28318530717958-3.14159265358979;Dt+=ia;var ra;var oa;var sa;if(ta>aa){ra=0;oa=0;sa=0}else if(ta==aa){ra=-1/0;oa=1/0;sa=Dt-ta}else if(Dt<ta){ra=-1/0;oa=0;sa=Dt-ta+Ht;if(sa>0){sa=0}}else if(Dt>aa){ra=0;oa=1/0;sa=Dt-aa-Ht;if(sa<0){sa=0}}else{ra=0;oa=0;sa=0}var na=it==0?0:1/it;kt.minImpulse=ra;kt.maxImpulse=oa;kt.cfm=Wt*na;kt.rhs=sa*Gt;Bt=kt.jacobian;Bt.ang1X=this.swingAxisX;Bt.ang1Y=this.swingAxisY;Bt.ang1Z=this.swingAxisZ;Bt.ang2X=this.swingAxisX;Bt.ang2Y=this.swingAxisY;Bt.ang2Z=this.swingAxisZ}if(this._twistSd.frequency<=0||!i){var ea=this._impulses[4];var _a=t.rows[t.numRows++];var va=_a.jacobian;va.lin1X=0;va.lin1Y=0;va.lin1Z=0;va.lin2X=0;va.lin2Y=0;va.lin2Z=0;va.ang1X=0;va.ang1Y=0;va.ang1Z=0;va.ang2X=0;va.ang2Y=0;va.ang2Z=0;_a.rhs=0;_a.cfm=0;_a.minImpulse=0;_a.maxImpulse=0;_a.motorSpeed=0;_a.motorMaxImpulse=0;_a.impulse=null;_a.impulse=ea;kt=_a;var ha=this._twistAngle;var la=this._twistLm;var ca=this._twistSd;var pa;var fa;var ma=ys.angularSlop;if(i){pa=0;fa=1}else{if(ca.frequency>0){ma=0;var ba=6.28318530717958*ca.frequency;var ua=ca.dampingRatio;if(ua<ys.minSpringDamperDampingRatio){ua=ys.minSpringDamperDampingRatio}var xa=a.dt;var ya=2*ua*ba;var ga=ba*ba;if(ca.useSymplecticEuler){pa=1/(xa*ya);fa=ga/ya}else{pa=1/(xa*(xa*ga+ya));fa=ga/(xa*ga+ya)}}else{pa=0;fa=this._positionCorrectionAlgorithm==ka.BAUMGARTE?a.invDt*ys.velocityBaumgarte:0}if(la.motorTorque>0){kt.motorSpeed=la.motorSpeed;kt.motorMaxImpulse=la.motorTorque*a.dt}else{kt.motorSpeed=0;kt.motorMaxImpulse=0}}var Xa=la.lowerLimit;var za=la.upperLimit;var Ma=(Xa+za)*.5;ha-=Ma;ha=((ha+3.14159265358979)%6.28318530717958+6.28318530717958)%6.28318530717958-3.14159265358979;ha+=Ma;var Ya;var Za;var da;if(Xa>za){Ya=0;Za=0;da=0}else if(Xa==za){Ya=-1/0;Za=1/0;da=ha-Xa}else if(ha<Xa){Ya=-1/0;Za=0;da=ha-Xa+ma;if(da>0){da=0}}else if(ha>za){Ya=0;Za=1/0;da=ha-za-ma;if(da<0){da=0}}else{Ya=0;Za=0;da=0}var Ia=wt==0?0:1/wt;kt.minImpulse=Ya;kt.maxImpulse=Za;kt.cfm=pa*Ia;kt.rhs=da*fa;Bt=kt.jacobian;Bt.ang1X=this.twistAxisX;Bt.ang1Y=this.twistAxisY;Bt.ang1Z=this.twistAxisZ;Bt.ang2X=this.twistAxisX;Bt.ang2Y=this.twistAxisY;Bt.ang2Z=this.twistAxisZ}},_syncAnchors:function(){Ei.prototype._syncAnchors.call(this);var t=this._b1._transform;var a=this._b2._transform;var i;var r;var o;var s;var n;var e;var _;var v;r=this._basisX1X;o=this._basisX1Y;s=this._basisX1Z;e=this._basisX2X;_=this._basisX2Y;v=this._basisX2Z;var h;var l;var c;var p;var f;var m;var b;var u;var x;var y;var g;var X;var z;var M;var Y;var Z;var d;var I;var w;var V;l=this._basisX1X;c=this._basisY1X;p=this._basisZ1X;f=this._basisX1Y;m=this._basisY1Y;b=this._basisZ1Y;u=this._basisX1Z;x=this._basisY1Z;y=this._basisZ1Z;X=this._basisX2X;z=this._basisY2X;M=this._basisZ2X;Y=this._basisX2Y;Z=this._basisY2Y;d=this._basisZ2Y;I=this._basisX2Z;w=this._basisY2Z;V=this._basisZ2Z;var L;var A;var k;var B;var P;var T;var S;var C;var q;var R;var E;var j;var N;var D;var F;var O;var W;var G;var H;var U=r*e+o*_+s*v;if(U<-.999999999){var J;var Q;var $;var K=r;var tt=o;var at=s;var it=K*K;var rt=tt*tt;var ot=at*at;var st;if(it<rt){if(it<ot){st=1/Math.sqrt(rt+ot);J=0;Q=at*st;$=-tt*st}else{st=1/Math.sqrt(it+rt);J=tt*st;Q=-K*st;$=0}}else if(rt<ot){st=1/Math.sqrt(ot+it);J=-at*st;Q=0;$=K*st}else{st=1/Math.sqrt(it+rt);J=tt*st;Q=-K*st;$=0}A=J;k=Q;B=$;P=0}else{var nt;var et;var _t;nt=o*v-s*_;et=s*e-r*v;_t=r*_-o*e;var vt=Math.sqrt((1+U)*.5);U=.5/vt;nt*=U;et*=U;_t*=U;A=nt;k=et;B=_t;P=vt}var ht=A;var lt=k;var ct=B;var pt=P;var ft=2*ht;var mt=2*lt;var bt=2*ct;var ut=ht*ft;var xt=lt*mt;var yt=ct*bt;var gt=ht*mt;var Xt=lt*bt;var zt=ht*bt;var Mt=pt*ft;var Yt=pt*mt;var Zt=pt*bt;S=1-xt-yt;C=gt-Zt;q=zt+Yt;R=gt+Zt;E=1-ut-yt;j=Xt-Mt;N=zt-Yt;D=Xt+Mt;F=1-ut-xt;this._swingAngle=(P<=-1?3.14159265358979:P>=1?0:Math.acos(P))*2;W=A;G=k;H=B;var dt;var It;var wt;var Vt;var Lt;var At;var kt;Lt=S*this._basisY2X+R*this._basisY2Y+N*this._basisY2Z;At=C*this._basisY2X+E*this._basisY2Y+D*this._basisY2Z;kt=q*this._basisY2X+j*this._basisY2Y+F*this._basisY2Z;It=Lt;wt=At;Vt=kt;var Bt=this._basisY1X*It+this._basisY1Y*wt+this._basisY1Z*Vt;var Pt=this._basisZ1X*It+this._basisZ1Y*wt+this._basisZ1Z*Vt;this._twistAngle=Math.atan2(Pt,Bt);this.twistAxisX=this._basisX1X+this._basisX2X;this.twistAxisY=this._basisX1Y+this._basisX2Y;this.twistAxisZ=this._basisX1Z+this._basisX2Z;var Tt=this.twistAxisX*this.twistAxisX+this.twistAxisY*this.twistAxisY+this.twistAxisZ*this.twistAxisZ;if(Tt>0){Tt=1/Math.sqrt(Tt)}this.twistAxisX*=Tt;this.twistAxisY*=Tt;this.twistAxisZ*=Tt;var St=Math.sqrt(W*W+G*G+H*H);if(St>0){St=1/St}W*=St*this._swingAngle;G*=St*this._swingAngle;H*=St*this._swingAngle;var Ct;var qt;var Rt;Ct=l*W+f*G+u*H;qt=c*W+m*G+x*H;Rt=p*W+b*G+y*H;W=Ct;G=qt;H=Rt;var Et=G;var jt=H;var Nt=this._maxSwingAngle1;var Dt=this._maxSwingAngle2;var Ft=1/(Nt*Nt);var Ot=1/(Dt*Dt);var Wt=Et*Et*Ft+jt*jt*Ot;if(Wt==0){this.swingAxisX=0;this.swingAxisY=0;this.swingAxisZ=0;this.swingError=0}else{var Gt=Math.sqrt(1/Wt);var Ht=Et*Gt;var Ut=jt*Gt;var Jt=Ht*Ft;var Qt=Ut*Ot;St=1/Math.sqrt(Jt*Jt+Qt*Qt);Jt*=St;Qt*=St;var $t=(Et-Ht)*Jt+(jt-Ut)*Qt;if($t>0){this.swingError=$t;this.swingAxisX=0;this.swingAxisY=Jt;this.swingAxisZ=Qt;var Kt;var ta;var aa;Kt=l*this.swingAxisX+c*this.swingAxisY+p*this.swingAxisZ;ta=f*this.swingAxisX+m*this.swingAxisY+b*this.swingAxisZ;aa=u*this.swingAxisX+x*this.swingAxisY+y*this.swingAxisZ;this.swingAxisX=Kt;this.swingAxisY=ta;this.swingAxisZ=aa;var ia;var ra;var oa;ia=S*this.swingAxisX+C*this.swingAxisY+q*this.swingAxisZ;ra=R*this.swingAxisX+E*this.swingAxisY+j*this.swingAxisZ;oa=N*this.swingAxisX+D*this.swingAxisY+F*this.swingAxisZ;this.swingAxisX=ia;this.swingAxisY=ra;this.swingAxisZ=oa}else{this.swingError=0}}this.linearErrorX=this._anchor2X-this._anchor1X;this.linearErrorY=this._anchor2Y-this._anchor1Y;this.linearErrorZ=this._anchor2Z-this._anchor1Z},_getVelocitySolverInfo:function(t,a){Ei.prototype._getVelocitySolverInfo.call(this,t,a);this.getInfo(a,t,false)},_getPositionSolverInfo:function(t){Ei.prototype._getPositionSolverInfo.call(this,t);this.getInfo(t,null,true)},getAxis1:function(){var t=new Is;var a=t;a.x=this._basisX1X;a.y=this._basisX1Y;a.z=this._basisX1Z;return t},getAxis2:function(){var t=new Is;var a=t;a.x=this._basisX2X;a.y=this._basisX2Y;a.z=this._basisX2Z;return t},getAxis1To:function(t){var a=t;a.x=this._basisX1X;a.y=this._basisX1Y;a.z=this._basisX1Z},getAxis2To:function(t){var a=t;a.x=this._basisX2X;a.y=this._basisX2Y;a.z=this._basisX2Z},getLocalAxis1:function(){var t=new Is;var a=t;a.x=this._localBasisX1X;a.y=this._localBasisX1Y;a.z=this._localBasisX1Z;return t},getLocalAxis2:function(){var t=new Is;var a=t;a.x=this._localBasisX2X;a.y=this._localBasisX2Y;a.z=this._localBasisX2Z;return t},getLocalAxis1To:function(t){var a=t;a.x=this._localBasisX1X;a.y=this._localBasisX1Y;a.z=this._localBasisX1Z},getLocalAxis2To:function(t){var a=t;a.x=this._localBasisX2X;a.y=this._localBasisX2Y;a.z=this._localBasisX2Z},getTwistSpringDamper:function(){return this._twistSd},getTwistLimitMotor:function(){return this._twistLm},getSwingSpringDamper:function(){return this._swingSd},getSwingAxis:function(){var t=new Is;var a=t;a.x=this.swingAxisX;a.y=this.swingAxisY;a.z=this.swingAxisZ;return t},getSwingAxisTo:function(t){var a=t;a.x=this.swingAxisX;a.y=this.swingAxisY;a.z=this.swingAxisZ},getSwingAngle:function(){return this._swingAngle},getTwistAngle:function(){return this._twistAngle}});var Bt=function(){zt.call(this);this.localTwistAxis1=new Is(1,0,0);this.localTwistAxis2=new Is(1,0,0);this.localSwingAxis1=new Is(0,1,0);this.twistSpringDamper=new Rt;this.swingSpringDamper=new Rt;this.twistLimitMotor=new St;this.maxSwingAngle1=3.14159265358979;this.maxSwingAngle2=3.14159265358979};Bt.__super__=zt;Bt.prototype=$extend(zt.prototype,{init:function(t,a,i,r,o){this._init(t,a,i);var s;var n;var e;var _;var v=r;n=v.x;e=v.y;_=v.z;var h;var l;var c;h=t._transform._rotation00*n+t._transform._rotation10*e+t._transform._rotation20*_;l=t._transform._rotation01*n+t._transform._rotation11*e+t._transform._rotation21*_;c=t._transform._rotation02*n+t._transform._rotation12*e+t._transform._rotation22*_;n=h;e=l;_=c;var p=this.localTwistAxis1;p.x=n;p.y=e;p.z=_;var f;var m;var b;var u;var x=r;m=x.x;b=x.y;u=x.z;var y;var g;var X;y=a._transform._rotation00*m+a._transform._rotation10*b+a._transform._rotation20*u;g=a._transform._rotation01*m+a._transform._rotation11*b+a._transform._rotation21*u;X=a._transform._rotation02*m+a._transform._rotation12*b+a._transform._rotation22*u;m=y;b=g;u=X;var z=this.localTwistAxis2;z.x=m;z.y=b;z.z=u;var M;var Y;var Z;var d;var I=o;Y=I.x;Z=I.y;d=I.z;var w;var V;var L;w=t._transform._rotation00*Y+t._transform._rotation10*Z+t._transform._rotation20*d;V=t._transform._rotation01*Y+t._transform._rotation11*Z+t._transform._rotation21*d;L=t._transform._rotation02*Y+t._transform._rotation12*Z+t._transform._rotation22*d;Y=w;Z=V;d=L;var A=this.localSwingAxis1;A.x=Y;A.y=Z;A.z=d;return this}});var Pt=function(t){Ei.call(this,t,1);var a=t.localAxis1;this._localBasisX1X=a.x;this._localBasisX1Y=a.y;this._localBasisX1Z=a.z;var i=t.localAxis2;this._localBasisX2X=i.x;this._localBasisX2Y=i.y;this._localBasisX2Z=i.z;if(this._localBasisX1X*this._localBasisX1X+this._localBasisX1Y*this._localBasisX1Y+this._localBasisX1Z*this._localBasisX1Z==0){this._localBasisX1X=1;this._localBasisX1Y=0;this._localBasisX1Z=0}else{var r=this._localBasisX1X*this._localBasisX1X+this._localBasisX1Y*this._localBasisX1Y+this._localBasisX1Z*this._localBasisX1Z;if(r>0){r=1/Math.sqrt(r)}this._localBasisX1X*=r;this._localBasisX1Y*=r;this._localBasisX1Z*=r}if(this._localBasisX2X*this._localBasisX2X+this._localBasisX2Y*this._localBasisX2Y+this._localBasisX2Z*this._localBasisX2Z==0){this._localBasisX2X=1;this._localBasisX2Y=0;this._localBasisX2Z=0}else{var o=this._localBasisX2X*this._localBasisX2X+this._localBasisX2Y*this._localBasisX2Y+this._localBasisX2Z*this._localBasisX2Z;if(o>0){o=1/Math.sqrt(o)}this._localBasisX2X*=o;this._localBasisX2Y*=o;this._localBasisX2Z*=o}var s;var n;var e;var _;var v;var h;var l;var c;var p;var f;var m;var b;var u;var x;var y;var g=this._localBasisX1X*this._localBasisX2X+this._localBasisX1Y*this._localBasisX2Y+this._localBasisX1Z*this._localBasisX2Z;if(g<-.999999999){var X;var z;var M;var Y=this._localBasisX1X;var Z=this._localBasisX1Y;var d=this._localBasisX1Z;var I=Y*Y;var w=Z*Z;var V=d*d;var L;if(I<w){if(I<V){L=1/Math.sqrt(w+V);X=0;z=d*L;M=-Z*L}else{L=1/Math.sqrt(I+w);X=Z*L;z=-Y*L;M=0}}else if(w<V){L=1/Math.sqrt(V+I);X=-d*L;z=0;M=Y*L}else{L=1/Math.sqrt(I+w);X=Z*L;z=-Y*L;M=0}n=X;e=z;_=M;v=0}else{var A;var k;var B;A=this._localBasisX1Y*this._localBasisX2Z-this._localBasisX1Z*this._localBasisX2Y;k=this._localBasisX1Z*this._localBasisX2X-this._localBasisX1X*this._localBasisX2Z;B=this._localBasisX1X*this._localBasisX2Y-this._localBasisX1Y*this._localBasisX2X;var P=Math.sqrt((1+g)*.5);g=.5/P;A*=g;k*=g;B*=g;n=A;e=k;_=B;v=P}var T=n;var S=e;var C=_;var q=v;var R=2*T;var E=2*S;var j=2*C;var N=T*R;var D=S*E;var F=C*j;var O=T*E;var W=S*j;var G=T*j;var H=q*R;var U=q*E;var J=q*j;l=1-D-F;c=O-J;p=G+U;f=O+J;m=1-N-F;b=W-H;u=G-U;x=W+H;y=1-N-D;var Q=this._localBasisX1X;var $=this._localBasisX1Y;var K=this._localBasisX1Z;var tt=Q*Q;var at=$*$;var it=K*K;var rt;if(tt<at){if(tt<it){rt=1/Math.sqrt(at+it);this._localBasisY1X=0;this._localBasisY1Y=K*rt;this._localBasisY1Z=-$*rt}else{rt=1/Math.sqrt(tt+at);this._localBasisY1X=$*rt;this._localBasisY1Y=-Q*rt;this._localBasisY1Z=0}}else if(at<it){rt=1/Math.sqrt(it+tt);this._localBasisY1X=-K*rt;this._localBasisY1Y=0;this._localBasisY1Z=Q*rt}else{rt=1/Math.sqrt(tt+at);this._localBasisY1X=$*rt;this._localBasisY1Y=-Q*rt;this._localBasisY1Z=0}this._localBasisZ1X=this._localBasisX1Y*this._localBasisY1Z-this._localBasisX1Z*this._localBasisY1Y;this._localBasisZ1Y=this._localBasisX1Z*this._localBasisY1X-this._localBasisX1X*this._localBasisY1Z;this._localBasisZ1Z=this._localBasisX1X*this._localBasisY1Y-this._localBasisX1Y*this._localBasisY1X;var ot;var st;var nt;ot=l*this._localBasisX1X+c*this._localBasisX1Y+p*this._localBasisX1Z;st=f*this._localBasisX1X+m*this._localBasisX1Y+b*this._localBasisX1Z;nt=u*this._localBasisX1X+x*this._localBasisX1Y+y*this._localBasisX1Z;this._localBasisX2X=ot;this._localBasisX2Y=st;this._localBasisX2Z=nt;var et;var _t;var vt;et=l*this._localBasisY1X+c*this._localBasisY1Y+p*this._localBasisY1Z;_t=f*this._localBasisY1X+m*this._localBasisY1Y+b*this._localBasisY1Z;vt=u*this._localBasisY1X+x*this._localBasisY1Y+y*this._localBasisY1Z;this._localBasisY2X=et;this._localBasisY2Y=_t;this._localBasisY2Z=vt;var ht;var lt;var ct;ht=l*this._localBasisZ1X+c*this._localBasisZ1Y+p*this._localBasisZ1Z;lt=f*this._localBasisZ1X+m*this._localBasisZ1Y+b*this._localBasisZ1Z;ct=u*this._localBasisZ1X+x*this._localBasisZ1Y+y*this._localBasisZ1Z;this._localBasisZ2X=ht;this._localBasisZ2Y=lt;this._localBasisZ2Z=ct;this.angle=0;this.angularErrorY=0;this.angularErrorZ=0;this._basis=new Zt(this);this._sd=t.springDamper.clone();this._lm=t.limitMotor.clone()};Pt.__super__=Ei;Pt.prototype=$extend(Ei.prototype,{getInfo:function(t,a,i){var r=i?1:this._positionCorrectionAlgorithm==ka.BAUMGARTE?a.invDt*ys.velocityBaumgarte:0;var o;var s;var n;var e;s=this.linearErrorX*r;n=this.linearErrorY*r;e=this.linearErrorZ*r;var _=s;var v=n;var h=e;var l=this.angularErrorY*r;var c=this.angularErrorZ*r;var p;var f;var m;var b;var u;var x;var y;var g;var X;var z;var M;var Y;var Z;var d;var I;var w;var V;var L;var A;var k;f=0;m=-this._relativeAnchor1Z;b=this._relativeAnchor1Y;u=this._relativeAnchor1Z;x=0;y=-this._relativeAnchor1X;g=-this._relativeAnchor1Y;X=this._relativeAnchor1X;z=0;Y=0;Z=-this._relativeAnchor2Z;d=this._relativeAnchor2Y;I=this._relativeAnchor2Z;w=0;V=-this._relativeAnchor2X;L=-this._relativeAnchor2Y;A=this._relativeAnchor2X;k=0;f=-f;m=-m;b=-b;u=-u;x=-x;y=-y;g=-g;X=-X;z=-z;Y=-Y;Z=-Z;d=-d;I=-I;w=-w;V=-V;L=-L;A=-A;k=-k;var B=this._basis.xX;var P=this._basis.xY;var T=this._basis.xZ;var S;var C;var q;var R;var E;var j;var N;var D;var F;var O;var W;F=this._b1._invInertia00*B+this._b1._invInertia01*P+this._b1._invInertia02*T;O=this._b1._invInertia10*B+this._b1._invInertia11*P+this._b1._invInertia12*T;W=this._b1._invInertia20*B+this._b1._invInertia21*P+this._b1._invInertia22*T;C=F;q=O;R=W;var G;var H;var U;G=this._b2._invInertia00*B+this._b2._invInertia01*P+this._b2._invInertia02*T;H=this._b2._invInertia10*B+this._b2._invInertia11*P+this._b2._invInertia12*T;U=this._b2._invInertia20*B+this._b2._invInertia21*P+this._b2._invInertia22*T;j=G;N=H;D=U;var J=C*B+q*P+R*T;var Q=j*B+N*P+D*T;if(J>0){var $=this._relativeAnchor1X*this._relativeAnchor1X+this._relativeAnchor1Y*this._relativeAnchor1Y+this._relativeAnchor1Z*this._relativeAnchor1Z;var K=B*this._relativeAnchor1X+P*this._relativeAnchor1Y+T*this._relativeAnchor1Z;var tt=$-K*K;if(tt>0){if(this._b1._invMass>0){J=1/(1/J+this._b1._mass*tt)}else{J=0}}}if(Q>0){var at=this._relativeAnchor2X*this._relativeAnchor2X+this._relativeAnchor2Y*this._relativeAnchor2Y+this._relativeAnchor2Z*this._relativeAnchor2Z;var it=B*this._relativeAnchor2X+P*this._relativeAnchor2Y+T*this._relativeAnchor2Z;var rt=at-it*it;if(rt>0){if(this._b2._invMass>0){Q=1/(1/Q+this._b2._mass*rt)}else{Q=0}}}var ot=J+Q==0?0:1/(J+Q);var st=this._impulses[0];var nt=t.rows[t.numRows++];var et=nt.jacobian;et.lin1X=0;et.lin1Y=0;et.lin1Z=0;et.lin2X=0;et.lin2Y=0;et.lin2Z=0;et.ang1X=0;et.ang1Y=0;et.ang1Z=0;et.ang2X=0;et.ang2Y=0;et.ang2Z=0;nt.rhs=0;nt.cfm=0;nt.minImpulse=0;nt.maxImpulse=0;nt.motorSpeed=0;nt.motorMaxImpulse=0;nt.impulse=null;nt.impulse=st;var _t=nt;_t.rhs=_;_t.cfm=0;_t.minImpulse=-1/0;_t.maxImpulse=1/0;var vt=_t.jacobian;vt.lin1X=1;vt.lin1Y=0;vt.lin1Z=0;vt.lin2X=1;vt.lin2Y=0;vt.lin2Z=0;vt.ang1X=f;vt.ang1Y=m;vt.ang1Z=b;vt.ang2X=Y;vt.ang2Y=Z;vt.ang2Z=d;var ht=this._impulses[1];var lt=t.rows[t.numRows++];var ct=lt.jacobian;ct.lin1X=0;ct.lin1Y=0;ct.lin1Z=0;ct.lin2X=0;ct.lin2Y=0;ct.lin2Z=0;ct.ang1X=0;ct.ang1Y=0;ct.ang1Z=0;ct.ang2X=0;ct.ang2Y=0;ct.ang2Z=0;lt.rhs=0;lt.cfm=0;lt.minImpulse=0;lt.maxImpulse=0;lt.motorSpeed=0;lt.motorMaxImpulse=0;lt.impulse=null;lt.impulse=ht;_t=lt;_t.rhs=v;_t.cfm=0;_t.minImpulse=-1/0;_t.maxImpulse=1/0;vt=_t.jacobian;vt.lin1X=0;vt.lin1Y=1;vt.lin1Z=0;vt.lin2X=0;vt.lin2Y=1;vt.lin2Z=0;vt.ang1X=u;vt.ang1Y=x;vt.ang1Z=y;vt.ang2X=I;vt.ang2Y=w;vt.ang2Z=V;var pt=this._impulses[2];var ft=t.rows[t.numRows++];var mt=ft.jacobian;mt.lin1X=0;mt.lin1Y=0;mt.lin1Z=0;mt.lin2X=0;mt.lin2Y=0;mt.lin2Z=0;mt.ang1X=0;mt.ang1Y=0;mt.ang1Z=0;mt.ang2X=0;mt.ang2Y=0;mt.ang2Z=0;ft.rhs=0;ft.cfm=0;ft.minImpulse=0;ft.maxImpulse=0;ft.motorSpeed=0;ft.motorMaxImpulse=0;ft.impulse=null;ft.impulse=pt;_t=ft;_t.rhs=h;_t.cfm=0;_t.minImpulse=-1/0;_t.maxImpulse=1/0;vt=_t.jacobian;vt.lin1X=0;vt.lin1Y=0;vt.lin1Z=1;vt.lin2X=0;vt.lin2Y=0;vt.lin2Z=1;vt.ang1X=g;vt.ang1Y=X;vt.ang1Z=z;vt.ang2X=L;vt.ang2Y=A;vt.ang2Z=k;if(this._sd.frequency<=0||!i){var bt=this._impulses[3];var ut=t.rows[t.numRows++];var xt=ut.jacobian;xt.lin1X=0;xt.lin1Y=0;xt.lin1Z=0;xt.lin2X=0;xt.lin2Y=0;xt.lin2Z=0;xt.ang1X=0;xt.ang1Y=0;xt.ang1Z=0;xt.ang2X=0;xt.ang2Y=0;xt.ang2Z=0;ut.rhs=0;ut.cfm=0;ut.minImpulse=0;ut.maxImpulse=0;ut.motorSpeed=0;ut.motorMaxImpulse=0;ut.impulse=null;ut.impulse=bt;_t=ut;var yt=this.angle;var gt=this._lm;var Xt=this._sd;var zt;var Mt;var Yt=ys.angularSlop;if(i){zt=0;Mt=1}else{if(Xt.frequency>0){Yt=0;var Zt=6.28318530717958*Xt.frequency;var dt=Xt.dampingRatio;if(dt<ys.minSpringDamperDampingRatio){dt=ys.minSpringDamperDampingRatio}var It=a.dt;var wt=2*dt*Zt;var Vt=Zt*Zt;if(Xt.useSymplecticEuler){zt=1/(It*wt);Mt=Vt/wt}else{zt=1/(It*(It*Vt+wt));Mt=Vt/(It*Vt+wt)}}else{zt=0;Mt=this._positionCorrectionAlgorithm==ka.BAUMGARTE?a.invDt*ys.velocityBaumgarte:0}if(gt.motorTorque>0){_t.motorSpeed=gt.motorSpeed;_t.motorMaxImpulse=gt.motorTorque*a.dt}else{_t.motorSpeed=0;_t.motorMaxImpulse=0}}var Lt=gt.lowerLimit;var At=gt.upperLimit;var kt=(Lt+At)*.5;yt-=kt;yt=((yt+3.14159265358979)%6.28318530717958+6.28318530717958)%6.28318530717958-3.14159265358979;yt+=kt;var Bt;var Pt;var Tt;if(Lt>At){Bt=0;Pt=0;Tt=0}else if(Lt==At){Bt=-1/0;Pt=1/0;Tt=yt-Lt}else if(yt<Lt){Bt=-1/0;Pt=0;Tt=yt-Lt+Yt;if(Tt>0){Tt=0}}else if(yt>At){Bt=0;Pt=1/0;Tt=yt-At-Yt;if(Tt<0){Tt=0}}else{Bt=0;Pt=0;Tt=0}var St=ot==0?0:1/ot;_t.minImpulse=Bt;_t.maxImpulse=Pt;_t.cfm=zt*St;_t.rhs=Tt*Mt;vt=_t.jacobian;vt.ang1X=this._basis.xX;vt.ang1Y=this._basis.xY;vt.ang1Z=this._basis.xZ;vt.ang2X=this._basis.xX;vt.ang2Y=this._basis.xY;vt.ang2Z=this._basis.xZ}var Ct=this._impulses[4];var qt=t.rows[t.numRows++];var Rt=qt.jacobian;Rt.lin1X=0;Rt.lin1Y=0;Rt.lin1Z=0;Rt.lin2X=0;Rt.lin2Y=0;Rt.lin2Z=0;Rt.ang1X=0;Rt.ang1Y=0;Rt.ang1Z=0;Rt.ang2X=0;Rt.ang2Y=0;Rt.ang2Z=0;qt.rhs=0;qt.cfm=0;qt.minImpulse=0;qt.maxImpulse=0;qt.motorSpeed=0;qt.motorMaxImpulse=0;qt.impulse=null;qt.impulse=Ct;_t=qt;_t.rhs=l;_t.cfm=0;_t.minImpulse=-1/0;_t.maxImpulse=1/0;vt=_t.jacobian;vt.ang1X=this._basis.yX;vt.ang1Y=this._basis.yY;vt.ang1Z=this._basis.yZ;vt.ang2X=this._basis.yX;vt.ang2Y=this._basis.yY;vt.ang2Z=this._basis.yZ;var Et=this._impulses[5];var jt=t.rows[t.numRows++];var Nt=jt.jacobian;Nt.lin1X=0;Nt.lin1Y=0;Nt.lin1Z=0;Nt.lin2X=0;Nt.lin2Y=0;Nt.lin2Z=0;Nt.ang1X=0;Nt.ang1Y=0;Nt.ang1Z=0;Nt.ang2X=0;Nt.ang2Y=0;Nt.ang2Z=0;jt.rhs=0;jt.cfm=0;jt.minImpulse=0;jt.maxImpulse=0;jt.motorSpeed=0;jt.motorMaxImpulse=0;jt.impulse=null;jt.impulse=Et;_t=jt;_t.rhs=c;_t.cfm=0;_t.minImpulse=-1/0;_t.maxImpulse=1/0;vt=_t.jacobian;vt.ang1X=this._basis.zX;vt.ang1Y=this._basis.zY;vt.ang1Z=this._basis.zZ;vt.ang2X=this._basis.zX;vt.ang2Y=this._basis.zY;vt.ang2Z=this._basis.zZ},_syncAnchors:function(){Ei.prototype._syncAnchors.call(this);var t=this._basis;var a=t.joint._b1._invMass;var i=t.joint._b2._invMass;var r;var o;var s;var n;var e;var _;var v;var h;var l;var c;var p;var f;var m;var b;var u;var x;var y;var g;var X;var z;var M;var Y;var Z;var d;var I;var w;var V;var L;var A;var k;var B;var P;var T;var S;var C;var q;var R;var E;var j;var N;var D;var F;var O;var W;var G;var H=t.joint._basisX1X*t.joint._basisX2X+t.joint._basisX1Y*t.joint._basisX2Y+t.joint._basisX1Z*t.joint._basisX2Z;if(H<-.999999999){var U;var J;var Q;var $=t.joint._basisX1X;var K=t.joint._basisX1Y;var tt=t.joint._basisX1Z;var at=$*$;var it=K*K;var rt=tt*tt;var ot;if(at<it){if(at<rt){ot=1/Math.sqrt(it+rt);U=0;J=tt*ot;Q=-K*ot}else{ot=1/Math.sqrt(at+it);U=K*ot;J=-$*ot;Q=0}}else if(it<rt){ot=1/Math.sqrt(rt+at);U=-tt*ot;J=0;Q=$*ot}else{ot=1/Math.sqrt(at+it);U=K*ot;J=-$*ot;Q=0}o=U;s=J;n=Q;e=0}else{var st;var nt;var et;st=t.joint._basisX1Y*t.joint._basisX2Z-t.joint._basisX1Z*t.joint._basisX2Y;nt=t.joint._basisX1Z*t.joint._basisX2X-t.joint._basisX1X*t.joint._basisX2Z;et=t.joint._basisX1X*t.joint._basisX2Y-t.joint._basisX1Y*t.joint._basisX2X;var _t=Math.sqrt((1+H)*.5);H=.5/_t;st*=H;nt*=H;et*=H;o=st;s=nt;n=et;e=_t}v=0;h=0;l=0;c=1;var vt;var ht;var lt;var ct;var pt;var ft;var mt;var bt;var ut;var xt;var yt;var gt;pt=v;ft=h;mt=l;bt=c;ut=o;xt=s;yt=n;gt=e;var Xt=pt*ut+ft*xt+mt*yt+bt*gt;if(Xt<0){Xt=-Xt;ut=-ut;xt=-xt;yt=-yt;gt=-gt}if(Xt>.999999){var zt;var Mt;var Yt;var Zt;zt=ut-pt;Mt=xt-ft;Yt=yt-mt;Zt=gt-bt;ut=pt+zt*(a/(a+i));xt=ft+Mt*(a/(a+i));yt=mt+Yt*(a/(a+i));gt=bt+Zt*(a/(a+i));var dt=ut*ut+xt*xt+yt*yt+gt*gt;if(dt>1e-32){dt=1/Math.sqrt(dt)}f=ut*dt;m=xt*dt;b=yt*dt;u=gt*dt}else{var It=a/(a+i)*Math.acos(Xt);ut+=pt*-Xt;xt+=ft*-Xt;yt+=mt*-Xt;gt+=bt*-Xt;var wt=ut*ut+xt*xt+yt*yt+gt*gt;if(wt>1e-32){wt=1/Math.sqrt(wt)}ut*=wt;xt*=wt;yt*=wt;gt*=wt;var Vt=Math.sin(It);var Lt=Math.cos(It);pt*=Lt;ft*=Lt;mt*=Lt;bt*=Lt;f=pt+ut*Vt;m=ft+xt*Vt;b=mt+yt*Vt;u=bt+gt*Vt}var At=f;var kt=m;var Bt=b;var Pt=u;var Tt=2*At;var St=2*kt;var Ct=2*Bt;var qt=At*Tt;var Rt=kt*St;var Et=Bt*Ct;var jt=At*St;var Nt=kt*Ct;var Dt=At*Ct;var Ft=Pt*Tt;var Ot=Pt*St;var Wt=Pt*Ct;y=1-Rt-Et;g=jt-Wt;X=Dt+Ot;z=jt+Wt;M=1-qt-Et;Y=Nt-Ft;Z=Dt-Ot;d=Nt+Ft;I=1-qt-Rt;var Gt;var Ht;var Ut;Gt=y*t.joint._basisX1X+g*t.joint._basisX1Y+X*t.joint._basisX1Z;Ht=z*t.joint._basisX1X+M*t.joint._basisX1Y+Y*t.joint._basisX1Z;Ut=Z*t.joint._basisX1X+d*t.joint._basisX1Y+I*t.joint._basisX1Z;V=Gt;L=Ht;A=Ut;j=t.xX;N=t.xY;D=t.xZ;O=t.yX;W=t.yY;G=t.yZ;var Jt=j*V+N*L+D*A;if(Jt<-.999999999){var Qt;var $t;var Kt;var ta=j;var aa=N;var ia=D;var ra=ta*ta;var oa=aa*aa;var sa=ia*ia;var na;if(ra<oa){if(ra<sa){na=1/Math.sqrt(oa+sa);Qt=0;$t=ia*na;Kt=-aa*na}else{na=1/Math.sqrt(ra+oa);Qt=aa*na;$t=-ta*na;Kt=0}}else if(oa<sa){na=1/Math.sqrt(sa+ra);Qt=-ia*na;$t=0;Kt=ta*na}else{na=1/Math.sqrt(ra+oa);Qt=aa*na;$t=-ta*na;Kt=0}f=Qt;m=$t;b=Kt;u=0}else{var ea;var _a;var va;ea=N*A-D*L;_a=D*V-j*A;va=j*L-N*V;var ha=Math.sqrt((1+Jt)*.5);Jt=.5/ha;ea*=Jt;_a*=Jt;va*=Jt;f=ea;m=_a;b=va;u=ha}var la=f;var ca=m;var pa=b;var fa=u;var ma=2*la;var ba=2*ca;var ua=2*pa;var xa=la*ma;var ya=ca*ba;var ga=pa*ua;var Xa=la*ba;var za=ca*ua;var Ma=la*ua;var Ya=fa*ma;var Za=fa*ba;var da=fa*ua;y=1-ya-ga;g=Xa-da;X=Ma+Za;z=Xa+da;M=1-xa-ga;Y=za-Ya;Z=Ma-Za;d=za+Ya;I=1-xa-ya;var Ia;var wa;var Va;Ia=y*O+g*W+X*G;wa=z*O+M*W+Y*G;Va=Z*O+d*W+I*G;B=Ia;P=wa;T=Va;C=L*T-A*P;q=A*B-V*T;R=V*P-L*B;if(C*C+q*q+R*R>1e-6){var La=C*C+q*q+R*R;if(La>0){La=1/Math.sqrt(La)}C*=La;q*=La;R*=La}else{var Aa=V;var ka=L;var Ba=A;var Pa=Aa*Aa;var Ta=ka*ka;var Sa=Ba*Ba;var Ca;if(Pa<Ta){if(Pa<Sa){Ca=1/Math.sqrt(Ta+Sa);C=0;q=Ba*Ca;R=-ka*Ca}else{Ca=1/Math.sqrt(Pa+Ta);C=ka*Ca;q=-Aa*Ca;R=0}}else if(Ta<Sa){Ca=1/Math.sqrt(Sa+Pa);C=-Ba*Ca;q=0;R=Aa*Ca}else{Ca=1/Math.sqrt(Pa+Ta);C=ka*Ca;q=-Aa*Ca;R=0}}B=q*A-R*L;P=R*V-C*A;T=C*L-q*V;t.xX=V;t.xY=L;t.xZ=A;t.yX=B;t.yY=P;t.yZ=T;t.zX=C;t.zY=q;t.zZ=R;var qa;var Ra;var Ea;var ja;Ra=this._basisX1Y*this._basisX2Z-this._basisX1Z*this._basisX2Y;Ea=this._basisX1Z*this._basisX2X-this._basisX1X*this._basisX2Z;ja=this._basisX1X*this._basisX2Y-this._basisX1Y*this._basisX2X;var Na=this._basisX1X*this._basisX2X+this._basisX1Y*this._basisX2Y+this._basisX1Z*this._basisX2Z;var Da=Na<=-1?3.14159265358979:Na>=1?0:Math.acos(Na);var Fa=Ra*Ra+Ea*Ea+ja*ja;if(Fa>0){Fa=1/Math.sqrt(Fa)}Ra*=Fa;Ea*=Fa;ja*=Fa;Ra*=Da;Ea*=Da;ja*=Da;this.angularErrorY=Ra*this._basis.yX+Ea*this._basis.yY+ja*this._basis.yZ;this.angularErrorZ=Ra*this._basis.zX+Ea*this._basis.zY+ja*this._basis.zZ;var Oa;var Wa;var Ga;var Ha;Wa=this._basisY1Y*this._basisY2Z-this._basisY1Z*this._basisY2Y;Ga=this._basisY1Z*this._basisY2X-this._basisY1X*this._basisY2Z;Ha=this._basisY1X*this._basisY2Y-this._basisY1Y*this._basisY2X;Na=this._basisY1X*this._basisY2X+this._basisY1Y*this._basisY2Y+this._basisY1Z*this._basisY2Z;this.angle=Na<=-1?3.14159265358979:Na>=1?0:Math.acos(Na);if(Wa*this._basis.xX+Ga*this._basis.xY+Ha*this._basis.xZ<0){this.angle=-this.angle}this.linearErrorX=this._anchor2X-this._anchor1X;this.linearErrorY=this._anchor2Y-this._anchor1Y;this.linearErrorZ=this._anchor2Z-this._anchor1Z},_getVelocitySolverInfo:function(t,a){Ei.prototype._getVelocitySolverInfo.call(this,t,a);this.getInfo(a,t,false)},_getPositionSolverInfo:function(t){Ei.prototype._getPositionSolverInfo.call(this,t);this.getInfo(t,null,true)},getAxis1:function(){var t=new Is;var a=t;a.x=this._basisX1X;a.y=this._basisX1Y;a.z=this._basisX1Z;return t},getAxis2:function(){var t=new Is;var a=t;a.x=this._basisX2X;a.y=this._basisX2Y;a.z=this._basisX2Z;return t},getAxis1To:function(t){var a=t;a.x=this._basisX1X;a.y=this._basisX1Y;a.z=this._basisX1Z},getAxis2To:function(t){var a=t;a.x=this._basisX2X;a.y=this._basisX2Y;a.z=this._basisX2Z},getLocalAxis1:function(){var t=new Is;var a=t;a.x=this._localBasisX1X;a.y=this._localBasisX1Y;a.z=this._localBasisX1Z;return t},getLocalAxis2:function(){var t=new Is;var a=t;a.x=this._localBasisX2X;a.y=this._localBasisX2Y;a.z=this._localBasisX2Z;return t},getLocalAxis1To:function(t){var a=t;a.x=this._localBasisX1X;a.y=this._localBasisX1Y;a.z=this._localBasisX1Z},getLocalAxis2To:function(t){var a=t;a.x=this._localBasisX2X;a.y=this._localBasisX2Y;a.z=this._localBasisX2Z},getSpringDamper:function(){return this._sd},getLimitMotor:function(){return this._lm},getAngle:function(){return this.angle}});var Tt=function(){zt.call(this);this.localAxis1=new Is(1,0,0);this.localAxis2=new Is(1,0,0);this.springDamper=new Rt;this.limitMotor=new St};Tt.__super__=zt;Tt.prototype=$extend(zt.prototype,{init:function(t,a,i,r){this._init(t,a,i);var o;var s;var n;var e;var _=r;s=_.x;n=_.y;e=_.z;var v;var h;var l;v=t._transform._rotation00*s+t._transform._rotation10*n+t._transform._rotation20*e;h=t._transform._rotation01*s+t._transform._rotation11*n+t._transform._rotation21*e;l=t._transform._rotation02*s+t._transform._rotation12*n+t._transform._rotation22*e;s=v;n=h;e=l;var c=this.localAxis1;c.x=s;c.y=n;c.z=e;var p;var f;var m;var b;var u=r;f=u.x;m=u.y;b=u.z;var x;var y;var g;x=a._transform._rotation00*f+a._transform._rotation10*m+a._transform._rotation20*b;y=a._transform._rotation01*f+a._transform._rotation11*m+a._transform._rotation21*b;g=a._transform._rotation02*f+a._transform._rotation12*m+a._transform._rotation22*b;f=x;m=y;b=g;var X=this.localAxis2;X.x=f;X.y=m;X.z=b;return this}});var St=function(){this.lowerLimit=1;this.upperLimit=0;this.motorTorque=0};St.prototype={setLimits:function(t,a){this.lowerLimit=t;this.upperLimit=a;return this},setMotor:function(t,a){this.motorSpeed=t;this.motorTorque=a;return this},clone:function(){var t=new St;t.lowerLimit=this.lowerLimit;t.upperLimit=this.upperLimit;t.motorSpeed=this.motorSpeed;t.motorTorque=this.motorTorque;return t}};var Ct=function(t){Ei.call(this,t,0);this._sd=t.springDamper.clone()};Ct.__super__=Ei;Ct.prototype=$extend(Ei.prototype,{getInfo:function(t,a,i){if(this._sd.frequency>0&&i){return}var r;var o;var s;var n;o=this._anchor2X-this._anchor1X;s=this._anchor2Y-this._anchor1Y;n=this._anchor2Z-this._anchor1Z;var e;var _;if(this._sd.frequency>0){var v=6.28318530717958*this._sd.frequency;var h=this._sd.dampingRatio;if(h<ys.minSpringDamperDampingRatio){h=ys.minSpringDamperDampingRatio}var l=a.dt;var c=2*h*v;var p=v*v;if(this._sd.useSymplecticEuler){e=1/(l*c);_=p/c}else{e=1/(l*(l*p+c));_=p/(l*p+c)}e*=this._b1._invMass+this._b2._invMass}else{e=0;_=i?1:this._positionCorrectionAlgorithm==ka.BAUMGARTE?a.invDt*ys.velocityBaumgarte:0}var f;var m;var b;var u;m=o*_;b=s*_;u=n*_;var x=m;var y=b;var g=u;var X;var z;var M;var Y;var Z;var d;var I;var w;var V;var L;var A;var k;var B;var P;var T;var S;var C;var q;var R;var E;z=0;M=-this._relativeAnchor1Z;Y=this._relativeAnchor1Y;Z=this._relativeAnchor1Z;d=0;I=-this._relativeAnchor1X;w=-this._relativeAnchor1Y;V=this._relativeAnchor1X;L=0;k=0;B=-this._relativeAnchor2Z;P=this._relativeAnchor2Y;T=this._relativeAnchor2Z;S=0;C=-this._relativeAnchor2X;q=-this._relativeAnchor2Y;R=this._relativeAnchor2X;E=0;z=-z;M=-M;Y=-Y;Z=-Z;d=-d;I=-I;w=-w;V=-V;L=-L;k=-k;B=-B;P=-P;T=-T;S=-S;C=-C;q=-q;R=-R;E=-E;var j=this._impulses[0];var N=t.rows[t.numRows++];var D=N.jacobian;D.lin1X=0;D.lin1Y=0;D.lin1Z=0;D.lin2X=0;D.lin2Y=0;D.lin2Z=0;D.ang1X=0;D.ang1Y=0;D.ang1Z=0;D.ang2X=0;D.ang2Y=0;D.ang2Z=0;N.rhs=0;N.cfm=0;N.minImpulse=0;N.maxImpulse=0;N.motorSpeed=0;N.motorMaxImpulse=0;N.impulse=null;N.impulse=j;var F=N;F.rhs=x;F.cfm=e;F.minImpulse=-1/0;F.maxImpulse=1/0;var O=F.jacobian;O.lin1X=1;O.lin1Y=0;O.lin1Z=0;O.lin2X=1;O.lin2Y=0;O.lin2Z=0;O.ang1X=z;O.ang1Y=M;O.ang1Z=Y;O.ang2X=k;O.ang2Y=B;O.ang2Z=P;var W=this._impulses[1];var G=t.rows[t.numRows++];var H=G.jacobian;H.lin1X=0;H.lin1Y=0;H.lin1Z=0;H.lin2X=0;H.lin2Y=0;H.lin2Z=0;H.ang1X=0;H.ang1Y=0;H.ang1Z=0;H.ang2X=0;H.ang2Y=0;H.ang2Z=0;G.rhs=0;G.cfm=0;G.minImpulse=0;G.maxImpulse=0;G.motorSpeed=0;G.motorMaxImpulse=0;G.impulse=null;G.impulse=W;F=G;F.rhs=y;F.cfm=e;F.minImpulse=-1/0;F.maxImpulse=1/0;O=F.jacobian;O.lin1X=0;O.lin1Y=1;O.lin1Z=0;O.lin2X=0;O.lin2Y=1;O.lin2Z=0;O.ang1X=Z;O.ang1Y=d;O.ang1Z=I;O.ang2X=T;O.ang2Y=S;O.ang2Z=C;var U=this._impulses[2];var J=t.rows[t.numRows++];var Q=J.jacobian;Q.lin1X=0;Q.lin1Y=0;Q.lin1Z=0;Q.lin2X=0;Q.lin2Y=0;Q.lin2Z=0;Q.ang1X=0;Q.ang1Y=0;Q.ang1Z=0;Q.ang2X=0;Q.ang2Y=0;Q.ang2Z=0;J.rhs=0;J.cfm=0;J.minImpulse=0;J.maxImpulse=0;J.motorSpeed=0;J.motorMaxImpulse=0;J.impulse=null;J.impulse=U;F=J;F.rhs=g;F.cfm=e;F.minImpulse=-1/0;F.maxImpulse=1/0;O=F.jacobian;O.lin1X=0;O.lin1Y=0;O.lin1Z=1;O.lin2X=0;O.lin2Y=0;O.lin2Z=1;O.ang1X=w;O.ang1Y=V;O.ang1Z=L;O.ang2X=q;O.ang2Y=R;O.ang2Z=E},_getVelocitySolverInfo:function(t,a){Ei.prototype._getVelocitySolverInfo.call(this,t,a);this.getInfo(a,t,false)},_getPositionSolverInfo:function(t){Ei.prototype._getPositionSolverInfo.call(this,t);this.getInfo(t,null,true)},getSpringDamper:function(){return this._sd}});var qt=function(){zt.call(this);this.springDamper=new Rt};qt.__super__=zt;qt.prototype=$extend(zt.prototype,{init:function(t,a,i){this._init(t,a,i);return this}});var Rt=function(){this.frequency=0;this.dampingRatio=0;this.useSymplecticEuler=false};Rt.prototype={setSpring:function(t,a){this.frequency=t;this.dampingRatio=a;return this},setSymplecticEuler:function(t){this.useSymplecticEuler=t;return this},clone:function(){var t=new Rt;t.frequency=this.frequency;t.dampingRatio=this.dampingRatio;t.useSymplecticEuler=this.useSymplecticEuler;return t}};var Et=function(){this.lowerLimit=1;this.upperLimit=0;this.motorForce=0};Et.prototype={setLimits:function(t,a){this.lowerLimit=t;this.upperLimit=a;return this},setMotor:function(t,a){this.motorSpeed=t;this.motorForce=a;return this},clone:function(){var t=new Et;t.lowerLimit=this.lowerLimit;t.upperLimit=this.upperLimit;t.motorSpeed=this.motorSpeed;t.motorForce=this.motorForce;return t}};var jt=function(t){Ei.call(this,t,Vt.UNIVERSAL);var a=t.localAxis1;this._localBasisX1X=a.x;this._localBasisX1Y=a.y;this._localBasisX1Z=a.z;var i=t.localAxis2;this._localBasisZ2X=i.x;this._localBasisZ2Y=i.y;this._localBasisZ2Z=i.z;if(this._localBasisX1X*this._localBasisX1X+this._localBasisX1Y*this._localBasisX1Y+this._localBasisX1Z*this._localBasisX1Z==0){this._localBasisX1X=1;this._localBasisX1Y=0;this._localBasisX1Z=0}else{var r=this._localBasisX1X*this._localBasisX1X+this._localBasisX1Y*this._localBasisX1Y+this._localBasisX1Z*this._localBasisX1Z;if(r>0){r=1/Math.sqrt(r)}this._localBasisX1X*=r;this._localBasisX1Y*=r;this._localBasisX1Z*=r}if(this._localBasisZ2X*this._localBasisZ2X+this._localBasisZ2Y*this._localBasisZ2Y+this._localBasisZ2Z*this._localBasisZ2Z==0){this._localBasisZ2X=0;this._localBasisZ2Y=0;this._localBasisZ2Z=1}else{var o=this._localBasisZ2X*this._localBasisZ2X+this._localBasisZ2Y*this._localBasisZ2Y+this._localBasisZ2Z*this._localBasisZ2Z;if(o>0){o=1/Math.sqrt(o)}this._localBasisZ2X*=o;this._localBasisZ2Y*=o;this._localBasisZ2Z*=o}var s=this._b1._transform;var n=this._b2._transform;var e;var _;var v;var h;var l;var c;var p;var f;var m;var b;var u;var x;var y;var g;var X;var z;var M;var Y;var Z;var d;var I;var w;var V;I=s._rotation00*this._localBasisX1X+s._rotation01*this._localBasisX1Y+s._rotation02*this._localBasisX1Z;w=s._rotation10*this._localBasisX1X+s._rotation11*this._localBasisX1Y+s._rotation12*this._localBasisX1Z;V=s._rotation20*this._localBasisX1X+s._rotation21*this._localBasisX1Y+s._rotation22*this._localBasisX1Z;_=I;v=w;h=V;var L;var A;var k;L=n._rotation00*this._localBasisZ2X+n._rotation01*this._localBasisZ2Y+n._rotation02*this._localBasisZ2Z;A=n._rotation10*this._localBasisZ2X+n._rotation11*this._localBasisZ2Y+n._rotation12*this._localBasisZ2Z;k=n._rotation20*this._localBasisZ2X+n._rotation21*this._localBasisZ2Y+n._rotation22*this._localBasisZ2Z;Y=L;Z=A;d=k;b=Z*h-d*v;u=d*_-Y*h;x=Y*v-Z*_;if(b*b+u*u+x*x==0){var B=_;var P=v;var T=h;var S=B*B;var C=P*P;var q=T*T;var R;if(S<C){if(S<q){R=1/Math.sqrt(C+q);b=0;u=T*R;x=-P*R}else{R=1/Math.sqrt(S+C);b=P*R;u=-B*R;x=0}}else if(C<q){R=1/Math.sqrt(q+S);b=-T*R;u=0;x=B*R}else{R=1/Math.sqrt(S+C);b=P*R;u=-B*R;x=0}}c=v*x-h*u;p=h*b-_*x;f=_*u-v*b;g=u*d-x*Z;X=x*Y-b*d;z=b*Z-u*Y;var E;var j;var N;E=s._rotation00*_+s._rotation10*v+s._rotation20*h;j=s._rotation01*_+s._rotation11*v+s._rotation21*h;N=s._rotation02*_+s._rotation12*v+s._rotation22*h;this._localBasisX1X=E;this._localBasisX1Y=j;this._localBasisX1Z=N;var D;var F;var O;D=s._rotation00*b+s._rotation10*u+s._rotation20*x;F=s._rotation01*b+s._rotation11*u+s._rotation21*x;O=s._rotation02*b+s._rotation12*u+s._rotation22*x;this._localBasisY1X=D;this._localBasisY1Y=F;this._localBasisY1Z=O;var W;var G;var H;W=s._rotation00*c+s._rotation10*p+s._rotation20*f;G=s._rotation01*c+s._rotation11*p+s._rotation21*f;H=s._rotation02*c+s._rotation12*p+s._rotation22*f;this._localBasisZ1X=W;this._localBasisZ1Y=G;this._localBasisZ1Z=H;var U;var J;var Q;U=n._rotation00*g+n._rotation10*X+n._rotation20*z;J=n._rotation01*g+n._rotation11*X+n._rotation21*z;Q=n._rotation02*g+n._rotation12*X+n._rotation22*z;this._localBasisX2X=U;this._localBasisX2Y=J;this._localBasisX2Z=Q;var $;var K;var tt;$=n._rotation00*b+n._rotation10*u+n._rotation20*x;K=n._rotation01*b+n._rotation11*u+n._rotation21*x;tt=n._rotation02*b+n._rotation12*u+n._rotation22*x;this._localBasisY2X=$;this._localBasisY2Y=K;this._localBasisY2Z=tt;var at;var it;var rt;at=n._rotation00*Y+n._rotation10*Z+n._rotation20*d;it=n._rotation01*Y+n._rotation11*Z+n._rotation21*d;rt=n._rotation02*Y+n._rotation12*Z+n._rotation22*d;this._localBasisZ2X=at;this._localBasisZ2Y=it;this._localBasisZ2Z=rt;this._angleX=0;this._angleY=0;this._angleZ=0;this.xSingular=false;this.ySingular=false;this.zSingular=false;this._sd1=t.springDamper1.clone();this._sd2=t.springDamper2.clone();this._lm1=t.limitMotor1.clone();this._lm2=t.limitMotor2.clone()};jt.__super__=Ei;jt.prototype=$extend(Ei.prototype,{getInfo:function(t,a,i){var r=i?1:this._positionCorrectionAlgorithm==ka.BAUMGARTE?a.invDt*ys.velocityBaumgarte:0;var o;var s;var n;var e;s=this.linearErrorX*r;n=this.linearErrorY*r;e=this.linearErrorZ*r;var _=s;var v=n;var h=e;var l=this._angleY*r;var c;var p;var f;var m;var b;var u;var x;var y;var g;var X;var z;var M;var Y;var Z;var d;var I;var w;var V;var L;var A;p=0;f=-this._relativeAnchor1Z;m=this._relativeAnchor1Y;b=this._relativeAnchor1Z;u=0;x=-this._relativeAnchor1X;y=-this._relativeAnchor1Y;g=this._relativeAnchor1X;X=0;M=0;Y=-this._relativeAnchor2Z;Z=this._relativeAnchor2Y;d=this._relativeAnchor2Z;I=0;w=-this._relativeAnchor2X;V=-this._relativeAnchor2Y;L=this._relativeAnchor2X;A=0;p=-p;f=-f;m=-m;b=-b;u=-u;x=-x;y=-y;g=-g;X=-X;M=-M;Y=-Y;Z=-Z;d=-d;I=-I;w=-w;V=-V;L=-L;A=-A;var k=this._axisXX;var B=this._axisXY;var P=this._axisXZ;var T;var S;var C;var q;var R;var E;var j;var N;var D;var F;var O;D=this._b1._invInertia00*k+this._b1._invInertia01*B+this._b1._invInertia02*P;F=this._b1._invInertia10*k+this._b1._invInertia11*B+this._b1._invInertia12*P;O=this._b1._invInertia20*k+this._b1._invInertia21*B+this._b1._invInertia22*P;S=D;C=F;q=O;var W;var G;var H;W=this._b2._invInertia00*k+this._b2._invInertia01*B+this._b2._invInertia02*P;G=this._b2._invInertia10*k+this._b2._invInertia11*B+this._b2._invInertia12*P;H=this._b2._invInertia20*k+this._b2._invInertia21*B+this._b2._invInertia22*P;E=W;j=G;N=H;var U=S*k+C*B+q*P;var J=E*k+j*B+N*P;if(U>0){var Q=this._relativeAnchor1X*this._relativeAnchor1X+this._relativeAnchor1Y*this._relativeAnchor1Y+this._relativeAnchor1Z*this._relativeAnchor1Z;var $=k*this._relativeAnchor1X+B*this._relativeAnchor1Y+P*this._relativeAnchor1Z;var K=Q-$*$;if(K>0){if(this._b1._invMass>0){U=1/(1/U+this._b1._mass*K)}else{U=0}}}if(J>0){var tt=this._relativeAnchor2X*this._relativeAnchor2X+this._relativeAnchor2Y*this._relativeAnchor2Y+this._relativeAnchor2Z*this._relativeAnchor2Z;var at=k*this._relativeAnchor2X+B*this._relativeAnchor2Y+P*this._relativeAnchor2Z;var it=tt-at*at;if(it>0){if(this._b2._invMass>0){J=1/(1/J+this._b2._mass*it)}else{J=0}}}var rt=U+J==0?0:1/(U+J);var ot=this._axisZX;var st=this._axisZY;var nt=this._axisZZ;var et;var _t;var vt;var ht;var lt;var ct;var pt;var ft;var mt;var bt;var ut;mt=this._b1._invInertia00*ot+this._b1._invInertia01*st+this._b1._invInertia02*nt;bt=this._b1._invInertia10*ot+this._b1._invInertia11*st+this._b1._invInertia12*nt;ut=this._b1._invInertia20*ot+this._b1._invInertia21*st+this._b1._invInertia22*nt;_t=mt;vt=bt;ht=ut;var xt;var yt;var gt;xt=this._b2._invInertia00*ot+this._b2._invInertia01*st+this._b2._invInertia02*nt;yt=this._b2._invInertia10*ot+this._b2._invInertia11*st+this._b2._invInertia12*nt;gt=this._b2._invInertia20*ot+this._b2._invInertia21*st+this._b2._invInertia22*nt;ct=xt;pt=yt;ft=gt;var Xt=_t*ot+vt*st+ht*nt;var zt=ct*ot+pt*st+ft*nt;if(Xt>0){var Mt=this._relativeAnchor1X*this._relativeAnchor1X+this._relativeAnchor1Y*this._relativeAnchor1Y+this._relativeAnchor1Z*this._relativeAnchor1Z;var Yt=ot*this._relativeAnchor1X+st*this._relativeAnchor1Y+nt*this._relativeAnchor1Z;var Zt=Mt-Yt*Yt;if(Zt>0){if(this._b1._invMass>0){Xt=1/(1/Xt+this._b1._mass*Zt)}else{Xt=0}}}if(zt>0){var dt=this._relativeAnchor2X*this._relativeAnchor2X+this._relativeAnchor2Y*this._relativeAnchor2Y+this._relativeAnchor2Z*this._relativeAnchor2Z;var It=ot*this._relativeAnchor2X+st*this._relativeAnchor2Y+nt*this._relativeAnchor2Z;var wt=dt-It*It;if(wt>0){if(this._b2._invMass>0){zt=1/(1/zt+this._b2._mass*wt)}else{zt=0}}}var Vt=Xt+zt==0?0:1/(Xt+zt);var Lt=this._impulses[0];var At=t.rows[t.numRows++];var kt=At.jacobian;kt.lin1X=0;kt.lin1Y=0;kt.lin1Z=0;kt.lin2X=0;kt.lin2Y=0;kt.lin2Z=0;kt.ang1X=0;kt.ang1Y=0;kt.ang1Z=0;kt.ang2X=0;kt.ang2Y=0;kt.ang2Z=0;At.rhs=0;At.cfm=0;At.minImpulse=0;At.maxImpulse=0;At.motorSpeed=0;At.motorMaxImpulse=0;At.impulse=null;At.impulse=Lt;var Bt=At;Bt.rhs=_;Bt.cfm=0;Bt.minImpulse=-1/0;Bt.maxImpulse=1/0;var Pt=Bt.jacobian;Pt.lin1X=1;Pt.lin1Y=0;Pt.lin1Z=0;Pt.lin2X=1;Pt.lin2Y=0;Pt.lin2Z=0;Pt.ang1X=p;Pt.ang1Y=f;Pt.ang1Z=m;Pt.ang2X=M;Pt.ang2Y=Y;Pt.ang2Z=Z;var Tt=this._impulses[1];var St=t.rows[t.numRows++];var Ct=St.jacobian;Ct.lin1X=0;Ct.lin1Y=0;Ct.lin1Z=0;Ct.lin2X=0;Ct.lin2Y=0;Ct.lin2Z=0;Ct.ang1X=0;Ct.ang1Y=0;Ct.ang1Z=0;Ct.ang2X=0;Ct.ang2Y=0;Ct.ang2Z=0;St.rhs=0;St.cfm=0;St.minImpulse=0;St.maxImpulse=0;St.motorSpeed=0;St.motorMaxImpulse=0;St.impulse=null;St.impulse=Tt;Bt=St;Bt.rhs=v;Bt.cfm=0;Bt.minImpulse=-1/0;Bt.maxImpulse=1/0;Pt=Bt.jacobian;Pt.lin1X=0;Pt.lin1Y=1;Pt.lin1Z=0;Pt.lin2X=0;Pt.lin2Y=1;Pt.lin2Z=0;Pt.ang1X=b;Pt.ang1Y=u;Pt.ang1Z=x;Pt.ang2X=d;Pt.ang2Y=I;Pt.ang2Z=w;var qt=this._impulses[2];var Rt=t.rows[t.numRows++];var Et=Rt.jacobian;Et.lin1X=0;Et.lin1Y=0;Et.lin1Z=0;Et.lin2X=0;Et.lin2Y=0;Et.lin2Z=0;Et.ang1X=0;Et.ang1Y=0;Et.ang1Z=0;Et.ang2X=0;Et.ang2Y=0;Et.ang2Z=0;Rt.rhs=0;Rt.cfm=0;Rt.minImpulse=0;Rt.maxImpulse=0;Rt.motorSpeed=0;Rt.motorMaxImpulse=0;Rt.impulse=null;Rt.impulse=qt;Bt=Rt;Bt.rhs=h;Bt.cfm=0;Bt.minImpulse=-1/0;Bt.maxImpulse=1/0;Pt=Bt.jacobian;Pt.lin1X=0;Pt.lin1Y=0;Pt.lin1Z=1;Pt.lin2X=0;Pt.lin2Y=0;Pt.lin2Z=1;Pt.ang1X=y;Pt.ang1Y=g;Pt.ang1Z=X;Pt.ang2X=V;Pt.ang2Y=L;Pt.ang2Z=A;if(!this.xSingular&&(this._sd1.frequency<=0||!i)){var jt=this._impulses[3];var Nt=t.rows[t.numRows++];var Dt=Nt.jacobian;Dt.lin1X=0;Dt.lin1Y=0;Dt.lin1Z=0;Dt.lin2X=0;Dt.lin2Y=0;Dt.lin2Z=0;Dt.ang1X=0;Dt.ang1Y=0;Dt.ang1Z=0;Dt.ang2X=0;Dt.ang2Y=0;Dt.ang2Z=0;Nt.rhs=0;Nt.cfm=0;Nt.minImpulse=0;Nt.maxImpulse=0;Nt.motorSpeed=0;Nt.motorMaxImpulse=0;Nt.impulse=null;Nt.impulse=jt;Bt=Nt;var Ft=this._angleX;var Ot=this._lm1;var Wt=this._sd1;var Gt;var Ht;var Ut=ys.angularSlop;if(i){Gt=0;Ht=1}else{if(Wt.frequency>0){Ut=0;var Jt=6.28318530717958*Wt.frequency;var Qt=Wt.dampingRatio;if(Qt<ys.minSpringDamperDampingRatio){Qt=ys.minSpringDamperDampingRatio}var $t=a.dt;var Kt=2*Qt*Jt;var ta=Jt*Jt;if(Wt.useSymplecticEuler){Gt=1/($t*Kt);Ht=ta/Kt}else{Gt=1/($t*($t*ta+Kt));Ht=ta/($t*ta+Kt)}}else{Gt=0;Ht=this._positionCorrectionAlgorithm==ka.BAUMGARTE?a.invDt*ys.velocityBaumgarte:0}if(Ot.motorTorque>0){Bt.motorSpeed=Ot.motorSpeed;Bt.motorMaxImpulse=Ot.motorTorque*a.dt}else{Bt.motorSpeed=0;Bt.motorMaxImpulse=0}}var aa=Ot.lowerLimit;var ia=Ot.upperLimit;var ra=(aa+ia)*.5;Ft-=ra;Ft=((Ft+3.14159265358979)%6.28318530717958+6.28318530717958)%6.28318530717958-3.14159265358979;Ft+=ra;var oa;var sa;var na;if(aa>ia){oa=0;sa=0;na=0}else if(aa==ia){oa=-1/0;sa=1/0;na=Ft-aa}else if(Ft<aa){oa=-1/0;sa=0;na=Ft-aa+Ut;if(na>0){na=0}}else if(Ft>ia){oa=0;sa=1/0;na=Ft-ia-Ut;if(na<0){na=0}}else{oa=0;sa=0;na=0}var ea=rt==0?0:1/rt;Bt.minImpulse=oa;Bt.maxImpulse=sa;Bt.cfm=Gt*ea;Bt.rhs=na*Ht;Pt=Bt.jacobian;Pt.ang1X=this._axisXX;Pt.ang1Y=this._axisXY;Pt.ang1Z=this._axisXZ;Pt.ang2X=this._axisXX;Pt.ang2Y=this._axisXY;Pt.ang2Z=this._axisXZ}if(!this.ySingular){var _a=this._impulses[4];var va=t.rows[t.numRows++];var ha=va.jacobian;ha.lin1X=0;ha.lin1Y=0;ha.lin1Z=0;ha.lin2X=0;ha.lin2Y=0;ha.lin2Z=0;ha.ang1X=0;ha.ang1Y=0;ha.ang1Z=0;ha.ang2X=0;ha.ang2Y=0;ha.ang2Z=0;va.rhs=0;va.cfm=0;va.minImpulse=0;va.maxImpulse=0;va.motorSpeed=0;va.motorMaxImpulse=0;va.impulse=null;va.impulse=_a;Bt=va;Bt.rhs=l;Bt.cfm=0;Bt.minImpulse=-1/0;Bt.maxImpulse=1/0;Pt=Bt.jacobian;Pt.ang1X=this._axisYX;Pt.ang1Y=this._axisYY;Pt.ang1Z=this._axisYZ;Pt.ang2X=this._axisYX;Pt.ang2Y=this._axisYY;Pt.ang2Z=this._axisYZ}if(!this.zSingular&&(this._sd2.frequency<=0||!i)){var la=this._impulses[5];var ca=t.rows[t.numRows++];var pa=ca.jacobian;pa.lin1X=0;pa.lin1Y=0;pa.lin1Z=0;pa.lin2X=0;pa.lin2Y=0;pa.lin2Z=0;pa.ang1X=0;pa.ang1Y=0;pa.ang1Z=0;pa.ang2X=0;pa.ang2Y=0;pa.ang2Z=0;ca.rhs=0;ca.cfm=0;ca.minImpulse=0;ca.maxImpulse=0;ca.motorSpeed=0;ca.motorMaxImpulse=0;ca.impulse=null;ca.impulse=la;Bt=ca;var fa=this._angleZ;var ma=this._lm2;var ba=this._sd2;var ua;var xa;var ya=ys.angularSlop;if(i){ua=0;xa=1}else{if(ba.frequency>0){ya=0;var ga=6.28318530717958*ba.frequency;var Xa=ba.dampingRatio;if(Xa<ys.minSpringDamperDampingRatio){Xa=ys.minSpringDamperDampingRatio}var za=a.dt;var Ma=2*Xa*ga;var Ya=ga*ga;if(ba.useSymplecticEuler){ua=1/(za*Ma);xa=Ya/Ma}else{ua=1/(za*(za*Ya+Ma));xa=Ya/(za*Ya+Ma)}}else{ua=0;xa=this._positionCorrectionAlgorithm==ka.BAUMGARTE?a.invDt*ys.velocityBaumgarte:0}if(ma.motorTorque>0){Bt.motorSpeed=ma.motorSpeed;Bt.motorMaxImpulse=ma.motorTorque*a.dt}else{Bt.motorSpeed=0;Bt.motorMaxImpulse=0}}var Za=ma.lowerLimit;var da=ma.upperLimit;var Ia=(Za+da)*.5;fa-=Ia;fa=((fa+3.14159265358979)%6.28318530717958+6.28318530717958)%6.28318530717958-3.14159265358979;fa+=Ia;var wa;var Va;var La;if(Za>da){wa=0;Va=0;La=0}else if(Za==da){wa=-1/0;Va=1/0;La=fa-Za}else if(fa<Za){wa=-1/0;Va=0;La=fa-Za+ya;if(La>0){La=0}}else if(fa>da){wa=0;Va=1/0;La=fa-da-ya;if(La<0){La=0}}else{wa=0;Va=0;La=0}var Aa=Vt==0?0:1/Vt;Bt.minImpulse=wa;Bt.maxImpulse=Va;Bt.cfm=ua*Aa;Bt.rhs=La*xa;Pt=Bt.jacobian;Pt.ang1X=this._axisZX;Pt.ang1Y=this._axisZY;Pt.ang1Z=this._axisZZ;Pt.ang2X=this._axisZX;Pt.ang2Y=this._axisZY;Pt.ang2Z=this._axisZZ}},_syncAnchors:function(){Ei.prototype._syncAnchors.call(this);var t;var a;var i;var r;var o;var s;var n;var e;var _;var v;var h;var l;var c;var p;var f;var m;var b;var u;var x;var y;a=this._basisX1X;i=this._basisY1X;r=this._basisZ1X;o=this._basisX1Y;s=this._basisY1Y;n=this._basisZ1Y;e=this._basisX1Z;_=this._basisY1Z;v=this._basisZ1Z;l=this._basisX2X;c=this._basisY2X;p=this._basisZ2X;f=this._basisX2Y;m=this._basisY2Y;b=this._basisZ2Y;u=this._basisX2Z;x=this._basisY2Z;y=this._basisZ2Z;var g;var X;var z;var M;var Y;var Z;var d;var I;var w;var V;var L;var A;var k;var B;var P;var T;var S;var C;var q;L=a*l+o*f+e*u;A=a*c+o*m+e*x;k=a*p+o*b+e*y;B=i*l+s*f+_*u;P=i*c+s*m+_*x;T=i*p+s*b+_*y;S=r*l+n*f+v*u;C=r*c+n*m+v*x;q=r*p+n*b+v*y;X=L;z=A;M=k;Y=B;Z=P;d=T;I=S;w=C;V=q;var R;var E;var j;var N;var D;var F;var O;var W;var G;var H;var U;var J;E=this._basisX1X;j=this._basisX1Y;N=this._basisX1Z;H=this._basisZ2X;U=this._basisZ2Y;J=this._basisZ2Z;F=U*N-J*j;O=J*E-H*N;W=H*j-U*E;this._axisXX=O*J-W*U;this._axisXY=W*H-F*J;this._axisXZ=F*U-O*H;this._axisYX=F;this._axisYY=O;this._axisYZ=W;this._axisZX=j*W-N*O;this._axisZY=N*F-E*W;this._axisZZ=E*O-j*F;var Q=this._axisXX*this._axisXX+this._axisXY*this._axisXY+this._axisXZ*this._axisXZ;if(Q>0){Q=1/Math.sqrt(Q)}this._axisXX*=Q;this._axisXY*=Q;this._axisXZ*=Q;var $=this._axisYX*this._axisYX+this._axisYY*this._axisYY+this._axisYZ*this._axisYZ;if($>0){$=1/Math.sqrt($)}this._axisYX*=$;this._axisYY*=$;this._axisYZ*=$;var K=this._axisZX*this._axisZX+this._axisZY*this._axisZY+this._axisZZ*this._axisZZ;if(K>0){K=1/Math.sqrt(K)}this._axisZX*=K;this._axisZY*=K;this._axisZZ*=K;this.xSingular=this._axisXX*this._axisXX+this._axisXY*this._axisXY+this._axisXZ*this._axisXZ==0;this.ySingular=this._axisYX*this._axisYX+this._axisYY*this._axisYY+this._axisYZ*this._axisYZ==0;this.zSingular=this._axisZX*this._axisZX+this._axisZY*this._axisZY+this._axisZZ*this._axisZZ==0;var tt;var at;var it;var rt;var ot;var st;var nt;var et;var _t;var vt;var ht;var lt;var ct;var pt;var ft;var mt;var bt;var ut;var xt;var yt;at=this._basisX1X;it=this._basisY1X;rt=this._basisZ1X;ot=this._basisX1Y;st=this._basisY1Y;nt=this._basisZ1Y;et=this._basisX1Z;_t=this._basisY1Z;vt=this._basisZ1Z;lt=this._basisX2X;ct=this._basisY2X;pt=this._basisZ2X;ft=this._basisX2Y;mt=this._basisY2Y;bt=this._basisZ2Y;ut=this._basisX2Z;xt=this._basisY2Z;yt=this._basisZ2Z;var gt;var Xt;var zt;var Mt;var Yt;var Zt;var dt;var It;var wt;var Vt;var Lt;var At;var kt;var Bt;var Pt;var Tt;var St;var Ct;var qt;Lt=at*lt+ot*ft+et*ut;At=at*ct+ot*mt+et*xt;kt=at*pt+ot*bt+et*yt;Bt=it*lt+st*ft+_t*ut;Pt=it*ct+st*mt+_t*xt;Tt=it*pt+st*bt+_t*yt;St=rt*lt+nt*ft+vt*ut;Ct=rt*ct+nt*mt+vt*xt;qt=rt*pt+nt*bt+vt*yt;Xt=Lt;zt=At;Mt=kt;Yt=Bt;Zt=Pt;dt=Tt;It=St;wt=Ct;Vt=qt;var Rt;var Et;var jt;var Nt;var Dt=Mt;if(Dt<=-1){var Ft=Math.atan2(wt,Zt);Et=Ft*.5;jt=-1.570796326794895;Nt=-Ft*.5}else if(Dt>=1){var Ot=Math.atan2(wt,Zt);Et=Ot*.5;jt=1.570796326794895;Nt=Ot*.5}else{var Wt=Math.asin(Dt);var Gt=Math.atan2(-dt,Vt);var Ht=Math.atan2(-zt,Xt);Et=Gt;jt=Wt;Nt=Ht}this._angleX=Et;this._angleY=jt;this._angleZ=Nt;this.linearErrorX=this._anchor2X-this._anchor1X;this.linearErrorY=this._anchor2Y-this._anchor1Y;this.linearErrorZ=this._anchor2Z-this._anchor1Z},_getVelocitySolverInfo:function(t,a){Ei.prototype._getVelocitySolverInfo.call(this,t,a);this.getInfo(a,t,false)},_getPositionSolverInfo:function(t){Ei.prototype._getPositionSolverInfo.call(this,t);this.getInfo(t,null,true)},getAxis1:function(){var t=new Is;var a=t;a.x=this._basisX1X;a.y=this._basisX1Y;a.z=this._basisX1Z;return t},getAxis2:function(){var t=new Is;var a=t;a.x=this._basisZ2X;a.y=this._basisZ2Y;a.z=this._basisZ2Z;return t},getAxis1To:function(t){var a=t;a.x=this._basisX1X;a.y=this._basisX1Y;a.z=this._basisX1Z},getAxis2To:function(t){var a=t;a.x=this._basisZ2X;a.y=this._basisZ2Y;a.z=this._basisZ2Z},getLocalAxis1:function(){var t=new Is;var a=t;a.x=this._localBasisX1X;a.y=this._localBasisX1Y;a.z=this._localBasisX1Z;return t},getLocalAxis2:function(){var t=new Is;var a=t;a.x=this._localBasisZ2X;a.y=this._localBasisZ2Y;a.z=this._localBasisZ2Z;return t},getLocalAxis1To:function(t){var a=t;a.x=this._localBasisX1X;a.y=this._localBasisX1Y;a.z=this._localBasisX1Z},getLocalAxis2To:function(t){var a=t;a.x=this._localBasisZ2X;a.y=this._localBasisZ2Y;a.z=this._localBasisZ2Z},getSpringDamper1:function(){return this._sd1},getSpringDamper2:function(){return this._sd2},getLimitMotor1:function(){return this._lm1},getLimitMotor2:function(){return this._lm2},getAngle1:function(){return this._angleX},getAngle2:function(){return this._angleZ}});var Nt=function(){zt.call(this);this.localAxis1=new Is(1,0,0);this.localAxis2=new Is(1,0,0);this.springDamper1=new Rt;this.springDamper2=new Rt;this.limitMotor1=new St;this.limitMotor2=new St};Nt.__super__=zt;Nt.prototype=$extend(zt.prototype,{init:function(t,a,i,r,o){this._init(t,a,i);var s;var n;var e;var _;var v=r;n=v.x;e=v.y;_=v.z;var h;var l;var c;h=t._transform._rotation00*n+t._transform._rotation10*e+t._transform._rotation20*_;l=t._transform._rotation01*n+t._transform._rotation11*e+t._transform._rotation21*_;c=t._transform._rotation02*n+t._transform._rotation12*e+t._transform._rotation22*_;n=h;e=l;_=c;var p=this.localAxis1;p.x=n;p.y=e;p.z=_;var f;var m;var b;var u;var x=o;m=x.x;b=x.y;u=x.z;var y;var g;var X;y=a._transform._rotation00*m+a._transform._rotation10*b+a._transform._rotation20*u;g=a._transform._rotation01*m+a._transform._rotation11*b+a._transform._rotation21*u;X=a._transform._rotation02*m+a._transform._rotation12*b+a._transform._rotation22*u;m=y;b=g;u=X;var z=this.localAxis2;z.x=m;z.y=b;z.z=u;return this}});var Dt=function(){};var Ft=function(){this.invMLinN1X=0;this.invMLinN1Y=0;this.invMLinN1Z=0;this.invMLinN2X=0;this.invMLinN2Y=0;this.invMLinN2Z=0;this.invMAngN1X=0;this.invMAngN1Y=0;this.invMAngN1Z=0;this.invMAngN2X=0;this.invMAngN2Y=0;this.invMAngN2Z=0;this.invMLinT1X=0;this.invMLinT1Y=0;this.invMLinT1Z=0;this.invMLinT2X=0;this.invMLinT2Y=0;this.invMLinT2Z=0;this.invMAngT1X=0;this.invMAngT1Y=0;this.invMAngT1Z=0;this.invMAngT2X=0;this.invMAngT2Y=0;this.invMAngT2Z=0;this.invMLinB1X=0;this.invMLinB1Y=0;this.invMLinB1Z=0;this.invMLinB2X=0;this.invMLinB2Y=0;this.invMLinB2Z=0;this.invMAngB1X=0;this.invMAngB1Y=0;this.invMAngB1Z=0;this.invMAngB2X=0;this.invMAngB2Y=0;this.invMAngB2Z=0;this.massN=0;this.massTB00=0;this.massTB01=0;this.massTB10=0;this.massTB11=0};var Ot=function(){this.invMLin1X=0;this.invMLin1Y=0;this.invMLin1Z=0;this.invMLin2X=0;this.invMLin2Y=0;this.invMLin2Z=0;this.invMAng1X=0;this.invMAng1Y=0;this.invMAng1Z=0;this.invMAng2X=0;this.invMAng2Y=0;this.invMAng2Z=0;this.mass=0;this.massWithoutCfm=0};var Wt=function(t){var a=new Array(t);this.iBounded=a;var i=new Array(t);this.iUnbounded=i;var r=new Array(t);this.signs=r;var o=new Array(t);this.b=o;this.numBounded=0;this.numUnbounded=0;this.matrixId=0};Wt.prototype={init:function(t){this.numBounded=t.numBounded;var a=0;var i=this.numBounded;while(a<i){var r=a++;this.iBounded[r]=t.iBounded[r];this.signs[r]=t.signs[r]}this.numUnbounded=t.numUnbounded;this.matrixId=0;var o=0;var s=this.numUnbounded;while(o<s){var n=o++;var e=t.iUnbounded[n];this.iUnbounded[n]=e;this.matrixId|=1<<e}},computeImpulses:function(t,a,i,r,o,s,n){var e=0;var _=this.numUnbounded;while(e<_){var v=e++;var h=this.iUnbounded[v];var l=t.rows[h];var c=i[h];this.b[h]=l.rhs*s-c-l.cfm*r[h]}var p=a._invMassWithoutCfm;var f=0;var m=this.numBounded;while(f<m){var b=f++;var u=this.iBounded[b];var x=this.signs[b];var y=t.rows[u];var g=r[u];var X=x<0?y.minImpulse:x>0?y.maxImpulse:0;var z=X-g;o[u]=z;if(z!=0){var M=0;var Y=this.numUnbounded;while(M<Y){var Z=M++;var d=this.iUnbounded[Z];var I=p[u][d]*z;var w=d;var V=this.b;V[w]=V[w]-I}}}var L=this.iUnbounded;var A=this.numUnbounded;var k=0;var B=0;var P=A;while(B<P){var T=B++;k|=1<<L[T]}var S;if(a._cacheComputed[k]){S=a._cachedSubmatrices[k]}else{a.computeSubmatrix(k,L,A);a._cacheComputed[k]=true;S=a._cachedSubmatrices[k]}var C=true;var q=0;var R=this.numUnbounded;while(q<R){var E=q++;var j=this.iUnbounded[E];var N=t.rows[j];var D=r[j];var F=D;var O=0;var W=this.numUnbounded;while(O<W){var G=O++;var H=this.iUnbounded[G];F+=this.b[H]*S[E][G]}if(F<N.minImpulse-ys.directMlcpSolverEps||F>N.maxImpulse+ys.directMlcpSolverEps){C=false;break}o[j]=F-D}if(n){return true}if(!C){return false}var U=0;var J=this.numBounded;while(U<J){var Q=U++;var $=this.iBounded[Q];var K=t.rows[$];var tt=this.signs[Q];var at=0;var it=r[$]+o[$];var rt=i[$];var ot=0;var st=t.numRows;while(ot<st){var nt=ot++;rt+=p[$][nt]*o[nt]}at=K.rhs*s-rt-K.cfm*it;if(tt<0&&at>ys.directMlcpSolverEps||tt>0&&at<-ys.directMlcpSolverEps){C=false;break}}return C}};var Gt=function(t){this.size=t;this.numBounded=0;var a=new Array(t);this.iBounded=a;var i=new Array(t);this.signs=i;this.numUnbounded=0;var r=new Array(t);this.iUnbounded=r};var Ht=function(t){this.maxRows=t;this.numBoundaries=0;var a=new Array(1<<t);this.boundaries=a;this.bbInfo=new Gt(t)};Ht.prototype={buildBoundariesRecursive:function(t,a){if(a==t.numRows){if(this.boundaries[this.numBoundaries]==null){this.boundaries[this.numBoundaries]=new Wt(this.maxRows)}this.boundaries[this.numBoundaries++].init(this.bbInfo);return}var i=t.rows[a];var r=i.minImpulse>-1/0;var o=i.maxImpulse<1/0;var s=i.minImpulse==0&&i.maxImpulse==0;if(s){var n=this.bbInfo;n.iBounded[n.numBounded]=a;n.signs[n.numBounded]=0;n.numBounded++;this.buildBoundariesRecursive(t,a+1);this.bbInfo.numBounded--;return}var e=this.bbInfo;e.iUnbounded[e.numUnbounded]=a;e.numUnbounded++;this.buildBoundariesRecursive(t,a+1);this.bbInfo.numUnbounded--;if(r){var _=this.bbInfo;_.iBounded[_.numBounded]=a;_.signs[_.numBounded]=-1;_.numBounded++;this.buildBoundariesRecursive(t,a+1);this.bbInfo.numBounded--}if(o){var v=this.bbInfo;v.iBounded[v.numBounded]=a;v.signs[v.numBounded]=1;v.numBounded++;this.buildBoundariesRecursive(t,a+1);this.bbInfo.numBounded--}},buildBoundaries:function(t){this.numBoundaries=0;var a=this.bbInfo;a.numBounded=0;a.numUnbounded=0;this.buildBoundariesRecursive(t,0)}};var Ut=function(t){this.n=t;var a=new Array(t);this.indices=a;var i=new Array(t);this.tmpIndices=i;var r=0;var o=t;while(r<o){var s=r++;this.indices[s]=s}};Ut.prototype={getIndex:function(t){return this.indices[t]},select:function(t){var a=0;while(this.indices[a]!=t)++a;while(a>0){var i=this.indices[a];this.indices[a]=this.indices[a-1];this.indices[a-1]=i;--a}},setSize:function(t){var a=0;var i=0;var r=0;var o=this.n;while(r<o){var s=r++;var n=this.indices[s];if(n<t){this.tmpIndices[a]=n;++a}else{this.tmpIndices[t+i]=n;++i}}var e=this.indices;this.indices=this.tmpIndices;this.tmpIndices=e}};var Jt=function(t){ht.call(this);this.joint=t;this.info=new yt;var a=ys.maxJacobianRows;this.massMatrix=new Qt(a);this.boundaryBuilder=new Ht(a);var i=new Array(a);this.massData=i;var r=0;var o=this.massData.length;while(r<o){var s=r++;this.massData[s]=new Ot}var n=this.boundaryBuilder.boundaries.length;this.velBoundarySelector=new Ut(n);this.posBoundarySelector=new Ut(n);var e=new Array(a);this.relVels=e;var _=new Array(a);this.impulses=_;var v=new Array(a);this.dImpulses=v;var h=new Array(a);this.dTotalImpulses=h;var l=0;var c=a;while(l<c){var p=l++;this.relVels[p]=0;this.impulses[p]=0;this.dImpulses[p]=0;this.dTotalImpulses[p]=0}};Jt.__super__=ht;Jt.prototype=$extend(ht.prototype,{preSolveVelocity:function(t){this.joint._syncAnchors();this.joint._getVelocitySolverInfo(t,this.info);this._b1=this.info.b1;this._b2=this.info.b2;this.massMatrix.computeInvMass(this.info,this.massData);var a=this.boundaryBuilder;a.numBoundaries=0;var i=a.bbInfo;i.numBounded=0;i.numUnbounded=0;a.buildBoundariesRecursive(this.info,0);var r=this.velBoundarySelector;var o=this.boundaryBuilder.numBoundaries;var s=0;var n=0;var e=0;var _=r.n;while(e<_){var v=e++;var h=r.indices[v];if(h<o){r.tmpIndices[s]=h;++s}else{r.tmpIndices[o+n]=h;++n}}var l=r.indices;r.indices=r.tmpIndices;r.tmpIndices=l},warmStart:function(t){var a=this.joint._positionCorrectionAlgorithm;var i=a==ka.BAUMGARTE?ys.jointWarmStartingFactorForBaungarte:ys.jointWarmStartingFactor;i*=t.dtRatio;if(i<=0){var r=0;var o=this.info.numRows;while(r<o){var s=r++;var n=this.info.rows[s];var e=n.impulse;e.impulse=0;e.impulseM=0;e.impulseP=0}return}var _=0;var v=this.info.numRows;while(_<v){var h=_++;var l=this.info.rows[h];var c=l.impulse;var p=c.impulse*i;if(p<l.minImpulse){p=l.minImpulse}else if(p>l.maxImpulse){p=l.maxImpulse}c.impulse=p;if(l.motorMaxImpulse>0){var f=c.impulseM*i;var m=l.motorMaxImpulse;if(f<-m){f=-m}else if(f>m){f=m}c.impulseM=f}else{c.impulseM=0}this.dImpulses[h]=c.impulse+c.impulseM}var b=this.dImpulses;var u=false;var x=false;var y;var g;var X;var z;var M;var Y;var Z;var d;var I;var w;var V;var L;var A;var k;var B;var P;g=this._b1._velX;X=this._b1._velY;z=this._b1._velZ;Y=this._b2._velX;Z=this._b2._velY;d=this._b2._velZ;w=this._b1._angVelX;V=this._b1._angVelY;L=this._b1._angVelZ;k=this._b2._angVelX;B=this._b2._angVelY;P=this._b2._angVelZ;var T=0;var S=this.info.numRows;while(T<S){var C=T++;var q=this.info.rows[C];var R=q.jacobian;var E=this.massData[C];var j=b[C];if((R.flag&1)!=0){g+=E.invMLin1X*j;X+=E.invMLin1Y*j;z+=E.invMLin1Z*j;Y+=E.invMLin2X*-j;Z+=E.invMLin2Y*-j;d+=E.invMLin2Z*-j;u=true}if((R.flag&2)!=0){w+=E.invMAng1X*j;V+=E.invMAng1Y*j;L+=E.invMAng1Z*j;k+=E.invMAng2X*-j;B+=E.invMAng2Y*-j;P+=E.invMAng2Z*-j;x=true}}if(u){this._b1._velX=g;this._b1._velY=X;this._b1._velZ=z;this._b2._velX=Y;this._b2._velY=Z;this._b2._velZ=d}if(x){this._b1._angVelX=w;this._b1._angVelY=V;this._b1._angVelZ=L;this._b2._angVelX=k;this._b2._angVelY=B;this._b2._angVelZ=P}},solveVelocity:function(){var t=this.info.numRows;var a;var i;var r;var o;var s;var n;var e;var _;var v;var h;var l;var c;var p;var f;var m;var b;i=this._b1._velX;r=this._b1._velY;o=this._b1._velZ;n=this._b2._velX;e=this._b2._velY;_=this._b2._velZ;h=this._b1._angVelX;l=this._b1._angVelY;c=this._b1._angVelZ;f=this._b2._angVelX;m=this._b2._angVelY;b=this._b2._angVelZ;var u=0;var x=t;while(u<x){var y=u++;var g=this.info.rows[y];var X=g.impulse;var z=g.jacobian;var M=0;M+=i*z.lin1X+r*z.lin1Y+o*z.lin1Z;M-=n*z.lin2X+e*z.lin2Y+_*z.lin2Z;M+=h*z.ang1X+l*z.ang1Y+c*z.ang1Z;M-=f*z.ang2X+m*z.ang2Y+b*z.ang2Z;this.relVels[y]=M;this.impulses[y]=X.impulse;this.dTotalImpulses[y]=0}var Y=this.massMatrix._invMassWithoutCfm;var Z=0;var d=t;while(Z<d){var I=Z++;var w=this.info.rows[I];var V=w.impulse;var L=this.massData[I];if(w.motorMaxImpulse>0){var A=V.impulseM;var k=A+L.massWithoutCfm*(-w.motorSpeed-this.relVels[I]);var B=V.impulseM;if(k<-B){k=-B}else if(k>B){k=B}V.impulseM=k;var P=k-A;this.dTotalImpulses[I]=P;var T=0;var S=t;while(T<S){var C=T++;var q=C;var R=this.relVels;R[q]=R[q]+P*Y[I][C]}}}var E=false;var j=0;var N=this.boundaryBuilder.numBoundaries;while(j<N){var D=j++;var F=this.velBoundarySelector.indices[D];var O=this.boundaryBuilder.boundaries[F];if(O.computeImpulses(this.info,this.massMatrix,this.relVels,this.impulses,this.dImpulses,1,false)){var W=0;var G=t;while(W<G){var H=W++;var U=this.info.rows[H];var J=U.impulse;var Q=this.dImpulses[H];J.impulse+=Q;var $=H;var K=this.dTotalImpulses;K[$]=K[$]+Q}var tt=this.dTotalImpulses;var at=false;var it=false;var rt;var ot;var st;var nt;var et;var _t;var vt;var ht;var lt;var ct;var pt;var ft;var mt;var bt;var ut;var xt;ot=this._b1._velX;st=this._b1._velY;nt=this._b1._velZ;_t=this._b2._velX;vt=this._b2._velY;ht=this._b2._velZ;ct=this._b1._angVelX;pt=this._b1._angVelY;ft=this._b1._angVelZ;bt=this._b2._angVelX;ut=this._b2._angVelY;xt=this._b2._angVelZ;var yt=0;var gt=this.info.numRows;while(yt<gt){var Xt=yt++;var zt=this.info.rows[Xt];var Mt=zt.jacobian;var Yt=this.massData[Xt];var Zt=tt[Xt];if((Mt.flag&1)!=0){ot+=Yt.invMLin1X*Zt;st+=Yt.invMLin1Y*Zt;nt+=Yt.invMLin1Z*Zt;_t+=Yt.invMLin2X*-Zt;vt+=Yt.invMLin2Y*-Zt;ht+=Yt.invMLin2Z*-Zt;at=true}if((Mt.flag&2)!=0){ct+=Yt.invMAng1X*Zt;pt+=Yt.invMAng1Y*Zt;ft+=Yt.invMAng1Z*Zt;bt+=Yt.invMAng2X*-Zt;ut+=Yt.invMAng2Y*-Zt;xt+=Yt.invMAng2Z*-Zt;it=true}}if(at){this._b1._velX=ot;this._b1._velY=st;this._b1._velZ=nt;this._b2._velX=_t;this._b2._velY=vt;this._b2._velZ=ht}if(it){this._b1._angVelX=ct;this._b1._angVelY=pt;this._b1._angVelZ=ft;this._b2._angVelX=bt;this._b2._angVelY=ut;this._b2._angVelZ=xt}var dt=this.velBoundarySelector;var It=0;while(dt.indices[It]!=F)++It;while(It>0){var wt=dt.indices[It];dt.indices[It]=dt.indices[It-1];dt.indices[It-1]=wt;--It}E=true;break}}if(!E){console.log("DirectJointConstraintSolver.hx:338:","could not find solution. (velocity)");return}},postSolveVelocity:function(t){var a;var i;var r;var o;var s;var n;var e;var _;i=0;r=0;o=0;n=0;e=0;_=0;var v=0;var h=this.info.numRows;while(v<h){var l=v++;var c=this.info.rows[l];var p=c.impulse;var f=c.jacobian;if((f.flag&1)!=0){i+=f.lin1X*p.impulse;r+=f.lin1Y*p.impulse;o+=f.lin1Z*p.impulse}else if((f.flag&2)!=0){n+=f.ang1X*p.impulse;e+=f.ang1Y*p.impulse;_+=f.ang1Z*p.impulse}}this.joint._appliedForceX=i*t.invDt;this.joint._appliedForceY=r*t.invDt;this.joint._appliedForceZ=o*t.invDt;this.joint._appliedTorqueX=n*t.invDt;this.joint._appliedTorqueY=e*t.invDt;this.joint._appliedTorqueZ=_*t.invDt},preSolvePosition:function(t){this.joint._syncAnchors();this.joint._getPositionSolverInfo(this.info);this._b1=this.info.b1;this._b2=this.info.b2;this.massMatrix.computeInvMass(this.info,this.massData);var a=this.boundaryBuilder;a.numBoundaries=0;var i=a.bbInfo;i.numBounded=0;i.numUnbounded=0;a.buildBoundariesRecursive(this.info,0);var r=this.posBoundarySelector;var o=this.boundaryBuilder.numBoundaries;var s=0;var n=0;var e=0;var _=r.n;while(e<_){var v=e++;var h=r.indices[v];if(h<o){r.tmpIndices[s]=h;++s}else{r.tmpIndices[o+n]=h;++n}}var l=r.indices;r.indices=r.tmpIndices;r.tmpIndices=l;var c=0;var p=this.info.numRows;while(c<p){var f=c++;this.info.rows[f].impulse.impulseP=0}},solvePositionSplitImpulse:function(){var t=this.info.numRows;var a;var i;var r;var o;var s;var n;var e;var _;var v;var h;var l;var c;var p;var f;var m;var b;i=this._b1._pseudoVelX;r=this._b1._pseudoVelY;o=this._b1._pseudoVelZ;n=this._b2._pseudoVelX;e=this._b2._pseudoVelY;_=this._b2._pseudoVelZ;h=this._b1._angPseudoVelX;l=this._b1._angPseudoVelY;c=this._b1._angPseudoVelZ;f=this._b2._angPseudoVelX;m=this._b2._angPseudoVelY;b=this._b2._angPseudoVelZ;var u=0;var x=t;while(u<x){var y=u++;var g=this.info.rows[y];var X=g.impulse;var z=g.jacobian;var M=0;M+=i*z.lin1X+r*z.lin1Y+o*z.lin1Z;M-=n*z.lin2X+e*z.lin2Y+_*z.lin2Z;M+=h*z.ang1X+l*z.ang1Y+c*z.ang1Z;M-=f*z.ang2X+m*z.ang2Y+b*z.ang2Z;this.relVels[y]=M;this.impulses[y]=X.impulseP}var Y=false;var Z=0;var d=this.boundaryBuilder.numBoundaries;while(Z<d){var I=Z++;var w=this.posBoundarySelector.indices[I];var V=this.boundaryBuilder.boundaries[w];if(V.computeImpulses(this.info,this.massMatrix,this.relVels,this.impulses,this.dImpulses,ys.positionSplitImpulseBaumgarte,false)){var L=0;var A=t;while(L<A){var k=L++;var B=this.info.rows[k];var P=B.impulse;var T=this.dImpulses[k];P.impulseP+=T}var S=this.dImpulses;var C=false;var q=false;var R;var E;var j;var N;var D;var F;var O;var W;var G;var H;var U;var J;var Q;var $;var K;var tt;E=this._b1._pseudoVelX;j=this._b1._pseudoVelY;N=this._b1._pseudoVelZ;F=this._b2._pseudoVelX;O=this._b2._pseudoVelY;W=this._b2._pseudoVelZ;H=this._b1._angPseudoVelX;U=this._b1._angPseudoVelY;J=this._b1._angPseudoVelZ;$=this._b2._angPseudoVelX;K=this._b2._angPseudoVelY;tt=this._b2._angPseudoVelZ;var at=0;var it=this.info.numRows;while(at<it){var rt=at++;var ot=this.info.rows[rt];var st=ot.jacobian;var nt=this.massData[rt];var et=S[rt];if((st.flag&1)!=0){E+=nt.invMLin1X*et;j+=nt.invMLin1Y*et;N+=nt.invMLin1Z*et;F+=nt.invMLin2X*-et;O+=nt.invMLin2Y*-et;W+=nt.invMLin2Z*-et;C=true}if((st.flag&2)!=0){H+=nt.invMAng1X*et;U+=nt.invMAng1Y*et;J+=nt.invMAng1Z*et;$+=nt.invMAng2X*-et;K+=nt.invMAng2Y*-et;tt+=nt.invMAng2Z*-et;q=true}}if(C){this._b1._pseudoVelX=E;this._b1._pseudoVelY=j;this._b1._pseudoVelZ=N;this._b2._pseudoVelX=F;this._b2._pseudoVelY=O;this._b2._pseudoVelZ=W}if(q){this._b1._angPseudoVelX=H;this._b1._angPseudoVelY=U;this._b1._angPseudoVelZ=J;this._b2._angPseudoVelX=$;this._b2._angPseudoVelY=K;this._b2._angPseudoVelZ=tt}var _t=this.posBoundarySelector;var vt=0;while(_t.indices[vt]!=w)++vt;while(vt>0){var ht=_t.indices[vt];_t.indices[vt]=_t.indices[vt-1];_t.indices[vt-1]=ht;--vt}Y=true;break}}if(!Y){console.log("DirectJointConstraintSolver.hx:454:","could not find solution. (split impulse)");return}},solvePositionNgs:function(t){this.joint._syncAnchors();this.joint._getPositionSolverInfo(this.info);this._b1=this.info.b1;this._b2=this.info.b2;this.massMatrix.computeInvMass(this.info,this.massData);var a=this.boundaryBuilder;a.numBoundaries=0;var i=a.bbInfo;i.numBounded=0;i.numUnbounded=0;a.buildBoundariesRecursive(this.info,0);var r=this.posBoundarySelector;var o=this.boundaryBuilder.numBoundaries;var s=0;var n=0;var e=0;var _=r.n;while(e<_){var v=e++;var h=r.indices[v];if(h<o){r.tmpIndices[s]=h;++s}else{r.tmpIndices[o+n]=h;++n}}var l=r.indices;r.indices=r.tmpIndices;r.tmpIndices=l;var c=this.info.numRows;var p=0;var f=c;while(p<f){var m=p++;var b=this.info.rows[m];var u=b.impulse;var x=b.jacobian;this.relVels[m]=0;this.impulses[m]=u.impulseP}var y=false;var g=0;var X=this.boundaryBuilder.numBoundaries;while(g<X){var z=g++;var M=this.posBoundarySelector.indices[z];var Y=this.boundaryBuilder.boundaries[M];if(Y.computeImpulses(this.info,this.massMatrix,this.relVels,this.impulses,this.dImpulses,ys.positionNgsBaumgarte,false)){var Z=0;var d=c;while(Z<d){var I=Z++;var w=this.info.rows[I];var V=w.impulse;var L=this.dImpulses[I];V.impulseP+=L}var A=this.dImpulses;var k=false;var B=false;var P;var T;var S;var C;var q;var R;var E;var j;var N;var D;var F;var O;var W;var G;var H;var U;T=0;S=0;C=0;R=0;E=0;j=0;D=0;F=0;O=0;G=0;H=0;U=0;var J=0;var Q=this.info.numRows;while(J<Q){var $=J++;var K=this.info.rows[$];var tt=K.jacobian;var at=this.massData[$];var it=A[$];if((tt.flag&1)!=0){T+=at.invMLin1X*it;S+=at.invMLin1Y*it;C+=at.invMLin1Z*it;R+=at.invMLin2X*-it;E+=at.invMLin2Y*-it;j+=at.invMLin2Z*-it;k=true}if((tt.flag&2)!=0){D+=at.invMAng1X*it;F+=at.invMAng1Y*it;O+=at.invMAng1Z*it;G+=at.invMAng2X*-it;H+=at.invMAng2Y*-it;U+=at.invMAng2Z*-it;B=true}}if(k){var rt=this._b1;rt._transform._positionX+=T;rt._transform._positionY+=S;rt._transform._positionZ+=C;var ot=this._b2;ot._transform._positionX+=R;ot._transform._positionY+=E;ot._transform._positionZ+=j}if(B){var st=this._b1;var nt=Math.sqrt(D*D+F*F+O*O);var et=nt*.5;var _t;var vt;if(et<.5){var ht=et*et;_t=.5*(1-ht*.16666666666666666+ht*ht*.008333333333333333);vt=1-ht*.5+ht*ht*.041666666666666664}else{_t=Math.sin(et)/nt;vt=Math.cos(et)}var lt;var ct;var pt;var ft;ct=D*_t;pt=F*_t;ft=O*_t;var mt;var bt;var ut;var xt;var yt;bt=ct;ut=pt;xt=ft;yt=vt;var gt;var Xt;var zt;var Mt;var Yt;var Zt=st._transform._rotation00;var dt=st._transform._rotation11;var It=st._transform._rotation22;var wt=Zt+dt+It;var Vt;if(wt>0){Vt=Math.sqrt(wt+1);Yt=.5*Vt;Vt=.5/Vt;Xt=(st._transform._rotation21-st._transform._rotation12)*Vt;zt=(st._transform._rotation02-st._transform._rotation20)*Vt;Mt=(st._transform._rotation10-st._transform._rotation01)*Vt}else if(Zt>dt){if(Zt>It){Vt=Math.sqrt(Zt-dt-It+1);Xt=.5*Vt;Vt=.5/Vt;zt=(st._transform._rotation01+st._transform._rotation10)*Vt;Mt=(st._transform._rotation02+st._transform._rotation20)*Vt;Yt=(st._transform._rotation21-st._transform._rotation12)*Vt}else{Vt=Math.sqrt(It-Zt-dt+1);Mt=.5*Vt;Vt=.5/Vt;Xt=(st._transform._rotation02+st._transform._rotation20)*Vt;zt=(st._transform._rotation12+st._transform._rotation21)*Vt;Yt=(st._transform._rotation10-st._transform._rotation01)*Vt}}else if(dt>It){Vt=Math.sqrt(dt-It-Zt+1);zt=.5*Vt;Vt=.5/Vt;Xt=(st._transform._rotation01+st._transform._rotation10)*Vt;Mt=(st._transform._rotation12+st._transform._rotation21)*Vt;Yt=(st._transform._rotation02-st._transform._rotation20)*Vt}else{Vt=Math.sqrt(It-Zt-dt+1);Mt=.5*Vt;Vt=.5/Vt;Xt=(st._transform._rotation02+st._transform._rotation20)*Vt;zt=(st._transform._rotation12+st._transform._rotation21)*Vt;Yt=(st._transform._rotation10-st._transform._rotation01)*Vt}Xt=yt*Xt+bt*Yt+ut*Mt-xt*zt;zt=yt*zt-bt*Mt+ut*Yt+xt*Xt;Mt=yt*Mt+bt*zt-ut*Xt+xt*Yt;Yt=yt*Yt-bt*Xt-ut*zt-xt*Mt;var Lt=Xt*Xt+zt*zt+Mt*Mt+Yt*Yt;if(Lt>1e-32){Lt=1/Math.sqrt(Lt)}Xt*=Lt;zt*=Lt;Mt*=Lt;Yt*=Lt;var At=Xt;var kt=zt;var Bt=Mt;var Pt=Yt;var Tt=2*At;var St=2*kt;var Ct=2*Bt;var qt=At*Tt;var Rt=kt*St;var Et=Bt*Ct;var jt=At*St;var Nt=kt*Ct;var Dt=At*Ct;var Ft=Pt*Tt;var Ot=Pt*St;var Wt=Pt*Ct;st._transform._rotation00=1-Rt-Et;st._transform._rotation01=jt-Wt;st._transform._rotation02=Dt+Ot;st._transform._rotation10=jt+Wt;st._transform._rotation11=1-qt-Et;st._transform._rotation12=Nt-Ft;st._transform._rotation20=Dt-Ot;st._transform._rotation21=Nt+Ft;st._transform._rotation22=1-qt-Rt;var Gt;var Ht;var Ut;var Jt;var Qt;var $t;var Kt;var ta;var aa;Gt=st._transform._rotation00*st._invLocalInertia00+st._transform._rotation01*st._invLocalInertia10+st._transform._rotation02*st._invLocalInertia20;Ht=st._transform._rotation00*st._invLocalInertia01+st._transform._rotation01*st._invLocalInertia11+st._transform._rotation02*st._invLocalInertia21;Ut=st._transform._rotation00*st._invLocalInertia02+st._transform._rotation01*st._invLocalInertia12+st._transform._rotation02*st._invLocalInertia22;Jt=st._transform._rotation10*st._invLocalInertia00+st._transform._rotation11*st._invLocalInertia10+st._transform._rotation12*st._invLocalInertia20;Qt=st._transform._rotation10*st._invLocalInertia01+st._transform._rotation11*st._invLocalInertia11+st._transform._rotation12*st._invLocalInertia21;$t=st._transform._rotation10*st._invLocalInertia02+st._transform._rotation11*st._invLocalInertia12+st._transform._rotation12*st._invLocalInertia22;Kt=st._transform._rotation20*st._invLocalInertia00+st._transform._rotation21*st._invLocalInertia10+st._transform._rotation22*st._invLocalInertia20;ta=st._transform._rotation20*st._invLocalInertia01+st._transform._rotation21*st._invLocalInertia11+st._transform._rotation22*st._invLocalInertia21;aa=st._transform._rotation20*st._invLocalInertia02+st._transform._rotation21*st._invLocalInertia12+st._transform._rotation22*st._invLocalInertia22;st._invInertia00=Gt;st._invInertia01=Ht;st._invInertia02=Ut;st._invInertia10=Jt;st._invInertia11=Qt;st._invInertia12=$t;st._invInertia20=Kt;st._invInertia21=ta;st._invInertia22=aa;var ia;var ra;var oa;var sa;var na;var ea;var _a;var va;var ha;ia=st._invInertia00*st._transform._rotation00+st._invInertia01*st._transform._rotation01+st._invInertia02*st._transform._rotation02;ra=st._invInertia00*st._transform._rotation10+st._invInertia01*st._transform._rotation11+st._invInertia02*st._transform._rotation12;oa=st._invInertia00*st._transform._rotation20+st._invInertia01*st._transform._rotation21+st._invInertia02*st._transform._rotation22;sa=st._invInertia10*st._transform._rotation00+st._invInertia11*st._transform._rotation01+st._invInertia12*st._transform._rotation02;na=st._invInertia10*st._transform._rotation10+st._invInertia11*st._transform._rotation11+st._invInertia12*st._transform._rotation12;ea=st._invInertia10*st._transform._rotation20+st._invInertia11*st._transform._rotation21+st._invInertia12*st._transform._rotation22;_a=st._invInertia20*st._transform._rotation00+st._invInertia21*st._transform._rotation01+st._invInertia22*st._transform._rotation02;va=st._invInertia20*st._transform._rotation10+st._invInertia21*st._transform._rotation11+st._invInertia22*st._transform._rotation12;ha=st._invInertia20*st._transform._rotation20+st._invInertia21*st._transform._rotation21+st._invInertia22*st._transform._rotation22;st._invInertia00=ia;st._invInertia01=ra;st._invInertia02=oa;st._invInertia10=sa;st._invInertia11=na;st._invInertia12=ea;st._invInertia20=_a;st._invInertia21=va;st._invInertia22=ha;st._invInertia00*=st._rotFactor.x;st._invInertia01*=st._rotFactor.x;st._invInertia02*=st._rotFactor.x;st._invInertia10*=st._rotFactor.y;st._invInertia11*=st._rotFactor.y;st._invInertia12*=st._rotFactor.y;st._invInertia20*=st._rotFactor.z;st._invInertia21*=st._rotFactor.z;st._invInertia22*=st._rotFactor.z;var la=this._b2;var ca=Math.sqrt(G*G+H*H+U*U);var pa=ca*.5;var fa;var ma;if(pa<.5){var ba=pa*pa;fa=.5*(1-ba*.16666666666666666+ba*ba*.008333333333333333);ma=1-ba*.5+ba*ba*.041666666666666664}else{fa=Math.sin(pa)/ca;ma=Math.cos(pa)}var ua;var xa;var ya;var ga;xa=G*fa;ya=H*fa;ga=U*fa;var Xa;var za;var Ma;var Ya;var Za;za=xa;Ma=ya;Ya=ga;Za=ma;var da;var Ia;var wa;var Va;var La;var Aa=la._transform._rotation00;var ka=la._transform._rotation11;var Ba=la._transform._rotation22;var Pa=Aa+ka+Ba;var Ta;if(Pa>0){Ta=Math.sqrt(Pa+1);La=.5*Ta;Ta=.5/Ta;Ia=(la._transform._rotation21-la._transform._rotation12)*Ta;wa=(la._transform._rotation02-la._transform._rotation20)*Ta;Va=(la._transform._rotation10-la._transform._rotation01)*Ta}else if(Aa>ka){if(Aa>Ba){Ta=Math.sqrt(Aa-ka-Ba+1);Ia=.5*Ta;Ta=.5/Ta;wa=(la._transform._rotation01+la._transform._rotation10)*Ta;Va=(la._transform._rotation02+la._transform._rotation20)*Ta;La=(la._transform._rotation21-la._transform._rotation12)*Ta}else{Ta=Math.sqrt(Ba-Aa-ka+1);Va=.5*Ta;Ta=.5/Ta;Ia=(la._transform._rotation02+la._transform._rotation20)*Ta;wa=(la._transform._rotation12+la._transform._rotation21)*Ta;La=(la._transform._rotation10-la._transform._rotation01)*Ta}}else if(ka>Ba){Ta=Math.sqrt(ka-Ba-Aa+1);wa=.5*Ta;Ta=.5/Ta;Ia=(la._transform._rotation01+la._transform._rotation10)*Ta;Va=(la._transform._rotation12+la._transform._rotation21)*Ta;La=(la._transform._rotation02-la._transform._rotation20)*Ta}else{Ta=Math.sqrt(Ba-Aa-ka+1);Va=.5*Ta;Ta=.5/Ta;Ia=(la._transform._rotation02+la._transform._rotation20)*Ta;wa=(la._transform._rotation12+la._transform._rotation21)*Ta;La=(la._transform._rotation10-la._transform._rotation01)*Ta}Ia=Za*Ia+za*La+Ma*Va-Ya*wa;wa=Za*wa-za*Va+Ma*La+Ya*Ia;Va=Za*Va+za*wa-Ma*Ia+Ya*La;La=Za*La-za*Ia-Ma*wa-Ya*Va;var Sa=Ia*Ia+wa*wa+Va*Va+La*La;if(Sa>1e-32){Sa=1/Math.sqrt(Sa)}Ia*=Sa;wa*=Sa;Va*=Sa;La*=Sa;var Ca=Ia;var qa=wa;var Ra=Va;var Ea=La;var ja=2*Ca;var Na=2*qa;var Da=2*Ra;var Fa=Ca*ja;var Oa=qa*Na;var Wa=Ra*Da;var Ga=Ca*Na;var Ha=qa*Da;var Ua=Ca*Da;var Ja=Ea*ja;var Qa=Ea*Na;var $a=Ea*Da;la._transform._rotation00=1-Oa-Wa;la._transform._rotation01=Ga-$a;la._transform._rotation02=Ua+Qa;la._transform._rotation10=Ga+$a;la._transform._rotation11=1-Fa-Wa;la._transform._rotation12=Ha-Ja;la._transform._rotation20=Ua-Qa;la._transform._rotation21=Ha+Ja;la._transform._rotation22=1-Fa-Oa;var Ka;var ti;var ai;var ii;var ri;var oi;var si;var ni;var ei;Ka=la._transform._rotation00*la._invLocalInertia00+la._transform._rotation01*la._invLocalInertia10+la._transform._rotation02*la._invLocalInertia20;ti=la._transform._rotation00*la._invLocalInertia01+la._transform._rotation01*la._invLocalInertia11+la._transform._rotation02*la._invLocalInertia21;ai=la._transform._rotation00*la._invLocalInertia02+la._transform._rotation01*la._invLocalInertia12+la._transform._rotation02*la._invLocalInertia22;ii=la._transform._rotation10*la._invLocalInertia00+la._transform._rotation11*la._invLocalInertia10+la._transform._rotation12*la._invLocalInertia20;ri=la._transform._rotation10*la._invLocalInertia01+la._transform._rotation11*la._invLocalInertia11+la._transform._rotation12*la._invLocalInertia21;oi=la._transform._rotation10*la._invLocalInertia02+la._transform._rotation11*la._invLocalInertia12+la._transform._rotation12*la._invLocalInertia22;si=la._transform._rotation20*la._invLocalInertia00+la._transform._rotation21*la._invLocalInertia10+la._transform._rotation22*la._invLocalInertia20;ni=la._transform._rotation20*la._invLocalInertia01+la._transform._rotation21*la._invLocalInertia11+la._transform._rotation22*la._invLocalInertia21;ei=la._transform._rotation20*la._invLocalInertia02+la._transform._rotation21*la._invLocalInertia12+la._transform._rotation22*la._invLocalInertia22;la._invInertia00=Ka;la._invInertia01=ti;la._invInertia02=ai;la._invInertia10=ii;la._invInertia11=ri;la._invInertia12=oi;la._invInertia20=si;la._invInertia21=ni;la._invInertia22=ei;var _i;var vi;var hi;var li;var ci;var pi;var fi;var mi;var bi;_i=la._invInertia00*la._transform._rotation00+la._invInertia01*la._transform._rotation01+la._invInertia02*la._transform._rotation02;vi=la._invInertia00*la._transform._rotation10+la._invInertia01*la._transform._rotation11+la._invInertia02*la._transform._rotation12;hi=la._invInertia00*la._transform._rotation20+la._invInertia01*la._transform._rotation21+la._invInertia02*la._transform._rotation22;li=la._invInertia10*la._transform._rotation00+la._invInertia11*la._transform._rotation01+la._invInertia12*la._transform._rotation02;ci=la._invInertia10*la._transform._rotation10+la._invInertia11*la._transform._rotation11+la._invInertia12*la._transform._rotation12;pi=la._invInertia10*la._transform._rotation20+la._invInertia11*la._transform._rotation21+la._invInertia12*la._transform._rotation22;fi=la._invInertia20*la._transform._rotation00+la._invInertia21*la._transform._rotation01+la._invInertia22*la._transform._rotation02;mi=la._invInertia20*la._transform._rotation10+la._invInertia21*la._transform._rotation11+la._invInertia22*la._transform._rotation12;bi=la._invInertia20*la._transform._rotation20+la._invInertia21*la._transform._rotation21+la._invInertia22*la._transform._rotation22;la._invInertia00=_i;la._invInertia01=vi;la._invInertia02=hi;la._invInertia10=li;la._invInertia11=ci;la._invInertia12=pi;la._invInertia20=fi;la._invInertia21=mi;la._invInertia22=bi;la._invInertia00*=la._rotFactor.x;la._invInertia01*=la._rotFactor.x;la._invInertia02*=la._rotFactor.x;la._invInertia10*=la._rotFactor.y;la._invInertia11*=la._rotFactor.y;la._invInertia12*=la._rotFactor.y;la._invInertia20*=la._rotFactor.z;la._invInertia21*=la._rotFactor.z;la._invInertia22*=la._rotFactor.z}var ui=this.posBoundarySelector;var xi=0;while(ui.indices[xi]!=M)++xi;while(xi>0){var yi=ui.indices[xi];ui.indices[xi]=ui.indices[xi-1];ui.indices[xi-1]=yi;--xi}y=true;break}}if(!y){console.log("DirectJointConstraintSolver.hx:506:","could not find solution. (NGS)");return}},postSolve:function(){this.joint._syncAnchors();this.joint._checkDestruction()}});var Qt=function(t){this._size=t;var a=this._size;var i=new Array(a);this.tmpMatrix=i;var r=this._size;var o=new Array(r);this._invMass=o;var s=this._size;var n=new Array(s);this._invMassWithoutCfm=n;var e=0;var _=this._size;while(e<_){var v=e++;var h=this.tmpMatrix;var l=this._size;var c=new Array(l);h[v]=c;var p=this._invMass;var f=this._size;var m=new Array(f);p[v]=m;var b=this._invMassWithoutCfm;var u=this._size;var x=new Array(u);b[v]=x;var y=0;var g=this._size;while(y<g){var X=y++;this.tmpMatrix[v][X]=0;this._invMass[v][X]=0;this._invMassWithoutCfm[v][X]=0}}this._maxSubmatrixId=1<<this._size;var z=this._maxSubmatrixId;var M=new Array(z);this._cacheComputed=M;var Y=this._maxSubmatrixId;var Z=new Array(Y);this._cachedSubmatrices=Z;var d=0;var I=this._maxSubmatrixId;while(d<I){var w=d++;var V=w;V=(V&85)+(V>>1&85);V=(V&51)+(V>>2&51);V=(V&15)+(V>>4&15);var L=V;var A=new Array(L);var k=A;var B=0;var P=L;while(B<P){var T=B++;var S=new Array(L);k[T]=S;var C=0;var q=L;while(C<q){var R=C++;k[T][R]=0}}this._cacheComputed[w]=false;this._cachedSubmatrices[w]=k}};Qt.prototype={computeSubmatrix:function(t,a,i){var r=0;var o=i;while(r<o){var s=r++;var n=a[s];var e=0;var _=i;while(e<_){var v=e++;this.tmpMatrix[s][v]=this._invMass[n][a[v]]}}var h=this.tmpMatrix;var l=this._cachedSubmatrices[t];var c;var p;var f;var m;var b;switch(i){case 4:c=h[0];p=l[0];b=1/c[0];p[0]=b;c[1]=c[1]*b;c[2]=c[2]*b;c[3]=c[3]*b;f=h[1];m=l[1];m[0]=-b*f[0];f[1]=f[1]-c[1]*f[0];f[2]=f[2]-c[2]*f[0];f[3]=f[3]-c[3]*f[0];f=h[2];m=l[2];m[0]=-b*f[0];f[1]=f[1]-c[1]*f[0];f[2]=f[2]-c[2]*f[0];f[3]=f[3]-c[3]*f[0];f=h[3];m=l[3];m[0]=-b*f[0];f[1]=f[1]-c[1]*f[0];f[2]=f[2]-c[2]*f[0];f[3]=f[3]-c[3]*f[0];c=h[1];p=l[1];b=1/c[1];p[1]=b;p[0]=p[0]*b;c[2]=c[2]*b;c[3]=c[3]*b;f=h[0];m=l[0];m[0]=m[0]-p[0]*f[1];f[2]=f[2]-c[2]*f[1];f[3]=f[3]-c[3]*f[1];f=h[2];m=l[2];m[0]=m[0]-p[0]*f[1];m[1]=-b*f[1];f[2]=f[2]-c[2]*f[1];f[3]=f[3]-c[3]*f[1];f=h[3];m=l[3];m[0]=m[0]-p[0]*f[1];m[1]=-b*f[1];f[2]=f[2]-c[2]*f[1];f[3]=f[3]-c[3]*f[1];c=h[2];p=l[2];b=1/c[2];p[2]=b;p[0]=p[0]*b;p[1]=p[1]*b;c[3]=c[3]*b;f=h[0];m=l[0];m[0]=m[0]-p[0]*f[2];f[3]=f[3]-c[3]*f[2];f=h[1];m=l[1];m[0]=m[0]-p[0]*f[2];m[1]=m[1]-p[1]*f[2];f[3]=f[3]-c[3]*f[2];f=h[3];m=l[3];m[0]=m[0]-p[0]*f[2];m[1]=m[1]-p[1]*f[2];m[2]=-b*f[2];f[3]=f[3]-c[3]*f[2];c=h[3];p=l[3];b=1/c[3];p[3]=b;p[0]=p[0]*b;p[1]=p[1]*b;p[2]=p[2]*b;f=h[0];m=l[0];m[0]=m[0]-p[0]*f[3];f=h[1];m=l[1];m[0]=m[0]-p[0]*f[3];m[1]=m[1]-p[1]*f[3];f=h[2];m=l[2];m[0]=m[0]-p[0]*f[3];m[1]=m[1]-p[1]*f[3];m[2]=m[2]-p[2]*f[3];p=l[1];l[0][1]=p[0];p=l[2];l[0][2]=p[0];l[1][2]=p[1];p=l[3];l[0][3]=p[0];l[1][3]=p[1];l[2][3]=p[2];break;case 5:c=h[0];p=l[0];b=1/c[0];p[0]=b;c[1]=c[1]*b;c[2]=c[2]*b;c[3]=c[3]*b;c[4]=c[4]*b;f=h[1];m=l[1];m[0]=-b*f[0];f[1]=f[1]-c[1]*f[0];f[2]=f[2]-c[2]*f[0];f[3]=f[3]-c[3]*f[0];f[4]=f[4]-c[4]*f[0];f=h[2];m=l[2];m[0]=-b*f[0];f[1]=f[1]-c[1]*f[0];f[2]=f[2]-c[2]*f[0];f[3]=f[3]-c[3]*f[0];f[4]=f[4]-c[4]*f[0];f=h[3];m=l[3];m[0]=-b*f[0];f[1]=f[1]-c[1]*f[0];f[2]=f[2]-c[2]*f[0];f[3]=f[3]-c[3]*f[0];f[4]=f[4]-c[4]*f[0];f=h[4];m=l[4];m[0]=-b*f[0];f[1]=f[1]-c[1]*f[0];f[2]=f[2]-c[2]*f[0];f[3]=f[3]-c[3]*f[0];f[4]=f[4]-c[4]*f[0];c=h[1];p=l[1];b=1/c[1];p[1]=b;p[0]=p[0]*b;c[2]=c[2]*b;c[3]=c[3]*b;c[4]=c[4]*b;f=h[0];m=l[0];m[0]=m[0]-p[0]*f[1];f[2]=f[2]-c[2]*f[1];f[3]=f[3]-c[3]*f[1];f[4]=f[4]-c[4]*f[1];f=h[2];m=l[2];m[0]=m[0]-p[0]*f[1];m[1]=-b*f[1];f[2]=f[2]-c[2]*f[1];f[3]=f[3]-c[3]*f[1];f[4]=f[4]-c[4]*f[1];f=h[3];m=l[3];m[0]=m[0]-p[0]*f[1];m[1]=-b*f[1];f[2]=f[2]-c[2]*f[1];f[3]=f[3]-c[3]*f[1];f[4]=f[4]-c[4]*f[1];f=h[4];m=l[4];m[0]=m[0]-p[0]*f[1];m[1]=-b*f[1];f[2]=f[2]-c[2]*f[1];f[3]=f[3]-c[3]*f[1];f[4]=f[4]-c[4]*f[1];c=h[2];p=l[2];b=1/c[2];p[2]=b;p[0]=p[0]*b;p[1]=p[1]*b;c[3]=c[3]*b;c[4]=c[4]*b;f=h[0];m=l[0];m[0]=m[0]-p[0]*f[2];f[3]=f[3]-c[3]*f[2];f[4]=f[4]-c[4]*f[2];f=h[1];m=l[1];m[0]=m[0]-p[0]*f[2];m[1]=m[1]-p[1]*f[2];f[3]=f[3]-c[3]*f[2];f[4]=f[4]-c[4]*f[2];f=h[3];m=l[3];m[0]=m[0]-p[0]*f[2];m[1]=m[1]-p[1]*f[2];m[2]=-b*f[2];f[3]=f[3]-c[3]*f[2];f[4]=f[4]-c[4]*f[2];f=h[4];m=l[4];m[0]=m[0]-p[0]*f[2];m[1]=m[1]-p[1]*f[2];m[2]=-b*f[2];f[3]=f[3]-c[3]*f[2];f[4]=f[4]-c[4]*f[2];c=h[3];p=l[3];b=1/c[3];p[3]=b;p[0]=p[0]*b;p[1]=p[1]*b;p[2]=p[2]*b;c[4]=c[4]*b;f=h[0];m=l[0];m[0]=m[0]-p[0]*f[3];f[4]=f[4]-c[4]*f[3];f=h[1];m=l[1];m[0]=m[0]-p[0]*f[3];m[1]=m[1]-p[1]*f[3];f[4]=f[4]-c[4]*f[3];f=h[2];m=l[2];m[0]=m[0]-p[0]*f[3];m[1]=m[1]-p[1]*f[3];m[2]=m[2]-p[2]*f[3];f[4]=f[4]-c[4]*f[3];f=h[4];m=l[4];m[0]=m[0]-p[0]*f[3];m[1]=m[1]-p[1]*f[3];m[2]=m[2]-p[2]*f[3];m[3]=-b*f[3];f[4]=f[4]-c[4]*f[3];c=h[4];p=l[4];b=1/c[4];p[4]=b;p[0]=p[0]*b;p[1]=p[1]*b;p[2]=p[2]*b;p[3]=p[3]*b;f=h[0];m=l[0];m[0]=m[0]-p[0]*f[4];f=h[1];m=l[1];m[0]=m[0]-p[0]*f[4];m[1]=m[1]-p[1]*f[4];f=h[2];m=l[2];m[0]=m[0]-p[0]*f[4];m[1]=m[1]-p[1]*f[4];m[2]=m[2]-p[2]*f[4];f=h[3];m=l[3];m[0]=m[0]-p[0]*f[4];m[1]=m[1]-p[1]*f[4];m[2]=m[2]-p[2]*f[4];m[3]=m[3]-p[3]*f[4];p=l[1];l[0][1]=p[0];p=l[2];l[0][2]=p[0];l[1][2]=p[1];p=l[3];l[0][3]=p[0];l[1][3]=p[1];l[2][3]=p[2];p=l[4];l[0][4]=p[0];l[1][4]=p[1];l[2][4]=p[2];l[3][4]=p[3];break;case 6:c=h[0];p=l[0];b=1/c[0];p[0]=b;c[1]=c[1]*b;c[2]=c[2]*b;c[3]=c[3]*b;c[4]=c[4]*b;c[5]=c[5]*b;f=h[1];m=l[1];m[0]=-b*f[0];f[1]=f[1]-c[1]*f[0];f[2]=f[2]-c[2]*f[0];f[3]=f[3]-c[3]*f[0];f[4]=f[4]-c[4]*f[0];f[5]=f[5]-c[5]*f[0];f=h[2];m=l[2];m[0]=-b*f[0];f[1]=f[1]-c[1]*f[0];f[2]=f[2]-c[2]*f[0];f[3]=f[3]-c[3]*f[0];f[4]=f[4]-c[4]*f[0];f[5]=f[5]-c[5]*f[0];f=h[3];m=l[3];m[0]=-b*f[0];f[1]=f[1]-c[1]*f[0];f[2]=f[2]-c[2]*f[0];f[3]=f[3]-c[3]*f[0];f[4]=f[4]-c[4]*f[0];f[5]=f[5]-c[5]*f[0];f=h[4];m=l[4];m[0]=-b*f[0];f[1]=f[1]-c[1]*f[0];f[2]=f[2]-c[2]*f[0];f[3]=f[3]-c[3]*f[0];f[4]=f[4]-c[4]*f[0];f[5]=f[5]-c[5]*f[0];f=h[5];m=l[5];m[0]=-b*f[0];f[1]=f[1]-c[1]*f[0];f[2]=f[2]-c[2]*f[0];f[3]=f[3]-c[3]*f[0];f[4]=f[4]-c[4]*f[0];f[5]=f[5]-c[5]*f[0];c=h[1];p=l[1];b=1/c[1];p[1]=b;p[0]=p[0]*b;c[2]=c[2]*b;c[3]=c[3]*b;c[4]=c[4]*b;c[5]=c[5]*b;f=h[0];m=l[0];m[0]=m[0]-p[0]*f[1];f[2]=f[2]-c[2]*f[1];f[3]=f[3]-c[3]*f[1];f[4]=f[4]-c[4]*f[1];f[5]=f[5]-c[5]*f[1];f=h[2];m=l[2];m[0]=m[0]-p[0]*f[1];m[1]=-b*f[1];f[2]=f[2]-c[2]*f[1];f[3]=f[3]-c[3]*f[1];f[4]=f[4]-c[4]*f[1];f[5]=f[5]-c[5]*f[1];f=h[3];m=l[3];m[0]=m[0]-p[0]*f[1];m[1]=-b*f[1];f[2]=f[2]-c[2]*f[1];f[3]=f[3]-c[3]*f[1];f[4]=f[4]-c[4]*f[1];f[5]=f[5]-c[5]*f[1];f=h[4];m=l[4];m[0]=m[0]-p[0]*f[1];m[1]=-b*f[1];f[2]=f[2]-c[2]*f[1];f[3]=f[3]-c[3]*f[1];f[4]=f[4]-c[4]*f[1];f[5]=f[5]-c[5]*f[1];f=h[5];m=l[5];m[0]=m[0]-p[0]*f[1];m[1]=-b*f[1];f[2]=f[2]-c[2]*f[1];f[3]=f[3]-c[3]*f[1];f[4]=f[4]-c[4]*f[1];f[5]=f[5]-c[5]*f[1];c=h[2];p=l[2];b=1/c[2];p[2]=b;p[0]=p[0]*b;p[1]=p[1]*b;c[3]=c[3]*b;c[4]=c[4]*b;c[5]=c[5]*b;f=h[0];m=l[0];m[0]=m[0]-p[0]*f[2];f[3]=f[3]-c[3]*f[2];f[4]=f[4]-c[4]*f[2];f[5]=f[5]-c[5]*f[2];f=h[1];m=l[1];m[0]=m[0]-p[0]*f[2];m[1]=m[1]-p[1]*f[2];f[3]=f[3]-c[3]*f[2];f[4]=f[4]-c[4]*f[2];f[5]=f[5]-c[5]*f[2];f=h[3];m=l[3];m[0]=m[0]-p[0]*f[2];m[1]=m[1]-p[1]*f[2];m[2]=-b*f[2];f[3]=f[3]-c[3]*f[2];f[4]=f[4]-c[4]*f[2];f[5]=f[5]-c[5]*f[2];f=h[4];m=l[4];m[0]=m[0]-p[0]*f[2];m[1]=m[1]-p[1]*f[2];m[2]=-b*f[2];f[3]=f[3]-c[3]*f[2];f[4]=f[4]-c[4]*f[2];f[5]=f[5]-c[5]*f[2];f=h[5];m=l[5];m[0]=m[0]-p[0]*f[2];m[1]=m[1]-p[1]*f[2];m[2]=-b*f[2];f[3]=f[3]-c[3]*f[2];f[4]=f[4]-c[4]*f[2];f[5]=f[5]-c[5]*f[2];c=h[3];p=l[3];b=1/c[3];p[3]=b;p[0]=p[0]*b;p[1]=p[1]*b;p[2]=p[2]*b;c[4]=c[4]*b;c[5]=c[5]*b;f=h[0];m=l[0];m[0]=m[0]-p[0]*f[3];f[4]=f[4]-c[4]*f[3];f[5]=f[5]-c[5]*f[3];f=h[1];m=l[1];m[0]=m[0]-p[0]*f[3];m[1]=m[1]-p[1]*f[3];f[4]=f[4]-c[4]*f[3];f[5]=f[5]-c[5]*f[3];f=h[2];m=l[2];m[0]=m[0]-p[0]*f[3];m[1]=m[1]-p[1]*f[3];m[2]=m[2]-p[2]*f[3];f[4]=f[4]-c[4]*f[3];f[5]=f[5]-c[5]*f[3];f=h[4];m=l[4];m[0]=m[0]-p[0]*f[3];m[1]=m[1]-p[1]*f[3];m[2]=m[2]-p[2]*f[3];m[3]=-b*f[3];f[4]=f[4]-c[4]*f[3];f[5]=f[5]-c[5]*f[3];f=h[5];m=l[5];m[0]=m[0]-p[0]*f[3];m[1]=m[1]-p[1]*f[3];m[2]=m[2]-p[2]*f[3];m[3]=-b*f[3];f[4]=f[4]-c[4]*f[3];f[5]=f[5]-c[5]*f[3];c=h[4];p=l[4];b=1/c[4];p[4]=b;p[0]=p[0]*b;p[1]=p[1]*b;p[2]=p[2]*b;p[3]=p[3]*b;c[5]=c[5]*b;f=h[0];m=l[0];m[0]=m[0]-p[0]*f[4];f[5]=f[5]-c[5]*f[4];f=h[1];m=l[1];m[0]=m[0]-p[0]*f[4];m[1]=m[1]-p[1]*f[4];f[5]=f[5]-c[5]*f[4];f=h[2];m=l[2];m[0]=m[0]-p[0]*f[4];m[1]=m[1]-p[1]*f[4];m[2]=m[2]-p[2]*f[4];f[5]=f[5]-c[5]*f[4];f=h[3];m=l[3];m[0]=m[0]-p[0]*f[4];m[1]=m[1]-p[1]*f[4];m[2]=m[2]-p[2]*f[4];m[3]=m[3]-p[3]*f[4];f[5]=f[5]-c[5]*f[4];f=h[5];m=l[5];m[0]=m[0]-p[0]*f[4];m[1]=m[1]-p[1]*f[4];m[2]=m[2]-p[2]*f[4];m[3]=m[3]-p[3]*f[4];m[4]=-b*f[4];f[5]=f[5]-c[5]*f[4];c=h[5];p=l[5];b=1/c[5];p[5]=b;p[0]=p[0]*b;p[1]=p[1]*b;p[2]=p[2]*b;p[3]=p[3]*b;p[4]=p[4]*b;f=h[0];m=l[0];m[0]=m[0]-p[0]*f[5];f=h[1];m=l[1];m[0]=m[0]-p[0]*f[5];m[1]=m[1]-p[1]*f[5];f=h[2];m=l[2];m[0]=m[0]-p[0]*f[5];m[1]=m[1]-p[1]*f[5];m[2]=m[2]-p[2]*f[5];f=h[3];m=l[3];m[0]=m[0]-p[0]*f[5];m[1]=m[1]-p[1]*f[5];m[2]=m[2]-p[2]*f[5];m[3]=m[3]-p[3]*f[5];f=h[4];m=l[4];m[0]=m[0]-p[0]*f[5];m[1]=m[1]-p[1]*f[5];m[2]=m[2]-p[2]*f[5];m[3]=m[3]-p[3]*f[5];m[4]=m[4]-p[4]*f[5];p=l[1];l[0][1]=p[0];p=l[2];l[0][2]=p[0];l[1][2]=p[1];p=l[3];l[0][3]=p[0];l[1][3]=p[1];l[2][3]=p[2];p=l[4];l[0][4]=p[0];l[1][4]=p[1];l[2][4]=p[2];l[3][4]=p[3];p=l[5];l[0][5]=p[0];l[1][5]=p[1];l[2][5]=p[2];l[3][5]=p[3];l[4][5]=p[4];break;default:var u=0;var x=i;while(u<x){var y=u++;c=h[y];p=l[y];var g=1/c[y];p[y]=g;var X=0;var z=y;while(X<z){var M=X++;p[M]=p[M]*g}var Y=y+1;var Z=i;while(Y<Z){var d=Y++;c[d]=c[d]*g}var I=0;var w=y;while(I<w){var V=I++;f=h[V];m=l[V];var L=0;var A=V+1;while(L<A){var k=L++;m[k]=m[k]-p[k]*f[y]}var B=y+1;var P=i;while(B<P){var T=B++;f[T]=f[T]-c[T]*f[y]}}var S=y+1;var C=i;while(S<C){var q=S++;f=h[q];m=l[q];var R=0;var E=y;while(R<E){var j=R++;m[j]=m[j]-p[j]*f[y]}m[y]=-g*f[y];var N=y+1;var D=i;while(N<D){var F=N++;f[F]=f[F]-c[F]*f[y]}}}var O=1;var W=i;while(O<W){var G=O++;p=l[G];var H=0;var U=G;while(H<U){var J=H++;l[J][G]=p[J]}}}},computeInvMass:function(t,a){var i=this._invMass;var r=this._invMassWithoutCfm;var o=t.numRows;var s=t.b1;var n=t.b2;var e=s._invMass;var _=n._invMass;var v;var h;var l;var c;var p;var f;var m;var b;var u;var x;var y;var g;var X;var z;var M;var Y;var Z;var d;var I;var w;h=s._invInertia00;l=s._invInertia01;c=s._invInertia02;p=s._invInertia10;f=s._invInertia11;m=s._invInertia12;b=s._invInertia20;u=s._invInertia21;x=s._invInertia22;g=n._invInertia00;X=n._invInertia01;z=n._invInertia02;M=n._invInertia10;Y=n._invInertia11;Z=n._invInertia12;d=n._invInertia20;I=n._invInertia21;w=n._invInertia22;var V=0;var L=o;while(V<L){var A=V++;var k=t.rows[A].jacobian;var B=a[A];k.updateSparsity();if((k.flag&1)!=0){B.invMLin1X=k.lin1X*e;B.invMLin1Y=k.lin1Y*e;B.invMLin1Z=k.lin1Z*e;B.invMLin2X=k.lin2X*_;B.invMLin2Y=k.lin2Y*_;B.invMLin2Z=k.lin2Z*_}else{B.invMLin1X=0;B.invMLin1Y=0;B.invMLin1Z=0;B.invMLin2X=0;B.invMLin2Y=0;B.invMLin2Z=0}if((k.flag&2)!=0){var P;var T;var S;P=h*k.ang1X+l*k.ang1Y+c*k.ang1Z;T=p*k.ang1X+f*k.ang1Y+m*k.ang1Z;S=b*k.ang1X+u*k.ang1Y+x*k.ang1Z;B.invMAng1X=P;B.invMAng1Y=T;B.invMAng1Z=S;var C;var q;var R;C=g*k.ang2X+X*k.ang2Y+z*k.ang2Z;q=M*k.ang2X+Y*k.ang2Y+Z*k.ang2Z;R=d*k.ang2X+I*k.ang2Y+w*k.ang2Z;B.invMAng2X=C;B.invMAng2Y=q;B.invMAng2Z=R}else{B.invMAng1X=0;B.invMAng1Y=0;B.invMAng1Z=0;B.invMAng2X=0;B.invMAng2Y=0;B.invMAng2Z=0}}var E=0;var j=o;while(E<j){var N=E++;var D=t.rows[N].jacobian;var F=N;var O=o;while(F<O){var W=F++;var G=t.rows[W].jacobian;var H=a[W];var U=D.lin1X*H.invMLin1X+D.lin1Y*H.invMLin1Y+D.lin1Z*H.invMLin1Z+(D.ang1X*H.invMAng1X+D.ang1Y*H.invMAng1Y+D.ang1Z*H.invMAng1Z)+(D.lin2X*H.invMLin2X+D.lin2Y*H.invMLin2Y+D.lin2Z*H.invMLin2Z)+(D.ang2X*H.invMAng2X+D.ang2Y*H.invMAng2Y+D.ang2Z*H.invMAng2Z);if(N==W){i[N][W]=U+t.rows[N].cfm;r[N][W]=U;H.mass=U+t.rows[N].cfm;H.massWithoutCfm=U;if(H.mass!=0){H.mass=1/H.mass}if(H.massWithoutCfm!=0){H.massWithoutCfm=1/H.massWithoutCfm}}else{i[N][W]=U;i[W][N]=U;r[N][W]=U;r[W][N]=U}}}var J=0;var Q=this._maxSubmatrixId;while(J<Q){var $=J++;this._cacheComputed[$]=false}}};var $t=function(t){ht.call(this);this.constraint=t;this.info=new ut;var a=ys.maxManifoldPoints;var i=new Array(a);this.massData=i;var r=0;var o=this.massData.length;while(r<o){var s=r++;this.massData[s]=new Ft}};$t.__super__=ht;$t.prototype=$extend(ht.prototype,{preSolveVelocity:function(t){this.constraint._getVelocitySolverInfo(t,this.info);this._b1=this.info.b1;this._b2=this.info.b2;var a=this._b1._invMass;var i=this._b2._invMass;var r;var o;var s;var n;var e;var _;var v;var h;var l;var c;var p;var f;var m;var b;var u;var x;var y;var g;var X;var z;o=this._b1._invInertia00;s=this._b1._invInertia01;n=this._b1._invInertia02;e=this._b1._invInertia10;_=this._b1._invInertia11;v=this._b1._invInertia12;h=this._b1._invInertia20;l=this._b1._invInertia21;c=this._b1._invInertia22;f=this._b2._invInertia00;m=this._b2._invInertia01;b=this._b2._invInertia02;u=this._b2._invInertia10;x=this._b2._invInertia11;y=this._b2._invInertia12;g=this._b2._invInertia20;X=this._b2._invInertia21;z=this._b2._invInertia22;var M=0;var Y=this.info.numRows;while(M<Y){var Z=M++;var d=this.info.rows[Z];var I=this.massData[Z];var w=d.jacobianN;I.invMLinN1X=w.lin1X*a;I.invMLinN1Y=w.lin1Y*a;I.invMLinN1Z=w.lin1Z*a;I.invMLinN2X=w.lin2X*i;I.invMLinN2Y=w.lin2Y*i;I.invMLinN2Z=w.lin2Z*i;var V;var L;var A;V=o*w.ang1X+s*w.ang1Y+n*w.ang1Z;L=e*w.ang1X+_*w.ang1Y+v*w.ang1Z;A=h*w.ang1X+l*w.ang1Y+c*w.ang1Z;I.invMAngN1X=V;I.invMAngN1Y=L;I.invMAngN1Z=A;var k;var B;var P;k=f*w.ang2X+m*w.ang2Y+b*w.ang2Z;B=u*w.ang2X+x*w.ang2Y+y*w.ang2Z;P=g*w.ang2X+X*w.ang2Y+z*w.ang2Z;I.invMAngN2X=k;I.invMAngN2Y=B;I.invMAngN2Z=P;I.massN=a+i+(I.invMAngN1X*w.ang1X+I.invMAngN1Y*w.ang1Y+I.invMAngN1Z*w.ang1Z)+(I.invMAngN2X*w.ang2X+I.invMAngN2Y*w.ang2Y+I.invMAngN2Z*w.ang2Z);if(I.massN!=0){I.massN=1/I.massN}var T=d.jacobianT;var S=d.jacobianB;I.invMLinT1X=T.lin1X*a;I.invMLinT1Y=T.lin1Y*a;I.invMLinT1Z=T.lin1Z*a;I.invMLinT2X=T.lin2X*i;I.invMLinT2Y=T.lin2Y*i;I.invMLinT2Z=T.lin2Z*i;I.invMLinB1X=S.lin1X*a;I.invMLinB1Y=S.lin1Y*a;I.invMLinB1Z=S.lin1Z*a;I.invMLinB2X=S.lin2X*i;I.invMLinB2Y=S.lin2Y*i;I.invMLinB2Z=S.lin2Z*i;var C;var q;var R;C=o*T.ang1X+s*T.ang1Y+n*T.ang1Z;q=e*T.ang1X+_*T.ang1Y+v*T.ang1Z;R=h*T.ang1X+l*T.ang1Y+c*T.ang1Z;I.invMAngT1X=C;I.invMAngT1Y=q;I.invMAngT1Z=R;var E;var j;var N;E=f*T.ang2X+m*T.ang2Y+b*T.ang2Z;j=u*T.ang2X+x*T.ang2Y+y*T.ang2Z;N=g*T.ang2X+X*T.ang2Y+z*T.ang2Z;I.invMAngT2X=E;I.invMAngT2Y=j;I.invMAngT2Z=N;var D;var F;var O;D=o*S.ang1X+s*S.ang1Y+n*S.ang1Z;F=e*S.ang1X+_*S.ang1Y+v*S.ang1Z;O=h*S.ang1X+l*S.ang1Y+c*S.ang1Z;I.invMAngB1X=D;I.invMAngB1Y=F;I.invMAngB1Z=O;var W;var G;var H;W=f*S.ang2X+m*S.ang2Y+b*S.ang2Z;G=u*S.ang2X+x*S.ang2Y+y*S.ang2Z;H=g*S.ang2X+X*S.ang2Y+z*S.ang2Z;I.invMAngB2X=W;I.invMAngB2Y=G;I.invMAngB2Z=H;var U=a+i+(I.invMAngT1X*T.ang1X+I.invMAngT1Y*T.ang1Y+I.invMAngT1Z*T.ang1Z)+(I.invMAngT2X*T.ang2X+I.invMAngT2Y*T.ang2Y+I.invMAngT2Z*T.ang2Z);var J=I.invMAngT1X*S.ang1X+I.invMAngT1Y*S.ang1Y+I.invMAngT1Z*S.ang1Z+(I.invMAngT2X*S.ang2X+I.invMAngT2Y*S.ang2Y+I.invMAngT2Z*S.ang2Z);var Q=J;var $=a+i+(I.invMAngB1X*S.ang1X+I.invMAngB1Y*S.ang1Y+I.invMAngB1Z*S.ang1Z)+(I.invMAngB2X*S.ang2X+I.invMAngB2Y*S.ang2Y+I.invMAngB2Z*S.ang2Z);var K=U*$-J*Q;if(K!=0){K=1/K}I.massTB00=$*K;I.massTB01=-J*K;I.massTB10=-Q*K;I.massTB11=U*K}},warmStart:function(t){var a;var i;var r;var o;var s;var n;var e;var _;var v;var h;var l;var c;var p;var f;var m;var b;i=this._b1._velX;r=this._b1._velY;o=this._b1._velZ;n=this._b2._velX;e=this._b2._velY;_=this._b2._velZ;h=this._b1._angVelX;l=this._b1._angVelY;c=this._b1._angVelZ;f=this._b2._angVelX;m=this._b2._angVelY;b=this._b2._angVelZ;var u=0;var x=this.info.numRows;while(u<x){var y=u++;var g=this.info.rows[y];var X=g.impulse;var z=this.massData[y];var M=g.jacobianT;var Y=g.jacobianB;var Z=X.impulseN;var d=X.impulseLX*M.lin1X+X.impulseLY*M.lin1Y+X.impulseLZ*M.lin1Z;var I=X.impulseLX*Y.lin1X+X.impulseLY*Y.lin1Y+X.impulseLZ*Y.lin1Z;X.impulseT=d;X.impulseB=I;X.impulseN*=t.dtRatio;X.impulseT*=t.dtRatio;X.impulseB*=t.dtRatio;i+=z.invMLinN1X*Z;r+=z.invMLinN1Y*Z;o+=z.invMLinN1Z*Z;i+=z.invMLinT1X*d;r+=z.invMLinT1Y*d;o+=z.invMLinT1Z*d;i+=z.invMLinB1X*I;r+=z.invMLinB1Y*I;o+=z.invMLinB1Z*I;n+=z.invMLinN2X*-Z;e+=z.invMLinN2Y*-Z;_+=z.invMLinN2Z*-Z;n+=z.invMLinT2X*-d;e+=z.invMLinT2Y*-d;_+=z.invMLinT2Z*-d;n+=z.invMLinB2X*-I;e+=z.invMLinB2Y*-I;_+=z.invMLinB2Z*-I;h+=z.invMAngN1X*Z;l+=z.invMAngN1Y*Z;c+=z.invMAngN1Z*Z;h+=z.invMAngT1X*d;l+=z.invMAngT1Y*d;c+=z.invMAngT1Z*d;h+=z.invMAngB1X*I;l+=z.invMAngB1Y*I;c+=z.invMAngB1Z*I;f+=z.invMAngN2X*-Z;m+=z.invMAngN2Y*-Z;b+=z.invMAngN2Z*-Z;f+=z.invMAngT2X*-d;m+=z.invMAngT2Y*-d;b+=z.invMAngT2Z*-d;f+=z.invMAngB2X*-I;m+=z.invMAngB2Y*-I;b+=z.invMAngB2Z*-I}this._b1._velX=i;this._b1._velY=r;this._b1._velZ=o;this._b2._velX=n;this._b2._velY=e;this._b2._velZ=_;this._b1._angVelX=h;this._b1._angVelY=l;this._b1._angVelZ=c;this._b2._angVelX=f;this._b2._angVelY=m;this._b2._angVelZ=b},solveVelocity:function(){var t;var a;var i;var r;var o;var s;var n;var e;var _;var v;var h;var l;var c;var p;var f;var m;a=this._b1._velX;i=this._b1._velY;r=this._b1._velZ;s=this._b2._velX;n=this._b2._velY;e=this._b2._velZ;v=this._b1._angVelX;h=this._b1._angVelY;l=this._b1._angVelZ;p=this._b2._angVelX;f=this._b2._angVelY;m=this._b2._angVelZ;var b=0;var u=this.info.numRows;while(b<u){var x=b++;var y=this.info.rows[x];var g=this.massData[x];var X=y.impulse;var z=0;var M=y.jacobianT;z+=a*M.lin1X+i*M.lin1Y+r*M.lin1Z;z-=s*M.lin2X+n*M.lin2Y+e*M.lin2Z;z+=v*M.ang1X+h*M.ang1Y+l*M.ang1Z;z-=p*M.ang2X+f*M.ang2Y+m*M.ang2Z;var Y=0;M=y.jacobianB;Y+=a*M.lin1X+i*M.lin1Y+r*M.lin1Z;Y-=s*M.lin2X+n*M.lin2Y+e*M.lin2Z;Y+=v*M.ang1X+h*M.ang1Y+l*M.ang1Z;Y-=p*M.ang2X+f*M.ang2Y+m*M.ang2Z;var Z=-(z*g.massTB00+Y*g.massTB01);var d=-(z*g.massTB10+Y*g.massTB11);var I=X.impulseT;var w=X.impulseB;X.impulseT+=Z;X.impulseB+=d;var V=y.friction*X.impulseN;if(V==0){X.impulseT=0;X.impulseB=0}else{var L=X.impulseT*X.impulseT+X.impulseB*X.impulseB;if(L>V*V){var A=V/Math.sqrt(L);X.impulseT*=A;X.impulseB*=A}}Z=X.impulseT-I;d=X.impulseB-w;a+=g.invMLinT1X*Z;i+=g.invMLinT1Y*Z;r+=g.invMLinT1Z*Z;a+=g.invMLinB1X*d;i+=g.invMLinB1Y*d;r+=g.invMLinB1Z*d;s+=g.invMLinT2X*-Z;n+=g.invMLinT2Y*-Z;e+=g.invMLinT2Z*-Z;s+=g.invMLinB2X*-d;n+=g.invMLinB2Y*-d;e+=g.invMLinB2Z*-d;v+=g.invMAngT1X*Z;h+=g.invMAngT1Y*Z;l+=g.invMAngT1Z*Z;v+=g.invMAngB1X*d;h+=g.invMAngB1Y*d;l+=g.invMAngB1Z*d;p+=g.invMAngT2X*-Z;f+=g.invMAngT2Y*-Z;m+=g.invMAngT2Z*-Z;p+=g.invMAngB2X*-d;f+=g.invMAngB2Y*-d;m+=g.invMAngB2Z*-d}var k=0;var B=this.info.numRows;while(k<B){var P=k++;var T=this.info.rows[P];var S=this.massData[P];var C=T.impulse;var q=0;var R=T.jacobianN;q+=a*R.lin1X+i*R.lin1Y+r*R.lin1Z;q-=s*R.lin2X+n*R.lin2Y+e*R.lin2Z;q+=v*R.ang1X+h*R.ang1Y+l*R.ang1Z;q-=p*R.ang2X+f*R.ang2Y+m*R.ang2Z;var E=(T.rhs-q)*S.massN;var j=C.impulseN;C.impulseN+=E;if(C.impulseN<0){C.impulseN=0}E=C.impulseN-j;a+=S.invMLinN1X*E;i+=S.invMLinN1Y*E;r+=S.invMLinN1Z*E;s+=S.invMLinN2X*-E;n+=S.invMLinN2Y*-E;e+=S.invMLinN2Z*-E;v+=S.invMAngN1X*E;h+=S.invMAngN1Y*E;l+=S.invMAngN1Z*E;p+=S.invMAngN2X*-E;f+=S.invMAngN2Y*-E;m+=S.invMAngN2Z*-E}this._b1._velX=a;this._b1._velY=i;this._b1._velZ=r;this._b2._velX=s;this._b2._velY=n;this._b2._velZ=e;this._b1._angVelX=v;this._b1._angVelY=h;this._b1._angVelZ=l;this._b2._angVelX=p;this._b2._angVelY=f;this._b2._angVelZ=m},preSolvePosition:function(t){this.constraint._syncManifold();this.constraint._getPositionSolverInfo(this.info);var a=this._b1._invMass;var i=this._b2._invMass;var r;var o;var s;var n;var e;var _;var v;var h;var l;var c;var p;var f;var m;var b;var u;var x;var y;var g;var X;var z;o=this._b1._invInertia00;s=this._b1._invInertia01;n=this._b1._invInertia02;e=this._b1._invInertia10;_=this._b1._invInertia11;v=this._b1._invInertia12;h=this._b1._invInertia20;l=this._b1._invInertia21;c=this._b1._invInertia22;f=this._b2._invInertia00;m=this._b2._invInertia01;b=this._b2._invInertia02;u=this._b2._invInertia10;x=this._b2._invInertia11;y=this._b2._invInertia12;g=this._b2._invInertia20;X=this._b2._invInertia21;z=this._b2._invInertia22;var M=0;var Y=this.info.numRows;while(M<Y){var Z=M++;var d=this.info.rows[Z];var I=this.massData[Z];var w=d.jacobianN;I.invMLinN1X=w.lin1X*a;I.invMLinN1Y=w.lin1Y*a;I.invMLinN1Z=w.lin1Z*a;I.invMLinN2X=w.lin2X*i;I.invMLinN2Y=w.lin2Y*i;I.invMLinN2Z=w.lin2Z*i;var V;var L;var A;V=o*w.ang1X+s*w.ang1Y+n*w.ang1Z;L=e*w.ang1X+_*w.ang1Y+v*w.ang1Z;A=h*w.ang1X+l*w.ang1Y+c*w.ang1Z;I.invMAngN1X=V;I.invMAngN1Y=L;I.invMAngN1Z=A;var k;var B;var P;k=f*w.ang2X+m*w.ang2Y+b*w.ang2Z;B=u*w.ang2X+x*w.ang2Y+y*w.ang2Z;P=g*w.ang2X+X*w.ang2Y+z*w.ang2Z;I.invMAngN2X=k;I.invMAngN2Y=B;I.invMAngN2Z=P;I.massN=a+i+(I.invMAngN1X*w.ang1X+I.invMAngN1Y*w.ang1Y+I.invMAngN1Z*w.ang1Z)+(I.invMAngN2X*w.ang2X+I.invMAngN2Y*w.ang2Y+I.invMAngN2Z*w.ang2Z);if(I.massN!=0){I.massN=1/I.massN}}var T=0;var S=this.info.numRows;while(T<S){var C=T++;this.info.rows[C].impulse.impulseP=0}},solvePositionSplitImpulse:function(){var t;var a;var i;var r;var o;var s;var n;var e;var _;var v;var h;var l;var c;var p;var f;var m;a=this._b1._pseudoVelX;i=this._b1._pseudoVelY;r=this._b1._pseudoVelZ;s=this._b2._pseudoVelX;n=this._b2._pseudoVelY;e=this._b2._pseudoVelZ;v=this._b1._angPseudoVelX;h=this._b1._angPseudoVelY;l=this._b1._angPseudoVelZ;p=this._b2._angPseudoVelX;f=this._b2._angPseudoVelY;m=this._b2._angPseudoVelZ;var b=0;var u=this.info.numRows;while(b<u){var x=b++;var y=this.info.rows[x];var g=this.massData[x];var X=y.impulse;var z=y.jacobianN;var M=0;M+=a*z.lin1X+i*z.lin1Y+r*z.lin1Z;M-=s*z.lin2X+n*z.lin2Y+e*z.lin2Z;M+=v*z.ang1X+h*z.ang1Y+l*z.ang1Z;M-=p*z.ang2X+f*z.ang2Y+m*z.ang2Z;var Y=(y.rhs-M)*g.massN*ys.positionSplitImpulseBaumgarte;var Z=X.impulseP;X.impulseP+=Y;if(X.impulseP<0){X.impulseP=0}Y=X.impulseP-Z;a+=g.invMLinN1X*Y;i+=g.invMLinN1Y*Y;r+=g.invMLinN1Z*Y;s+=g.invMLinN2X*-Y;n+=g.invMLinN2Y*-Y;e+=g.invMLinN2Z*-Y;v+=g.invMAngN1X*Y;h+=g.invMAngN1Y*Y;l+=g.invMAngN1Z*Y;p+=g.invMAngN2X*-Y;f+=g.invMAngN2Y*-Y;m+=g.invMAngN2Z*-Y}this._b1._pseudoVelX=a;this._b1._pseudoVelY=i;this._b1._pseudoVelZ=r;this._b2._pseudoVelX=s;this._b2._pseudoVelY=n;this._b2._pseudoVelZ=e;this._b1._angPseudoVelX=v;this._b1._angPseudoVelY=h;this._b1._angPseudoVelZ=l;this._b2._angPseudoVelX=p;this._b2._angPseudoVelY=f;this._b2._angPseudoVelZ=m},solvePositionNgs:function(t){this.constraint._syncManifold();this.constraint._getPositionSolverInfo(this.info);var a=this._b1._invMass;var i=this._b2._invMass;var r;var o;var s;var n;var e;var _;var v;var h;var l;var c;var p;var f;var m;var b;var u;var x;var y;var g;var X;var z;o=this._b1._invInertia00;s=this._b1._invInertia01;n=this._b1._invInertia02;e=this._b1._invInertia10;_=this._b1._invInertia11;v=this._b1._invInertia12;h=this._b1._invInertia20;l=this._b1._invInertia21;c=this._b1._invInertia22;f=this._b2._invInertia00;m=this._b2._invInertia01;b=this._b2._invInertia02;u=this._b2._invInertia10;x=this._b2._invInertia11;y=this._b2._invInertia12;g=this._b2._invInertia20;X=this._b2._invInertia21;z=this._b2._invInertia22;var M=0;var Y=this.info.numRows;while(M<Y){var Z=M++;var d=this.info.rows[Z];var I=this.massData[Z];var w=d.jacobianN;I.invMLinN1X=w.lin1X*a;I.invMLinN1Y=w.lin1Y*a;I.invMLinN1Z=w.lin1Z*a;I.invMLinN2X=w.lin2X*i;I.invMLinN2Y=w.lin2Y*i;I.invMLinN2Z=w.lin2Z*i;var V;var L;var A;V=o*w.ang1X+s*w.ang1Y+n*w.ang1Z;L=e*w.ang1X+_*w.ang1Y+v*w.ang1Z;A=h*w.ang1X+l*w.ang1Y+c*w.ang1Z;I.invMAngN1X=V;I.invMAngN1Y=L;I.invMAngN1Z=A;var k;var B;var P;k=f*w.ang2X+m*w.ang2Y+b*w.ang2Z;B=u*w.ang2X+x*w.ang2Y+y*w.ang2Z;P=g*w.ang2X+X*w.ang2Y+z*w.ang2Z;I.invMAngN2X=k;I.invMAngN2Y=B;I.invMAngN2Z=P;I.massN=a+i+(I.invMAngN1X*w.ang1X+I.invMAngN1Y*w.ang1Y+I.invMAngN1Z*w.ang1Z)+(I.invMAngN2X*w.ang2X+I.invMAngN2Y*w.ang2Y+I.invMAngN2Z*w.ang2Z);if(I.massN!=0){I.massN=1/I.massN}}var T;var S;var C;var q;var R;var E;var j;var N;var D;var F;var O;var W;var G;var H;var U;var J;S=0;C=0;q=0;E=0;j=0;N=0;F=0;O=0;W=0;H=0;U=0;J=0;var Q=0;var $=this.info.numRows;while(Q<$){var K=Q++;var tt=this.info.rows[K];var at=this.massData[K];var it=tt.impulse;var rt=tt.jacobianN;var ot=0;ot+=S*rt.lin1X+C*rt.lin1Y+q*rt.lin1Z;ot-=E*rt.lin2X+j*rt.lin2Y+N*rt.lin2Z;ot+=F*rt.ang1X+O*rt.ang1Y+W*rt.ang1Z;ot-=H*rt.ang2X+U*rt.ang2Y+J*rt.ang2Z;var st=(tt.rhs-ot)*at.massN*ys.positionNgsBaumgarte;var nt=it.impulseP;it.impulseP+=st;if(it.impulseP<0){it.impulseP=0}st=it.impulseP-nt;S+=at.invMLinN1X*st;C+=at.invMLinN1Y*st;q+=at.invMLinN1Z*st;E+=at.invMLinN2X*-st;j+=at.invMLinN2Y*-st;N+=at.invMLinN2Z*-st;F+=at.invMAngN1X*st;O+=at.invMAngN1Y*st;W+=at.invMAngN1Z*st;H+=at.invMAngN2X*-st;U+=at.invMAngN2Y*-st;J+=at.invMAngN2Z*-st}var et=this._b1;et._transform._positionX+=S;et._transform._positionY+=C;et._transform._positionZ+=q;var _t=this._b2;_t._transform._positionX+=E;_t._transform._positionY+=j;_t._transform._positionZ+=N;var vt=this._b1;var ht=Math.sqrt(F*F+O*O+W*W);var lt=ht*.5;var ct;var pt;if(lt<.5){var ft=lt*lt;ct=.5*(1-ft*.16666666666666666+ft*ft*.008333333333333333);pt=1-ft*.5+ft*ft*.041666666666666664}else{ct=Math.sin(lt)/ht;pt=Math.cos(lt)}var mt;var bt;var ut;var xt;bt=F*ct;ut=O*ct;xt=W*ct;var yt;var gt;var Xt;var zt;var Mt;gt=bt;Xt=ut;zt=xt;Mt=pt;var Yt;var Zt;var dt;var It;var wt;var Vt=vt._transform._rotation00;var Lt=vt._transform._rotation11;var At=vt._transform._rotation22;var kt=Vt+Lt+At;var Bt;if(kt>0){Bt=Math.sqrt(kt+1);wt=.5*Bt;Bt=.5/Bt;Zt=(vt._transform._rotation21-vt._transform._rotation12)*Bt;dt=(vt._transform._rotation02-vt._transform._rotation20)*Bt;It=(vt._transform._rotation10-vt._transform._rotation01)*Bt}else if(Vt>Lt){if(Vt>At){Bt=Math.sqrt(Vt-Lt-At+1);Zt=.5*Bt;Bt=.5/Bt;dt=(vt._transform._rotation01+vt._transform._rotation10)*Bt;It=(vt._transform._rotation02+vt._transform._rotation20)*Bt;wt=(vt._transform._rotation21-vt._transform._rotation12)*Bt}else{Bt=Math.sqrt(At-Vt-Lt+1);It=.5*Bt;Bt=.5/Bt;Zt=(vt._transform._rotation02+vt._transform._rotation20)*Bt;dt=(vt._transform._rotation12+vt._transform._rotation21)*Bt;wt=(vt._transform._rotation10-vt._transform._rotation01)*Bt}}else if(Lt>At){Bt=Math.sqrt(Lt-At-Vt+1);dt=.5*Bt;Bt=.5/Bt;Zt=(vt._transform._rotation01+vt._transform._rotation10)*Bt;It=(vt._transform._rotation12+vt._transform._rotation21)*Bt;wt=(vt._transform._rotation02-vt._transform._rotation20)*Bt}else{Bt=Math.sqrt(At-Vt-Lt+1);It=.5*Bt;Bt=.5/Bt;Zt=(vt._transform._rotation02+vt._transform._rotation20)*Bt;dt=(vt._transform._rotation12+vt._transform._rotation21)*Bt;wt=(vt._transform._rotation10-vt._transform._rotation01)*Bt}Zt=Mt*Zt+gt*wt+Xt*It-zt*dt;dt=Mt*dt-gt*It+Xt*wt+zt*Zt;It=Mt*It+gt*dt-Xt*Zt+zt*wt;wt=Mt*wt-gt*Zt-Xt*dt-zt*It;var Pt=Zt*Zt+dt*dt+It*It+wt*wt;if(Pt>1e-32){Pt=1/Math.sqrt(Pt)}Zt*=Pt;dt*=Pt;It*=Pt;wt*=Pt;var Tt=Zt;var St=dt;var Ct=It;var qt=wt;var Rt=2*Tt;var Et=2*St;var jt=2*Ct;var Nt=Tt*Rt;var Dt=St*Et;var Ft=Ct*jt;var Ot=Tt*Et;var Wt=St*jt;var Gt=Tt*jt;var Ht=qt*Rt;var Ut=qt*Et;var Jt=qt*jt;vt._transform._rotation00=1-Dt-Ft;vt._transform._rotation01=Ot-Jt;vt._transform._rotation02=Gt+Ut;vt._transform._rotation10=Ot+Jt;vt._transform._rotation11=1-Nt-Ft;vt._transform._rotation12=Wt-Ht;vt._transform._rotation20=Gt-Ut;vt._transform._rotation21=Wt+Ht;vt._transform._rotation22=1-Nt-Dt;var Qt;var $t;var Kt;var ta;var aa;var ia;var ra;var oa;var sa;Qt=vt._transform._rotation00*vt._invLocalInertia00+vt._transform._rotation01*vt._invLocalInertia10+vt._transform._rotation02*vt._invLocalInertia20;$t=vt._transform._rotation00*vt._invLocalInertia01+vt._transform._rotation01*vt._invLocalInertia11+vt._transform._rotation02*vt._invLocalInertia21;Kt=vt._transform._rotation00*vt._invLocalInertia02+vt._transform._rotation01*vt._invLocalInertia12+vt._transform._rotation02*vt._invLocalInertia22;ta=vt._transform._rotation10*vt._invLocalInertia00+vt._transform._rotation11*vt._invLocalInertia10+vt._transform._rotation12*vt._invLocalInertia20;aa=vt._transform._rotation10*vt._invLocalInertia01+vt._transform._rotation11*vt._invLocalInertia11+vt._transform._rotation12*vt._invLocalInertia21;ia=vt._transform._rotation10*vt._invLocalInertia02+vt._transform._rotation11*vt._invLocalInertia12+vt._transform._rotation12*vt._invLocalInertia22;ra=vt._transform._rotation20*vt._invLocalInertia00+vt._transform._rotation21*vt._invLocalInertia10+vt._transform._rotation22*vt._invLocalInertia20;oa=vt._transform._rotation20*vt._invLocalInertia01+vt._transform._rotation21*vt._invLocalInertia11+vt._transform._rotation22*vt._invLocalInertia21;sa=vt._transform._rotation20*vt._invLocalInertia02+vt._transform._rotation21*vt._invLocalInertia12+vt._transform._rotation22*vt._invLocalInertia22;vt._invInertia00=Qt;vt._invInertia01=$t;vt._invInertia02=Kt;vt._invInertia10=ta;vt._invInertia11=aa;vt._invInertia12=ia;vt._invInertia20=ra;vt._invInertia21=oa;vt._invInertia22=sa;var na;var ea;var _a;var va;var ha;var la;var ca;var pa;var fa;na=vt._invInertia00*vt._transform._rotation00+vt._invInertia01*vt._transform._rotation01+vt._invInertia02*vt._transform._rotation02;ea=vt._invInertia00*vt._transform._rotation10+vt._invInertia01*vt._transform._rotation11+vt._invInertia02*vt._transform._rotation12;_a=vt._invInertia00*vt._transform._rotation20+vt._invInertia01*vt._transform._rotation21+vt._invInertia02*vt._transform._rotation22;va=vt._invInertia10*vt._transform._rotation00+vt._invInertia11*vt._transform._rotation01+vt._invInertia12*vt._transform._rotation02;ha=vt._invInertia10*vt._transform._rotation10+vt._invInertia11*vt._transform._rotation11+vt._invInertia12*vt._transform._rotation12;la=vt._invInertia10*vt._transform._rotation20+vt._invInertia11*vt._transform._rotation21+vt._invInertia12*vt._transform._rotation22;ca=vt._invInertia20*vt._transform._rotation00+vt._invInertia21*vt._transform._rotation01+vt._invInertia22*vt._transform._rotation02;pa=vt._invInertia20*vt._transform._rotation10+vt._invInertia21*vt._transform._rotation11+vt._invInertia22*vt._transform._rotation12;fa=vt._invInertia20*vt._transform._rotation20+vt._invInertia21*vt._transform._rotation21+vt._invInertia22*vt._transform._rotation22;vt._invInertia00=na;vt._invInertia01=ea;vt._invInertia02=_a;vt._invInertia10=va;vt._invInertia11=ha;vt._invInertia12=la;vt._invInertia20=ca;vt._invInertia21=pa;vt._invInertia22=fa;vt._invInertia00*=vt._rotFactor.x;vt._invInertia01*=vt._rotFactor.x;vt._invInertia02*=vt._rotFactor.x;vt._invInertia10*=vt._rotFactor.y;vt._invInertia11*=vt._rotFactor.y;vt._invInertia12*=vt._rotFactor.y;vt._invInertia20*=vt._rotFactor.z;vt._invInertia21*=vt._rotFactor.z;vt._invInertia22*=vt._rotFactor.z;var ma=this._b2;var ba=Math.sqrt(H*H+U*U+J*J);var ua=ba*.5;var xa;var ya;if(ua<.5){var ga=ua*ua;xa=.5*(1-ga*.16666666666666666+ga*ga*.008333333333333333);ya=1-ga*.5+ga*ga*.041666666666666664}else{xa=Math.sin(ua)/ba;ya=Math.cos(ua)}var Xa;var za;var Ma;var Ya;za=H*xa;Ma=U*xa;Ya=J*xa;var Za;var da;var Ia;var wa;var Va;da=za;Ia=Ma;wa=Ya;Va=ya;var La;var Aa;var ka;var Ba;var Pa;var Ta=ma._transform._rotation00;var Sa=ma._transform._rotation11;var Ca=ma._transform._rotation22;var qa=Ta+Sa+Ca;var Ra;if(qa>0){Ra=Math.sqrt(qa+1);Pa=.5*Ra;Ra=.5/Ra;Aa=(ma._transform._rotation21-ma._transform._rotation12)*Ra;ka=(ma._transform._rotation02-ma._transform._rotation20)*Ra;Ba=(ma._transform._rotation10-ma._transform._rotation01)*Ra}else if(Ta>Sa){if(Ta>Ca){Ra=Math.sqrt(Ta-Sa-Ca+1);Aa=.5*Ra;Ra=.5/Ra;ka=(ma._transform._rotation01+ma._transform._rotation10)*Ra;Ba=(ma._transform._rotation02+ma._transform._rotation20)*Ra;Pa=(ma._transform._rotation21-ma._transform._rotation12)*Ra}else{Ra=Math.sqrt(Ca-Ta-Sa+1);Ba=.5*Ra;Ra=.5/Ra;Aa=(ma._transform._rotation02+ma._transform._rotation20)*Ra;ka=(ma._transform._rotation12+ma._transform._rotation21)*Ra;Pa=(ma._transform._rotation10-ma._transform._rotation01)*Ra}}else if(Sa>Ca){Ra=Math.sqrt(Sa-Ca-Ta+1);ka=.5*Ra;Ra=.5/Ra;Aa=(ma._transform._rotation01+ma._transform._rotation10)*Ra;Ba=(ma._transform._rotation12+ma._transform._rotation21)*Ra;Pa=(ma._transform._rotation02-ma._transform._rotation20)*Ra}else{Ra=Math.sqrt(Ca-Ta-Sa+1);Ba=.5*Ra;Ra=.5/Ra;Aa=(ma._transform._rotation02+ma._transform._rotation20)*Ra;ka=(ma._transform._rotation12+ma._transform._rotation21)*Ra;Pa=(ma._transform._rotation10-ma._transform._rotation01)*Ra}Aa=Va*Aa+da*Pa+Ia*Ba-wa*ka;ka=Va*ka-da*Ba+Ia*Pa+wa*Aa;Ba=Va*Ba+da*ka-Ia*Aa+wa*Pa;Pa=Va*Pa-da*Aa-Ia*ka-wa*Ba;var Ea=Aa*Aa+ka*ka+Ba*Ba+Pa*Pa;if(Ea>1e-32){Ea=1/Math.sqrt(Ea)}Aa*=Ea;ka*=Ea;Ba*=Ea;Pa*=Ea;var ja=Aa;var Na=ka;var Da=Ba;var Fa=Pa;var Oa=2*ja;var Wa=2*Na;var Ga=2*Da;var Ha=ja*Oa;var Ua=Na*Wa;var Ja=Da*Ga;var Qa=ja*Wa;var $a=Na*Ga;var Ka=ja*Ga;var ti=Fa*Oa;var ai=Fa*Wa;var ii=Fa*Ga;ma._transform._rotation00=1-Ua-Ja;ma._transform._rotation01=Qa-ii;ma._transform._rotation02=Ka+ai;ma._transform._rotation10=Qa+ii;ma._transform._rotation11=1-Ha-Ja;ma._transform._rotation12=$a-ti;ma._transform._rotation20=Ka-ai;ma._transform._rotation21=$a+ti;ma._transform._rotation22=1-Ha-Ua;var ri;var oi;var si;var ni;var ei;var _i;var vi;var hi;var li;ri=ma._transform._rotation00*ma._invLocalInertia00+ma._transform._rotation01*ma._invLocalInertia10+ma._transform._rotation02*ma._invLocalInertia20;oi=ma._transform._rotation00*ma._invLocalInertia01+ma._transform._rotation01*ma._invLocalInertia11+ma._transform._rotation02*ma._invLocalInertia21;si=ma._transform._rotation00*ma._invLocalInertia02+ma._transform._rotation01*ma._invLocalInertia12+ma._transform._rotation02*ma._invLocalInertia22;ni=ma._transform._rotation10*ma._invLocalInertia00+ma._transform._rotation11*ma._invLocalInertia10+ma._transform._rotation12*ma._invLocalInertia20;ei=ma._transform._rotation10*ma._invLocalInertia01+ma._transform._rotation11*ma._invLocalInertia11+ma._transform._rotation12*ma._invLocalInertia21;_i=ma._transform._rotation10*ma._invLocalInertia02+ma._transform._rotation11*ma._invLocalInertia12+ma._transform._rotation12*ma._invLocalInertia22;vi=ma._transform._rotation20*ma._invLocalInertia00+ma._transform._rotation21*ma._invLocalInertia10+ma._transform._rotation22*ma._invLocalInertia20;hi=ma._transform._rotation20*ma._invLocalInertia01+ma._transform._rotation21*ma._invLocalInertia11+ma._transform._rotation22*ma._invLocalInertia21;li=ma._transform._rotation20*ma._invLocalInertia02+ma._transform._rotation21*ma._invLocalInertia12+ma._transform._rotation22*ma._invLocalInertia22;ma._invInertia00=ri;ma._invInertia01=oi;ma._invInertia02=si;ma._invInertia10=ni;ma._invInertia11=ei;ma._invInertia12=_i;ma._invInertia20=vi;ma._invInertia21=hi;ma._invInertia22=li;var ci;var pi;var fi;var mi;var bi;var ui;var xi;var yi;var gi;ci=ma._invInertia00*ma._transform._rotation00+ma._invInertia01*ma._transform._rotation01+ma._invInertia02*ma._transform._rotation02;pi=ma._invInertia00*ma._transform._rotation10+ma._invInertia01*ma._transform._rotation11+ma._invInertia02*ma._transform._rotation12;fi=ma._invInertia00*ma._transform._rotation20+ma._invInertia01*ma._transform._rotation21+ma._invInertia02*ma._transform._rotation22;mi=ma._invInertia10*ma._transform._rotation00+ma._invInertia11*ma._transform._rotation01+ma._invInertia12*ma._transform._rotation02;bi=ma._invInertia10*ma._transform._rotation10+ma._invInertia11*ma._transform._rotation11+ma._invInertia12*ma._transform._rotation12;ui=ma._invInertia10*ma._transform._rotation20+ma._invInertia11*ma._transform._rotation21+ma._invInertia12*ma._transform._rotation22;xi=ma._invInertia20*ma._transform._rotation00+ma._invInertia21*ma._transform._rotation01+ma._invInertia22*ma._transform._rotation02;yi=ma._invInertia20*ma._transform._rotation10+ma._invInertia21*ma._transform._rotation11+ma._invInertia22*ma._transform._rotation12;gi=ma._invInertia20*ma._transform._rotation20+ma._invInertia21*ma._transform._rotation21+ma._invInertia22*ma._transform._rotation22;ma._invInertia00=ci;ma._invInertia01=pi;ma._invInertia02=fi;ma._invInertia10=mi;ma._invInertia11=bi;ma._invInertia12=ui;ma._invInertia20=xi;ma._invInertia21=yi;ma._invInertia22=gi;ma._invInertia00*=ma._rotFactor.x;ma._invInertia01*=ma._rotFactor.x;ma._invInertia02*=ma._rotFactor.x;ma._invInertia10*=ma._rotFactor.y;ma._invInertia11*=ma._rotFactor.y;ma._invInertia12*=ma._rotFactor.y;ma._invInertia20*=ma._rotFactor.z;ma._invInertia21*=ma._rotFactor.z;ma._invInertia22*=ma._rotFactor.z},postSolve:function(){var t=0;var a=this.info.numRows;while(t<a){var i=t++;var r=this.info.rows[i];var o=r.impulse;var s=r.jacobianT;var n=r.jacobianB;var e;var _;var v;var h;_=0;v=0;h=0;_+=s.lin1X*o.impulseT;v+=s.lin1Y*o.impulseT;h+=s.lin1Z*o.impulseT;_+=n.lin1X*o.impulseB;v+=n.lin1Y*o.impulseB;h+=n.lin1Z*o.impulseB;o.impulseLX=_;o.impulseLY=v;o.impulseLZ=h}this.constraint._syncManifold()}});var Kt=function(t){ht.call(this);this.joint=t;this.info=new yt;var a=ys.maxJacobianRows;var i=new Array(a);this.massData=i;var r=0;var o=this.massData.length;while(r<o){var s=r++;this.massData[s]=new Ot}};Kt.__super__=ht;Kt.prototype=$extend(ht.prototype,{preSolveVelocity:function(t){this.joint._syncAnchors();this.joint._getVelocitySolverInfo(t,this.info);this._b1=this.info.b1;this._b2=this.info.b2;var a=this._b1._invMass;var i=this._b2._invMass;var r;var o;var s;var n;var e;var _;var v;var h;var l;var c;var p;var f;var m;var b;var u;var x;var y;var g;var X;var z;o=this._b1._invInertia00;s=this._b1._invInertia01;n=this._b1._invInertia02;e=this._b1._invInertia10;_=this._b1._invInertia11;v=this._b1._invInertia12;h=this._b1._invInertia20;l=this._b1._invInertia21;c=this._b1._invInertia22;f=this._b2._invInertia00;m=this._b2._invInertia01;b=this._b2._invInertia02;u=this._b2._invInertia10;x=this._b2._invInertia11;y=this._b2._invInertia12;g=this._b2._invInertia20;X=this._b2._invInertia21;z=this._b2._invInertia22;var M=0;var Y=this.info.numRows;while(M<Y){var Z=M++;var d=this.info.rows[Z];var I=this.massData[Z];var w=d.jacobian;w.updateSparsity();if((w.flag&1)!=0){I.invMLin1X=w.lin1X*a;I.invMLin1Y=w.lin1Y*a;I.invMLin1Z=w.lin1Z*a;I.invMLin2X=w.lin2X*i;I.invMLin2Y=w.lin2Y*i;I.invMLin2Z=w.lin2Z*i}else{I.invMLin1X=0;I.invMLin1Y=0;I.invMLin1Z=0;I.invMLin2X=0;I.invMLin2Y=0;I.invMLin2Z=0}if((w.flag&2)!=0){var V;var L;var A;V=o*w.ang1X+s*w.ang1Y+n*w.ang1Z;L=e*w.ang1X+_*w.ang1Y+v*w.ang1Z;A=h*w.ang1X+l*w.ang1Y+c*w.ang1Z;I.invMAng1X=V;I.invMAng1Y=L;I.invMAng1Z=A;var k;var B;var P;k=f*w.ang2X+m*w.ang2Y+b*w.ang2Z;B=u*w.ang2X+x*w.ang2Y+y*w.ang2Z;P=g*w.ang2X+X*w.ang2Y+z*w.ang2Z;I.invMAng2X=k;I.invMAng2Y=B;I.invMAng2Z=P}else{I.invMAng1X=0;I.invMAng1Y=0;I.invMAng1Z=0;I.invMAng2X=0;I.invMAng2Y=0;I.invMAng2Z=0}I.massWithoutCfm=I.invMLin1X*w.lin1X+I.invMLin1Y*w.lin1Y+I.invMLin1Z*w.lin1Z+(I.invMLin2X*w.lin2X+I.invMLin2Y*w.lin2Y+I.invMLin2Z*w.lin2Z)+(I.invMAng1X*w.ang1X+I.invMAng1Y*w.ang1Y+I.invMAng1Z*w.ang1Z)+(I.invMAng2X*w.ang2X+I.invMAng2Y*w.ang2Y+I.invMAng2Z*w.ang2Z);I.mass=I.massWithoutCfm+d.cfm;if(I.massWithoutCfm!=0){I.massWithoutCfm=1/I.massWithoutCfm}if(I.mass!=0){I.mass=1/I.mass}}},warmStart:function(t){var a=this.joint._positionCorrectionAlgorithm;var i=a==ka.BAUMGARTE?ys.jointWarmStartingFactorForBaungarte:ys.jointWarmStartingFactor;i*=t.dtRatio;if(i<=0){var r=0;var o=this.info.numRows;while(r<o){var s=r++;var n=this.info.rows[s];var e=n.impulse;e.impulse=0;e.impulseM=0;e.impulseP=0}return}var _;var v;var h;var l;var c;var p;var f;var m;var b;var u;var x;var y;var g;var X;var z;var M;v=this._b1._velX;h=this._b1._velY;l=this._b1._velZ;p=this._b2._velX;f=this._b2._velY;m=this._b2._velZ;u=this._b1._angVelX;x=this._b1._angVelY;y=this._b1._angVelZ;X=this._b2._angVelX;z=this._b2._angVelY;M=this._b2._angVelZ;var Y=0;var Z=this.info.numRows;while(Y<Z){var d=Y++;var I=this.info.rows[d];var w=this.massData[d];var V=I.impulse;var L=I.jacobian;V.impulse*=i;V.impulseM*=i;var A=V.impulse+V.impulseM;v+=w.invMLin1X*A;h+=w.invMLin1Y*A;l+=w.invMLin1Z*A;p+=w.invMLin2X*-A;f+=w.invMLin2Y*-A;m+=w.invMLin2Z*-A;u+=w.invMAng1X*A;x+=w.invMAng1Y*A;y+=w.invMAng1Z*A;X+=w.invMAng2X*-A;z+=w.invMAng2Y*-A;M+=w.invMAng2Z*-A}this._b1._velX=v;this._b1._velY=h;this._b1._velZ=l;this._b2._velX=p;this._b2._velY=f;this._b2._velZ=m;this._b1._angVelX=u;this._b1._angVelY=x;this._b1._angVelZ=y;this._b2._angVelX=X;this._b2._angVelY=z;this._b2._angVelZ=M},solveVelocity:function(){var t;var a;var i;var r;var o;var s;var n;var e;var _;var v;var h;var l;var c;var p;var f;var m;a=this._b1._velX;i=this._b1._velY;r=this._b1._velZ;s=this._b2._velX;n=this._b2._velY;e=this._b2._velZ;v=this._b1._angVelX;h=this._b1._angVelY;l=this._b1._angVelZ;p=this._b2._angVelX;f=this._b2._angVelY;m=this._b2._angVelZ;var b=0;var u=this.info.numRows;while(b<u){var x=b++;var y=this.info.rows[x];var g=this.massData[x];var X=y.impulse;var z=y.jacobian;if(y.motorMaxImpulse==0){continue}var M=0;M+=a*z.lin1X+i*z.lin1Y+r*z.lin1Z;M-=s*z.lin2X+n*z.lin2Y+e*z.lin2Z;M+=v*z.ang1X+h*z.ang1Y+l*z.ang1Z;M-=p*z.ang2X+f*z.ang2Y+m*z.ang2Z;var Y=(-y.motorSpeed-M)*g.massWithoutCfm;var Z=X.impulseM;X.impulseM+=Y;if(X.impulseM<-y.motorMaxImpulse){X.impulseM=-y.motorMaxImpulse}else if(X.impulseM>y.motorMaxImpulse){X.impulseM=y.motorMaxImpulse}Y=X.impulseM-Z;if((z.flag&1)!=0){a+=g.invMLin1X*Y;i+=g.invMLin1Y*Y;r+=g.invMLin1Z*Y;s+=g.invMLin2X*-Y;n+=g.invMLin2Y*-Y;e+=g.invMLin2Z*-Y}if((z.flag&2)!=0){v+=g.invMAng1X*Y;h+=g.invMAng1Y*Y;l+=g.invMAng1Z*Y;p+=g.invMAng2X*-Y;f+=g.invMAng2Y*-Y;m+=g.invMAng2Z*-Y}}var d=0;var I=this.info.numRows;while(d<I){var w=d++;var V=this.info.rows[w];var L=this.massData[w];var A=V.impulse;var k=V.jacobian;var B=0;B+=a*k.lin1X+i*k.lin1Y+r*k.lin1Z;B-=s*k.lin2X+n*k.lin2Y+e*k.lin2Z;B+=v*k.ang1X+h*k.ang1Y+l*k.ang1Z;B-=p*k.ang2X+f*k.ang2Y+m*k.ang2Z;var P=(V.rhs-B-A.impulse*V.cfm)*L.mass;var T=A.impulse;A.impulse+=P;if(A.impulse<V.minImpulse){A.impulse=V.minImpulse}else if(A.impulse>V.maxImpulse){A.impulse=V.maxImpulse}P=A.impulse-T;if((k.flag&1)!=0){a+=L.invMLin1X*P;i+=L.invMLin1Y*P;r+=L.invMLin1Z*P;s+=L.invMLin2X*-P;n+=L.invMLin2Y*-P;e+=L.invMLin2Z*-P}if((k.flag&2)!=0){v+=L.invMAng1X*P;h+=L.invMAng1Y*P;l+=L.invMAng1Z*P;p+=L.invMAng2X*-P;f+=L.invMAng2Y*-P;m+=L.invMAng2Z*-P}}this._b1._velX=a;this._b1._velY=i;this._b1._velZ=r;this._b2._velX=s;this._b2._velY=n;this._b2._velZ=e;this._b1._angVelX=v;this._b1._angVelY=h;this._b1._angVelZ=l;this._b2._angVelX=p;this._b2._angVelY=f;this._b2._angVelZ=m},postSolveVelocity:function(t){var a;var i;var r;var o;var s;var n;var e;var _;i=0;r=0;o=0;n=0;e=0;_=0;var v=0;var h=this.info.numRows;while(v<h){var l=v++;var c=this.info.rows[l];var p=c.impulse;var f=c.jacobian;if((f.flag&1)!=0){i+=f.lin1X*p.impulse;r+=f.lin1Y*p.impulse;o+=f.lin1Z*p.impulse}else if((f.flag&2)!=0){n+=f.ang1X*p.impulse;e+=f.ang1Y*p.impulse;_+=f.ang1Z*p.impulse}}this.joint._appliedForceX=i*t.invDt;this.joint._appliedForceY=r*t.invDt;this.joint._appliedForceZ=o*t.invDt;this.joint._appliedTorqueX=n*t.invDt;this.joint._appliedTorqueY=e*t.invDt;this.joint._appliedTorqueZ=_*t.invDt},preSolvePosition:function(t){this.joint._syncAnchors();this.joint._getPositionSolverInfo(this.info);this._b1=this.info.b1;this._b2=this.info.b2;var a=this._b1._invMass;var i=this._b2._invMass;var r;var o;var s;var n;var e;var _;var v;var h;var l;var c;var p;var f;var m;var b;var u;var x;var y;var g;var X;var z;o=this._b1._invInertia00;s=this._b1._invInertia01;n=this._b1._invInertia02;e=this._b1._invInertia10;_=this._b1._invInertia11;v=this._b1._invInertia12;h=this._b1._invInertia20;l=this._b1._invInertia21;c=this._b1._invInertia22;f=this._b2._invInertia00;m=this._b2._invInertia01;b=this._b2._invInertia02;u=this._b2._invInertia10;x=this._b2._invInertia11;y=this._b2._invInertia12;g=this._b2._invInertia20;X=this._b2._invInertia21;z=this._b2._invInertia22;var M=0;var Y=this.info.numRows;while(M<Y){var Z=M++;var d=this.info.rows[Z];var I=this.massData[Z];var w=d.impulse;var V=d.jacobian;I.invMLin1X=V.lin1X*a;I.invMLin1Y=V.lin1Y*a;I.invMLin1Z=V.lin1Z*a;I.invMLin2X=V.lin2X*i;I.invMLin2Y=V.lin2Y*i;I.invMLin2Z=V.lin2Z*i;var L;var A;var k;L=o*V.ang1X+s*V.ang1Y+n*V.ang1Z;A=e*V.ang1X+_*V.ang1Y+v*V.ang1Z;k=h*V.ang1X+l*V.ang1Y+c*V.ang1Z;I.invMAng1X=L;I.invMAng1Y=A;I.invMAng1Z=k;var B;var P;var T;B=f*V.ang2X+m*V.ang2Y+b*V.ang2Z;P=u*V.ang2X+x*V.ang2Y+y*V.ang2Z;T=g*V.ang2X+X*V.ang2Y+z*V.ang2Z;I.invMAng2X=B;I.invMAng2Y=P;I.invMAng2Z=T;I.mass=I.invMLin1X*V.lin1X+I.invMLin1Y*V.lin1Y+I.invMLin1Z*V.lin1Z+(I.invMLin2X*V.lin2X+I.invMLin2Y*V.lin2Y+I.invMLin2Z*V.lin2Z)+(I.invMAng1X*V.ang1X+I.invMAng1Y*V.ang1Y+I.invMAng1Z*V.ang1Z)+(I.invMAng2X*V.ang2X+I.invMAng2Y*V.ang2Y+I.invMAng2Z*V.ang2Z);if(I.mass!=0){I.mass=1/I.mass}}var S=0;var C=this.info.numRows;while(S<C){var q=S++;this.info.rows[q].impulse.impulseP=0}},solvePositionSplitImpulse:function(){var t;var a;var i;var r;var o;var s;var n;var e;var _;var v;var h;var l;var c;var p;var f;var m;a=this._b1._pseudoVelX;i=this._b1._pseudoVelY;r=this._b1._pseudoVelZ;s=this._b2._pseudoVelX;n=this._b2._pseudoVelY;e=this._b2._pseudoVelZ;v=this._b1._angPseudoVelX;h=this._b1._angPseudoVelY;l=this._b1._angPseudoVelZ;p=this._b2._angPseudoVelX;f=this._b2._angPseudoVelY;m=this._b2._angPseudoVelZ;var b=0;var u=this.info.numRows;while(b<u){var x=b++;var y=this.info.rows[x];var g=this.massData[x];var X=y.impulse;var z=y.jacobian;var M=0;M+=a*z.lin1X+i*z.lin1Y+r*z.lin1Z;M-=s*z.lin2X+n*z.lin2Y+e*z.lin2Z;M+=v*z.ang1X+h*z.ang1Y+l*z.ang1Z;M-=p*z.ang2X+f*z.ang2Y+m*z.ang2Z;var Y=(y.rhs*ys.positionSplitImpulseBaumgarte-M)*g.mass;var Z=X.impulseP;X.impulseP+=Y;if(X.impulseP<y.minImpulse){X.impulseP=y.minImpulse}else if(X.impulseP>y.maxImpulse){X.impulseP=y.maxImpulse}Y=X.impulseP-Z;a+=g.invMLin1X*Y;i+=g.invMLin1Y*Y;r+=g.invMLin1Z*Y;s+=g.invMLin2X*-Y;n+=g.invMLin2Y*-Y;e+=g.invMLin2Z*-Y;v+=g.invMAng1X*Y;h+=g.invMAng1Y*Y;l+=g.invMAng1Z*Y;p+=g.invMAng2X*-Y;f+=g.invMAng2Y*-Y;m+=g.invMAng2Z*-Y}this._b1._pseudoVelX=a;this._b1._pseudoVelY=i;this._b1._pseudoVelZ=r;this._b2._pseudoVelX=s;this._b2._pseudoVelY=n;this._b2._pseudoVelZ=e;this._b1._angPseudoVelX=v;this._b1._angPseudoVelY=h;this._b1._angPseudoVelZ=l;this._b2._angPseudoVelX=p;this._b2._angPseudoVelY=f;this._b2._angPseudoVelZ=m},solvePositionNgs:function(t){this.joint._syncAnchors();this.joint._getPositionSolverInfo(this.info);this._b1=this.info.b1;this._b2=this.info.b2;var a=this._b1._invMass;var i=this._b2._invMass;var r;var o;var s;var n;var e;var _;var v;var h;var l;var c;var p;var f;var m;var b;var u;var x;var y;var g;var X;var z;o=this._b1._invInertia00;s=this._b1._invInertia01;n=this._b1._invInertia02;e=this._b1._invInertia10;_=this._b1._invInertia11;v=this._b1._invInertia12;h=this._b1._invInertia20;l=this._b1._invInertia21;c=this._b1._invInertia22;f=this._b2._invInertia00;m=this._b2._invInertia01;b=this._b2._invInertia02;u=this._b2._invInertia10;x=this._b2._invInertia11;y=this._b2._invInertia12;g=this._b2._invInertia20;X=this._b2._invInertia21;z=this._b2._invInertia22;var M=0;var Y=this.info.numRows;while(M<Y){var Z=M++;var d=this.info.rows[Z];var I=this.massData[Z];var w=d.impulse;var V=d.jacobian;I.invMLin1X=V.lin1X*a;I.invMLin1Y=V.lin1Y*a;I.invMLin1Z=V.lin1Z*a;I.invMLin2X=V.lin2X*i;I.invMLin2Y=V.lin2Y*i;I.invMLin2Z=V.lin2Z*i;var L;var A;var k;L=o*V.ang1X+s*V.ang1Y+n*V.ang1Z;A=e*V.ang1X+_*V.ang1Y+v*V.ang1Z;k=h*V.ang1X+l*V.ang1Y+c*V.ang1Z;I.invMAng1X=L;I.invMAng1Y=A;I.invMAng1Z=k;var B;var P;var T;B=f*V.ang2X+m*V.ang2Y+b*V.ang2Z;P=u*V.ang2X+x*V.ang2Y+y*V.ang2Z;T=g*V.ang2X+X*V.ang2Y+z*V.ang2Z;I.invMAng2X=B;I.invMAng2Y=P;I.invMAng2Z=T;I.mass=I.invMLin1X*V.lin1X+I.invMLin1Y*V.lin1Y+I.invMLin1Z*V.lin1Z+(I.invMLin2X*V.lin2X+I.invMLin2Y*V.lin2Y+I.invMLin2Z*V.lin2Z)+(I.invMAng1X*V.ang1X+I.invMAng1Y*V.ang1Y+I.invMAng1Z*V.ang1Z)+(I.invMAng2X*V.ang2X+I.invMAng2Y*V.ang2Y+I.invMAng2Z*V.ang2Z);if(I.mass!=0){I.mass=1/I.mass}}var S;var C;var q;var R;var E;var j;var N;var D;var F;var O;var W;var G;var H;var U;var J;var Q;C=0;q=0;R=0;j=0;N=0;D=0;O=0;W=0;G=0;U=0;J=0;Q=0;var $=0;var K=this.info.numRows;while($<K){var tt=$++;var at=this.info.rows[tt];var it=this.massData[tt];var rt=at.impulse;var ot=at.jacobian;var st=0;st+=C*ot.lin1X+q*ot.lin1Y+R*ot.lin1Z;st-=j*ot.lin2X+N*ot.lin2Y+D*ot.lin2Z;st+=O*ot.ang1X+W*ot.ang1Y+G*ot.ang1Z;st-=U*ot.ang2X+J*ot.ang2Y+Q*ot.ang2Z;var nt=(at.rhs*ys.positionNgsBaumgarte-st)*it.mass;var et=rt.impulseP;rt.impulseP+=nt;if(rt.impulseP<at.minImpulse){rt.impulseP=at.minImpulse}else if(rt.impulseP>at.maxImpulse){rt.impulseP=at.maxImpulse}nt=rt.impulseP-et;C+=it.invMLin1X*nt;q+=it.invMLin1Y*nt;R+=it.invMLin1Z*nt;j+=it.invMLin2X*-nt;N+=it.invMLin2Y*-nt;D+=it.invMLin2Z*-nt;O+=it.invMAng1X*nt;W+=it.invMAng1Y*nt;G+=it.invMAng1Z*nt;U+=it.invMAng2X*-nt;J+=it.invMAng2Y*-nt;Q+=it.invMAng2Z*-nt}var _t=this._b1;_t._transform._positionX+=C;_t._transform._positionY+=q;_t._transform._positionZ+=R;var vt=this._b2;vt._transform._positionX+=j;vt._transform._positionY+=N;vt._transform._positionZ+=D;var ht=this._b1;var lt=Math.sqrt(O*O+W*W+G*G);var ct=lt*.5;var pt;var ft;if(ct<.5){var mt=ct*ct;pt=.5*(1-mt*.16666666666666666+mt*mt*.008333333333333333);ft=1-mt*.5+mt*mt*.041666666666666664}else{pt=Math.sin(ct)/lt;ft=Math.cos(ct)}var bt;var ut;var xt;var yt;ut=O*pt;xt=W*pt;yt=G*pt;var gt;var Xt;var zt;var Mt;var Yt;Xt=ut;zt=xt;Mt=yt;Yt=ft;var Zt;var dt;var It;var wt;var Vt;var Lt=ht._transform._rotation00;var At=ht._transform._rotation11;var kt=ht._transform._rotation22;var Bt=Lt+At+kt;var Pt;if(Bt>0){Pt=Math.sqrt(Bt+1);Vt=.5*Pt;Pt=.5/Pt;dt=(ht._transform._rotation21-ht._transform._rotation12)*Pt;It=(ht._transform._rotation02-ht._transform._rotation20)*Pt;wt=(ht._transform._rotation10-ht._transform._rotation01)*Pt}else if(Lt>At){if(Lt>kt){Pt=Math.sqrt(Lt-At-kt+1);dt=.5*Pt;Pt=.5/Pt;It=(ht._transform._rotation01+ht._transform._rotation10)*Pt;wt=(ht._transform._rotation02+ht._transform._rotation20)*Pt;Vt=(ht._transform._rotation21-ht._transform._rotation12)*Pt}else{Pt=Math.sqrt(kt-Lt-At+1);wt=.5*Pt;Pt=.5/Pt;dt=(ht._transform._rotation02+ht._transform._rotation20)*Pt;It=(ht._transform._rotation12+ht._transform._rotation21)*Pt;Vt=(ht._transform._rotation10-ht._transform._rotation01)*Pt}}else if(At>kt){Pt=Math.sqrt(At-kt-Lt+1);It=.5*Pt;Pt=.5/Pt;dt=(ht._transform._rotation01+ht._transform._rotation10)*Pt;wt=(ht._transform._rotation12+ht._transform._rotation21)*Pt;Vt=(ht._transform._rotation02-ht._transform._rotation20)*Pt}else{Pt=Math.sqrt(kt-Lt-At+1);wt=.5*Pt;Pt=.5/Pt;dt=(ht._transform._rotation02+ht._transform._rotation20)*Pt;It=(ht._transform._rotation12+ht._transform._rotation21)*Pt;Vt=(ht._transform._rotation10-ht._transform._rotation01)*Pt}dt=Yt*dt+Xt*Vt+zt*wt-Mt*It;It=Yt*It-Xt*wt+zt*Vt+Mt*dt;wt=Yt*wt+Xt*It-zt*dt+Mt*Vt;Vt=Yt*Vt-Xt*dt-zt*It-Mt*wt;var Tt=dt*dt+It*It+wt*wt+Vt*Vt;if(Tt>1e-32){Tt=1/Math.sqrt(Tt)}dt*=Tt;It*=Tt;wt*=Tt;Vt*=Tt;var St=dt;var Ct=It;var qt=wt;var Rt=Vt;var Et=2*St;var jt=2*Ct;var Nt=2*qt;var Dt=St*Et;var Ft=Ct*jt;var Ot=qt*Nt;var Wt=St*jt;var Gt=Ct*Nt;var Ht=St*Nt;var Ut=Rt*Et;var Jt=Rt*jt;var Qt=Rt*Nt;ht._transform._rotation00=1-Ft-Ot;ht._transform._rotation01=Wt-Qt;ht._transform._rotation02=Ht+Jt;ht._transform._rotation10=Wt+Qt;ht._transform._rotation11=1-Dt-Ot;ht._transform._rotation12=Gt-Ut;ht._transform._rotation20=Ht-Jt;ht._transform._rotation21=Gt+Ut;ht._transform._rotation22=1-Dt-Ft;var $t;var Kt;var ta;var aa;var ia;var ra;var oa;var sa;var na;$t=ht._transform._rotation00*ht._invLocalInertia00+ht._transform._rotation01*ht._invLocalInertia10+ht._transform._rotation02*ht._invLocalInertia20;Kt=ht._transform._rotation00*ht._invLocalInertia01+ht._transform._rotation01*ht._invLocalInertia11+ht._transform._rotation02*ht._invLocalInertia21;ta=ht._transform._rotation00*ht._invLocalInertia02+ht._transform._rotation01*ht._invLocalInertia12+ht._transform._rotation02*ht._invLocalInertia22;aa=ht._transform._rotation10*ht._invLocalInertia00+ht._transform._rotation11*ht._invLocalInertia10+ht._transform._rotation12*ht._invLocalInertia20;ia=ht._transform._rotation10*ht._invLocalInertia01+ht._transform._rotation11*ht._invLocalInertia11+ht._transform._rotation12*ht._invLocalInertia21;ra=ht._transform._rotation10*ht._invLocalInertia02+ht._transform._rotation11*ht._invLocalInertia12+ht._transform._rotation12*ht._invLocalInertia22;oa=ht._transform._rotation20*ht._invLocalInertia00+ht._transform._rotation21*ht._invLocalInertia10+ht._transform._rotation22*ht._invLocalInertia20;sa=ht._transform._rotation20*ht._invLocalInertia01+ht._transform._rotation21*ht._invLocalInertia11+ht._transform._rotation22*ht._invLocalInertia21;na=ht._transform._rotation20*ht._invLocalInertia02+ht._transform._rotation21*ht._invLocalInertia12+ht._transform._rotation22*ht._invLocalInertia22;ht._invInertia00=$t;ht._invInertia01=Kt;ht._invInertia02=ta;ht._invInertia10=aa;ht._invInertia11=ia;ht._invInertia12=ra;ht._invInertia20=oa;ht._invInertia21=sa;ht._invInertia22=na;var ea;var _a;var va;var ha;var la;var ca;var pa;var fa;var ma;ea=ht._invInertia00*ht._transform._rotation00+ht._invInertia01*ht._transform._rotation01+ht._invInertia02*ht._transform._rotation02;_a=ht._invInertia00*ht._transform._rotation10+ht._invInertia01*ht._transform._rotation11+ht._invInertia02*ht._transform._rotation12;va=ht._invInertia00*ht._transform._rotation20+ht._invInertia01*ht._transform._rotation21+ht._invInertia02*ht._transform._rotation22;ha=ht._invInertia10*ht._transform._rotation00+ht._invInertia11*ht._transform._rotation01+ht._invInertia12*ht._transform._rotation02;la=ht._invInertia10*ht._transform._rotation10+ht._invInertia11*ht._transform._rotation11+ht._invInertia12*ht._transform._rotation12;ca=ht._invInertia10*ht._transform._rotation20+ht._invInertia11*ht._transform._rotation21+ht._invInertia12*ht._transform._rotation22;pa=ht._invInertia20*ht._transform._rotation00+ht._invInertia21*ht._transform._rotation01+ht._invInertia22*ht._transform._rotation02;fa=ht._invInertia20*ht._transform._rotation10+ht._invInertia21*ht._transform._rotation11+ht._invInertia22*ht._transform._rotation12;ma=ht._invInertia20*ht._transform._rotation20+ht._invInertia21*ht._transform._rotation21+ht._invInertia22*ht._transform._rotation22;ht._invInertia00=ea;ht._invInertia01=_a;ht._invInertia02=va;ht._invInertia10=ha;ht._invInertia11=la;ht._invInertia12=ca;ht._invInertia20=pa;ht._invInertia21=fa;ht._invInertia22=ma;ht._invInertia00*=ht._rotFactor.x;ht._invInertia01*=ht._rotFactor.x;ht._invInertia02*=ht._rotFactor.x;ht._invInertia10*=ht._rotFactor.y;ht._invInertia11*=ht._rotFactor.y;ht._invInertia12*=ht._rotFactor.y;ht._invInertia20*=ht._rotFactor.z;ht._invInertia21*=ht._rotFactor.z;ht._invInertia22*=ht._rotFactor.z;var ba=this._b2;var ua=Math.sqrt(U*U+J*J+Q*Q);var xa=ua*.5;var ya;var ga;if(xa<.5){var Xa=xa*xa;ya=.5*(1-Xa*.16666666666666666+Xa*Xa*.008333333333333333);ga=1-Xa*.5+Xa*Xa*.041666666666666664}else{ya=Math.sin(xa)/ua;ga=Math.cos(xa)}var za;var Ma;var Ya;var Za;Ma=U*ya;Ya=J*ya;Za=Q*ya;var da;var Ia;var wa;var Va;var La;Ia=Ma;wa=Ya;Va=Za;La=ga;var Aa;var ka;var Ba;var Pa;var Ta;var Sa=ba._transform._rotation00;var Ca=ba._transform._rotation11;var qa=ba._transform._rotation22;var Ra=Sa+Ca+qa;var Ea;if(Ra>0){Ea=Math.sqrt(Ra+1);Ta=.5*Ea;Ea=.5/Ea;ka=(ba._transform._rotation21-ba._transform._rotation12)*Ea;Ba=(ba._transform._rotation02-ba._transform._rotation20)*Ea;Pa=(ba._transform._rotation10-ba._transform._rotation01)*Ea}else if(Sa>Ca){if(Sa>qa){Ea=Math.sqrt(Sa-Ca-qa+1);ka=.5*Ea;Ea=.5/Ea;Ba=(ba._transform._rotation01+ba._transform._rotation10)*Ea;Pa=(ba._transform._rotation02+ba._transform._rotation20)*Ea;Ta=(ba._transform._rotation21-ba._transform._rotation12)*Ea}else{Ea=Math.sqrt(qa-Sa-Ca+1);Pa=.5*Ea;Ea=.5/Ea;ka=(ba._transform._rotation02+ba._transform._rotation20)*Ea;Ba=(ba._transform._rotation12+ba._transform._rotation21)*Ea;Ta=(ba._transform._rotation10-ba._transform._rotation01)*Ea}}else if(Ca>qa){Ea=Math.sqrt(Ca-qa-Sa+1);Ba=.5*Ea;Ea=.5/Ea;ka=(ba._transform._rotation01+ba._transform._rotation10)*Ea;Pa=(ba._transform._rotation12+ba._transform._rotation21)*Ea;Ta=(ba._transform._rotation02-ba._transform._rotation20)*Ea}else{Ea=Math.sqrt(qa-Sa-Ca+1);Pa=.5*Ea;Ea=.5/Ea;ka=(ba._transform._rotation02+ba._transform._rotation20)*Ea;Ba=(ba._transform._rotation12+ba._transform._rotation21)*Ea;Ta=(ba._transform._rotation10-ba._transform._rotation01)*Ea}ka=La*ka+Ia*Ta+wa*Pa-Va*Ba;Ba=La*Ba-Ia*Pa+wa*Ta+Va*ka;Pa=La*Pa+Ia*Ba-wa*ka+Va*Ta;Ta=La*Ta-Ia*ka-wa*Ba-Va*Pa;var ja=ka*ka+Ba*Ba+Pa*Pa+Ta*Ta;if(ja>1e-32){ja=1/Math.sqrt(ja)}ka*=ja;Ba*=ja;Pa*=ja;Ta*=ja;var Na=ka;var Da=Ba;var Fa=Pa;var Oa=Ta;var Wa=2*Na;var Ga=2*Da;var Ha=2*Fa;var Ua=Na*Wa;var Ja=Da*Ga;var Qa=Fa*Ha;var $a=Na*Ga;var Ka=Da*Ha;var ti=Na*Ha;var ai=Oa*Wa;var ii=Oa*Ga;var ri=Oa*Ha;ba._transform._rotation00=1-Ja-Qa;ba._transform._rotation01=$a-ri;ba._transform._rotation02=ti+ii;ba._transform._rotation10=$a+ri;ba._transform._rotation11=1-Ua-Qa;ba._transform._rotation12=Ka-ai;ba._transform._rotation20=ti-ii;ba._transform._rotation21=Ka+ai;ba._transform._rotation22=1-Ua-Ja;var oi;var si;var ni;var ei;var _i;var vi;var hi;var li;var ci;oi=ba._transform._rotation00*ba._invLocalInertia00+ba._transform._rotation01*ba._invLocalInertia10+ba._transform._rotation02*ba._invLocalInertia20;si=ba._transform._rotation00*ba._invLocalInertia01+ba._transform._rotation01*ba._invLocalInertia11+ba._transform._rotation02*ba._invLocalInertia21;ni=ba._transform._rotation00*ba._invLocalInertia02+ba._transform._rotation01*ba._invLocalInertia12+ba._transform._rotation02*ba._invLocalInertia22;ei=ba._transform._rotation10*ba._invLocalInertia00+ba._transform._rotation11*ba._invLocalInertia10+ba._transform._rotation12*ba._invLocalInertia20;_i=ba._transform._rotation10*ba._invLocalInertia01+ba._transform._rotation11*ba._invLocalInertia11+ba._transform._rotation12*ba._invLocalInertia21;vi=ba._transform._rotation10*ba._invLocalInertia02+ba._transform._rotation11*ba._invLocalInertia12+ba._transform._rotation12*ba._invLocalInertia22;hi=ba._transform._rotation20*ba._invLocalInertia00+ba._transform._rotation21*ba._invLocalInertia10+ba._transform._rotation22*ba._invLocalInertia20;li=ba._transform._rotation20*ba._invLocalInertia01+ba._transform._rotation21*ba._invLocalInertia11+ba._transform._rotation22*ba._invLocalInertia21;ci=ba._transform._rotation20*ba._invLocalInertia02+ba._transform._rotation21*ba._invLocalInertia12+ba._transform._rotation22*ba._invLocalInertia22;ba._invInertia00=oi;ba._invInertia01=si;ba._invInertia02=ni;ba._invInertia10=ei;ba._invInertia11=_i;ba._invInertia12=vi;ba._invInertia20=hi;ba._invInertia21=li;ba._invInertia22=ci;var pi;var fi;var mi;var bi;var ui;var xi;var yi;var gi;var Xi;pi=ba._invInertia00*ba._transform._rotation00+ba._invInertia01*ba._transform._rotation01+ba._invInertia02*ba._transform._rotation02;fi=ba._invInertia00*ba._transform._rotation10+ba._invInertia01*ba._transform._rotation11+ba._invInertia02*ba._transform._rotation12;mi=ba._invInertia00*ba._transform._rotation20+ba._invInertia01*ba._transform._rotation21+ba._invInertia02*ba._transform._rotation22;bi=ba._invInertia10*ba._transform._rotation00+ba._invInertia11*ba._transform._rotation01+ba._invInertia12*ba._transform._rotation02;ui=ba._invInertia10*ba._transform._rotation10+ba._invInertia11*ba._transform._rotation11+ba._invInertia12*ba._transform._rotation12;xi=ba._invInertia10*ba._transform._rotation20+ba._invInertia11*ba._transform._rotation21+ba._invInertia12*ba._transform._rotation22;yi=ba._invInertia20*ba._transform._rotation00+ba._invInertia21*ba._transform._rotation01+ba._invInertia22*ba._transform._rotation02;gi=ba._invInertia20*ba._transform._rotation10+ba._invInertia21*ba._transform._rotation11+ba._invInertia22*ba._transform._rotation12;Xi=ba._invInertia20*ba._transform._rotation20+ba._invInertia21*ba._transform._rotation21+ba._invInertia22*ba._transform._rotation22;ba._invInertia00=pi;ba._invInertia01=fi;ba._invInertia02=mi;ba._invInertia10=bi;ba._invInertia11=ui;ba._invInertia12=xi;ba._invInertia20=yi;ba._invInertia21=gi;ba._invInertia22=Xi;ba._invInertia00*=ba._rotFactor.x;ba._invInertia01*=ba._rotFactor.x;ba._invInertia02*=ba._rotFactor.x;ba._invInertia10*=ba._rotFactor.y;ba._invInertia11*=ba._rotFactor.y;ba._invInertia12*=ba._rotFactor.y;ba._invInertia20*=ba._rotFactor.z;ba._invInertia21*=ba._rotFactor.z;ba._invInertia22*=ba._rotFactor.z},postSolve:function(){this.joint._syncAnchors();this.joint._checkDestruction()}});var ta=function(){this.mass=0;this.localInertia=new ws};var aa=function(t){this._next=null;this._prev=null;this._shapeList=null;this._shapeListLast=null;this._numShapes=0;this._contactLinkList=null;this._contactLinkListLast=null;this._numContactLinks=0;this._jointLinkList=null;this._jointLinkListLast=null;this._numJointLinks=0;var a=t.linearVelocity;this._velX=a.x;this._velY=a.y;this._velZ=a.z;var i=t.angularVelocity;this._angVelX=i.x;this._angVelY=i.y;this._angVelZ=i.z;this._pseudoVelX=0;this._pseudoVelY=0;this._pseudoVelZ=0;this._angPseudoVelX=0;this._angPseudoVelY=0;this._angPseudoVelZ=0;this._ptransform=new j;this._transform=new j;var r=t.position;this._ptransform._positionX=r.x;this._ptransform._positionY=r.y;this._ptransform._positionZ=r.z;var o=t.rotation;this._ptransform._rotation00=o.e00;this._ptransform._rotation01=o.e01;this._ptransform._rotation02=o.e02;this._ptransform._rotation10=o.e10;this._ptransform._rotation11=o.e11;this._ptransform._rotation12=o.e12;this._ptransform._rotation20=o.e20;this._ptransform._rotation21=o.e21;this._ptransform._rotation22=o.e22;var s=this._transform;var n=this._ptransform;s._positionX=n._positionX;s._positionY=n._positionY;s._positionZ=n._positionZ;s._rotation00=n._rotation00;s._rotation01=n._rotation01;s._rotation02=n._rotation02;s._rotation10=n._rotation10;s._rotation11=n._rotation11;s._rotation12=n._rotation12;s._rotation20=n._rotation20;s._rotation21=n._rotation21;s._rotation22=n._rotation22;this._type=t.type;this._sleepTime=0;this._sleeping=false;this._autoSleep=t.autoSleep;this._mass=0;this._invMass=0;this._localInertia00=0;this._localInertia01=0;this._localInertia02=0;this._localInertia10=0;this._localInertia11=0;this._localInertia12=0;this._localInertia20=0;this._localInertia21=0;this._localInertia22=0;this._invLocalInertia00=0;this._invLocalInertia01=0;this._invLocalInertia02=0;this._invLocalInertia10=0;this._invLocalInertia11=0;this._invLocalInertia12=0;this._invLocalInertia20=0;this._invLocalInertia21=0;this._invLocalInertia22=0;this._invLocalInertiaWithoutRotFactor00=0;this._invLocalInertiaWithoutRotFactor01=0;this._invLocalInertiaWithoutRotFactor02=0;this._invLocalInertiaWithoutRotFactor10=0;this._invLocalInertiaWithoutRotFactor11=0;this._invLocalInertiaWithoutRotFactor12=0;this._invLocalInertiaWithoutRotFactor20=0;this._invLocalInertiaWithoutRotFactor21=0;this._invLocalInertiaWithoutRotFactor22=0;this._invInertia00=0;this._invInertia01=0;this._invInertia02=0;this._invInertia10=0;this._invInertia11=0;this._invInertia12=0;this._invInertia20=0;this._invInertia21=0;this._invInertia22=0;this._linearDamping=t.linearDamping;this._angularDamping=t.angularDamping;this._forceX=0;this._forceY=0;this._forceZ=0;this._torqueX=0;this._torqueY=0;this._torqueZ=0;this._rotFactor=new Is(1,1,1);this._addedToIsland=false;this._gravityScale=1;this._world=null};aa.prototype={_integrate:function(t){var a=this._type;switch(a){case 1:this._velX=0;this._velY=0;this._velZ=0;this._angVelX=0;this._angVelY=0;this._angVelZ=0;this._pseudoVelX=0;this._pseudoVelY=0;this._pseudoVelZ=0;this._angPseudoVelX=0;this._angPseudoVelY=0;this._angPseudoVelZ=0;break;case 0:case 2:var i;var r;var o;var s;var n;var e;var _;var v;r=this._velX*t;o=this._velY*t;s=this._velZ*t;e=this._angVelX*t;_=this._angVelY*t;v=this._angVelZ*t;var h=r*r+o*o+s*s;var l=e*e+_*_+v*v;if(h==0&&l==0){return}if(h>ys.maxTranslationPerStep*ys.maxTranslationPerStep){var c=ys.maxTranslationPerStep/Math.sqrt(h);this._velX*=c;this._velY*=c;this._velZ*=c;r*=c;o*=c;s*=c}if(l>ys.maxRotationPerStep*ys.maxRotationPerStep){var p=ys.maxRotationPerStep/Math.sqrt(l);this._angVelX*=p;this._angVelY*=p;this._angVelZ*=p;e*=p;_*=p;v*=p}this._transform._positionX+=r;this._transform._positionY+=o;this._transform._positionZ+=s;var f=Math.sqrt(e*e+_*_+v*v);var m=f*.5;var b;var u;if(m<.5){var x=m*m;b=.5*(1-x*.16666666666666666+x*x*.008333333333333333);u=1-x*.5+x*x*.041666666666666664}else{b=Math.sin(m)/f;u=Math.cos(m)}var y;var g;var X;var z;g=e*b;X=_*b;z=v*b;var M;var Y;var Z;var d;var I;Y=g;Z=X;d=z;I=u;var w;var V;var L;var A;var k;var B=this._transform._rotation00;var P=this._transform._rotation11;var T=this._transform._rotation22;var S=B+P+T;var C;if(S>0){C=Math.sqrt(S+1);k=.5*C;C=.5/C;V=(this._transform._rotation21-this._transform._rotation12)*C;L=(this._transform._rotation02-this._transform._rotation20)*C;A=(this._transform._rotation10-this._transform._rotation01)*C}else if(B>P){if(B>T){C=Math.sqrt(B-P-T+1);V=.5*C;C=.5/C;L=(this._transform._rotation01+this._transform._rotation10)*C;A=(this._transform._rotation02+this._transform._rotation20)*C;k=(this._transform._rotation21-this._transform._rotation12)*C}else{C=Math.sqrt(T-B-P+1);A=.5*C;C=.5/C;V=(this._transform._rotation02+this._transform._rotation20)*C;L=(this._transform._rotation12+this._transform._rotation21)*C;k=(this._transform._rotation10-this._transform._rotation01)*C}}else if(P>T){C=Math.sqrt(P-T-B+1);L=.5*C;C=.5/C;V=(this._transform._rotation01+this._transform._rotation10)*C;A=(this._transform._rotation12+this._transform._rotation21)*C;k=(this._transform._rotation02-this._transform._rotation20)*C}else{C=Math.sqrt(T-B-P+1);A=.5*C;C=.5/C;V=(this._transform._rotation02+this._transform._rotation20)*C;L=(this._transform._rotation12+this._transform._rotation21)*C;k=(this._transform._rotation10-this._transform._rotation01)*C}V=I*V+Y*k+Z*A-d*L;L=I*L-Y*A+Z*k+d*V;A=I*A+Y*L-Z*V+d*k;k=I*k-Y*V-Z*L-d*A;var q=V*V+L*L+A*A+k*k;if(q>1e-32){q=1/Math.sqrt(q)}V*=q;L*=q;A*=q;k*=q;var R=V;var E=L;var j=A;var N=k;var D=2*R;var F=2*E;var O=2*j;var W=R*D;var G=E*F;var H=j*O;var U=R*F;var J=E*O;var Q=R*O;var $=N*D;var K=N*F;var tt=N*O;this._transform._rotation00=1-G-H;this._transform._rotation01=U-tt;this._transform._rotation02=Q+K;this._transform._rotation10=U+tt;this._transform._rotation11=1-W-H;this._transform._rotation12=J-$;this._transform._rotation20=Q-K;this._transform._rotation21=J+$;this._transform._rotation22=1-W-G;var at;var it;var rt;var ot;var st;var nt;var et;var _t;var vt;at=this._transform._rotation00*this._invLocalInertia00+this._transform._rotation01*this._invLocalInertia10+this._transform._rotation02*this._invLocalInertia20;it=this._transform._rotation00*this._invLocalInertia01+this._transform._rotation01*this._invLocalInertia11+this._transform._rotation02*this._invLocalInertia21;rt=this._transform._rotation00*this._invLocalInertia02+this._transform._rotation01*this._invLocalInertia12+this._transform._rotation02*this._invLocalInertia22;ot=this._transform._rotation10*this._invLocalInertia00+this._transform._rotation11*this._invLocalInertia10+this._transform._rotation12*this._invLocalInertia20;st=this._transform._rotation10*this._invLocalInertia01+this._transform._rotation11*this._invLocalInertia11+this._transform._rotation12*this._invLocalInertia21;nt=this._transform._rotation10*this._invLocalInertia02+this._transform._rotation11*this._invLocalInertia12+this._transform._rotation12*this._invLocalInertia22;et=this._transform._rotation20*this._invLocalInertia00+this._transform._rotation21*this._invLocalInertia10+this._transform._rotation22*this._invLocalInertia20;_t=this._transform._rotation20*this._invLocalInertia01+this._transform._rotation21*this._invLocalInertia11+this._transform._rotation22*this._invLocalInertia21;vt=this._transform._rotation20*this._invLocalInertia02+this._transform._rotation21*this._invLocalInertia12+this._transform._rotation22*this._invLocalInertia22;this._invInertia00=at;this._invInertia01=it;this._invInertia02=rt;this._invInertia10=ot;this._invInertia11=st;this._invInertia12=nt;this._invInertia20=et;this._invInertia21=_t;this._invInertia22=vt;var ht;var lt;var ct;var pt;var ft;var mt;var bt;var ut;var xt;ht=this._invInertia00*this._transform._rotation00+this._invInertia01*this._transform._rotation01+this._invInertia02*this._transform._rotation02;lt=this._invInertia00*this._transform._rotation10+this._invInertia01*this._transform._rotation11+this._invInertia02*this._transform._rotation12;ct=this._invInertia00*this._transform._rotation20+this._invInertia01*this._transform._rotation21+this._invInertia02*this._transform._rotation22;pt=this._invInertia10*this._transform._rotation00+this._invInertia11*this._transform._rotation01+this._invInertia12*this._transform._rotation02;ft=this._invInertia10*this._transform._rotation10+this._invInertia11*this._transform._rotation11+this._invInertia12*this._transform._rotation12;mt=this._invInertia10*this._transform._rotation20+this._invInertia11*this._transform._rotation21+this._invInertia12*this._transform._rotation22;bt=this._invInertia20*this._transform._rotation00+this._invInertia21*this._transform._rotation01+this._invInertia22*this._transform._rotation02;ut=this._invInertia20*this._transform._rotation10+this._invInertia21*this._transform._rotation11+this._invInertia22*this._transform._rotation12;xt=this._invInertia20*this._transform._rotation20+this._invInertia21*this._transform._rotation21+this._invInertia22*this._transform._rotation22;this._invInertia00=ht;this._invInertia01=lt;this._invInertia02=ct;this._invInertia10=pt;this._invInertia11=ft;this._invInertia12=mt;this._invInertia20=bt;this._invInertia21=ut;this._invInertia22=xt;this._invInertia00*=this._rotFactor.x;this._invInertia01*=this._rotFactor.x;this._invInertia02*=this._rotFactor.x;this._invInertia10*=this._rotFactor.y;this._invInertia11*=this._rotFactor.y;this._invInertia12*=this._rotFactor.y;this._invInertia20*=this._rotFactor.z;this._invInertia21*=this._rotFactor.z;this._invInertia22*=this._rotFactor.z;break}},_integratePseudoVelocity:function(){var t=this._pseudoVelX*this._pseudoVelX+this._pseudoVelY*this._pseudoVelY+this._pseudoVelZ*this._pseudoVelZ;var a=this._angPseudoVelX*this._angPseudoVelX+this._angPseudoVelY*this._angPseudoVelY+this._angPseudoVelZ*this._angPseudoVelZ;if(t==0&&a==0){return}var i=this._type;switch(i){case 1:this._pseudoVelX=0;this._pseudoVelY=0;this._pseudoVelZ=0;this._angPseudoVelX=0;this._angPseudoVelY=0;this._angPseudoVelZ=0;break;case 0:case 2:var r;var o;var s;var n;var e;var _;var v;var h;o=this._pseudoVelX;s=this._pseudoVelY;n=this._pseudoVelZ;_=this._angPseudoVelX;v=this._angPseudoVelY;h=this._angPseudoVelZ;this._pseudoVelX=0;this._pseudoVelY=0;this._pseudoVelZ=0;this._angPseudoVelX=0;this._angPseudoVelY=0;this._angPseudoVelZ=0;this._transform._positionX+=o;this._transform._positionY+=s;this._transform._positionZ+=n;var l=Math.sqrt(_*_+v*v+h*h);var c=l*.5;var p;var f;if(c<.5){var m=c*c;p=.5*(1-m*.16666666666666666+m*m*.008333333333333333);f=1-m*.5+m*m*.041666666666666664}else{p=Math.sin(c)/l;f=Math.cos(c)}var b;var u;var x;var y;u=_*p;x=v*p;y=h*p;var g;var X;var z;var M;var Y;X=u;z=x;M=y;Y=f;var Z;var d;var I;var w;var V;var L=this._transform._rotation00;var A=this._transform._rotation11;var k=this._transform._rotation22;var B=L+A+k;var P;if(B>0){P=Math.sqrt(B+1);V=.5*P;P=.5/P;d=(this._transform._rotation21-this._transform._rotation12)*P;I=(this._transform._rotation02-this._transform._rotation20)*P;w=(this._transform._rotation10-this._transform._rotation01)*P}else if(L>A){if(L>k){P=Math.sqrt(L-A-k+1);d=.5*P;P=.5/P;I=(this._transform._rotation01+this._transform._rotation10)*P;w=(this._transform._rotation02+this._transform._rotation20)*P;V=(this._transform._rotation21-this._transform._rotation12)*P}else{P=Math.sqrt(k-L-A+1);w=.5*P;P=.5/P;d=(this._transform._rotation02+this._transform._rotation20)*P;I=(this._transform._rotation12+this._transform._rotation21)*P;V=(this._transform._rotation10-this._transform._rotation01)*P}}else if(A>k){P=Math.sqrt(A-k-L+1);I=.5*P;P=.5/P;d=(this._transform._rotation01+this._transform._rotation10)*P;w=(this._transform._rotation12+this._transform._rotation21)*P;V=(this._transform._rotation02-this._transform._rotation20)*P}else{P=Math.sqrt(k-L-A+1);w=.5*P;P=.5/P;d=(this._transform._rotation02+this._transform._rotation20)*P;I=(this._transform._rotation12+this._transform._rotation21)*P;V=(this._transform._rotation10-this._transform._rotation01)*P}d=Y*d+X*V+z*w-M*I;I=Y*I-X*w+z*V+M*d;w=Y*w+X*I-z*d+M*V;V=Y*V-X*d-z*I-M*w;var T=d*d+I*I+w*w+V*V;if(T>1e-32){T=1/Math.sqrt(T)}d*=T;I*=T;w*=T;V*=T;var S=d;var C=I;var q=w;var R=V;var E=2*S;var j=2*C;var N=2*q;var D=S*E;var F=C*j;var O=q*N;var W=S*j;var G=C*N;var H=S*N;var U=R*E;var J=R*j;var Q=R*N;this._transform._rotation00=1-F-O;this._transform._rotation01=W-Q;this._transform._rotation02=H+J;this._transform._rotation10=W+Q;this._transform._rotation11=1-D-O;this._transform._rotation12=G-U;this._transform._rotation20=H-J;this._transform._rotation21=G+U;this._transform._rotation22=1-D-F;var $;var K;var tt;var at;var it;var rt;var ot;var st;var nt;$=this._transform._rotation00*this._invLocalInertia00+this._transform._rotation01*this._invLocalInertia10+this._transform._rotation02*this._invLocalInertia20;K=this._transform._rotation00*this._invLocalInertia01+this._transform._rotation01*this._invLocalInertia11+this._transform._rotation02*this._invLocalInertia21;tt=this._transform._rotation00*this._invLocalInertia02+this._transform._rotation01*this._invLocalInertia12+this._transform._rotation02*this._invLocalInertia22;at=this._transform._rotation10*this._invLocalInertia00+this._transform._rotation11*this._invLocalInertia10+this._transform._rotation12*this._invLocalInertia20;it=this._transform._rotation10*this._invLocalInertia01+this._transform._rotation11*this._invLocalInertia11+this._transform._rotation12*this._invLocalInertia21;rt=this._transform._rotation10*this._invLocalInertia02+this._transform._rotation11*this._invLocalInertia12+this._transform._rotation12*this._invLocalInertia22;ot=this._transform._rotation20*this._invLocalInertia00+this._transform._rotation21*this._invLocalInertia10+this._transform._rotation22*this._invLocalInertia20;st=this._transform._rotation20*this._invLocalInertia01+this._transform._rotation21*this._invLocalInertia11+this._transform._rotation22*this._invLocalInertia21;nt=this._transform._rotation20*this._invLocalInertia02+this._transform._rotation21*this._invLocalInertia12+this._transform._rotation22*this._invLocalInertia22;this._invInertia00=$;this._invInertia01=K;this._invInertia02=tt;this._invInertia10=at;this._invInertia11=it;this._invInertia12=rt;this._invInertia20=ot;this._invInertia21=st;this._invInertia22=nt;var et;var _t;var vt;var ht;var lt;var ct;var pt;var ft;var mt;et=this._invInertia00*this._transform._rotation00+this._invInertia01*this._transform._rotation01+this._invInertia02*this._transform._rotation02;_t=this._invInertia00*this._transform._rotation10+this._invInertia01*this._transform._rotation11+this._invInertia02*this._transform._rotation12;vt=this._invInertia00*this._transform._rotation20+this._invInertia01*this._transform._rotation21+this._invInertia02*this._transform._rotation22;ht=this._invInertia10*this._transform._rotation00+this._invInertia11*this._transform._rotation01+this._invInertia12*this._transform._rotation02;lt=this._invInertia10*this._transform._rotation10+this._invInertia11*this._transform._rotation11+this._invInertia12*this._transform._rotation12;ct=this._invInertia10*this._transform._rotation20+this._invInertia11*this._transform._rotation21+this._invInertia12*this._transform._rotation22;pt=this._invInertia20*this._transform._rotation00+this._invInertia21*this._transform._rotation01+this._invInertia22*this._transform._rotation02;ft=this._invInertia20*this._transform._rotation10+this._invInertia21*this._transform._rotation11+this._invInertia22*this._transform._rotation12;mt=this._invInertia20*this._transform._rotation20+this._invInertia21*this._transform._rotation21+this._invInertia22*this._transform._rotation22;this._invInertia00=et;this._invInertia01=_t;this._invInertia02=vt;this._invInertia10=ht;this._invInertia11=lt;this._invInertia12=ct;this._invInertia20=pt;this._invInertia21=ft;this._invInertia22=mt;this._invInertia00*=this._rotFactor.x;this._invInertia01*=this._rotFactor.x;this._invInertia02*=this._rotFactor.x;this._invInertia10*=this._rotFactor.y;this._invInertia11*=this._rotFactor.y;this._invInertia12*=this._rotFactor.y;this._invInertia20*=this._rotFactor.z;this._invInertia21*=this._rotFactor.z;this._invInertia22*=this._rotFactor.z;break}},updateMass:function(){var t;var a;var i;var r;var o;var s;var n;var e;var _;var v;a=0;i=0;r=0;o=0;s=0;n=0;e=0;_=0;v=0;var h=0;var l=this._shapeList;while(l!=null){var c=l._next;var p=l._geom;p._updateMass();var f=l._density*p._volume;var m;var b;var u;var x;var y;var g;var X;var z;var M;var Y;var Z;var d;var I;var w;var V;var L;var A;var k;var B;Z=l._localTransform._rotation00*p._inertiaCoeff00+l._localTransform._rotation01*p._inertiaCoeff10+l._localTransform._rotation02*p._inertiaCoeff20;d=l._localTransform._rotation00*p._inertiaCoeff01+l._localTransform._rotation01*p._inertiaCoeff11+l._localTransform._rotation02*p._inertiaCoeff21;I=l._localTransform._rotation00*p._inertiaCoeff02+l._localTransform._rotation01*p._inertiaCoeff12+l._localTransform._rotation02*p._inertiaCoeff22;w=l._localTransform._rotation10*p._inertiaCoeff00+l._localTransform._rotation11*p._inertiaCoeff10+l._localTransform._rotation12*p._inertiaCoeff20;V=l._localTransform._rotation10*p._inertiaCoeff01+l._localTransform._rotation11*p._inertiaCoeff11+l._localTransform._rotation12*p._inertiaCoeff21;L=l._localTransform._rotation10*p._inertiaCoeff02+l._localTransform._rotation11*p._inertiaCoeff12+l._localTransform._rotation12*p._inertiaCoeff22;A=l._localTransform._rotation20*p._inertiaCoeff00+l._localTransform._rotation21*p._inertiaCoeff10+l._localTransform._rotation22*p._inertiaCoeff20;k=l._localTransform._rotation20*p._inertiaCoeff01+l._localTransform._rotation21*p._inertiaCoeff11+l._localTransform._rotation22*p._inertiaCoeff21;B=l._localTransform._rotation20*p._inertiaCoeff02+l._localTransform._rotation21*p._inertiaCoeff12+l._localTransform._rotation22*p._inertiaCoeff22;b=Z;u=d;x=I;y=w;g=V;X=L;z=A;M=k;Y=B;var P;var T;var S;var C;var q;var R;var E;var j;var N;P=b*l._localTransform._rotation00+u*l._localTransform._rotation01+x*l._localTransform._rotation02;T=b*l._localTransform._rotation10+u*l._localTransform._rotation11+x*l._localTransform._rotation12;S=b*l._localTransform._rotation20+u*l._localTransform._rotation21+x*l._localTransform._rotation22;C=y*l._localTransform._rotation00+g*l._localTransform._rotation01+X*l._localTransform._rotation02;q=y*l._localTransform._rotation10+g*l._localTransform._rotation11+X*l._localTransform._rotation12;R=y*l._localTransform._rotation20+g*l._localTransform._rotation21+X*l._localTransform._rotation22;E=z*l._localTransform._rotation00+M*l._localTransform._rotation01+Y*l._localTransform._rotation02;j=z*l._localTransform._rotation10+M*l._localTransform._rotation11+Y*l._localTransform._rotation12;N=z*l._localTransform._rotation20+M*l._localTransform._rotation21+Y*l._localTransform._rotation22;b=P;u=T;x=S;y=C;g=q;X=R;z=E;M=j;Y=N;b*=f;u*=f;x*=f;y*=f;g*=f;X*=f;z*=f;M*=f;Y*=f;var D;var F;var O;var W;var G;var H;var U;var J;var Q;var $;var K=l._localTransform._positionX*l._localTransform._positionX;var tt=l._localTransform._positionY*l._localTransform._positionY;var at=l._localTransform._positionZ*l._localTransform._positionZ;var it=-l._localTransform._positionX*l._localTransform._positionY;var rt=-l._localTransform._positionY*l._localTransform._positionZ;var ot=-l._localTransform._positionZ*l._localTransform._positionX;F=tt+at;O=it;W=ot;G=it;H=K+at;U=rt;J=ot;Q=rt;$=K+tt;b+=F*f;u+=O*f;x+=W*f;y+=G*f;g+=H*f;X+=U*f;z+=J*f;M+=Q*f;Y+=$*f;h+=f;a+=b;i+=u;r+=x;o+=y;s+=g;n+=X;e+=z;_+=M;v+=Y;l=c}this._mass=h;this._localInertia00=a;this._localInertia01=i;this._localInertia02=r;this._localInertia10=o;this._localInertia11=s;this._localInertia12=n;this._localInertia20=e;this._localInertia21=_;this._localInertia22=v;var st=this._localInertia11*this._localInertia22-this._localInertia12*this._localInertia21;var nt=this._localInertia10*this._localInertia22-this._localInertia12*this._localInertia20;var et=this._localInertia10*this._localInertia21-this._localInertia11*this._localInertia20;var _t=this._localInertia00*st-this._localInertia01*nt+this._localInertia02*et;if(this._mass>0&&_t>0&&this._type==0){this._invMass=1/this._mass;var vt=this._localInertia11*this._localInertia22-this._localInertia12*this._localInertia21;var ht=this._localInertia10*this._localInertia22-this._localInertia12*this._localInertia20;var lt=this._localInertia10*this._localInertia21-this._localInertia11*this._localInertia20;var ct=this._localInertia01*this._localInertia22-this._localInertia02*this._localInertia21;var pt=this._localInertia00*this._localInertia22-this._localInertia02*this._localInertia20;var ft=this._localInertia00*this._localInertia21-this._localInertia01*this._localInertia20;var mt=this._localInertia01*this._localInertia12-this._localInertia02*this._localInertia11;var bt=this._localInertia00*this._localInertia12-this._localInertia02*this._localInertia10;var ut=this._localInertia00*this._localInertia11-this._localInertia01*this._localInertia10;var xt=this._localInertia00*vt-this._localInertia01*ht+this._localInertia02*lt;if(xt<-1e-32||xt>1e-32){xt=1/xt}this._invLocalInertia00=vt*xt;this._invLocalInertia01=-ct*xt;this._invLocalInertia02=mt*xt;this._invLocalInertia10=-ht*xt;this._invLocalInertia11=pt*xt;this._invLocalInertia12=-bt*xt;this._invLocalInertia20=lt*xt;this._invLocalInertia21=-ft*xt;this._invLocalInertia22=ut*xt;this._invLocalInertiaWithoutRotFactor00=this._invLocalInertia00;this._invLocalInertiaWithoutRotFactor01=this._invLocalInertia01;this._invLocalInertiaWithoutRotFactor02=this._invLocalInertia02;this._invLocalInertiaWithoutRotFactor10=this._invLocalInertia10;this._invLocalInertiaWithoutRotFactor11=this._invLocalInertia11;this._invLocalInertiaWithoutRotFactor12=this._invLocalInertia12;this._invLocalInertiaWithoutRotFactor20=this._invLocalInertia20;this._invLocalInertiaWithoutRotFactor21=this._invLocalInertia21;this._invLocalInertiaWithoutRotFactor22=this._invLocalInertia22;this._invLocalInertia00=this._invLocalInertiaWithoutRotFactor00*this._rotFactor.x;this._invLocalInertia01=this._invLocalInertiaWithoutRotFactor01*this._rotFactor.x;this._invLocalInertia02=this._invLocalInertiaWithoutRotFactor02*this._rotFactor.x;this._invLocalInertia10=this._invLocalInertiaWithoutRotFactor10*this._rotFactor.y;this._invLocalInertia11=this._invLocalInertiaWithoutRotFactor11*this._rotFactor.y;this._invLocalInertia12=this._invLocalInertiaWithoutRotFactor12*this._rotFactor.y;this._invLocalInertia20=this._invLocalInertiaWithoutRotFactor20*this._rotFactor.z;this._invLocalInertia21=this._invLocalInertiaWithoutRotFactor21*this._rotFactor.z;this._invLocalInertia22=this._invLocalInertiaWithoutRotFactor22*this._rotFactor.z}else{this._invMass=0;this._invLocalInertia00=0;this._invLocalInertia01=0;this._invLocalInertia02=0;this._invLocalInertia10=0;this._invLocalInertia11=0;this._invLocalInertia12=0;this._invLocalInertia20=0;this._invLocalInertia21=0;this._invLocalInertia22=0;this._invLocalInertiaWithoutRotFactor00=0;this._invLocalInertiaWithoutRotFactor01=0;this._invLocalInertiaWithoutRotFactor02=0;this._invLocalInertiaWithoutRotFactor10=0;this._invLocalInertiaWithoutRotFactor11=0;this._invLocalInertiaWithoutRotFactor12=0;this._invLocalInertiaWithoutRotFactor20=0;this._invLocalInertiaWithoutRotFactor21=0;this._invLocalInertiaWithoutRotFactor22=0;if(this._type==0){this._type=1}}var yt;var gt;var Xt;var zt;var Mt;var Yt;var Zt;var dt;var It;yt=this._transform._rotation00*this._invLocalInertia00+this._transform._rotation01*this._invLocalInertia10+this._transform._rotation02*this._invLocalInertia20;gt=this._transform._rotation00*this._invLocalInertia01+this._transform._rotation01*this._invLocalInertia11+this._transform._rotation02*this._invLocalInertia21;Xt=this._transform._rotation00*this._invLocalInertia02+this._transform._rotation01*this._invLocalInertia12+this._transform._rotation02*this._invLocalInertia22;zt=this._transform._rotation10*this._invLocalInertia00+this._transform._rotation11*this._invLocalInertia10+this._transform._rotation12*this._invLocalInertia20;Mt=this._transform._rotation10*this._invLocalInertia01+this._transform._rotation11*this._invLocalInertia11+this._transform._rotation12*this._invLocalInertia21;Yt=this._transform._rotation10*this._invLocalInertia02+this._transform._rotation11*this._invLocalInertia12+this._transform._rotation12*this._invLocalInertia22;Zt=this._transform._rotation20*this._invLocalInertia00+this._transform._rotation21*this._invLocalInertia10+this._transform._rotation22*this._invLocalInertia20;dt=this._transform._rotation20*this._invLocalInertia01+this._transform._rotation21*this._invLocalInertia11+this._transform._rotation22*this._invLocalInertia21;It=this._transform._rotation20*this._invLocalInertia02+this._transform._rotation21*this._invLocalInertia12+this._transform._rotation22*this._invLocalInertia22;this._invInertia00=yt;this._invInertia01=gt;this._invInertia02=Xt;this._invInertia10=zt;this._invInertia11=Mt;this._invInertia12=Yt;this._invInertia20=Zt;this._invInertia21=dt;this._invInertia22=It;var wt;var Vt;var Lt;var At;var kt;var Bt;var Pt;var Tt;var St;wt=this._invInertia00*this._transform._rotation00+this._invInertia01*this._transform._rotation01+this._invInertia02*this._transform._rotation02;Vt=this._invInertia00*this._transform._rotation10+this._invInertia01*this._transform._rotation11+this._invInertia02*this._transform._rotation12;Lt=this._invInertia00*this._transform._rotation20+this._invInertia01*this._transform._rotation21+this._invInertia02*this._transform._rotation22;At=this._invInertia10*this._transform._rotation00+this._invInertia11*this._transform._rotation01+this._invInertia12*this._transform._rotation02;kt=this._invInertia10*this._transform._rotation10+this._invInertia11*this._transform._rotation11+this._invInertia12*this._transform._rotation12;Bt=this._invInertia10*this._transform._rotation20+this._invInertia11*this._transform._rotation21+this._invInertia12*this._transform._rotation22;Pt=this._invInertia20*this._transform._rotation00+this._invInertia21*this._transform._rotation01+this._invInertia22*this._transform._rotation02;Tt=this._invInertia20*this._transform._rotation10+this._invInertia21*this._transform._rotation11+this._invInertia22*this._transform._rotation12;St=this._invInertia20*this._transform._rotation20+this._invInertia21*this._transform._rotation21+this._invInertia22*this._transform._rotation22;this._invInertia00=wt;this._invInertia01=Vt;this._invInertia02=Lt;this._invInertia10=At;this._invInertia11=kt;this._invInertia12=Bt;this._invInertia20=Pt;this._invInertia21=Tt;this._invInertia22=St;this._invInertia00*=this._rotFactor.x;this._invInertia01*=this._rotFactor.x;this._invInertia02*=this._rotFactor.x;this._invInertia10*=this._rotFactor.y;this._invInertia11*=this._rotFactor.y;this._invInertia12*=this._rotFactor.y;this._invInertia20*=this._rotFactor.z;this._invInertia21*=this._rotFactor.z;this._invInertia22*=this._rotFactor.z;this._sleeping=false;this._sleepTime=0},getPosition:function(){var t=new Is;var a=t;a.x=this._transform._positionX;a.y=this._transform._positionY;a.z=this._transform._positionZ;return t},getPositionTo:function(t){var a=t;a.x=this._transform._positionX;a.y=this._transform._positionY;a.z=this._transform._positionZ},setPosition:function(t){var a=t;this._transform._positionX=a.x;this._transform._positionY=a.y;this._transform._positionZ=a.z;var i=this._ptransform;var r=this._transform;i._positionX=r._positionX;i._positionY=r._positionY;i._positionZ=r._positionZ;i._rotation00=r._rotation00;i._rotation01=r._rotation01;i._rotation02=r._rotation02;i._rotation10=r._rotation10;i._rotation11=r._rotation11;i._rotation12=r._rotation12;i._rotation20=r._rotation20;i._rotation21=r._rotation21;i._rotation22=r._rotation22;var o=this._shapeList;while(o!=null){var s=o._next;var n=o._ptransform;var e=o._localTransform;var _=this._ptransform;var v;var h;var l;var c;var p;var f;var m;var b;var u;v=_._rotation00*e._rotation00+_._rotation01*e._rotation10+_._rotation02*e._rotation20;h=_._rotation00*e._rotation01+_._rotation01*e._rotation11+_._rotation02*e._rotation21;l=_._rotation00*e._rotation02+_._rotation01*e._rotation12+_._rotation02*e._rotation22;c=_._rotation10*e._rotation00+_._rotation11*e._rotation10+_._rotation12*e._rotation20;p=_._rotation10*e._rotation01+_._rotation11*e._rotation11+_._rotation12*e._rotation21;f=_._rotation10*e._rotation02+_._rotation11*e._rotation12+_._rotation12*e._rotation22;m=_._rotation20*e._rotation00+_._rotation21*e._rotation10+_._rotation22*e._rotation20;b=_._rotation20*e._rotation01+_._rotation21*e._rotation11+_._rotation22*e._rotation21;u=_._rotation20*e._rotation02+_._rotation21*e._rotation12+_._rotation22*e._rotation22;n._rotation00=v;n._rotation01=h;n._rotation02=l;n._rotation10=c;n._rotation11=p;n._rotation12=f;n._rotation20=m;n._rotation21=b;n._rotation22=u;var x;var y;var g;x=_._rotation00*e._positionX+_._rotation01*e._positionY+_._rotation02*e._positionZ;y=_._rotation10*e._positionX+_._rotation11*e._positionY+_._rotation12*e._positionZ;g=_._rotation20*e._positionX+_._rotation21*e._positionY+_._rotation22*e._positionZ;n._positionX=x;n._positionY=y;n._positionZ=g;n._positionX+=_._positionX;n._positionY+=_._positionY;n._positionZ+=_._positionZ;var X=o._transform;var z=o._localTransform;var M=this._transform;var Y;var Z;var d;var I;var w;var V;var L;var A;var k;Y=M._rotation00*z._rotation00+M._rotation01*z._rotation10+M._rotation02*z._rotation20;Z=M._rotation00*z._rotation01+M._rotation01*z._rotation11+M._rotation02*z._rotation21;d=M._rotation00*z._rotation02+M._rotation01*z._rotation12+M._rotation02*z._rotation22;I=M._rotation10*z._rotation00+M._rotation11*z._rotation10+M._rotation12*z._rotation20;w=M._rotation10*z._rotation01+M._rotation11*z._rotation11+M._rotation12*z._rotation21;V=M._rotation10*z._rotation02+M._rotation11*z._rotation12+M._rotation12*z._rotation22;L=M._rotation20*z._rotation00+M._rotation21*z._rotation10+M._rotation22*z._rotation20;A=M._rotation20*z._rotation01+M._rotation21*z._rotation11+M._rotation22*z._rotation21;k=M._rotation20*z._rotation02+M._rotation21*z._rotation12+M._rotation22*z._rotation22;X._rotation00=Y;X._rotation01=Z;X._rotation02=d;X._rotation10=I;X._rotation11=w;X._rotation12=V;X._rotation20=L;X._rotation21=A;X._rotation22=k;var B;var P;var T;B=M._rotation00*z._positionX+M._rotation01*z._positionY+M._rotation02*z._positionZ;P=M._rotation10*z._positionX+M._rotation11*z._positionY+M._rotation12*z._positionZ;T=M._rotation20*z._positionX+M._rotation21*z._positionY+M._rotation22*z._positionZ;X._positionX=B;X._positionY=P;X._positionZ=T;X._positionX+=M._positionX;X._positionY+=M._positionY;X._positionZ+=M._positionZ;var S;var C;var q;var R;var E;var j;var N;var D;o._geom._computeAabb(o._aabb,o._ptransform);C=o._aabb._minX;q=o._aabb._minY;R=o._aabb._minZ;j=o._aabb._maxX;N=o._aabb._maxY;D=o._aabb._maxZ;o._geom._computeAabb(o._aabb,o._transform);o._aabb._minX=C<o._aabb._minX?C:o._aabb._minX;o._aabb._minY=q<o._aabb._minY?q:o._aabb._minY;o._aabb._minZ=R<o._aabb._minZ?R:o._aabb._minZ;o._aabb._maxX=j>o._aabb._maxX?j:o._aabb._maxX;o._aabb._maxY=N>o._aabb._maxY?N:o._aabb._maxY;o._aabb._maxZ=D>o._aabb._maxZ?D:o._aabb._maxZ;if(o._proxy!=null){var F;var O;var W;var G;O=o._transform._positionX-o._ptransform._positionX;W=o._transform._positionY-o._ptransform._positionY;G=o._transform._positionZ-o._ptransform._positionZ;var H=o.displacement;H.x=O;H.y=W;H.z=G;o._rigidBody._world._broadPhase.moveProxy(o._proxy,o._aabb,o.displacement)}o=s}this._sleeping=false;this._sleepTime=0},translate:function(t){var a;var i;var r;var o;var s=t;i=s.x;r=s.y;o=s.z;this._transform._positionX+=i;this._transform._positionY+=r;this._transform._positionZ+=o;var n=this._ptransform;var e=this._transform;n._positionX=e._positionX;n._positionY=e._positionY;n._positionZ=e._positionZ;n._rotation00=e._rotation00;n._rotation01=e._rotation01;n._rotation02=e._rotation02;n._rotation10=e._rotation10;n._rotation11=e._rotation11;n._rotation12=e._rotation12;n._rotation20=e._rotation20;n._rotation21=e._rotation21;n._rotation22=e._rotation22;var _=this._shapeList;while(_!=null){var v=_._next;var h=_._ptransform;var l=_._localTransform;var c=this._ptransform;var p;var f;var m;var b;var u;var x;var y;var g;var X;p=c._rotation00*l._rotation00+c._rotation01*l._rotation10+c._rotation02*l._rotation20;f=c._rotation00*l._rotation01+c._rotation01*l._rotation11+c._rotation02*l._rotation21;m=c._rotation00*l._rotation02+c._rotation01*l._rotation12+c._rotation02*l._rotation22;b=c._rotation10*l._rotation00+c._rotation11*l._rotation10+c._rotation12*l._rotation20;u=c._rotation10*l._rotation01+c._rotation11*l._rotation11+c._rotation12*l._rotation21;x=c._rotation10*l._rotation02+c._rotation11*l._rotation12+c._rotation12*l._rotation22;y=c._rotation20*l._rotation00+c._rotation21*l._rotation10+c._rotation22*l._rotation20;g=c._rotation20*l._rotation01+c._rotation21*l._rotation11+c._rotation22*l._rotation21;X=c._rotation20*l._rotation02+c._rotation21*l._rotation12+c._rotation22*l._rotation22;h._rotation00=p;h._rotation01=f;h._rotation02=m;h._rotation10=b;h._rotation11=u;h._rotation12=x;h._rotation20=y;h._rotation21=g;h._rotation22=X;var z;var M;var Y;z=c._rotation00*l._positionX+c._rotation01*l._positionY+c._rotation02*l._positionZ;M=c._rotation10*l._positionX+c._rotation11*l._positionY+c._rotation12*l._positionZ;Y=c._rotation20*l._positionX+c._rotation21*l._positionY+c._rotation22*l._positionZ;h._positionX=z;h._positionY=M;h._positionZ=Y;h._positionX+=c._positionX;h._positionY+=c._positionY;h._positionZ+=c._positionZ;var Z=_._transform;var d=_._localTransform;var I=this._transform;var w;var V;var L;var A;var k;var B;var P;var T;var S;w=I._rotation00*d._rotation00+I._rotation01*d._rotation10+I._rotation02*d._rotation20;V=I._rotation00*d._rotation01+I._rotation01*d._rotation11+I._rotation02*d._rotation21;L=I._rotation00*d._rotation02+I._rotation01*d._rotation12+I._rotation02*d._rotation22;A=I._rotation10*d._rotation00+I._rotation11*d._rotation10+I._rotation12*d._rotation20;k=I._rotation10*d._rotation01+I._rotation11*d._rotation11+I._rotation12*d._rotation21;B=I._rotation10*d._rotation02+I._rotation11*d._rotation12+I._rotation12*d._rotation22;P=I._rotation20*d._rotation00+I._rotation21*d._rotation10+I._rotation22*d._rotation20;T=I._rotation20*d._rotation01+I._rotation21*d._rotation11+I._rotation22*d._rotation21;S=I._rotation20*d._rotation02+I._rotation21*d._rotation12+I._rotation22*d._rotation22;Z._rotation00=w;Z._rotation01=V;Z._rotation02=L;Z._rotation10=A;Z._rotation11=k;Z._rotation12=B;Z._rotation20=P;Z._rotation21=T;Z._rotation22=S;var C;var q;var R;C=I._rotation00*d._positionX+I._rotation01*d._positionY+I._rotation02*d._positionZ;q=I._rotation10*d._positionX+I._rotation11*d._positionY+I._rotation12*d._positionZ;R=I._rotation20*d._positionX+I._rotation21*d._positionY+I._rotation22*d._positionZ;Z._positionX=C;Z._positionY=q;Z._positionZ=R;Z._positionX+=I._positionX;Z._positionY+=I._positionY;Z._positionZ+=I._positionZ;var E;var j;var N;var D;var F;var O;var W;var G;_._geom._computeAabb(_._aabb,_._ptransform);j=_._aabb._minX;N=_._aabb._minY;D=_._aabb._minZ;O=_._aabb._maxX;W=_._aabb._maxY;G=_._aabb._maxZ;_._geom._computeAabb(_._aabb,_._transform);_._aabb._minX=j<_._aabb._minX?j:_._aabb._minX;_._aabb._minY=N<_._aabb._minY?N:_._aabb._minY;_._aabb._minZ=D<_._aabb._minZ?D:_._aabb._minZ;_._aabb._maxX=O>_._aabb._maxX?O:_._aabb._maxX;_._aabb._maxY=W>_._aabb._maxY?W:_._aabb._maxY;_._aabb._maxZ=G>_._aabb._maxZ?G:_._aabb._maxZ;if(_._proxy!=null){var H;var U;var J;var Q;U=_._transform._positionX-_._ptransform._positionX;J=_._transform._positionY-_._ptransform._positionY;Q=_._transform._positionZ-_._ptransform._positionZ;var $=_.displacement;$.x=U;$.y=J;$.z=Q;_._rigidBody._world._broadPhase.moveProxy(_._proxy,_._aabb,_.displacement)}_=v}this._sleeping=false;this._sleepTime=0},getRotation:function(){var t=new ws;var a=t;a.e00=this._transform._rotation00;a.e01=this._transform._rotation01;a.e02=this._transform._rotation02;a.e10=this._transform._rotation10;a.e11=this._transform._rotation11;a.e12=this._transform._rotation12;a.e20=this._transform._rotation20;a.e21=this._transform._rotation21;a.e22=this._transform._rotation22;return t},getRotationTo:function(t){var a=t;a.e00=this._transform._rotation00;a.e01=this._transform._rotation01;a.e02=this._transform._rotation02;a.e10=this._transform._rotation10;a.e11=this._transform._rotation11;a.e12=this._transform._rotation12;a.e20=this._transform._rotation20;a.e21=this._transform._rotation21;a.e22=this._transform._rotation22},setRotation:function(t){var a=t;this._transform._rotation00=a.e00;this._transform._rotation01=a.e01;this._transform._rotation02=a.e02;this._transform._rotation10=a.e10;this._transform._rotation11=a.e11;this._transform._rotation12=a.e12;this._transform._rotation20=a.e20;this._transform._rotation21=a.e21;this._transform._rotation22=a.e22;var i;var r;var o;var s;var n;var e;var _;var v;var h;i=this._transform._rotation00*this._invLocalInertia00+this._transform._rotation01*this._invLocalInertia10+this._transform._rotation02*this._invLocalInertia20;r=this._transform._rotation00*this._invLocalInertia01+this._transform._rotation01*this._invLocalInertia11+this._transform._rotation02*this._invLocalInertia21;o=this._transform._rotation00*this._invLocalInertia02+this._transform._rotation01*this._invLocalInertia12+this._transform._rotation02*this._invLocalInertia22;s=this._transform._rotation10*this._invLocalInertia00+this._transform._rotation11*this._invLocalInertia10+this._transform._rotation12*this._invLocalInertia20;n=this._transform._rotation10*this._invLocalInertia01+this._transform._rotation11*this._invLocalInertia11+this._transform._rotation12*this._invLocalInertia21;e=this._transform._rotation10*this._invLocalInertia02+this._transform._rotation11*this._invLocalInertia12+this._transform._rotation12*this._invLocalInertia22;_=this._transform._rotation20*this._invLocalInertia00+this._transform._rotation21*this._invLocalInertia10+this._transform._rotation22*this._invLocalInertia20;v=this._transform._rotation20*this._invLocalInertia01+this._transform._rotation21*this._invLocalInertia11+this._transform._rotation22*this._invLocalInertia21;h=this._transform._rotation20*this._invLocalInertia02+this._transform._rotation21*this._invLocalInertia12+this._transform._rotation22*this._invLocalInertia22;this._invInertia00=i;this._invInertia01=r;this._invInertia02=o;this._invInertia10=s;this._invInertia11=n;this._invInertia12=e;this._invInertia20=_;this._invInertia21=v;this._invInertia22=h;var l;var c;var p;var f;var m;var b;var u;var x;var y;l=this._invInertia00*this._transform._rotation00+this._invInertia01*this._transform._rotation01+this._invInertia02*this._transform._rotation02;c=this._invInertia00*this._transform._rotation10+this._invInertia01*this._transform._rotation11+this._invInertia02*this._transform._rotation12;p=this._invInertia00*this._transform._rotation20+this._invInertia01*this._transform._rotation21+this._invInertia02*this._transform._rotation22;f=this._invInertia10*this._transform._rotation00+this._invInertia11*this._transform._rotation01+this._invInertia12*this._transform._rotation02;m=this._invInertia10*this._transform._rotation10+this._invInertia11*this._transform._rotation11+this._invInertia12*this._transform._rotation12;b=this._invInertia10*this._transform._rotation20+this._invInertia11*this._transform._rotation21+this._invInertia12*this._transform._rotation22;u=this._invInertia20*this._transform._rotation00+this._invInertia21*this._transform._rotation01+this._invInertia22*this._transform._rotation02;x=this._invInertia20*this._transform._rotation10+this._invInertia21*this._transform._rotation11+this._invInertia22*this._transform._rotation12;y=this._invInertia20*this._transform._rotation20+this._invInertia21*this._transform._rotation21+this._invInertia22*this._transform._rotation22;this._invInertia00=l;this._invInertia01=c;this._invInertia02=p;this._invInertia10=f;this._invInertia11=m;this._invInertia12=b;this._invInertia20=u;this._invInertia21=x;this._invInertia22=y;this._invInertia00*=this._rotFactor.x;this._invInertia01*=this._rotFactor.x;this._invInertia02*=this._rotFactor.x;this._invInertia10*=this._rotFactor.y;this._invInertia11*=this._rotFactor.y;this._invInertia12*=this._rotFactor.y;this._invInertia20*=this._rotFactor.z;this._invInertia21*=this._rotFactor.z;this._invInertia22*=this._rotFactor.z;var g=this._ptransform;var X=this._transform;g._positionX=X._positionX;g._positionY=X._positionY;g._positionZ=X._positionZ;g._rotation00=X._rotation00;g._rotation01=X._rotation01;g._rotation02=X._rotation02;g._rotation10=X._rotation10;g._rotation11=X._rotation11;g._rotation12=X._rotation12;g._rotation20=X._rotation20;g._rotation21=X._rotation21;g._rotation22=X._rotation22;var z=this._shapeList;while(z!=null){var M=z._next;var Y=z._ptransform;var Z=z._localTransform;var d=this._ptransform;var I;var w;var V;var L;var A;var k;var B;var P;var T;I=d._rotation00*Z._rotation00+d._rotation01*Z._rotation10+d._rotation02*Z._rotation20;w=d._rotation00*Z._rotation01+d._rotation01*Z._rotation11+d._rotation02*Z._rotation21;V=d._rotation00*Z._rotation02+d._rotation01*Z._rotation12+d._rotation02*Z._rotation22;L=d._rotation10*Z._rotation00+d._rotation11*Z._rotation10+d._rotation12*Z._rotation20;A=d._rotation10*Z._rotation01+d._rotation11*Z._rotation11+d._rotation12*Z._rotation21;k=d._rotation10*Z._rotation02+d._rotation11*Z._rotation12+d._rotation12*Z._rotation22;B=d._rotation20*Z._rotation00+d._rotation21*Z._rotation10+d._rotation22*Z._rotation20;P=d._rotation20*Z._rotation01+d._rotation21*Z._rotation11+d._rotation22*Z._rotation21;T=d._rotation20*Z._rotation02+d._rotation21*Z._rotation12+d._rotation22*Z._rotation22;Y._rotation00=I;Y._rotation01=w;Y._rotation02=V;Y._rotation10=L;Y._rotation11=A;Y._rotation12=k;Y._rotation20=B;Y._rotation21=P;Y._rotation22=T;var S;var C;var q;S=d._rotation00*Z._positionX+d._rotation01*Z._positionY+d._rotation02*Z._positionZ;C=d._rotation10*Z._positionX+d._rotation11*Z._positionY+d._rotation12*Z._positionZ;q=d._rotation20*Z._positionX+d._rotation21*Z._positionY+d._rotation22*Z._positionZ;Y._positionX=S;Y._positionY=C;Y._positionZ=q;Y._positionX+=d._positionX;Y._positionY+=d._positionY;Y._positionZ+=d._positionZ;var R=z._transform;var E=z._localTransform;var j=this._transform;var N;var D;var F;var O;var W;var G;var H;var U;var J;N=j._rotation00*E._rotation00+j._rotation01*E._rotation10+j._rotation02*E._rotation20;D=j._rotation00*E._rotation01+j._rotation01*E._rotation11+j._rotation02*E._rotation21;F=j._rotation00*E._rotation02+j._rotation01*E._rotation12+j._rotation02*E._rotation22;O=j._rotation10*E._rotation00+j._rotation11*E._rotation10+j._rotation12*E._rotation20;W=j._rotation10*E._rotation01+j._rotation11*E._rotation11+j._rotation12*E._rotation21;G=j._rotation10*E._rotation02+j._rotation11*E._rotation12+j._rotation12*E._rotation22;H=j._rotation20*E._rotation00+j._rotation21*E._rotation10+j._rotation22*E._rotation20;U=j._rotation20*E._rotation01+j._rotation21*E._rotation11+j._rotation22*E._rotation21;J=j._rotation20*E._rotation02+j._rotation21*E._rotation12+j._rotation22*E._rotation22;R._rotation00=N;R._rotation01=D;R._rotation02=F;R._rotation10=O;R._rotation11=W;R._rotation12=G;R._rotation20=H;R._rotation21=U;R._rotation22=J;var Q;var $;var K;Q=j._rotation00*E._positionX+j._rotation01*E._positionY+j._rotation02*E._positionZ;$=j._rotation10*E._positionX+j._rotation11*E._positionY+j._rotation12*E._positionZ;K=j._rotation20*E._positionX+j._rotation21*E._positionY+j._rotation22*E._positionZ;R._positionX=Q;R._positionY=$;R._positionZ=K;R._positionX+=j._positionX;R._positionY+=j._positionY;R._positionZ+=j._positionZ;var tt;var at;var it;var rt;var ot;var st;var nt;var et;z._geom._computeAabb(z._aabb,z._ptransform);at=z._aabb._minX;it=z._aabb._minY;rt=z._aabb._minZ;st=z._aabb._maxX;nt=z._aabb._maxY;et=z._aabb._maxZ;z._geom._computeAabb(z._aabb,z._transform);z._aabb._minX=at<z._aabb._minX?at:z._aabb._minX;z._aabb._minY=it<z._aabb._minY?it:z._aabb._minY;z._aabb._minZ=rt<z._aabb._minZ?rt:z._aabb._minZ;z._aabb._maxX=st>z._aabb._maxX?st:z._aabb._maxX;z._aabb._maxY=nt>z._aabb._maxY?nt:z._aabb._maxY;z._aabb._maxZ=et>z._aabb._maxZ?et:z._aabb._maxZ;if(z._proxy!=null){var _t;var vt;var ht;var lt;vt=z._transform._positionX-z._ptransform._positionX;ht=z._transform._positionY-z._ptransform._positionY;lt=z._transform._positionZ-z._ptransform._positionZ;var ct=z.displacement;ct.x=vt;ct.y=ht;ct.z=lt;z._rigidBody._world._broadPhase.moveProxy(z._proxy,z._aabb,z.displacement)}z=M}this._sleeping=false;this._sleepTime=0},setRotationXyz:function(t){var a;var i;var r;var o;var s=t;i=s.x;r=s.y;o=s.z;var n=Math.sin(i);var e=Math.sin(r);var _=Math.sin(o);var v=Math.cos(i);var h=Math.cos(r);var l=Math.cos(o);this._transform._rotation00=h*l;this._transform._rotation01=-h*_;this._transform._rotation02=e;this._transform._rotation10=v*_+l*n*e;this._transform._rotation11=v*l-n*e*_;this._transform._rotation12=-h*n;this._transform._rotation20=n*_-v*l*e;this._transform._rotation21=l*n+v*e*_;this._transform._rotation22=v*h;var c;var p;var f;var m;var b;var u;var x;var y;var g;c=this._transform._rotation00*this._invLocalInertia00+this._transform._rotation01*this._invLocalInertia10+this._transform._rotation02*this._invLocalInertia20;p=this._transform._rotation00*this._invLocalInertia01+this._transform._rotation01*this._invLocalInertia11+this._transform._rotation02*this._invLocalInertia21;f=this._transform._rotation00*this._invLocalInertia02+this._transform._rotation01*this._invLocalInertia12+this._transform._rotation02*this._invLocalInertia22;m=this._transform._rotation10*this._invLocalInertia00+this._transform._rotation11*this._invLocalInertia10+this._transform._rotation12*this._invLocalInertia20;b=this._transform._rotation10*this._invLocalInertia01+this._transform._rotation11*this._invLocalInertia11+this._transform._rotation12*this._invLocalInertia21;u=this._transform._rotation10*this._invLocalInertia02+this._transform._rotation11*this._invLocalInertia12+this._transform._rotation12*this._invLocalInertia22;x=this._transform._rotation20*this._invLocalInertia00+this._transform._rotation21*this._invLocalInertia10+this._transform._rotation22*this._invLocalInertia20;y=this._transform._rotation20*this._invLocalInertia01+this._transform._rotation21*this._invLocalInertia11+this._transform._rotation22*this._invLocalInertia21;g=this._transform._rotation20*this._invLocalInertia02+this._transform._rotation21*this._invLocalInertia12+this._transform._rotation22*this._invLocalInertia22;this._invInertia00=c;this._invInertia01=p;this._invInertia02=f;this._invInertia10=m;this._invInertia11=b;this._invInertia12=u;this._invInertia20=x;this._invInertia21=y;this._invInertia22=g;var X;var z;var M;var Y;var Z;var d;var I;var w;var V;X=this._invInertia00*this._transform._rotation00+this._invInertia01*this._transform._rotation01+this._invInertia02*this._transform._rotation02;z=this._invInertia00*this._transform._rotation10+this._invInertia01*this._transform._rotation11+this._invInertia02*this._transform._rotation12;M=this._invInertia00*this._transform._rotation20+this._invInertia01*this._transform._rotation21+this._invInertia02*this._transform._rotation22;Y=this._invInertia10*this._transform._rotation00+this._invInertia11*this._transform._rotation01+this._invInertia12*this._transform._rotation02;Z=this._invInertia10*this._transform._rotation10+this._invInertia11*this._transform._rotation11+this._invInertia12*this._transform._rotation12;d=this._invInertia10*this._transform._rotation20+this._invInertia11*this._transform._rotation21+this._invInertia12*this._transform._rotation22;I=this._invInertia20*this._transform._rotation00+this._invInertia21*this._transform._rotation01+this._invInertia22*this._transform._rotation02;w=this._invInertia20*this._transform._rotation10+this._invInertia21*this._transform._rotation11+this._invInertia22*this._transform._rotation12;V=this._invInertia20*this._transform._rotation20+this._invInertia21*this._transform._rotation21+this._invInertia22*this._transform._rotation22;this._invInertia00=X;this._invInertia01=z;this._invInertia02=M;this._invInertia10=Y;this._invInertia11=Z;this._invInertia12=d;this._invInertia20=I;this._invInertia21=w;this._invInertia22=V;this._invInertia00*=this._rotFactor.x;this._invInertia01*=this._rotFactor.x;this._invInertia02*=this._rotFactor.x;this._invInertia10*=this._rotFactor.y;this._invInertia11*=this._rotFactor.y;this._invInertia12*=this._rotFactor.y;this._invInertia20*=this._rotFactor.z;this._invInertia21*=this._rotFactor.z;this._invInertia22*=this._rotFactor.z;var L=this._ptransform;var A=this._transform;L._positionX=A._positionX;L._positionY=A._positionY;L._positionZ=A._positionZ;L._rotation00=A._rotation00;L._rotation01=A._rotation01;L._rotation02=A._rotation02;L._rotation10=A._rotation10;L._rotation11=A._rotation11;L._rotation12=A._rotation12;L._rotation20=A._rotation20;L._rotation21=A._rotation21;L._rotation22=A._rotation22;var k=this._shapeList;while(k!=null){var B=k._next;var P=k._ptransform;var T=k._localTransform;var S=this._ptransform;var C;var q;var R;var E;var j;var N;var D;var F;var O;C=S._rotation00*T._rotation00+S._rotation01*T._rotation10+S._rotation02*T._rotation20;q=S._rotation00*T._rotation01+S._rotation01*T._rotation11+S._rotation02*T._rotation21;R=S._rotation00*T._rotation02+S._rotation01*T._rotation12+S._rotation02*T._rotation22;E=S._rotation10*T._rotation00+S._rotation11*T._rotation10+S._rotation12*T._rotation20;j=S._rotation10*T._rotation01+S._rotation11*T._rotation11+S._rotation12*T._rotation21;N=S._rotation10*T._rotation02+S._rotation11*T._rotation12+S._rotation12*T._rotation22;D=S._rotation20*T._rotation00+S._rotation21*T._rotation10+S._rotation22*T._rotation20;F=S._rotation20*T._rotation01+S._rotation21*T._rotation11+S._rotation22*T._rotation21;O=S._rotation20*T._rotation02+S._rotation21*T._rotation12+S._rotation22*T._rotation22;P._rotation00=C;P._rotation01=q;P._rotation02=R;P._rotation10=E;P._rotation11=j;P._rotation12=N;P._rotation20=D;P._rotation21=F;P._rotation22=O;var W;var G;var H;W=S._rotation00*T._positionX+S._rotation01*T._positionY+S._rotation02*T._positionZ;G=S._rotation10*T._positionX+S._rotation11*T._positionY+S._rotation12*T._positionZ;H=S._rotation20*T._positionX+S._rotation21*T._positionY+S._rotation22*T._positionZ;P._positionX=W;P._positionY=G;P._positionZ=H;P._positionX+=S._positionX;P._positionY+=S._positionY;P._positionZ+=S._positionZ;var U=k._transform;var J=k._localTransform;var Q=this._transform;var $;var K;var tt;var at;var it;var rt;var ot;var st;var nt;$=Q._rotation00*J._rotation00+Q._rotation01*J._rotation10+Q._rotation02*J._rotation20;K=Q._rotation00*J._rotation01+Q._rotation01*J._rotation11+Q._rotation02*J._rotation21;tt=Q._rotation00*J._rotation02+Q._rotation01*J._rotation12+Q._rotation02*J._rotation22;at=Q._rotation10*J._rotation00+Q._rotation11*J._rotation10+Q._rotation12*J._rotation20;it=Q._rotation10*J._rotation01+Q._rotation11*J._rotation11+Q._rotation12*J._rotation21;rt=Q._rotation10*J._rotation02+Q._rotation11*J._rotation12+Q._rotation12*J._rotation22;ot=Q._rotation20*J._rotation00+Q._rotation21*J._rotation10+Q._rotation22*J._rotation20;st=Q._rotation20*J._rotation01+Q._rotation21*J._rotation11+Q._rotation22*J._rotation21;nt=Q._rotation20*J._rotation02+Q._rotation21*J._rotation12+Q._rotation22*J._rotation22;U._rotation00=$;U._rotation01=K;U._rotation02=tt;U._rotation10=at;U._rotation11=it;U._rotation12=rt;U._rotation20=ot;U._rotation21=st;U._rotation22=nt;var et;var _t;var vt;et=Q._rotation00*J._positionX+Q._rotation01*J._positionY+Q._rotation02*J._positionZ;_t=Q._rotation10*J._positionX+Q._rotation11*J._positionY+Q._rotation12*J._positionZ;vt=Q._rotation20*J._positionX+Q._rotation21*J._positionY+Q._rotation22*J._positionZ;U._positionX=et;U._positionY=_t;U._positionZ=vt;U._positionX+=Q._positionX;U._positionY+=Q._positionY;U._positionZ+=Q._positionZ;var ht;var lt;var ct;var pt;var ft;var mt;var bt;var ut;k._geom._computeAabb(k._aabb,k._ptransform);lt=k._aabb._minX;ct=k._aabb._minY;pt=k._aabb._minZ;mt=k._aabb._maxX;bt=k._aabb._maxY;ut=k._aabb._maxZ;k._geom._computeAabb(k._aabb,k._transform);k._aabb._minX=lt<k._aabb._minX?lt:k._aabb._minX;k._aabb._minY=ct<k._aabb._minY?ct:k._aabb._minY;k._aabb._minZ=pt<k._aabb._minZ?pt:k._aabb._minZ;k._aabb._maxX=mt>k._aabb._maxX?mt:k._aabb._maxX;k._aabb._maxY=bt>k._aabb._maxY?bt:k._aabb._maxY;k._aabb._maxZ=ut>k._aabb._maxZ?ut:k._aabb._maxZ;if(k._proxy!=null){var xt;var yt;var gt;var Xt;yt=k._transform._positionX-k._ptransform._positionX;gt=k._transform._positionY-k._ptransform._positionY;Xt=k._transform._positionZ-k._ptransform._positionZ;var zt=k.displacement;zt.x=yt;zt.y=gt;zt.z=Xt;k._rigidBody._world._broadPhase.moveProxy(k._proxy,k._aabb,k.displacement)}k=B}this._sleeping=false;this._sleepTime=0},rotate:function(t){var a;var i;var r;var o;var s;var n;var e;var _;var v;var h;var l=t;i=l.e00;r=l.e01;o=l.e02;s=l.e10;n=l.e11;e=l.e12;_=l.e20;v=l.e21;h=l.e22;var c;var p;var f;var m;var b;var u;var x;var y;var g;c=i*this._transform._rotation00+r*this._transform._rotation10+o*this._transform._rotation20;p=i*this._transform._rotation01+r*this._transform._rotation11+o*this._transform._rotation21;f=i*this._transform._rotation02+r*this._transform._rotation12+o*this._transform._rotation22;m=s*this._transform._rotation00+n*this._transform._rotation10+e*this._transform._rotation20;b=s*this._transform._rotation01+n*this._transform._rotation11+e*this._transform._rotation21;u=s*this._transform._rotation02+n*this._transform._rotation12+e*this._transform._rotation22;x=_*this._transform._rotation00+v*this._transform._rotation10+h*this._transform._rotation20;y=_*this._transform._rotation01+v*this._transform._rotation11+h*this._transform._rotation21;g=_*this._transform._rotation02+v*this._transform._rotation12+h*this._transform._rotation22;this._transform._rotation00=c;this._transform._rotation01=p;this._transform._rotation02=f;this._transform._rotation10=m;this._transform._rotation11=b;this._transform._rotation12=u;this._transform._rotation20=x;this._transform._rotation21=y;this._transform._rotation22=g;var X;var z;var M;var Y;var Z;var d;var I;var w;var V;X=this._transform._rotation00*this._invLocalInertia00+this._transform._rotation01*this._invLocalInertia10+this._transform._rotation02*this._invLocalInertia20;z=this._transform._rotation00*this._invLocalInertia01+this._transform._rotation01*this._invLocalInertia11+this._transform._rotation02*this._invLocalInertia21;M=this._transform._rotation00*this._invLocalInertia02+this._transform._rotation01*this._invLocalInertia12+this._transform._rotation02*this._invLocalInertia22;Y=this._transform._rotation10*this._invLocalInertia00+this._transform._rotation11*this._invLocalInertia10+this._transform._rotation12*this._invLocalInertia20;Z=this._transform._rotation10*this._invLocalInertia01+this._transform._rotation11*this._invLocalInertia11+this._transform._rotation12*this._invLocalInertia21;d=this._transform._rotation10*this._invLocalInertia02+this._transform._rotation11*this._invLocalInertia12+this._transform._rotation12*this._invLocalInertia22;I=this._transform._rotation20*this._invLocalInertia00+this._transform._rotation21*this._invLocalInertia10+this._transform._rotation22*this._invLocalInertia20;w=this._transform._rotation20*this._invLocalInertia01+this._transform._rotation21*this._invLocalInertia11+this._transform._rotation22*this._invLocalInertia21;V=this._transform._rotation20*this._invLocalInertia02+this._transform._rotation21*this._invLocalInertia12+this._transform._rotation22*this._invLocalInertia22;this._invInertia00=X;this._invInertia01=z;this._invInertia02=M;this._invInertia10=Y;this._invInertia11=Z;this._invInertia12=d;this._invInertia20=I;this._invInertia21=w;this._invInertia22=V;var L;var A;var k;var B;var P;var T;var S;var C;var q;L=this._invInertia00*this._transform._rotation00+this._invInertia01*this._transform._rotation01+this._invInertia02*this._transform._rotation02;A=this._invInertia00*this._transform._rotation10+this._invInertia01*this._transform._rotation11+this._invInertia02*this._transform._rotation12;k=this._invInertia00*this._transform._rotation20+this._invInertia01*this._transform._rotation21+this._invInertia02*this._transform._rotation22;B=this._invInertia10*this._transform._rotation00+this._invInertia11*this._transform._rotation01+this._invInertia12*this._transform._rotation02;P=this._invInertia10*this._transform._rotation10+this._invInertia11*this._transform._rotation11+this._invInertia12*this._transform._rotation12;T=this._invInertia10*this._transform._rotation20+this._invInertia11*this._transform._rotation21+this._invInertia12*this._transform._rotation22;S=this._invInertia20*this._transform._rotation00+this._invInertia21*this._transform._rotation01+this._invInertia22*this._transform._rotation02;C=this._invInertia20*this._transform._rotation10+this._invInertia21*this._transform._rotation11+this._invInertia22*this._transform._rotation12;q=this._invInertia20*this._transform._rotation20+this._invInertia21*this._transform._rotation21+this._invInertia22*this._transform._rotation22;this._invInertia00=L;this._invInertia01=A;this._invInertia02=k;this._invInertia10=B;this._invInertia11=P;this._invInertia12=T;this._invInertia20=S;this._invInertia21=C;this._invInertia22=q;this._invInertia00*=this._rotFactor.x;this._invInertia01*=this._rotFactor.x;this._invInertia02*=this._rotFactor.x;this._invInertia10*=this._rotFactor.y;this._invInertia11*=this._rotFactor.y;this._invInertia12*=this._rotFactor.y;this._invInertia20*=this._rotFactor.z;this._invInertia21*=this._rotFactor.z;this._invInertia22*=this._rotFactor.z;var R=this._ptransform;var E=this._transform;R._positionX=E._positionX;R._positionY=E._positionY;R._positionZ=E._positionZ;R._rotation00=E._rotation00;R._rotation01=E._rotation01;R._rotation02=E._rotation02;R._rotation10=E._rotation10;R._rotation11=E._rotation11;R._rotation12=E._rotation12;R._rotation20=E._rotation20;R._rotation21=E._rotation21;R._rotation22=E._rotation22;var j=this._shapeList;while(j!=null){var N=j._next;var D=j._ptransform;var F=j._localTransform;var O=this._ptransform;var W;var G;var H;var U;var J;var Q;var $;var K;var tt;W=O._rotation00*F._rotation00+O._rotation01*F._rotation10+O._rotation02*F._rotation20;G=O._rotation00*F._rotation01+O._rotation01*F._rotation11+O._rotation02*F._rotation21;H=O._rotation00*F._rotation02+O._rotation01*F._rotation12+O._rotation02*F._rotation22;U=O._rotation10*F._rotation00+O._rotation11*F._rotation10+O._rotation12*F._rotation20;J=O._rotation10*F._rotation01+O._rotation11*F._rotation11+O._rotation12*F._rotation21;Q=O._rotation10*F._rotation02+O._rotation11*F._rotation12+O._rotation12*F._rotation22;$=O._rotation20*F._rotation00+O._rotation21*F._rotation10+O._rotation22*F._rotation20;K=O._rotation20*F._rotation01+O._rotation21*F._rotation11+O._rotation22*F._rotation21;tt=O._rotation20*F._rotation02+O._rotation21*F._rotation12+O._rotation22*F._rotation22;D._rotation00=W;D._rotation01=G;D._rotation02=H;D._rotation10=U;D._rotation11=J;D._rotation12=Q;D._rotation20=$;D._rotation21=K;D._rotation22=tt;var at;var it;var rt;at=O._rotation00*F._positionX+O._rotation01*F._positionY+O._rotation02*F._positionZ;it=O._rotation10*F._positionX+O._rotation11*F._positionY+O._rotation12*F._positionZ;rt=O._rotation20*F._positionX+O._rotation21*F._positionY+O._rotation22*F._positionZ;D._positionX=at;D._positionY=it;D._positionZ=rt;D._positionX+=O._positionX;D._positionY+=O._positionY;D._positionZ+=O._positionZ;var ot=j._transform;var st=j._localTransform;var nt=this._transform;var et;var _t;var vt;var ht;var lt;var ct;var pt;var ft;var mt;et=nt._rotation00*st._rotation00+nt._rotation01*st._rotation10+nt._rotation02*st._rotation20;_t=nt._rotation00*st._rotation01+nt._rotation01*st._rotation11+nt._rotation02*st._rotation21;vt=nt._rotation00*st._rotation02+nt._rotation01*st._rotation12+nt._rotation02*st._rotation22;ht=nt._rotation10*st._rotation00+nt._rotation11*st._rotation10+nt._rotation12*st._rotation20;lt=nt._rotation10*st._rotation01+nt._rotation11*st._rotation11+nt._rotation12*st._rotation21;ct=nt._rotation10*st._rotation02+nt._rotation11*st._rotation12+nt._rotation12*st._rotation22;pt=nt._rotation20*st._rotation00+nt._rotation21*st._rotation10+nt._rotation22*st._rotation20;ft=nt._rotation20*st._rotation01+nt._rotation21*st._rotation11+nt._rotation22*st._rotation21;mt=nt._rotation20*st._rotation02+nt._rotation21*st._rotation12+nt._rotation22*st._rotation22;ot._rotation00=et;ot._rotation01=_t;ot._rotation02=vt;ot._rotation10=ht;ot._rotation11=lt;ot._rotation12=ct;ot._rotation20=pt;ot._rotation21=ft;ot._rotation22=mt;var bt;var ut;var xt;bt=nt._rotation00*st._positionX+nt._rotation01*st._positionY+nt._rotation02*st._positionZ;ut=nt._rotation10*st._positionX+nt._rotation11*st._positionY+nt._rotation12*st._positionZ;xt=nt._rotation20*st._positionX+nt._rotation21*st._positionY+nt._rotation22*st._positionZ;ot._positionX=bt;ot._positionY=ut;ot._positionZ=xt;ot._positionX+=nt._positionX;ot._positionY+=nt._positionY;ot._positionZ+=nt._positionZ;var yt;var gt;var Xt;var zt;var Mt;var Yt;var Zt;var dt;j._geom._computeAabb(j._aabb,j._ptransform);gt=j._aabb._minX;Xt=j._aabb._minY;zt=j._aabb._minZ;Yt=j._aabb._maxX;Zt=j._aabb._maxY;dt=j._aabb._maxZ;j._geom._computeAabb(j._aabb,j._transform);j._aabb._minX=gt<j._aabb._minX?gt:j._aabb._minX;j._aabb._minY=Xt<j._aabb._minY?Xt:j._aabb._minY;j._aabb._minZ=zt<j._aabb._minZ?zt:j._aabb._minZ;j._aabb._maxX=Yt>j._aabb._maxX?Yt:j._aabb._maxX;j._aabb._maxY=Zt>j._aabb._maxY?Zt:j._aabb._maxY;j._aabb._maxZ=dt>j._aabb._maxZ?dt:j._aabb._maxZ;if(j._proxy!=null){var It;var wt;var Vt;var Lt;wt=j._transform._positionX-j._ptransform._positionX;Vt=j._transform._positionY-j._ptransform._positionY;Lt=j._transform._positionZ-j._ptransform._positionZ;var At=j.displacement;At.x=wt;At.y=Vt;At.z=Lt;j._rigidBody._world._broadPhase.moveProxy(j._proxy,j._aabb,j.displacement)}j=N}this._sleeping=false;this._sleepTime=0},rotateXyz:function(t){var a;var i;var r;var o;var s;var n;var e;var _;var v;var h;var l;var c;var p;var f;var m=t;i=m.x;r=m.y;o=m.z;var b=Math.sin(i);var u=Math.sin(r);var x=Math.sin(o);var y=Math.cos(i);var g=Math.cos(r);var X=Math.cos(o);n=g*X;e=-g*x;_=u;v=y*x+X*b*u;h=y*X-b*u*x;l=-g*b;c=b*x-y*X*u;p=X*b+y*u*x;f=y*g;var z;var M;var Y;var Z;var d;var I;var w;var V;var L;z=n*this._transform._rotation00+e*this._transform._rotation10+_*this._transform._rotation20;M=n*this._transform._rotation01+e*this._transform._rotation11+_*this._transform._rotation21;Y=n*this._transform._rotation02+e*this._transform._rotation12+_*this._transform._rotation22;Z=v*this._transform._rotation00+h*this._transform._rotation10+l*this._transform._rotation20;d=v*this._transform._rotation01+h*this._transform._rotation11+l*this._transform._rotation21;I=v*this._transform._rotation02+h*this._transform._rotation12+l*this._transform._rotation22;w=c*this._transform._rotation00+p*this._transform._rotation10+f*this._transform._rotation20;V=c*this._transform._rotation01+p*this._transform._rotation11+f*this._transform._rotation21;L=c*this._transform._rotation02+p*this._transform._rotation12+f*this._transform._rotation22;this._transform._rotation00=z;this._transform._rotation01=M;this._transform._rotation02=Y;this._transform._rotation10=Z;this._transform._rotation11=d;this._transform._rotation12=I;this._transform._rotation20=w;this._transform._rotation21=V;this._transform._rotation22=L;var A;var k;var B;var P;var T;var S;var C;var q;var R;A=this._transform._rotation00*this._invLocalInertia00+this._transform._rotation01*this._invLocalInertia10+this._transform._rotation02*this._invLocalInertia20;k=this._transform._rotation00*this._invLocalInertia01+this._transform._rotation01*this._invLocalInertia11+this._transform._rotation02*this._invLocalInertia21;B=this._transform._rotation00*this._invLocalInertia02+this._transform._rotation01*this._invLocalInertia12+this._transform._rotation02*this._invLocalInertia22;P=this._transform._rotation10*this._invLocalInertia00+this._transform._rotation11*this._invLocalInertia10+this._transform._rotation12*this._invLocalInertia20;T=this._transform._rotation10*this._invLocalInertia01+this._transform._rotation11*this._invLocalInertia11+this._transform._rotation12*this._invLocalInertia21;S=this._transform._rotation10*this._invLocalInertia02+this._transform._rotation11*this._invLocalInertia12+this._transform._rotation12*this._invLocalInertia22;C=this._transform._rotation20*this._invLocalInertia00+this._transform._rotation21*this._invLocalInertia10+this._transform._rotation22*this._invLocalInertia20;q=this._transform._rotation20*this._invLocalInertia01+this._transform._rotation21*this._invLocalInertia11+this._transform._rotation22*this._invLocalInertia21;R=this._transform._rotation20*this._invLocalInertia02+this._transform._rotation21*this._invLocalInertia12+this._transform._rotation22*this._invLocalInertia22;this._invInertia00=A;this._invInertia01=k;this._invInertia02=B;this._invInertia10=P;this._invInertia11=T;this._invInertia12=S;this._invInertia20=C;this._invInertia21=q;this._invInertia22=R;var E;var j;var N;var D;var F;var O;var W;var G;var H;E=this._invInertia00*this._transform._rotation00+this._invInertia01*this._transform._rotation01+this._invInertia02*this._transform._rotation02;j=this._invInertia00*this._transform._rotation10+this._invInertia01*this._transform._rotation11+this._invInertia02*this._transform._rotation12;N=this._invInertia00*this._transform._rotation20+this._invInertia01*this._transform._rotation21+this._invInertia02*this._transform._rotation22;D=this._invInertia10*this._transform._rotation00+this._invInertia11*this._transform._rotation01+this._invInertia12*this._transform._rotation02;F=this._invInertia10*this._transform._rotation10+this._invInertia11*this._transform._rotation11+this._invInertia12*this._transform._rotation12;O=this._invInertia10*this._transform._rotation20+this._invInertia11*this._transform._rotation21+this._invInertia12*this._transform._rotation22;W=this._invInertia20*this._transform._rotation00+this._invInertia21*this._transform._rotation01+this._invInertia22*this._transform._rotation02;G=this._invInertia20*this._transform._rotation10+this._invInertia21*this._transform._rotation11+this._invInertia22*this._transform._rotation12;H=this._invInertia20*this._transform._rotation20+this._invInertia21*this._transform._rotation21+this._invInertia22*this._transform._rotation22;this._invInertia00=E;this._invInertia01=j;this._invInertia02=N;this._invInertia10=D;this._invInertia11=F;this._invInertia12=O;this._invInertia20=W;this._invInertia21=G;this._invInertia22=H;this._invInertia00*=this._rotFactor.x;this._invInertia01*=this._rotFactor.x;this._invInertia02*=this._rotFactor.x;this._invInertia10*=this._rotFactor.y;this._invInertia11*=this._rotFactor.y;this._invInertia12*=this._rotFactor.y;this._invInertia20*=this._rotFactor.z;this._invInertia21*=this._rotFactor.z;this._invInertia22*=this._rotFactor.z;var U=this._ptransform;var J=this._transform;U._positionX=J._positionX;U._positionY=J._positionY;U._positionZ=J._positionZ;U._rotation00=J._rotation00;U._rotation01=J._rotation01;U._rotation02=J._rotation02;U._rotation10=J._rotation10;U._rotation11=J._rotation11;U._rotation12=J._rotation12;U._rotation20=J._rotation20;U._rotation21=J._rotation21;U._rotation22=J._rotation22;var Q=this._shapeList;while(Q!=null){var $=Q._next;var K=Q._ptransform;var tt=Q._localTransform;var at=this._ptransform;var it;var rt;var ot;var st;var nt;var et;var _t;var vt;var ht;it=at._rotation00*tt._rotation00+at._rotation01*tt._rotation10+at._rotation02*tt._rotation20;rt=at._rotation00*tt._rotation01+at._rotation01*tt._rotation11+at._rotation02*tt._rotation21;ot=at._rotation00*tt._rotation02+at._rotation01*tt._rotation12+at._rotation02*tt._rotation22;st=at._rotation10*tt._rotation00+at._rotation11*tt._rotation10+at._rotation12*tt._rotation20;nt=at._rotation10*tt._rotation01+at._rotation11*tt._rotation11+at._rotation12*tt._rotation21;et=at._rotation10*tt._rotation02+at._rotation11*tt._rotation12+at._rotation12*tt._rotation22;_t=at._rotation20*tt._rotation00+at._rotation21*tt._rotation10+at._rotation22*tt._rotation20;vt=at._rotation20*tt._rotation01+at._rotation21*tt._rotation11+at._rotation22*tt._rotation21;ht=at._rotation20*tt._rotation02+at._rotation21*tt._rotation12+at._rotation22*tt._rotation22;K._rotation00=it;K._rotation01=rt;K._rotation02=ot;K._rotation10=st;K._rotation11=nt;K._rotation12=et;K._rotation20=_t;K._rotation21=vt;K._rotation22=ht;var lt;var ct;var pt;lt=at._rotation00*tt._positionX+at._rotation01*tt._positionY+at._rotation02*tt._positionZ;ct=at._rotation10*tt._positionX+at._rotation11*tt._positionY+at._rotation12*tt._positionZ;pt=at._rotation20*tt._positionX+at._rotation21*tt._positionY+at._rotation22*tt._positionZ;K._positionX=lt;K._positionY=ct;K._positionZ=pt;K._positionX+=at._positionX;K._positionY+=at._positionY;K._positionZ+=at._positionZ;var ft=Q._transform;var mt=Q._localTransform;var bt=this._transform;var ut;var xt;var yt;var gt;var Xt;var zt;var Mt;var Yt;var Zt;ut=bt._rotation00*mt._rotation00+bt._rotation01*mt._rotation10+bt._rotation02*mt._rotation20;xt=bt._rotation00*mt._rotation01+bt._rotation01*mt._rotation11+bt._rotation02*mt._rotation21;yt=bt._rotation00*mt._rotation02+bt._rotation01*mt._rotation12+bt._rotation02*mt._rotation22;gt=bt._rotation10*mt._rotation00+bt._rotation11*mt._rotation10+bt._rotation12*mt._rotation20;Xt=bt._rotation10*mt._rotation01+bt._rotation11*mt._rotation11+bt._rotation12*mt._rotation21;zt=bt._rotation10*mt._rotation02+bt._rotation11*mt._rotation12+bt._rotation12*mt._rotation22;Mt=bt._rotation20*mt._rotation00+bt._rotation21*mt._rotation10+bt._rotation22*mt._rotation20;Yt=bt._rotation20*mt._rotation01+bt._rotation21*mt._rotation11+bt._rotation22*mt._rotation21;Zt=bt._rotation20*mt._rotation02+bt._rotation21*mt._rotation12+bt._rotation22*mt._rotation22;ft._rotation00=ut;ft._rotation01=xt;ft._rotation02=yt;ft._rotation10=gt;ft._rotation11=Xt;ft._rotation12=zt;ft._rotation20=Mt;ft._rotation21=Yt;ft._rotation22=Zt;var dt;var It;var wt;dt=bt._rotation00*mt._positionX+bt._rotation01*mt._positionY+bt._rotation02*mt._positionZ;It=bt._rotation10*mt._positionX+bt._rotation11*mt._positionY+bt._rotation12*mt._positionZ;wt=bt._rotation20*mt._positionX+bt._rotation21*mt._positionY+bt._rotation22*mt._positionZ;ft._positionX=dt;ft._positionY=It;ft._positionZ=wt;ft._positionX+=bt._positionX;ft._positionY+=bt._positionY;ft._positionZ+=bt._positionZ;var Vt;var Lt;var At;var kt;var Bt;var Pt;var Tt;var St;Q._geom._computeAabb(Q._aabb,Q._ptransform);Lt=Q._aabb._minX;At=Q._aabb._minY;kt=Q._aabb._minZ;Pt=Q._aabb._maxX;Tt=Q._aabb._maxY;St=Q._aabb._maxZ;Q._geom._computeAabb(Q._aabb,Q._transform);Q._aabb._minX=Lt<Q._aabb._minX?Lt:Q._aabb._minX;Q._aabb._minY=At<Q._aabb._minY?At:Q._aabb._minY;Q._aabb._minZ=kt<Q._aabb._minZ?kt:Q._aabb._minZ;Q._aabb._maxX=Pt>Q._aabb._maxX?Pt:Q._aabb._maxX;Q._aabb._maxY=Tt>Q._aabb._maxY?Tt:Q._aabb._maxY;Q._aabb._maxZ=St>Q._aabb._maxZ?St:Q._aabb._maxZ;if(Q._proxy!=null){var Ct;var qt;var Rt;var Et;qt=Q._transform._positionX-Q._ptransform._positionX;Rt=Q._transform._positionY-Q._ptransform._positionY;Et=Q._transform._positionZ-Q._ptransform._positionZ;var jt=Q.displacement;jt.x=qt;jt.y=Rt;jt.z=Et;Q._rigidBody._world._broadPhase.moveProxy(Q._proxy,Q._aabb,Q.displacement)}Q=$}this._sleeping=false;this._sleepTime=0},getOrientation:function(){var t=new va;var a;var i;var r;var o;var s;var n=this._transform._rotation00;var e=this._transform._rotation11;var _=this._transform._rotation22;var v=n+e+_;var h;if(v>0){h=Math.sqrt(v+1);s=.5*h;h=.5/h;i=(this._transform._rotation21-this._transform._rotation12)*h;r=(this._transform._rotation02-this._transform._rotation20)*h;o=(this._transform._rotation10-this._transform._rotation01)*h}else if(n>e){if(n>_){h=Math.sqrt(n-e-_+1);i=.5*h;h=.5/h;r=(this._transform._rotation01+this._transform._rotation10)*h;o=(this._transform._rotation02+this._transform._rotation20)*h;s=(this._transform._rotation21-this._transform._rotation12)*h}else{h=Math.sqrt(_-n-e+1);o=.5*h;h=.5/h;i=(this._transform._rotation02+this._transform._rotation20)*h;r=(this._transform._rotation12+this._transform._rotation21)*h;s=(this._transform._rotation10-this._transform._rotation01)*h}}else if(e>_){h=Math.sqrt(e-_-n+1);r=.5*h;h=.5/h;i=(this._transform._rotation01+this._transform._rotation10)*h;o=(this._transform._rotation12+this._transform._rotation21)*h;s=(this._transform._rotation02-this._transform._rotation20)*h}else{h=Math.sqrt(_-n-e+1);o=.5*h;h=.5/h;i=(this._transform._rotation02+this._transform._rotation20)*h;r=(this._transform._rotation12+this._transform._rotation21)*h;s=(this._transform._rotation10-this._transform._rotation01)*h}var l=t;l.x=i;l.y=r;l.z=o;l.w=s;return t},getOrientationTo:function(t){var a;var i;var r;var o;var s;var n=this._transform._rotation00;var e=this._transform._rotation11;var _=this._transform._rotation22;var v=n+e+_;var h;if(v>0){h=Math.sqrt(v+1);s=.5*h;h=.5/h;i=(this._transform._rotation21-this._transform._rotation12)*h;r=(this._transform._rotation02-this._transform._rotation20)*h;o=(this._transform._rotation10-this._transform._rotation01)*h}else if(n>e){if(n>_){h=Math.sqrt(n-e-_+1);i=.5*h;h=.5/h;r=(this._transform._rotation01+this._transform._rotation10)*h;o=(this._transform._rotation02+this._transform._rotation20)*h;s=(this._transform._rotation21-this._transform._rotation12)*h}else{h=Math.sqrt(_-n-e+1);o=.5*h;h=.5/h;i=(this._transform._rotation02+this._transform._rotation20)*h;r=(this._transform._rotation12+this._transform._rotation21)*h;s=(this._transform._rotation10-this._transform._rotation01)*h}}else if(e>_){h=Math.sqrt(e-_-n+1);r=.5*h;h=.5/h;i=(this._transform._rotation01+this._transform._rotation10)*h;o=(this._transform._rotation12+this._transform._rotation21)*h;s=(this._transform._rotation02-this._transform._rotation20)*h}else{h=Math.sqrt(_-n-e+1);o=.5*h;h=.5/h;i=(this._transform._rotation02+this._transform._rotation20)*h;r=(this._transform._rotation12+this._transform._rotation21)*h;s=(this._transform._rotation10-this._transform._rotation01)*h}var l=t;l.x=i;l.y=r;l.z=o;l.w=s},setOrientation:function(t){var a;var i;var r;var o;var s;var n=t;i=n.x;r=n.y;o=n.z;s=n.w;var e=i;var _=r;var v=o;var h=s;var l=2*e;var c=2*_;var p=2*v;var f=e*l;var m=_*c;var b=v*p;var u=e*c;var x=_*p;var y=e*p;var g=h*l;var X=h*c;var z=h*p;this._transform._rotation00=1-m-b;this._transform._rotation01=u-z;this._transform._rotation02=y+X;this._transform._rotation10=u+z;this._transform._rotation11=1-f-b;this._transform._rotation12=x-g;this._transform._rotation20=y-X;this._transform._rotation21=x+g;this._transform._rotation22=1-f-m;var M;var Y;var Z;var d;var I;var w;var V;var L;var A;M=this._transform._rotation00*this._invLocalInertia00+this._transform._rotation01*this._invLocalInertia10+this._transform._rotation02*this._invLocalInertia20;Y=this._transform._rotation00*this._invLocalInertia01+this._transform._rotation01*this._invLocalInertia11+this._transform._rotation02*this._invLocalInertia21;Z=this._transform._rotation00*this._invLocalInertia02+this._transform._rotation01*this._invLocalInertia12+this._transform._rotation02*this._invLocalInertia22;d=this._transform._rotation10*this._invLocalInertia00+this._transform._rotation11*this._invLocalInertia10+this._transform._rotation12*this._invLocalInertia20;I=this._transform._rotation10*this._invLocalInertia01+this._transform._rotation11*this._invLocalInertia11+this._transform._rotation12*this._invLocalInertia21;w=this._transform._rotation10*this._invLocalInertia02+this._transform._rotation11*this._invLocalInertia12+this._transform._rotation12*this._invLocalInertia22;V=this._transform._rotation20*this._invLocalInertia00+this._transform._rotation21*this._invLocalInertia10+this._transform._rotation22*this._invLocalInertia20;L=this._transform._rotation20*this._invLocalInertia01+this._transform._rotation21*this._invLocalInertia11+this._transform._rotation22*this._invLocalInertia21;A=this._transform._rotation20*this._invLocalInertia02+this._transform._rotation21*this._invLocalInertia12+this._transform._rotation22*this._invLocalInertia22;this._invInertia00=M;this._invInertia01=Y;this._invInertia02=Z;this._invInertia10=d;this._invInertia11=I;this._invInertia12=w;this._invInertia20=V;this._invInertia21=L;this._invInertia22=A;var k;var B;var P;var T;var S;var C;var q;var R;var E;k=this._invInertia00*this._transform._rotation00+this._invInertia01*this._transform._rotation01+this._invInertia02*this._transform._rotation02;B=this._invInertia00*this._transform._rotation10+this._invInertia01*this._transform._rotation11+this._invInertia02*this._transform._rotation12;P=this._invInertia00*this._transform._rotation20+this._invInertia01*this._transform._rotation21+this._invInertia02*this._transform._rotation22;T=this._invInertia10*this._transform._rotation00+this._invInertia11*this._transform._rotation01+this._invInertia12*this._transform._rotation02;S=this._invInertia10*this._transform._rotation10+this._invInertia11*this._transform._rotation11+this._invInertia12*this._transform._rotation12;C=this._invInertia10*this._transform._rotation20+this._invInertia11*this._transform._rotation21+this._invInertia12*this._transform._rotation22;q=this._invInertia20*this._transform._rotation00+this._invInertia21*this._transform._rotation01+this._invInertia22*this._transform._rotation02;R=this._invInertia20*this._transform._rotation10+this._invInertia21*this._transform._rotation11+this._invInertia22*this._transform._rotation12;E=this._invInertia20*this._transform._rotation20+this._invInertia21*this._transform._rotation21+this._invInertia22*this._transform._rotation22;this._invInertia00=k;this._invInertia01=B;this._invInertia02=P;this._invInertia10=T;this._invInertia11=S;this._invInertia12=C;this._invInertia20=q;this._invInertia21=R;this._invInertia22=E;this._invInertia00*=this._rotFactor.x;this._invInertia01*=this._rotFactor.x;this._invInertia02*=this._rotFactor.x;this._invInertia10*=this._rotFactor.y;this._invInertia11*=this._rotFactor.y;this._invInertia12*=this._rotFactor.y;this._invInertia20*=this._rotFactor.z;this._invInertia21*=this._rotFactor.z;this._invInertia22*=this._rotFactor.z;var j=this._ptransform;var N=this._transform;j._positionX=N._positionX;j._positionY=N._positionY;j._positionZ=N._positionZ;j._rotation00=N._rotation00;j._rotation01=N._rotation01;j._rotation02=N._rotation02;j._rotation10=N._rotation10;j._rotation11=N._rotation11;j._rotation12=N._rotation12;j._rotation20=N._rotation20;j._rotation21=N._rotation21;j._rotation22=N._rotation22;var D=this._shapeList;while(D!=null){var F=D._next;var O=D._ptransform;var W=D._localTransform;var G=this._ptransform;var H;var U;var J;var Q;var $;var K;var tt;var at;var it;H=G._rotation00*W._rotation00+G._rotation01*W._rotation10+G._rotation02*W._rotation20;U=G._rotation00*W._rotation01+G._rotation01*W._rotation11+G._rotation02*W._rotation21;J=G._rotation00*W._rotation02+G._rotation01*W._rotation12+G._rotation02*W._rotation22;Q=G._rotation10*W._rotation00+G._rotation11*W._rotation10+G._rotation12*W._rotation20;$=G._rotation10*W._rotation01+G._rotation11*W._rotation11+G._rotation12*W._rotation21;K=G._rotation10*W._rotation02+G._rotation11*W._rotation12+G._rotation12*W._rotation22;tt=G._rotation20*W._rotation00+G._rotation21*W._rotation10+G._rotation22*W._rotation20;at=G._rotation20*W._rotation01+G._rotation21*W._rotation11+G._rotation22*W._rotation21;it=G._rotation20*W._rotation02+G._rotation21*W._rotation12+G._rotation22*W._rotation22;O._rotation00=H;O._rotation01=U;O._rotation02=J;O._rotation10=Q;O._rotation11=$;O._rotation12=K;O._rotation20=tt;O._rotation21=at;O._rotation22=it;var rt;var ot;var st;rt=G._rotation00*W._positionX+G._rotation01*W._positionY+G._rotation02*W._positionZ;ot=G._rotation10*W._positionX+G._rotation11*W._positionY+G._rotation12*W._positionZ;st=G._rotation20*W._positionX+G._rotation21*W._positionY+G._rotation22*W._positionZ;O._positionX=rt;O._positionY=ot;O._positionZ=st;O._positionX+=G._positionX;O._positionY+=G._positionY;O._positionZ+=G._positionZ;var nt=D._transform;var et=D._localTransform;var _t=this._transform;var vt;var ht;var lt;var ct;var pt;var ft;var mt;var bt;var ut;vt=_t._rotation00*et._rotation00+_t._rotation01*et._rotation10+_t._rotation02*et._rotation20;ht=_t._rotation00*et._rotation01+_t._rotation01*et._rotation11+_t._rotation02*et._rotation21;lt=_t._rotation00*et._rotation02+_t._rotation01*et._rotation12+_t._rotation02*et._rotation22;ct=_t._rotation10*et._rotation00+_t._rotation11*et._rotation10+_t._rotation12*et._rotation20;pt=_t._rotation10*et._rotation01+_t._rotation11*et._rotation11+_t._rotation12*et._rotation21;ft=_t._rotation10*et._rotation02+_t._rotation11*et._rotation12+_t._rotation12*et._rotation22;mt=_t._rotation20*et._rotation00+_t._rotation21*et._rotation10+_t._rotation22*et._rotation20;bt=_t._rotation20*et._rotation01+_t._rotation21*et._rotation11+_t._rotation22*et._rotation21;ut=_t._rotation20*et._rotation02+_t._rotation21*et._rotation12+_t._rotation22*et._rotation22;nt._rotation00=vt;nt._rotation01=ht;nt._rotation02=lt;nt._rotation10=ct;nt._rotation11=pt;nt._rotation12=ft;nt._rotation20=mt;nt._rotation21=bt;nt._rotation22=ut;var xt;var yt;var gt;xt=_t._rotation00*et._positionX+_t._rotation01*et._positionY+_t._rotation02*et._positionZ;yt=_t._rotation10*et._positionX+_t._rotation11*et._positionY+_t._rotation12*et._positionZ;gt=_t._rotation20*et._positionX+_t._rotation21*et._positionY+_t._rotation22*et._positionZ;nt._positionX=xt;nt._positionY=yt;nt._positionZ=gt;nt._positionX+=_t._positionX;nt._positionY+=_t._positionY;nt._positionZ+=_t._positionZ;var Xt;var zt;var Mt;var Yt;var Zt;var dt;var It;var wt;D._geom._computeAabb(D._aabb,D._ptransform);zt=D._aabb._minX;Mt=D._aabb._minY;Yt=D._aabb._minZ;dt=D._aabb._maxX;It=D._aabb._maxY;wt=D._aabb._maxZ;D._geom._computeAabb(D._aabb,D._transform);D._aabb._minX=zt<D._aabb._minX?zt:D._aabb._minX;D._aabb._minY=Mt<D._aabb._minY?Mt:D._aabb._minY;D._aabb._minZ=Yt<D._aabb._minZ?Yt:D._aabb._minZ;D._aabb._maxX=dt>D._aabb._maxX?dt:D._aabb._maxX;D._aabb._maxY=It>D._aabb._maxY?It:D._aabb._maxY;D._aabb._maxZ=wt>D._aabb._maxZ?wt:D._aabb._maxZ;if(D._proxy!=null){var Vt;var Lt;var At;var kt;Lt=D._transform._positionX-D._ptransform._positionX;At=D._transform._positionY-D._ptransform._positionY;kt=D._transform._positionZ-D._ptransform._positionZ;var Bt=D.displacement;Bt.x=Lt;Bt.y=At;Bt.z=kt;D._rigidBody._world._broadPhase.moveProxy(D._proxy,D._aabb,D.displacement)}D=F}this._sleeping=false;this._sleepTime=0},getTransform:function(){var t=this._transform;var a=new j;a._positionX=t._positionX;a._positionY=t._positionY;a._positionZ=t._positionZ;a._rotation00=t._rotation00;a._rotation01=t._rotation01;a._rotation02=t._rotation02;a._rotation10=t._rotation10;a._rotation11=t._rotation11;a._rotation12=t._rotation12;a._rotation20=t._rotation20;a._rotation21=t._rotation21;a._rotation22=t._rotation22;return a},getTransformTo:function(t){var a=this._transform;t._positionX=a._positionX;t._positionY=a._positionY;t._positionZ=a._positionZ;t._rotation00=a._rotation00;t._rotation01=a._rotation01;t._rotation02=a._rotation02;t._rotation10=a._rotation10;t._rotation11=a._rotation11;t._rotation12=a._rotation12;t._rotation20=a._rotation20;t._rotation21=a._rotation21;t._rotation22=a._rotation22},setTransform:function(t){this._transform._positionX=t._positionX;this._transform._positionY=t._positionY;this._transform._positionZ=t._positionZ;this._transform._rotation00=t._rotation00;this._transform._rotation01=t._rotation01;this._transform._rotation02=t._rotation02;this._transform._rotation10=t._rotation10;this._transform._rotation11=t._rotation11;this._transform._rotation12=t._rotation12;this._transform._rotation20=t._rotation20;this._transform._rotation21=t._rotation21;this._transform._rotation22=t._rotation22;var a;var i;var r;var o;var s;var n;var e;var _;var v;a=this._transform._rotation00*this._invLocalInertia00+this._transform._rotation01*this._invLocalInertia10+this._transform._rotation02*this._invLocalInertia20;i=this._transform._rotation00*this._invLocalInertia01+this._transform._rotation01*this._invLocalInertia11+this._transform._rotation02*this._invLocalInertia21;r=this._transform._rotation00*this._invLocalInertia02+this._transform._rotation01*this._invLocalInertia12+this._transform._rotation02*this._invLocalInertia22;o=this._transform._rotation10*this._invLocalInertia00+this._transform._rotation11*this._invLocalInertia10+this._transform._rotation12*this._invLocalInertia20;s=this._transform._rotation10*this._invLocalInertia01+this._transform._rotation11*this._invLocalInertia11+this._transform._rotation12*this._invLocalInertia21;n=this._transform._rotation10*this._invLocalInertia02+this._transform._rotation11*this._invLocalInertia12+this._transform._rotation12*this._invLocalInertia22;e=this._transform._rotation20*this._invLocalInertia00+this._transform._rotation21*this._invLocalInertia10+this._transform._rotation22*this._invLocalInertia20;_=this._transform._rotation20*this._invLocalInertia01+this._transform._rotation21*this._invLocalInertia11+this._transform._rotation22*this._invLocalInertia21;v=this._transform._rotation20*this._invLocalInertia02+this._transform._rotation21*this._invLocalInertia12+this._transform._rotation22*this._invLocalInertia22;this._invInertia00=a;this._invInertia01=i;this._invInertia02=r;this._invInertia10=o;this._invInertia11=s;this._invInertia12=n;this._invInertia20=e;this._invInertia21=_;this._invInertia22=v;var h;var l;var c;var p;var f;var m;var b;var u;var x;h=this._invInertia00*this._transform._rotation00+this._invInertia01*this._transform._rotation01+this._invInertia02*this._transform._rotation02;l=this._invInertia00*this._transform._rotation10+this._invInertia01*this._transform._rotation11+this._invInertia02*this._transform._rotation12;c=this._invInertia00*this._transform._rotation20+this._invInertia01*this._transform._rotation21+this._invInertia02*this._transform._rotation22;p=this._invInertia10*this._transform._rotation00+this._invInertia11*this._transform._rotation01+this._invInertia12*this._transform._rotation02;f=this._invInertia10*this._transform._rotation10+this._invInertia11*this._transform._rotation11+this._invInertia12*this._transform._rotation12;m=this._invInertia10*this._transform._rotation20+this._invInertia11*this._transform._rotation21+this._invInertia12*this._transform._rotation22;b=this._invInertia20*this._transform._rotation00+this._invInertia21*this._transform._rotation01+this._invInertia22*this._transform._rotation02;u=this._invInertia20*this._transform._rotation10+this._invInertia21*this._transform._rotation11+this._invInertia22*this._transform._rotation12;x=this._invInertia20*this._transform._rotation20+this._invInertia21*this._transform._rotation21+this._invInertia22*this._transform._rotation22;this._invInertia00=h;this._invInertia01=l;this._invInertia02=c;this._invInertia10=p;this._invInertia11=f;this._invInertia12=m;this._invInertia20=b;this._invInertia21=u;this._invInertia22=x;this._invInertia00*=this._rotFactor.x;this._invInertia01*=this._rotFactor.x;this._invInertia02*=this._rotFactor.x;this._invInertia10*=this._rotFactor.y;this._invInertia11*=this._rotFactor.y;this._invInertia12*=this._rotFactor.y;this._invInertia20*=this._rotFactor.z;this._invInertia21*=this._rotFactor.z;this._invInertia22*=this._rotFactor.z;var y=this._ptransform;var g=this._transform;y._positionX=g._positionX;y._positionY=g._positionY;y._positionZ=g._positionZ;y._rotation00=g._rotation00;y._rotation01=g._rotation01;y._rotation02=g._rotation02;y._rotation10=g._rotation10;y._rotation11=g._rotation11;y._rotation12=g._rotation12;y._rotation20=g._rotation20;y._rotation21=g._rotation21;y._rotation22=g._rotation22;var X=this._shapeList;while(X!=null){var z=X._next;var M=X._ptransform;var Y=X._localTransform;var Z=this._ptransform;var d;var I;var w;var V;var L;var A;var k;var B;var P;d=Z._rotation00*Y._rotation00+Z._rotation01*Y._rotation10+Z._rotation02*Y._rotation20;I=Z._rotation00*Y._rotation01+Z._rotation01*Y._rotation11+Z._rotation02*Y._rotation21;w=Z._rotation00*Y._rotation02+Z._rotation01*Y._rotation12+Z._rotation02*Y._rotation22;V=Z._rotation10*Y._rotation00+Z._rotation11*Y._rotation10+Z._rotation12*Y._rotation20;L=Z._rotation10*Y._rotation01+Z._rotation11*Y._rotation11+Z._rotation12*Y._rotation21;A=Z._rotation10*Y._rotation02+Z._rotation11*Y._rotation12+Z._rotation12*Y._rotation22;k=Z._rotation20*Y._rotation00+Z._rotation21*Y._rotation10+Z._rotation22*Y._rotation20;B=Z._rotation20*Y._rotation01+Z._rotation21*Y._rotation11+Z._rotation22*Y._rotation21;P=Z._rotation20*Y._rotation02+Z._rotation21*Y._rotation12+Z._rotation22*Y._rotation22;M._rotation00=d;M._rotation01=I;M._rotation02=w;M._rotation10=V;M._rotation11=L;M._rotation12=A;M._rotation20=k;M._rotation21=B;M._rotation22=P;var T;var S;var C;T=Z._rotation00*Y._positionX+Z._rotation01*Y._positionY+Z._rotation02*Y._positionZ;S=Z._rotation10*Y._positionX+Z._rotation11*Y._positionY+Z._rotation12*Y._positionZ;C=Z._rotation20*Y._positionX+Z._rotation21*Y._positionY+Z._rotation22*Y._positionZ;M._positionX=T;M._positionY=S;M._positionZ=C;M._positionX+=Z._positionX;M._positionY+=Z._positionY;M._positionZ+=Z._positionZ;var q=X._transform;var R=X._localTransform;var E=this._transform;var j;var N;var D;var F;var O;var W;var G;var H;var U;j=E._rotation00*R._rotation00+E._rotation01*R._rotation10+E._rotation02*R._rotation20;N=E._rotation00*R._rotation01+E._rotation01*R._rotation11+E._rotation02*R._rotation21;D=E._rotation00*R._rotation02+E._rotation01*R._rotation12+E._rotation02*R._rotation22;F=E._rotation10*R._rotation00+E._rotation11*R._rotation10+E._rotation12*R._rotation20;O=E._rotation10*R._rotation01+E._rotation11*R._rotation11+E._rotation12*R._rotation21;W=E._rotation10*R._rotation02+E._rotation11*R._rotation12+E._rotation12*R._rotation22;G=E._rotation20*R._rotation00+E._rotation21*R._rotation10+E._rotation22*R._rotation20;H=E._rotation20*R._rotation01+E._rotation21*R._rotation11+E._rotation22*R._rotation21;U=E._rotation20*R._rotation02+E._rotation21*R._rotation12+E._rotation22*R._rotation22;q._rotation00=j;q._rotation01=N;q._rotation02=D;q._rotation10=F;q._rotation11=O;q._rotation12=W;q._rotation20=G;q._rotation21=H;q._rotation22=U;var J;var Q;var $;J=E._rotation00*R._positionX+E._rotation01*R._positionY+E._rotation02*R._positionZ;Q=E._rotation10*R._positionX+E._rotation11*R._positionY+E._rotation12*R._positionZ;$=E._rotation20*R._positionX+E._rotation21*R._positionY+E._rotation22*R._positionZ;q._positionX=J;q._positionY=Q;q._positionZ=$;q._positionX+=E._positionX;q._positionY+=E._positionY;q._positionZ+=E._positionZ;var K;var tt;var at;var it;var rt;var ot;var st;var nt;X._geom._computeAabb(X._aabb,X._ptransform);tt=X._aabb._minX;at=X._aabb._minY;it=X._aabb._minZ;ot=X._aabb._maxX;st=X._aabb._maxY;nt=X._aabb._maxZ;X._geom._computeAabb(X._aabb,X._transform);X._aabb._minX=tt<X._aabb._minX?tt:X._aabb._minX;X._aabb._minY=at<X._aabb._minY?at:X._aabb._minY;X._aabb._minZ=it<X._aabb._minZ?it:X._aabb._minZ;X._aabb._maxX=ot>X._aabb._maxX?ot:X._aabb._maxX;X._aabb._maxY=st>X._aabb._maxY?st:X._aabb._maxY;X._aabb._maxZ=nt>X._aabb._maxZ?nt:X._aabb._maxZ;if(X._proxy!=null){var et;var _t;var vt;var ht;_t=X._transform._positionX-X._ptransform._positionX;vt=X._transform._positionY-X._ptransform._positionY;ht=X._transform._positionZ-X._ptransform._positionZ;var lt=X.displacement;lt.x=_t;lt.y=vt;lt.z=ht;X._rigidBody._world._broadPhase.moveProxy(X._proxy,X._aabb,X.displacement)}X=z}this._sleeping=false;this._sleepTime=0},getMass:function(){return this._mass},getLocalInertia:function(){var t=new ws;var a=t;a.e00=this._localInertia00;a.e01=this._localInertia01;a.e02=this._localInertia02;a.e10=this._localInertia10;a.e11=this._localInertia11;a.e12=this._localInertia12;a.e20=this._localInertia20;a.e21=this._localInertia21;a.e22=this._localInertia22;return t},getLocalInertiaTo:function(t){var a=t;a.e00=this._localInertia00;a.e01=this._localInertia01;a.e02=this._localInertia02;a.e10=this._localInertia10;a.e11=this._localInertia11;a.e12=this._localInertia12;a.e20=this._localInertia20;a.e21=this._localInertia21;a.e22=this._localInertia22},getMassData:function(){var t=new ta;t.mass=this._mass;var a=t.localInertia;a.e00=this._localInertia00;a.e01=this._localInertia01;a.e02=this._localInertia02;a.e10=this._localInertia10;a.e11=this._localInertia11;a.e12=this._localInertia12;a.e20=this._localInertia20;a.e21=this._localInertia21;a.e22=this._localInertia22;return t},getMassDataTo:function(t){t.mass=this._mass;var a=t.localInertia;a.e00=this._localInertia00;a.e01=this._localInertia01;a.e02=this._localInertia02;a.e10=this._localInertia10;a.e11=this._localInertia11;a.e12=this._localInertia12;a.e20=this._localInertia20;a.e21=this._localInertia21;a.e22=this._localInertia22},setMassData:function(t){this._mass=t.mass;var a=t.localInertia;this._localInertia00=a.e00;this._localInertia01=a.e01;this._localInertia02=a.e02;this._localInertia10=a.e10;this._localInertia11=a.e11;this._localInertia12=a.e12;this._localInertia20=a.e20;this._localInertia21=a.e21;this._localInertia22=a.e22;var i=this._localInertia11*this._localInertia22-this._localInertia12*this._localInertia21;var r=this._localInertia10*this._localInertia22-this._localInertia12*this._localInertia20;var o=this._localInertia10*this._localInertia21-this._localInertia11*this._localInertia20;var s=this._localInertia00*i-this._localInertia01*r+this._localInertia02*o;if(this._mass>0&&s>0&&this._type==0){this._invMass=1/this._mass;var n=this._localInertia11*this._localInertia22-this._localInertia12*this._localInertia21;var e=this._localInertia10*this._localInertia22-this._localInertia12*this._localInertia20;var _=this._localInertia10*this._localInertia21-this._localInertia11*this._localInertia20;var v=this._localInertia01*this._localInertia22-this._localInertia02*this._localInertia21;var h=this._localInertia00*this._localInertia22-this._localInertia02*this._localInertia20;var l=this._localInertia00*this._localInertia21-this._localInertia01*this._localInertia20;var c=this._localInertia01*this._localInertia12-this._localInertia02*this._localInertia11;var p=this._localInertia00*this._localInertia12-this._localInertia02*this._localInertia10;var f=this._localInertia00*this._localInertia11-this._localInertia01*this._localInertia10;var m=this._localInertia00*n-this._localInertia01*e+this._localInertia02*_;if(m<-1e-32||m>1e-32){m=1/m}this._invLocalInertia00=n*m;this._invLocalInertia01=-v*m;this._invLocalInertia02=c*m;this._invLocalInertia10=-e*m;this._invLocalInertia11=h*m;this._invLocalInertia12=-p*m;this._invLocalInertia20=_*m;this._invLocalInertia21=-l*m;this._invLocalInertia22=f*m;this._invLocalInertiaWithoutRotFactor00=this._invLocalInertia00;this._invLocalInertiaWithoutRotFactor01=this._invLocalInertia01;this._invLocalInertiaWithoutRotFactor02=this._invLocalInertia02;this._invLocalInertiaWithoutRotFactor10=this._invLocalInertia10;this._invLocalInertiaWithoutRotFactor11=this._invLocalInertia11;this._invLocalInertiaWithoutRotFactor12=this._invLocalInertia12;this._invLocalInertiaWithoutRotFactor20=this._invLocalInertia20;this._invLocalInertiaWithoutRotFactor21=this._invLocalInertia21;this._invLocalInertiaWithoutRotFactor22=this._invLocalInertia22;this._invLocalInertia00=this._invLocalInertiaWithoutRotFactor00*this._rotFactor.x;this._invLocalInertia01=this._invLocalInertiaWithoutRotFactor01*this._rotFactor.x;this._invLocalInertia02=this._invLocalInertiaWithoutRotFactor02*this._rotFactor.x;this._invLocalInertia10=this._invLocalInertiaWithoutRotFactor10*this._rotFactor.y;this._invLocalInertia11=this._invLocalInertiaWithoutRotFactor11*this._rotFactor.y;this._invLocalInertia12=this._invLocalInertiaWithoutRotFactor12*this._rotFactor.y;this._invLocalInertia20=this._invLocalInertiaWithoutRotFactor20*this._rotFactor.z;this._invLocalInertia21=this._invLocalInertiaWithoutRotFactor21*this._rotFactor.z;this._invLocalInertia22=this._invLocalInertiaWithoutRotFactor22*this._rotFactor.z}else{this._invMass=0;this._invLocalInertia00=0;this._invLocalInertia01=0;this._invLocalInertia02=0;this._invLocalInertia10=0;this._invLocalInertia11=0;this._invLocalInertia12=0;this._invLocalInertia20=0;this._invLocalInertia21=0;this._invLocalInertia22=0;this._invLocalInertiaWithoutRotFactor00=0;this._invLocalInertiaWithoutRotFactor01=0;this._invLocalInertiaWithoutRotFactor02=0;this._invLocalInertiaWithoutRotFactor10=0;this._invLocalInertiaWithoutRotFactor11=0;this._invLocalInertiaWithoutRotFactor12=0;this._invLocalInertiaWithoutRotFactor20=0;this._invLocalInertiaWithoutRotFactor21=0;this._invLocalInertiaWithoutRotFactor22=0;if(this._type==0){this._type=1}}var b;var u;var x;var y;var g;var X;var z;var M;var Y;b=this._transform._rotation00*this._invLocalInertia00+this._transform._rotation01*this._invLocalInertia10+this._transform._rotation02*this._invLocalInertia20;u=this._transform._rotation00*this._invLocalInertia01+this._transform._rotation01*this._invLocalInertia11+this._transform._rotation02*this._invLocalInertia21;x=this._transform._rotation00*this._invLocalInertia02+this._transform._rotation01*this._invLocalInertia12+this._transform._rotation02*this._invLocalInertia22;y=this._transform._rotation10*this._invLocalInertia00+this._transform._rotation11*this._invLocalInertia10+this._transform._rotation12*this._invLocalInertia20;g=this._transform._rotation10*this._invLocalInertia01+this._transform._rotation11*this._invLocalInertia11+this._transform._rotation12*this._invLocalInertia21;X=this._transform._rotation10*this._invLocalInertia02+this._transform._rotation11*this._invLocalInertia12+this._transform._rotation12*this._invLocalInertia22;z=this._transform._rotation20*this._invLocalInertia00+this._transform._rotation21*this._invLocalInertia10+this._transform._rotation22*this._invLocalInertia20;M=this._transform._rotation20*this._invLocalInertia01+this._transform._rotation21*this._invLocalInertia11+this._transform._rotation22*this._invLocalInertia21;Y=this._transform._rotation20*this._invLocalInertia02+this._transform._rotation21*this._invLocalInertia12+this._transform._rotation22*this._invLocalInertia22;this._invInertia00=b;this._invInertia01=u;this._invInertia02=x;this._invInertia10=y;this._invInertia11=g;this._invInertia12=X;this._invInertia20=z;this._invInertia21=M;this._invInertia22=Y;var Z;var d;var I;var w;var V;var L;var A;var k;var B;Z=this._invInertia00*this._transform._rotation00+this._invInertia01*this._transform._rotation01+this._invInertia02*this._transform._rotation02;d=this._invInertia00*this._transform._rotation10+this._invInertia01*this._transform._rotation11+this._invInertia02*this._transform._rotation12;I=this._invInertia00*this._transform._rotation20+this._invInertia01*this._transform._rotation21+this._invInertia02*this._transform._rotation22;w=this._invInertia10*this._transform._rotation00+this._invInertia11*this._transform._rotation01+this._invInertia12*this._transform._rotation02;V=this._invInertia10*this._transform._rotation10+this._invInertia11*this._transform._rotation11+this._invInertia12*this._transform._rotation12;L=this._invInertia10*this._transform._rotation20+this._invInertia11*this._transform._rotation21+this._invInertia12*this._transform._rotation22;A=this._invInertia20*this._transform._rotation00+this._invInertia21*this._transform._rotation01+this._invInertia22*this._transform._rotation02;k=this._invInertia20*this._transform._rotation10+this._invInertia21*this._transform._rotation11+this._invInertia22*this._transform._rotation12;B=this._invInertia20*this._transform._rotation20+this._invInertia21*this._transform._rotation21+this._invInertia22*this._transform._rotation22;this._invInertia00=Z;this._invInertia01=d;this._invInertia02=I;this._invInertia10=w;this._invInertia11=V;this._invInertia12=L;this._invInertia20=A;this._invInertia21=k;this._invInertia22=B;this._invInertia00*=this._rotFactor.x;this._invInertia01*=this._rotFactor.x;this._invInertia02*=this._rotFactor.x;this._invInertia10*=this._rotFactor.y;this._invInertia11*=this._rotFactor.y;this._invInertia12*=this._rotFactor.y;this._invInertia20*=this._rotFactor.z;this._invInertia21*=this._rotFactor.z;this._invInertia22*=this._rotFactor.z;this._sleeping=false;this._sleepTime=0},getRotationFactor:function(){var t=this._rotFactor;return new Is(t.x,t.y,t.z)},setRotationFactor:function(t){var a=this._rotFactor;a.x=t.x;a.y=t.y;a.z=t.z;var i;var r;var o;var s;var n;var e;var _;var v;var h;i=this._transform._rotation00*this._invLocalInertia00+this._transform._rotation01*this._invLocalInertia10+this._transform._rotation02*this._invLocalInertia20;r=this._transform._rotation00*this._invLocalInertia01+this._transform._rotation01*this._invLocalInertia11+this._transform._rotation02*this._invLocalInertia21;o=this._transform._rotation00*this._invLocalInertia02+this._transform._rotation01*this._invLocalInertia12+this._transform._rotation02*this._invLocalInertia22;s=this._transform._rotation10*this._invLocalInertia00+this._transform._rotation11*this._invLocalInertia10+this._transform._rotation12*this._invLocalInertia20;n=this._transform._rotation10*this._invLocalInertia01+this._transform._rotation11*this._invLocalInertia11+this._transform._rotation12*this._invLocalInertia21;e=this._transform._rotation10*this._invLocalInertia02+this._transform._rotation11*this._invLocalInertia12+this._transform._rotation12*this._invLocalInertia22;_=this._transform._rotation20*this._invLocalInertia00+this._transform._rotation21*this._invLocalInertia10+this._transform._rotation22*this._invLocalInertia20;v=this._transform._rotation20*this._invLocalInertia01+this._transform._rotation21*this._invLocalInertia11+this._transform._rotation22*this._invLocalInertia21;h=this._transform._rotation20*this._invLocalInertia02+this._transform._rotation21*this._invLocalInertia12+this._transform._rotation22*this._invLocalInertia22;this._invInertia00=i;this._invInertia01=r;this._invInertia02=o;this._invInertia10=s;this._invInertia11=n;this._invInertia12=e;this._invInertia20=_;this._invInertia21=v;this._invInertia22=h;var l;var c;var p;var f;var m;var b;var u;var x;var y;l=this._invInertia00*this._transform._rotation00+this._invInertia01*this._transform._rotation01+this._invInertia02*this._transform._rotation02;c=this._invInertia00*this._transform._rotation10+this._invInertia01*this._transform._rotation11+this._invInertia02*this._transform._rotation12;p=this._invInertia00*this._transform._rotation20+this._invInertia01*this._transform._rotation21+this._invInertia02*this._transform._rotation22;f=this._invInertia10*this._transform._rotation00+this._invInertia11*this._transform._rotation01+this._invInertia12*this._transform._rotation02;m=this._invInertia10*this._transform._rotation10+this._invInertia11*this._transform._rotation11+this._invInertia12*this._transform._rotation12;b=this._invInertia10*this._transform._rotation20+this._invInertia11*this._transform._rotation21+this._invInertia12*this._transform._rotation22;u=this._invInertia20*this._transform._rotation00+this._invInertia21*this._transform._rotation01+this._invInertia22*this._transform._rotation02;x=this._invInertia20*this._transform._rotation10+this._invInertia21*this._transform._rotation11+this._invInertia22*this._transform._rotation12;y=this._invInertia20*this._transform._rotation20+this._invInertia21*this._transform._rotation21+this._invInertia22*this._transform._rotation22;this._invInertia00=l;this._invInertia01=c;this._invInertia02=p;this._invInertia10=f;this._invInertia11=m;this._invInertia12=b;this._invInertia20=u;this._invInertia21=x;this._invInertia22=y;this._invInertia00*=this._rotFactor.x;this._invInertia01*=this._rotFactor.x;this._invInertia02*=this._rotFactor.x;this._invInertia10*=this._rotFactor.y;this._invInertia11*=this._rotFactor.y;this._invInertia12*=this._rotFactor.y;this._invInertia20*=this._rotFactor.z;this._invInertia21*=this._rotFactor.z;this._invInertia22*=this._rotFactor.z;this._sleeping=false;this._sleepTime=0},getLinearVelocity:function(){var t=new Is;var a=t;a.x=this._velX;a.y=this._velY;a.z=this._velZ;return t},getLinearVelocityTo:function(t){var a=t;a.x=this._velX;a.y=this._velY;a.z=this._velZ},setLinearVelocity:function(t){if(this._type==1){this._velX=0;this._velY=0;this._velZ=0}else{var a=t;this._velX=a.x;this._velY=a.y;this._velZ=a.z}this._sleeping=false;this._sleepTime=0},getAngularVelocity:function(){var t=new Is;var a=t;a.x=this._angVelX;a.y=this._angVelY;a.z=this._angVelZ;return t},getAngularVelocityTo:function(t){var a=t;a.x=this._velX;a.y=this._velY;a.z=this._velZ},setAngularVelocity:function(t){if(this._type==1){this._angVelX=0;this._angVelY=0;this._angVelZ=0}else{var a=t;this._angVelX=a.x;this._angVelY=a.y;this._angVelZ=a.z}this._sleeping=false;this._sleepTime=0},addLinearVelocity:function(t){if(this._type!=1){var a;var i;var r;var o;var s=t;i=s.x;r=s.y;o=s.z;this._velX+=i;this._velY+=r;this._velZ+=o}this._sleeping=false;this._sleepTime=0},addAngularVelocity:function(t){if(this._type!=1){var a;var i;var r;var o;var s=t;i=s.x;r=s.y;o=s.z;this._angVelX+=i;this._angVelY+=r;this._angVelZ+=o}this._sleeping=false;this._sleepTime=0},applyImpulse:function(t,a){var i;var r;var o;var s;var n=t;r=n.x;o=n.y;s=n.z;this._velX+=r*this._invMass;this._velY+=o*this._invMass;this._velZ+=s*this._invMass;var e;var _;var v;var h;var l;var c;var p;var f;var m=a;c=m.x;p=m.y;f=m.z;c-=this._transform._positionX;p-=this._transform._positionY;f-=this._transform._positionZ;_=p*s-f*o;v=f*r-c*s;h=c*o-p*r;var b;var u;var x;b=this._invInertia00*_+this._invInertia01*v+this._invInertia02*h;u=this._invInertia10*_+this._invInertia11*v+this._invInertia12*h;x=this._invInertia20*_+this._invInertia21*v+this._invInertia22*h;_=b;v=u;h=x;this._angVelX+=_;this._angVelY+=v;this._angVelZ+=h;this._sleeping=false;this._sleepTime=0},applyLinearImpulse:function(t){var a;var i;var r;var o;var s=t;i=s.x;r=s.y;o=s.z;this._velX+=i*this._invMass;this._velY+=r*this._invMass;this._velZ+=o*this._invMass;this._sleeping=false;this._sleepTime=0},applyAngularImpulse:function(t){var a;var i;var r;var o;var s=t;i=s.x;r=s.y;o=s.z;var n;var e;var _;n=this._invInertia00*i+this._invInertia01*r+this._invInertia02*o;e=this._invInertia10*i+this._invInertia11*r+this._invInertia12*o;_=this._invInertia20*i+this._invInertia21*r+this._invInertia22*o;i=n;r=e;o=_;this._angVelX+=i;this._angVelY+=r;this._angVelZ+=o;this._sleeping=false;this._sleepTime=0},applyForce:function(t,a){var i;var r;var o;var s;var n=t;r=n.x;o=n.y;s=n.z;this._forceX+=r;this._forceY+=o;this._forceZ+=s;var e;var _;var v;var h;var l;var c;var p;var f;var m=a;c=m.x;p=m.y;f=m.z;c-=this._transform._positionX;p-=this._transform._positionY;f-=this._transform._positionZ;_=p*s-f*o;v=f*r-c*s;h=c*o-p*r;this._torqueX+=_;this._torqueY+=v;this._torqueZ+=h;this._sleeping=false;this._sleepTime=0},applyForceToCenter:function(t){var a;var i;var r;var o;var s=t;i=s.x;r=s.y;o=s.z;this._forceX+=i;this._forceY+=r;this._forceZ+=o;this._sleeping=false;this._sleepTime=0},applyTorque:function(t){var a;var i;var r;var o;var s=t;i=s.x;r=s.y;o=s.z;this._torqueX+=i;this._torqueY+=r;this._torqueZ+=o;this._sleeping=false;this._sleepTime=0},getGravityScale:function(){return this._gravityScale},setGravityScale:function(t){this._gravityScale=t;this._sleeping=false;this._sleepTime=0},getLocalPoint:function(t){var a;var i;var r;var o;var s=t;i=s.x;r=s.y;o=s.z;i-=this._transform._positionX;r-=this._transform._positionY;o-=this._transform._positionZ;var n;var e;var _;n=this._transform._rotation00*i+this._transform._rotation10*r+this._transform._rotation20*o;e=this._transform._rotation01*i+this._transform._rotation11*r+this._transform._rotation21*o;_=this._transform._rotation02*i+this._transform._rotation12*r+this._transform._rotation22*o;i=n;r=e;o=_;var v=new Is;var h=v;h.x=i;h.y=r;h.z=o;return v},getLocalPointTo:function(t,a){var i;var r;var o;var s;var n=t;r=n.x;o=n.y;s=n.z;r-=this._transform._positionX;o-=this._transform._positionY;s-=this._transform._positionZ;var e;var _;var v;e=this._transform._rotation00*r+this._transform._rotation10*o+this._transform._rotation20*s;_=this._transform._rotation01*r+this._transform._rotation11*o+this._transform._rotation21*s;v=this._transform._rotation02*r+this._transform._rotation12*o+this._transform._rotation22*s;r=e;o=_;s=v;var h=a;h.x=r;h.y=o;h.z=s},getLocalVector:function(t){var a;var i;var r;var o;var s=t;i=s.x;r=s.y;o=s.z;var n;var e;var _;n=this._transform._rotation00*i+this._transform._rotation10*r+this._transform._rotation20*o;e=this._transform._rotation01*i+this._transform._rotation11*r+this._transform._rotation21*o;_=this._transform._rotation02*i+this._transform._rotation12*r+this._transform._rotation22*o;i=n;r=e;o=_;var v=new Is;var h=v;h.x=i;h.y=r;h.z=o;return v},getLocalVectorTo:function(t,a){var i;var r;var o;var s;var n=t;r=n.x;o=n.y;s=n.z;var e;var _;var v;e=this._transform._rotation00*r+this._transform._rotation10*o+this._transform._rotation20*s;_=this._transform._rotation01*r+this._transform._rotation11*o+this._transform._rotation21*s;v=this._transform._rotation02*r+this._transform._rotation12*o+this._transform._rotation22*s;r=e;o=_;s=v;var h=a;h.x=r;h.y=o;h.z=s},getWorldPoint:function(t){var a;var i;var r;var o;var s=t;i=s.x;r=s.y;o=s.z;var n;var e;var _;n=this._transform._rotation00*i+this._transform._rotation01*r+this._transform._rotation02*o;e=this._transform._rotation10*i+this._transform._rotation11*r+this._transform._rotation12*o;_=this._transform._rotation20*i+this._transform._rotation21*r+this._transform._rotation22*o;i=n;r=e;o=_;i+=this._transform._positionX;r+=this._transform._positionY;o+=this._transform._positionZ;var v=new Is;var h=v;h.x=i;h.y=r;h.z=o;return v},getWorldPointTo:function(t,a){var i;var r;var o;var s;var n=t;r=n.x;o=n.y;s=n.z;var e;var _;var v;e=this._transform._rotation00*r+this._transform._rotation01*o+this._transform._rotation02*s;_=this._transform._rotation10*r+this._transform._rotation11*o+this._transform._rotation12*s;v=this._transform._rotation20*r+this._transform._rotation21*o+this._transform._rotation22*s;r=e;o=_;s=v;r+=this._transform._positionX;o+=this._transform._positionY;s+=this._transform._positionZ;var h=a;h.x=r;h.y=o;h.z=s},getWorldVector:function(t){var a;var i;var r;var o;var s=t;i=s.x;r=s.y;o=s.z;var n;var e;var _;n=this._transform._rotation00*i+this._transform._rotation01*r+this._transform._rotation02*o;e=this._transform._rotation10*i+this._transform._rotation11*r+this._transform._rotation12*o;_=this._transform._rotation20*i+this._transform._rotation21*r+this._transform._rotation22*o;i=n;r=e;o=_;var v=new Is;var h=v;h.x=i;h.y=r;h.z=o;return v},getWorldVectorTo:function(t,a){var i;var r;var o;var s;var n=t;r=n.x;o=n.y;s=n.z;var e;var _;var v;e=this._transform._rotation00*r+this._transform._rotation01*o+this._transform._rotation02*s;_=this._transform._rotation10*r+this._transform._rotation11*o+this._transform._rotation12*s;v=this._transform._rotation20*r+this._transform._rotation21*o+this._transform._rotation22*s;r=e;o=_;s=v;var h=a;h.x=r;h.y=o;h.z=s},getNumShapes:function(){return this._numShapes},getShapeList:function(){return this._shapeList},getNumContectLinks:function(){return this._numContactLinks},getContactLinkList:function(){return this._contactLinkList},getNumJointLinks:function(){return this._numJointLinks},getJointLinkList:function(){return this._jointLinkList},addShape:function(t){if(this._shapeList==null){this._shapeList=t;this._shapeListLast=t}else{this._shapeListLast._next=t;t._prev=this._shapeListLast;this._shapeListLast=t}this._numShapes++;t._rigidBody=this;if(this._world!=null){var a=this._world;t._proxy=a._broadPhase.createProxy(t,t._aabb);t._id=a._shapeIdCount++;a._numShapes++}this.updateMass();var i=this._shapeList;while(i!=null){var r=i._next;var o=i._ptransform;var s=i._localTransform;var n=this._ptransform;var e;var _;var v;var h;var l;var c;var p;var f;var m;e=n._rotation00*s._rotation00+n._rotation01*s._rotation10+n._rotation02*s._rotation20;_=n._rotation00*s._rotation01+n._rotation01*s._rotation11+n._rotation02*s._rotation21;v=n._rotation00*s._rotation02+n._rotation01*s._rotation12+n._rotation02*s._rotation22;h=n._rotation10*s._rotation00+n._rotation11*s._rotation10+n._rotation12*s._rotation20;l=n._rotation10*s._rotation01+n._rotation11*s._rotation11+n._rotation12*s._rotation21;c=n._rotation10*s._rotation02+n._rotation11*s._rotation12+n._rotation12*s._rotation22;p=n._rotation20*s._rotation00+n._rotation21*s._rotation10+n._rotation22*s._rotation20;f=n._rotation20*s._rotation01+n._rotation21*s._rotation11+n._rotation22*s._rotation21;m=n._rotation20*s._rotation02+n._rotation21*s._rotation12+n._rotation22*s._rotation22;o._rotation00=e;o._rotation01=_;o._rotation02=v;o._rotation10=h;o._rotation11=l;o._rotation12=c;o._rotation20=p;o._rotation21=f;o._rotation22=m;var b;var u;var x;b=n._rotation00*s._positionX+n._rotation01*s._positionY+n._rotation02*s._positionZ;u=n._rotation10*s._positionX+n._rotation11*s._positionY+n._rotation12*s._positionZ;x=n._rotation20*s._positionX+n._rotation21*s._positionY+n._rotation22*s._positionZ;o._positionX=b;o._positionY=u;o._positionZ=x;o._positionX+=n._positionX;o._positionY+=n._positionY;o._positionZ+=n._positionZ;var y=i._transform;var g=i._localTransform;var X=this._transform;var z;var M;var Y;var Z;var d;var I;var w;var V;var L;z=X._rotation00*g._rotation00+X._rotation01*g._rotation10+X._rotation02*g._rotation20;M=X._rotation00*g._rotation01+X._rotation01*g._rotation11+X._rotation02*g._rotation21;Y=X._rotation00*g._rotation02+X._rotation01*g._rotation12+X._rotation02*g._rotation22;Z=X._rotation10*g._rotation00+X._rotation11*g._rotation10+X._rotation12*g._rotation20;d=X._rotation10*g._rotation01+X._rotation11*g._rotation11+X._rotation12*g._rotation21;I=X._rotation10*g._rotation02+X._rotation11*g._rotation12+X._rotation12*g._rotation22;w=X._rotation20*g._rotation00+X._rotation21*g._rotation10+X._rotation22*g._rotation20;V=X._rotation20*g._rotation01+X._rotation21*g._rotation11+X._rotation22*g._rotation21;L=X._rotation20*g._rotation02+X._rotation21*g._rotation12+X._rotation22*g._rotation22;y._rotation00=z;y._rotation01=M;y._rotation02=Y;y._rotation10=Z;y._rotation11=d;y._rotation12=I;y._rotation20=w;y._rotation21=V;y._rotation22=L;var A;var k;var B;A=X._rotation00*g._positionX+X._rotation01*g._positionY+X._rotation02*g._positionZ;k=X._rotation10*g._positionX+X._rotation11*g._positionY+X._rotation12*g._positionZ;B=X._rotation20*g._positionX+X._rotation21*g._positionY+X._rotation22*g._positionZ;y._positionX=A;y._positionY=k;y._positionZ=B;y._positionX+=X._positionX;y._positionY+=X._positionY;y._positionZ+=X._positionZ;var P;var T;var S;var C;var q;var R;var E;var j;i._geom._computeAabb(i._aabb,i._ptransform);T=i._aabb._minX;S=i._aabb._minY;C=i._aabb._minZ;R=i._aabb._maxX;E=i._aabb._maxY;j=i._aabb._maxZ;i._geom._computeAabb(i._aabb,i._transform);i._aabb._minX=T<i._aabb._minX?T:i._aabb._minX;i._aabb._minY=S<i._aabb._minY?S:i._aabb._minY;i._aabb._minZ=C<i._aabb._minZ?C:i._aabb._minZ;i._aabb._maxX=R>i._aabb._maxX?R:i._aabb._maxX;i._aabb._maxY=E>i._aabb._maxY?E:i._aabb._maxY;i._aabb._maxZ=j>i._aabb._maxZ?j:i._aabb._maxZ;if(i._proxy!=null){var N;var D;var F;var O;D=i._transform._positionX-i._ptransform._positionX;F=i._transform._positionY-i._ptransform._positionY;O=i._transform._positionZ-i._ptransform._positionZ;var W=i.displacement;W.x=D;W.y=F;W.z=O;i._rigidBody._world._broadPhase.moveProxy(i._proxy,i._aabb,i.displacement)}i=r}},removeShape:function(t){var a=t._prev;var i=t._next;if(a!=null){a._next=i}if(i!=null){i._prev=a}if(t==this._shapeList){this._shapeList=this._shapeList._next}if(t==this._shapeListLast){this._shapeListLast=this._shapeListLast._prev}t._next=null;t._prev=null;this._numShapes--;t._rigidBody=null;if(this._world!=null){var r=this._world;r._broadPhase.destroyProxy(t._proxy);t._proxy=null;t._id=-1;var o=t._rigidBody._contactLinkList;while(o!=null){var s=o._next;var n=o._contact;if(n._s1==t||n._s2==t){var e=o._other;e._sleeping=false;e._sleepTime=0;var _=r._contactManager;var v=n._prev;var h=n._next;if(v!=null){v._next=h}if(h!=null){h._prev=v}if(n==_._contactList){_._contactList=_._contactList._next}if(n==_._contactListLast){_._contactListLast=_._contactListLast._prev}n._next=null;n._prev=null;if(n._touching){var l=n._s1._contactCallback;var c=n._s2._contactCallback;if(l==c){c=null}if(l!=null){l.endContact(n)}if(c!=null){c.endContact(n)}}var p=n._link1._prev;var f=n._link1._next;if(p!=null){p._next=f}if(f!=null){f._prev=p}if(n._link1==n._b1._contactLinkList){n._b1._contactLinkList=n._b1._contactLinkList._next}if(n._link1==n._b1._contactLinkListLast){n._b1._contactLinkListLast=n._b1._contactLinkListLast._prev}n._link1._next=null;n._link1._prev=null;var m=n._link2._prev;var b=n._link2._next;if(m!=null){m._next=b}if(b!=null){b._prev=m}if(n._link2==n._b2._contactLinkList){n._b2._contactLinkList=n._b2._contactLinkList._next}if(n._link2==n._b2._contactLinkListLast){n._b2._contactLinkListLast=n._b2._contactLinkListLast._prev}n._link2._next=null;n._link2._prev=null;n._b1._numContactLinks--;n._b2._numContactLinks--;n._link1._other=null;n._link2._other=null;n._link1._contact=null;n._link2._contact=null;n._s1=null;n._s2=null;n._b1=null;n._b2=null;n._touching=false;n._cachedDetectorData._clear();n._manifold._clear();n._detector=null;var u=n._contactConstraint;u._s1=null;u._s2=null;u._b1=null;u._b2=null;u._tf1=null;u._tf2=null;n._next=_._contactPool;_._contactPool=n;_._numContacts--}o=s}r._numShapes--}this.updateMass();var x=this._shapeList;while(x!=null){var y=x._next;var g=x._ptransform;var X=x._localTransform;var z=this._ptransform;var M;var Y;var Z;var d;var I;var w;var V;var L;var A;M=z._rotation00*X._rotation00+z._rotation01*X._rotation10+z._rotation02*X._rotation20;Y=z._rotation00*X._rotation01+z._rotation01*X._rotation11+z._rotation02*X._rotation21;Z=z._rotation00*X._rotation02+z._rotation01*X._rotation12+z._rotation02*X._rotation22;d=z._rotation10*X._rotation00+z._rotation11*X._rotation10+z._rotation12*X._rotation20;I=z._rotation10*X._rotation01+z._rotation11*X._rotation11+z._rotation12*X._rotation21;w=z._rotation10*X._rotation02+z._rotation11*X._rotation12+z._rotation12*X._rotation22;V=z._rotation20*X._rotation00+z._rotation21*X._rotation10+z._rotation22*X._rotation20;L=z._rotation20*X._rotation01+z._rotation21*X._rotation11+z._rotation22*X._rotation21;A=z._rotation20*X._rotation02+z._rotation21*X._rotation12+z._rotation22*X._rotation22;g._rotation00=M;g._rotation01=Y;g._rotation02=Z;g._rotation10=d;g._rotation11=I;g._rotation12=w;g._rotation20=V;g._rotation21=L;g._rotation22=A;var k;var B;var P;k=z._rotation00*X._positionX+z._rotation01*X._positionY+z._rotation02*X._positionZ;B=z._rotation10*X._positionX+z._rotation11*X._positionY+z._rotation12*X._positionZ;P=z._rotation20*X._positionX+z._rotation21*X._positionY+z._rotation22*X._positionZ;g._positionX=k;g._positionY=B;g._positionZ=P;g._positionX+=z._positionX;g._positionY+=z._positionY;g._positionZ+=z._positionZ;var T=x._transform;var S=x._localTransform;var C=this._transform;var q;var R;var E;var j;var N;var D;var F;var O;var W;q=C._rotation00*S._rotation00+C._rotation01*S._rotation10+C._rotation02*S._rotation20;R=C._rotation00*S._rotation01+C._rotation01*S._rotation11+C._rotation02*S._rotation21;E=C._rotation00*S._rotation02+C._rotation01*S._rotation12+C._rotation02*S._rotation22;j=C._rotation10*S._rotation00+C._rotation11*S._rotation10+C._rotation12*S._rotation20;N=C._rotation10*S._rotation01+C._rotation11*S._rotation11+C._rotation12*S._rotation21;D=C._rotation10*S._rotation02+C._rotation11*S._rotation12+C._rotation12*S._rotation22;F=C._rotation20*S._rotation00+C._rotation21*S._rotation10+C._rotation22*S._rotation20;O=C._rotation20*S._rotation01+C._rotation21*S._rotation11+C._rotation22*S._rotation21;W=C._rotation20*S._rotation02+C._rotation21*S._rotation12+C._rotation22*S._rotation22;T._rotation00=q;T._rotation01=R;T._rotation02=E;T._rotation10=j;T._rotation11=N;T._rotation12=D;T._rotation20=F;T._rotation21=O;T._rotation22=W;var G;var H;var U;G=C._rotation00*S._positionX+C._rotation01*S._positionY+C._rotation02*S._positionZ;H=C._rotation10*S._positionX+C._rotation11*S._positionY+C._rotation12*S._positionZ;U=C._rotation20*S._positionX+C._rotation21*S._positionY+C._rotation22*S._positionZ;T._positionX=G;T._positionY=H;T._positionZ=U;T._positionX+=C._positionX;T._positionY+=C._positionY;T._positionZ+=C._positionZ;var J;var Q;var $;var K;var tt;var at;var it;var rt;x._geom._computeAabb(x._aabb,x._ptransform);Q=x._aabb._minX;$=x._aabb._minY;K=x._aabb._minZ;at=x._aabb._maxX;it=x._aabb._maxY;rt=x._aabb._maxZ;x._geom._computeAabb(x._aabb,x._transform);x._aabb._minX=Q<x._aabb._minX?Q:x._aabb._minX;x._aabb._minY=$<x._aabb._minY?$:x._aabb._minY;x._aabb._minZ=K<x._aabb._minZ?K:x._aabb._minZ;x._aabb._maxX=at>x._aabb._maxX?at:x._aabb._maxX;x._aabb._maxY=it>x._aabb._maxY?it:x._aabb._maxY;x._aabb._maxZ=rt>x._aabb._maxZ?rt:x._aabb._maxZ;if(x._proxy!=null){var ot;var st;var nt;var et;st=x._transform._positionX-x._ptransform._positionX;nt=x._transform._positionY-x._ptransform._positionY;et=x._transform._positionZ-x._ptransform._positionZ;var _t=x.displacement;_t.x=st;_t.y=nt;_t.z=et;x._rigidBody._world._broadPhase.moveProxy(x._proxy,x._aabb,x.displacement)}x=y}},getType:function(){return this._type},setType:function(t){this._type=t;this.updateMass()},wakeUp:function(){this._sleeping=false;this._sleepTime=0},sleep:function(){this._sleeping=true;this._sleepTime=0},isSleeping:function(){return this._sleeping},getSleepTime:function(){return this._sleepTime},setAutoSleep:function(t){this._autoSleep=t;this._sleeping=false;this._sleepTime=0},getLinearDamping:function(){return this._linearDamping},setLinearDamping:function(t){this._linearDamping=t},getAngularDamping:function(){return this._angularDamping},setAngularDamping:function(t){this._angularDamping=t},getPrev:function(){return this._prev},getNext:function(){return this._next}};var ia=function(){this.position=new Is;this.rotation=new ws;this.linearVelocity=new Is;this.angularVelocity=new Is;this.type=0;this.autoSleep=true;this.linearDamping=0;this.angularDamping=0};var ra=function(){};var oa=function(t){this._id=-1;this._localTransform=new j;this._ptransform=new j;this._transform=new j;var a=t.position;this._localTransform._positionX=a.x;this._localTransform._positionY=a.y;this._localTransform._positionZ=a.z;var i=t.rotation;this._localTransform._rotation00=i.e00;this._localTransform._rotation01=i.e01;this._localTransform._rotation02=i.e02;this._localTransform._rotation10=i.e10;this._localTransform._rotation11=i.e11;this._localTransform._rotation12=i.e12;this._localTransform._rotation20=i.e20;this._localTransform._rotation21=i.e21;this._localTransform._rotation22=i.e22;var r=this._ptransform;var o=this._localTransform;r._positionX=o._positionX;r._positionY=o._positionY;r._positionZ=o._positionZ;r._rotation00=o._rotation00;r._rotation01=o._rotation01;r._rotation02=o._rotation02;r._rotation10=o._rotation10;r._rotation11=o._rotation11;r._rotation12=o._rotation12;r._rotation20=o._rotation20;r._rotation21=o._rotation21;r._rotation22=o._rotation22;var s=this._transform;var n=this._localTransform;s._positionX=n._positionX;s._positionY=n._positionY;s._positionZ=n._positionZ;s._rotation00=n._rotation00;s._rotation01=n._rotation01;s._rotation02=n._rotation02;s._rotation10=n._rotation10;s._rotation11=n._rotation11;s._rotation12=n._rotation12;s._rotation20=n._rotation20;s._rotation21=n._rotation21;s._rotation22=n._rotation22;this._restitution=t.restitution;this._friction=t.friction;this._density=t.density;this._geom=t.geometry;this._collisionGroup=t.collisionGroup;this._collisionMask=t.collisionMask;this._contactCallback=t.contactCallback;this._aabb=new m;this._proxy=null;this.displacement=new Is};oa.prototype={getFriction:function(){return this._friction},setFriction:function(t){this._friction=t},getRestitution:function(){return this._restitution},setRestitution:function(t){this._restitution=t},getLocalTransform:function(){var t=this._localTransform;var a=new j;a._positionX=t._positionX;a._positionY=t._positionY;a._positionZ=t._positionZ;a._rotation00=t._rotation00;a._rotation01=t._rotation01;a._rotation02=t._rotation02;a._rotation10=t._rotation10;a._rotation11=t._rotation11;a._rotation12=t._rotation12;a._rotation20=t._rotation20;a._rotation21=t._rotation21;a._rotation22=t._rotation22;return a},getLocalTransformTo:function(t){var a=this._localTransform;t._positionX=a._positionX;t._positionY=a._positionY;t._positionZ=a._positionZ;t._rotation00=a._rotation00;t._rotation01=a._rotation01;t._rotation02=a._rotation02;t._rotation10=a._rotation10;t._rotation11=a._rotation11;t._rotation12=a._rotation12;t._rotation20=a._rotation20;t._rotation21=a._rotation21;t._rotation22=a._rotation22},getTransform:function(){var t=this._transform;var a=new j;a._positionX=t._positionX;a._positionY=t._positionY;a._positionZ=t._positionZ;a._rotation00=t._rotation00;a._rotation01=t._rotation01;a._rotation02=t._rotation02;a._rotation10=t._rotation10;a._rotation11=t._rotation11;a._rotation12=t._rotation12;a._rotation20=t._rotation20;a._rotation21=t._rotation21;a._rotation22=t._rotation22;return a},getTransformTo:function(t){var a=this._transform;t._positionX=a._positionX;t._positionY=a._positionY;t._positionZ=a._positionZ;t._rotation00=a._rotation00;t._rotation01=a._rotation01;t._rotation02=a._rotation02;t._rotation10=a._rotation10;t._rotation11=a._rotation11;t._rotation12=a._rotation12;t._rotation20=a._rotation20;t._rotation21=a._rotation21;t._rotation22=a._rotation22},setLocalTransform:function(t){var a=this._localTransform;a._positionX=t._positionX;a._positionY=t._positionY;a._positionZ=t._positionZ;a._rotation00=t._rotation00;a._rotation01=t._rotation01;a._rotation02=t._rotation02;a._rotation10=t._rotation10;a._rotation11=t._rotation11;a._rotation12=t._rotation12;a._rotation20=t._rotation20;a._rotation21=t._rotation21;a._rotation22=t._rotation22;if(this._rigidBody!=null){var i=this._rigidBody;i.updateMass();var r=i._shapeList;while(r!=null){var o=r._next;var s=r._ptransform;var n=r._localTransform;var e=i._ptransform;var _;var v;var h;var l;var c;var p;var f;var m;var b;_=e._rotation00*n._rotation00+e._rotation01*n._rotation10+e._rotation02*n._rotation20;v=e._rotation00*n._rotation01+e._rotation01*n._rotation11+e._rotation02*n._rotation21;h=e._rotation00*n._rotation02+e._rotation01*n._rotation12+e._rotation02*n._rotation22;l=e._rotation10*n._rotation00+e._rotation11*n._rotation10+e._rotation12*n._rotation20;c=e._rotation10*n._rotation01+e._rotation11*n._rotation11+e._rotation12*n._rotation21;p=e._rotation10*n._rotation02+e._rotation11*n._rotation12+e._rotation12*n._rotation22;f=e._rotation20*n._rotation00+e._rotation21*n._rotation10+e._rotation22*n._rotation20;m=e._rotation20*n._rotation01+e._rotation21*n._rotation11+e._rotation22*n._rotation21;b=e._rotation20*n._rotation02+e._rotation21*n._rotation12+e._rotation22*n._rotation22;s._rotation00=_;s._rotation01=v;s._rotation02=h;s._rotation10=l;s._rotation11=c;s._rotation12=p;s._rotation20=f;s._rotation21=m;s._rotation22=b;var u;var x;var y;u=e._rotation00*n._positionX+e._rotation01*n._positionY+e._rotation02*n._positionZ;x=e._rotation10*n._positionX+e._rotation11*n._positionY+e._rotation12*n._positionZ;y=e._rotation20*n._positionX+e._rotation21*n._positionY+e._rotation22*n._positionZ;s._positionX=u;s._positionY=x;s._positionZ=y;s._positionX+=e._positionX;s._positionY+=e._positionY;s._positionZ+=e._positionZ;var g=r._transform;var X=r._localTransform;var z=i._transform;var M;var Y;var Z;var d;var I;var w;var V;var L;var A;M=z._rotation00*X._rotation00+z._rotation01*X._rotation10+z._rotation02*X._rotation20;Y=z._rotation00*X._rotation01+z._rotation01*X._rotation11+z._rotation02*X._rotation21;Z=z._rotation00*X._rotation02+z._rotation01*X._rotation12+z._rotation02*X._rotation22;d=z._rotation10*X._rotation00+z._rotation11*X._rotation10+z._rotation12*X._rotation20;I=z._rotation10*X._rotation01+z._rotation11*X._rotation11+z._rotation12*X._rotation21;w=z._rotation10*X._rotation02+z._rotation11*X._rotation12+z._rotation12*X._rotation22;V=z._rotation20*X._rotation00+z._rotation21*X._rotation10+z._rotation22*X._rotation20;L=z._rotation20*X._rotation01+z._rotation21*X._rotation11+z._rotation22*X._rotation21;A=z._rotation20*X._rotation02+z._rotation21*X._rotation12+z._rotation22*X._rotation22;g._rotation00=M;g._rotation01=Y;g._rotation02=Z;g._rotation10=d;g._rotation11=I;g._rotation12=w;g._rotation20=V;g._rotation21=L;g._rotation22=A;var k;var B;var P;k=z._rotation00*X._positionX+z._rotation01*X._positionY+z._rotation02*X._positionZ;B=z._rotation10*X._positionX+z._rotation11*X._positionY+z._rotation12*X._positionZ;P=z._rotation20*X._positionX+z._rotation21*X._positionY+z._rotation22*X._positionZ;g._positionX=k;g._positionY=B;g._positionZ=P;g._positionX+=z._positionX;g._positionY+=z._positionY;g._positionZ+=z._positionZ;var T;var S;var C;var q;var R;var E;var j;var N;r._geom._computeAabb(r._aabb,r._ptransform);S=r._aabb._minX;C=r._aabb._minY;q=r._aabb._minZ;E=r._aabb._maxX;j=r._aabb._maxY;N=r._aabb._maxZ;r._geom._computeAabb(r._aabb,r._transform);r._aabb._minX=S<r._aabb._minX?S:r._aabb._minX;r._aabb._minY=C<r._aabb._minY?C:r._aabb._minY;r._aabb._minZ=q<r._aabb._minZ?q:r._aabb._minZ;r._aabb._maxX=E>r._aabb._maxX?E:r._aabb._maxX;r._aabb._maxY=j>r._aabb._maxY?j:r._aabb._maxY;r._aabb._maxZ=N>r._aabb._maxZ?N:r._aabb._maxZ;if(r._proxy!=null){var D;var F;var O;var W;F=r._transform._positionX-r._ptransform._positionX;O=r._transform._positionY-r._ptransform._positionY;W=r._transform._positionZ-r._ptransform._positionZ;var G=r.displacement;G.x=F;G.y=O;G.z=W;r._rigidBody._world._broadPhase.moveProxy(r._proxy,r._aabb,r.displacement)}r=o}}},getDensity:function(){return this._density},setDensity:function(t){this._density=t;if(this._rigidBody!=null){var a=this._rigidBody;a.updateMass();var i=a._shapeList;while(i!=null){var r=i._next;var o=i._ptransform;var s=i._localTransform;var n=a._ptransform;var e;var _;var v;var h;var l;var c;var p;var f;var m;e=n._rotation00*s._rotation00+n._rotation01*s._rotation10+n._rotation02*s._rotation20;_=n._rotation00*s._rotation01+n._rotation01*s._rotation11+n._rotation02*s._rotation21;v=n._rotation00*s._rotation02+n._rotation01*s._rotation12+n._rotation02*s._rotation22;h=n._rotation10*s._rotation00+n._rotation11*s._rotation10+n._rotation12*s._rotation20;l=n._rotation10*s._rotation01+n._rotation11*s._rotation11+n._rotation12*s._rotation21;c=n._rotation10*s._rotation02+n._rotation11*s._rotation12+n._rotation12*s._rotation22;p=n._rotation20*s._rotation00+n._rotation21*s._rotation10+n._rotation22*s._rotation20;f=n._rotation20*s._rotation01+n._rotation21*s._rotation11+n._rotation22*s._rotation21;m=n._rotation20*s._rotation02+n._rotation21*s._rotation12+n._rotation22*s._rotation22;o._rotation00=e;o._rotation01=_;o._rotation02=v;o._rotation10=h;o._rotation11=l;o._rotation12=c;o._rotation20=p;o._rotation21=f;o._rotation22=m;var b;var u;var x;b=n._rotation00*s._positionX+n._rotation01*s._positionY+n._rotation02*s._positionZ;u=n._rotation10*s._positionX+n._rotation11*s._positionY+n._rotation12*s._positionZ;x=n._rotation20*s._positionX+n._rotation21*s._positionY+n._rotation22*s._positionZ;o._positionX=b;o._positionY=u;o._positionZ=x;o._positionX+=n._positionX;o._positionY+=n._positionY;o._positionZ+=n._positionZ;var y=i._transform;var g=i._localTransform;var X=a._transform;var z;var M;var Y;var Z;var d;var I;var w;var V;var L;z=X._rotation00*g._rotation00+X._rotation01*g._rotation10+X._rotation02*g._rotation20;M=X._rotation00*g._rotation01+X._rotation01*g._rotation11+X._rotation02*g._rotation21;Y=X._rotation00*g._rotation02+X._rotation01*g._rotation12+X._rotation02*g._rotation22;Z=X._rotation10*g._rotation00+X._rotation11*g._rotation10+X._rotation12*g._rotation20;d=X._rotation10*g._rotation01+X._rotation11*g._rotation11+X._rotation12*g._rotation21;I=X._rotation10*g._rotation02+X._rotation11*g._rotation12+X._rotation12*g._rotation22;w=X._rotation20*g._rotation00+X._rotation21*g._rotation10+X._rotation22*g._rotation20;V=X._rotation20*g._rotation01+X._rotation21*g._rotation11+X._rotation22*g._rotation21;L=X._rotation20*g._rotation02+X._rotation21*g._rotation12+X._rotation22*g._rotation22;y._rotation00=z;y._rotation01=M;y._rotation02=Y;y._rotation10=Z;y._rotation11=d;y._rotation12=I;y._rotation20=w;y._rotation21=V;y._rotation22=L;var A;var k;var B;A=X._rotation00*g._positionX+X._rotation01*g._positionY+X._rotation02*g._positionZ;k=X._rotation10*g._positionX+X._rotation11*g._positionY+X._rotation12*g._positionZ;B=X._rotation20*g._positionX+X._rotation21*g._positionY+X._rotation22*g._positionZ;y._positionX=A;y._positionY=k;y._positionZ=B;y._positionX+=X._positionX;y._positionY+=X._positionY;y._positionZ+=X._positionZ;var P;var T;var S;var C;var q;var R;var E;var j;i._geom._computeAabb(i._aabb,i._ptransform);T=i._aabb._minX;S=i._aabb._minY;C=i._aabb._minZ;R=i._aabb._maxX;E=i._aabb._maxY;j=i._aabb._maxZ;i._geom._computeAabb(i._aabb,i._transform);i._aabb._minX=T<i._aabb._minX?T:i._aabb._minX;i._aabb._minY=S<i._aabb._minY?S:i._aabb._minY;i._aabb._minZ=C<i._aabb._minZ?C:i._aabb._minZ;i._aabb._maxX=R>i._aabb._maxX?R:i._aabb._maxX;i._aabb._maxY=E>i._aabb._maxY?E:i._aabb._maxY;i._aabb._maxZ=j>i._aabb._maxZ?j:i._aabb._maxZ;if(i._proxy!=null){var N;var D;var F;var O;D=i._transform._positionX-i._ptransform._positionX;F=i._transform._positionY-i._ptransform._positionY;O=i._transform._positionZ-i._ptransform._positionZ;var W=i.displacement;W.x=D;W.y=F;W.z=O;i._rigidBody._world._broadPhase.moveProxy(i._proxy,i._aabb,i.displacement)}i=r}}},getAabb:function(){return this._aabb.clone()},getAabbTo:function(t){t.copyFrom(this._aabb)},getGeometry:function(){return this._geom},getRigidBody:function(){return this._rigidBody},getCollisionGroup:function(){return this._collisionGroup},setCollisionGroup:function(t){this._collisionGroup=t},getCollisionMask:function(){return this._collisionMask},setCollisionMask:function(t){this._collisionMask=t},getContactCallback:function(){return this._contactCallback},setContactCallback:function(t){this._contactCallback=t},getPrev:function(){return this._prev},getNext:function(){return this._next}};var sa=function(){this.position=new Is;this.rotation=new ws;this.friction=ys.defaultFriction;this.restitution=ys.defaultRestitution;this.density=ys.defaultDensity;this.collisionGroup=ys.defaultCollisionGroup;this.collisionMask=ys.defaultCollisionMask;this.geometry=null;this.contactCallback=null};n._BRUTE_FORCE=1;n._BVH=2;n.BRUTE_FORCE=1;n.BVH=2;c.SIMPLE=0;c.MINIMIZE_SURFACE_AREA=1;X._SPHERE=0;X._BOX=1;X._CYLINDER=2;X._CONE=3;X._CAPSULE=4;X._CONVEX_HULL=5;X._CONVEX_MIN=0;X._CONVEX_MAX=5;X.SPHERE=0;X.BOX=1;X.CYLINDER=2;X.CONE=3;X.CAPSULE=4;X.CONVEX_HULL=5;w.EDGE_BIAS_MULT=1;R.OK=0;R.INVALID_TRIANGLE=1;R.NO_ADJACENT_PAIR_INDEX=2;R.NO_ADJACENT_TRIANGLE=3;R.EDGE_LOOP_BROKEN=4;R.NO_OUTER_TRIANGLE=5;R.TRIANGLE_INVISIBLE=6;E.count=0;Is.numCreations=0;ys.defaultFriction=.2;ys.defaultRestitution=.2;ys.defaultDensity=1;ys.defaultCollisionGroup=1;ys.defaultCollisionMask=1;ys.maxTranslationPerStep=20;ys.maxRotationPerStep=3.14159265358979;ys.bvhProxyPadding=.1;ys.bvhIncrementalCollisionThreshold=.45;ys.defaultGJKMargin=.05;ys.enableGJKCaching=true;ys.maxEPAVertices=128;ys.maxEPAPolyhedronFaces=128;ys.contactEnableBounceThreshold=.5;ys.velocityBaumgarte=.2;ys.positionSplitImpulseBaumgarte=.4;ys.positionNgsBaumgarte=1;ys.contactUseAlternativePositionCorrectionAlgorithmDepthThreshold=.05;ys.defaultContactPositionCorrectionAlgorithm=0;ys.alternativeContactPositionCorrectionAlgorithm=1;ys.contactPersistenceThreshold=.05;ys.maxManifoldPoints=4;ys.defaultJointConstraintSolverType=0;ys.defaultJointPositionCorrectionAlgorithm=0;ys.jointWarmStartingFactorForBaungarte=.8;ys.jointWarmStartingFactor=.95;ys.minSpringDamperDampingRatio=1e-6;ys.minRagdollMaxSwingAngle=1e-6;ys.maxJacobianRows=6;ys.directMlcpSolverEps=1e-9;ys.islandInitialRigidBodyArraySize=128;ys.islandInitialConstraintArraySize=128;ys.sleepingVelocityThreshold=.2;ys.sleepingAngularVelocityThreshold=.5;ys.sleepingTimeThreshold=1;ys.disableSleeping=false;ys.linearSlop=.005;ys.angularSlop=.017453292519943278;N.instance=new N;Ga._SUCCEEDED=0;Ga._GJK_FAILED_TO_MAKE_TETRAHEDRON=1;Ga._GJK_DID_NOT_CONVERGE=2;Ga._EPA_FAILED_TO_INIT=257;Ga._EPA_FAILED_TO_ADD_VERTEX=258;Ga._EPA_DID_NOT_CONVERGE=259;Ga.SUCCEEDED=0;Ga.GJK_FAILED_TO_MAKE_TETRAHEDRON=1;Ga.GJK_DID_NOT_CONVERGE=2;Ga.EPA_FAILED_TO_INIT=257;Ga.EPA_FAILED_TO_ADD_VERTEX=258;Ga.EPA_DID_NOT_CONVERGE=259;ws.numCreations=0;O.numCreations=0;W.POSITIVE_INFINITY=1/0;W.NEGATIVE_INFINITY=-1/0;W.PI=3.14159265358979;W.TWO_PI=6.28318530717958;W.HALF_PI=1.570796326794895;W.TO_RADIANS=.017453292519943278;W.TO_DEGREES=57.29577951308238;va.numCreations=0;et.SPHERE_PHI_DIVISION=8;et.SPHERE_THETA_DIVISION=4;et.CIRCLE_THETA_DIVISION=8;vt.broadPhaseCollisionTime=0;vt.narrowPhaseCollisionTime=0;vt.dynamicsTime=0;vt.totalTime=0;ka._BAUMGARTE=0;ka._SPLIT_IMPULSE=1;ka._NGS=2;ka.BAUMGARTE=0;ka.SPLIT_IMPULSE=1;ka.NGS=2;bt.BIT_LINEAR_SET=1;bt.BIT_ANGULAR_SET=2;Vt._SPHERICAL=0;Vt._REVOLUTE=1;Vt._CYLINDRICAL=2;Vt._PRISMATIC=3;Vt._UNIVERSAL=4;Vt._RAGDOLL=5;Vt.SPHERICAL=0;Vt.REVOLUTE=1;Vt.CYLINDRICAL=2;Vt.PRISMATIC=3;Vt.UNIVERSAL=4;Vt.RAGDOLL=5;Dt._ITERATIVE=0;Dt._DIRECT=1;Dt.ITERATIVE=0;Dt.DIRECT=1;ra._DYNAMIC=0;ra._STATIC=1;ra._KINEMATIC=2;ra.DYNAMIC=0;ra.STATIC=1;ra.KINEMATIC=2;t["OIMO"]={};t["OIMO"]["DebugDraw"]=et;t["OIMO"]["BroadPhase"]=a;a.prototype["createProxy"]=a.prototype.createProxy;a.prototype["destroyProxy"]=a.prototype.destroyProxy;a.prototype["moveProxy"]=a.prototype.moveProxy;a.prototype["isOverlapping"]=a.prototype.isOverlapping;a.prototype["collectPairs"]=a.prototype.collectPairs;a.prototype["getProxyPairList"]=a.prototype.getProxyPairList;a.prototype["isIncremental"]=a.prototype.isIncremental;a.prototype["getTestCount"]=a.prototype.getTestCount;a.prototype["rayCast"]=a.prototype.rayCast;a.prototype["convexCast"]=a.prototype.convexCast;a.prototype["aabbTest"]=a.prototype.aabbTest;t["OIMO"]["Geometry"]=o;o.prototype["getType"]=o.prototype.getType;o.prototype["getVolume"]=o.prototype.getVolume;o.prototype["rayCast"]=o.prototype.rayCast;t["OIMO"]["ConvexGeometry"]=_;_.prototype["getGjkMergin"]=_.prototype.getGjkMergin;_.prototype["setGjkMergin"]=_.prototype.setGjkMergin;_.prototype["computeLocalSupportingVertex"]=_.prototype.computeLocalSupportingVertex;_.prototype["rayCast"]=_.prototype.rayCast;t["OIMO"]["BroadPhaseProxyCallback"]=s;s.prototype["process"]=s.prototype.process;t["OIMO"]["BroadPhaseType"]=n;t["OIMO"]["Proxy"]=e;e.prototype["getId"]=e.prototype.getId;e.prototype["getFatAabb"]=e.prototype.getFatAabb;e.prototype["getFatAabbTo"]=e.prototype.getFatAabbTo;t["OIMO"]["ProxyPair"]=v;v.prototype["getProxy1"]=v.prototype.getProxy1;v.prototype["getProxy2"]=v.prototype.getProxy2;v.prototype["getNext"]=v.prototype.getNext;t["OIMO"]["BruteForceBroadPhase"]=h;h.prototype["createProxy"]=h.prototype.createProxy;h.prototype["destroyProxy"]=h.prototype.destroyProxy;h.prototype["moveProxy"]=h.prototype.moveProxy;h.prototype["collectPairs"]=h.prototype.collectPairs;h.prototype["rayCast"]=h.prototype.rayCast;h.prototype["convexCast"]=h.prototype.convexCast;h.prototype["aabbTest"]=h.prototype.aabbTest;t["OIMO"]["BvhBroadPhase"]=l;l.prototype["createProxy"]=l.prototype.createProxy;l.prototype["destroyProxy"]=l.prototype.destroyProxy;l.prototype["moveProxy"]=l.prototype.moveProxy;l.prototype["collectPairs"]=l.prototype.collectPairs;l.prototype["rayCast"]=l.prototype.rayCast;l.prototype["convexCast"]=l.prototype.convexCast;l.prototype["aabbTest"]=l.prototype.aabbTest;l.prototype["getTreeBalance"]=l.prototype.getTreeBalance;t["OIMO"]["Aabb"]=m;m.prototype["init"]=m.prototype.init;m.prototype["getMin"]=m.prototype.getMin;m.prototype["getMinTo"]=m.prototype.getMinTo;m.prototype["setMin"]=m.prototype.setMin;m.prototype["getMax"]=m.prototype.getMax;m.prototype["getMaxTo"]=m.prototype.getMaxTo;m.prototype["setMax"]=m.prototype.setMax;m.prototype["getCenter"]=m.prototype.getCenter;m.prototype["getCenterTo"]=m.prototype.getCenterTo;m.prototype["getExtents"]=m.prototype.getExtents;m.prototype["getExtentsTo"]=m.prototype.getExtentsTo;m.prototype["combine"]=m.prototype.combine;m.prototype["combined"]=m.prototype.combined;m.prototype["overlap"]=m.prototype.overlap;m.prototype["getIntersection"]=m.prototype.getIntersection;m.prototype["getIntersectionTo"]=m.prototype.getIntersectionTo;m.prototype["copyFrom"]=m.prototype.copyFrom;m.prototype["clone"]=m.prototype.clone;t["OIMO"]["BoxGeometry"]=b;b.prototype["getHalfExtents"]=b.prototype.getHalfExtents;b.prototype["getHalfExtentsTo"]=b.prototype.getHalfExtentsTo;b.prototype["computeLocalSupportingVertex"]=b.prototype.computeLocalSupportingVertex;t["OIMO"]["CapsuleGeometry"]=u;u.prototype["getRadius"]=u.prototype.getRadius;u.prototype["getHalfHeight"]=u.prototype.getHalfHeight;u.prototype["computeLocalSupportingVertex"]=u.prototype.computeLocalSupportingVertex;t["OIMO"]["ConeGeometry"]=x;x.prototype["getRadius"]=x.prototype.getRadius;x.prototype["getHalfHeight"]=x.prototype.getHalfHeight;x.prototype["computeLocalSupportingVertex"]=x.prototype.computeLocalSupportingVertex;t["OIMO"]["ConvexHullGeometry"]=y;y.prototype["getVertices"]=y.prototype.getVertices;y.prototype["computeLocalSupportingVertex"]=y.prototype.computeLocalSupportingVertex;t["OIMO"]["CylinderGeometry"]=g;g.prototype["getRadius"]=g.prototype.getRadius;g.prototype["getHalfHeight"]=g.prototype.getHalfHeight;g.prototype["computeLocalSupportingVertex"]=g.prototype.computeLocalSupportingVertex;t["OIMO"]["GeometryType"]=X;t["OIMO"]["RayCastHit"]=z;t["OIMO"]["SphereGeometry"]=M;M.prototype["getRadius"]=M.prototype.getRadius;M.prototype["computeLocalSupportingVertex"]=M.prototype.computeLocalSupportingVertex;t["OIMO"]["CollisionMatrix"]=Y;Y.prototype["getDetector"]=Y.prototype.getDetector;t["OIMO"]["DetectorResult"]=Z;Z.prototype["getMaxDepth"]=Z.prototype.getMaxDepth;Z.prototype["clear"]=Z.prototype.clear;t["OIMO"]["DetectorResultPoint"]=d;t["OIMO"]["Detector"]=I;I.prototype["detect"]=I.prototype.detect;t["OIMO"]["BoxBoxDetector"]=w;t["OIMO"]["CapsuleCapsuleDetector"]=B;t["OIMO"]["GjkEpaDetector"]=P;t["OIMO"]["SphereBoxDetector"]=T;t["OIMO"]["SphereCapsuleDetector"]=S;t["OIMO"]["SphereSphereDetector"]=C;t["OIMO"]["Vec3"]=Is;Is.prototype["init"]=Is.prototype.init;Is.prototype["zero"]=Is.prototype.zero;Is.prototype["add"]=Is.prototype.add;Is.prototype["addScaled"]=Is.prototype.addScaled;Is.prototype["sub"]=Is.prototype.sub;Is.prototype["scale"]=Is.prototype.scale;Is.prototype["scale3"]=Is.prototype.scale3;Is.prototype["dot"]=Is.prototype.dot;Is.prototype["cross"]=Is.prototype.cross;Is.prototype["addEq"]=Is.prototype.addEq;Is.prototype["addScaledEq"]=Is.prototype.addScaledEq;Is.prototype["subEq"]=Is.prototype.subEq;Is.prototype["scaleEq"]=Is.prototype.scaleEq;Is.prototype["scale3Eq"]=Is.prototype.scale3Eq;Is.prototype["crossEq"]=Is.prototype.crossEq;Is.prototype["mulMat3"]=Is.prototype.mulMat3;Is.prototype["mulMat4"]=Is.prototype.mulMat4;Is.prototype["mulTransform"]=Is.prototype.mulTransform;Is.prototype["mulMat3Eq"]=Is.prototype.mulMat3Eq;Is.prototype["mulMat4Eq"]=Is.prototype.mulMat4Eq;Is.prototype["mulTransformEq"]=Is.prototype.mulTransformEq;Is.prototype["length"]=Is.prototype.length;Is.prototype["lengthSq"]=Is.prototype.lengthSq;Is.prototype["normalized"]=Is.prototype.normalized;Is.prototype["normalize"]=Is.prototype.normalize;Is.prototype["negate"]=Is.prototype.negate;Is.prototype["negateEq"]=Is.prototype.negateEq;Is.prototype["copyFrom"]=Is.prototype.copyFrom;Is.prototype["clone"]=Is.prototype.clone;Is.prototype["toString"]=Is.prototype.toString;t["OIMO"]["Transform"]=j;j.prototype["identity"]=j.prototype.identity;j.prototype["getPosition"]=j.prototype.getPosition;j.prototype["getPositionTo"]=j.prototype.getPositionTo;j.prototype["setPosition"]=j.prototype.setPosition;j.prototype["translate"]=j.prototype.translate;j.prototype["getRotation"]=j.prototype.getRotation;j.prototype["getRotationTo"]=j.prototype.getRotationTo;j.prototype["setRotation"]=j.prototype.setRotation;j.prototype["setRotationXyz"]=j.prototype.setRotationXyz;j.prototype["rotate"]=j.prototype.rotate;j.prototype["rotateXyz"]=j.prototype.rotateXyz;j.prototype["getOrientation"]=j.prototype.getOrientation;j.prototype["getOrientationTo"]=j.prototype.getOrientationTo;j.prototype["setOrientation"]=j.prototype.setOrientation;j.prototype["clone"]=j.prototype.clone;j.prototype["copyFrom"]=j.prototype.copyFrom;t["OIMO"]["Setting"]=ys;t["OIMO"]["GjkEpa"]=N;N.prototype["computeClosestPoints"]=N.prototype.computeClosestPoints;N.prototype["computeDistance"]=N.prototype.computeDistance;N.prototype["convexCast"]=N.prototype.convexCast;N.prototype["rayCast"]=N.prototype.rayCast;N["getInstance"]=N.getInstance;t["OIMO"]["GjkEpaResultState"]=Ga;t["OIMO"]["SimplexUtil"]=F;F["projectOrigin2"]=F.projectOrigin2;F["projectOrigin3"]=F.projectOrigin3;F["projectOrigin4"]=F.projectOrigin4;t["OIMO"]["Mat3"]=ws;ws.prototype["init"]=ws.prototype.init;ws.prototype["identity"]=ws.prototype.identity;ws.prototype["add"]=ws.prototype.add;ws.prototype["sub"]=ws.prototype.sub;ws.prototype["scale"]=ws.prototype.scale;ws.prototype["mul"]=ws.prototype.mul;ws.prototype["addEq"]=ws.prototype.addEq;ws.prototype["subEq"]=ws.prototype.subEq;ws.prototype["scaleEq"]=ws.prototype.scaleEq;ws.prototype["mulEq"]=ws.prototype.mulEq;ws.prototype["prependScale"]=ws.prototype.prependScale;ws.prototype["appendScale"]=ws.prototype.appendScale;ws.prototype["prependRotation"]=ws.prototype.prependRotation;ws.prototype["appendRotation"]=ws.prototype.appendRotation;ws.prototype["prependScaleEq"]=ws.prototype.prependScaleEq;ws.prototype["appendScaleEq"]=ws.prototype.appendScaleEq;ws.prototype["prependRotationEq"]=ws.prototype.prependRotationEq;ws.prototype["appendRotationEq"]=ws.prototype.appendRotationEq;ws.prototype["transpose"]=ws.prototype.transpose;ws.prototype["transposeEq"]=ws.prototype.transposeEq;ws.prototype["determinant"]=ws.prototype.determinant;ws.prototype["trace"]=ws.prototype.trace;ws.prototype["inverse"]=ws.prototype.inverse;ws.prototype["inverseEq"]=ws.prototype.inverseEq;ws.prototype["toArray"]=ws.prototype.toArray;ws.prototype["copyFrom"]=ws.prototype.copyFrom;ws.prototype["clone"]=ws.prototype.clone;ws.prototype["fromQuat"]=ws.prototype.fromQuat;ws.prototype["toQuat"]=ws.prototype.toQuat;ws.prototype["fromEulerXyz"]=ws.prototype.fromEulerXyz;ws.prototype["toEulerXyz"]=ws.prototype.toEulerXyz;ws.prototype["getRow"]=ws.prototype.getRow;ws.prototype["getCol"]=ws.prototype.getCol;ws.prototype["getRowTo"]=ws.prototype.getRowTo;ws.prototype["getColTo"]=ws.prototype.getColTo;ws.prototype["fromRows"]=ws.prototype.fromRows;ws.prototype["fromCols"]=ws.prototype.fromCols;ws.prototype["toString"]=ws.prototype.toString;t["OIMO"]["Mat4"]=O;O.prototype["init"]=O.prototype.init;O.prototype["identity"]=O.prototype.identity;O.prototype["add"]=O.prototype.add;O.prototype["sub"]=O.prototype.sub;O.prototype["scale"]=O.prototype.scale;O.prototype["mul"]=O.prototype.mul;O.prototype["addEq"]=O.prototype.addEq;O.prototype["subEq"]=O.prototype.subEq;O.prototype["scaleEq"]=O.prototype.scaleEq;O.prototype["mulEq"]=O.prototype.mulEq;O.prototype["prependScale"]=O.prototype.prependScale;O.prototype["appendScale"]=O.prototype.appendScale;O.prototype["prependRotation"]=O.prototype.prependRotation;O.prototype["appendRotation"]=O.prototype.appendRotation;O.prototype["prependTranslation"]=O.prototype.prependTranslation;O.prototype["appendTranslation"]=O.prototype.appendTranslation;O.prototype["prependScaleEq"]=O.prototype.prependScaleEq;O.prototype["appendScaleEq"]=O.prototype.appendScaleEq;O.prototype["prependRotationEq"]=O.prototype.prependRotationEq;O.prototype["appendRotationEq"]=O.prototype.appendRotationEq;O.prototype["prependTranslationEq"]=O.prototype.prependTranslationEq;O.prototype["appendTranslationEq"]=O.prototype.appendTranslationEq;O.prototype["transpose"]=O.prototype.transpose;O.prototype["transposeEq"]=O.prototype.transposeEq;O.prototype["determinant"]=O.prototype.determinant;O.prototype["trace"]=O.prototype.trace;O.prototype["inverse"]=O.prototype.inverse;O.prototype["inverseEq"]=O.prototype.inverseEq;O.prototype["lookAt"]=O.prototype.lookAt;O.prototype["perspective"]=O.prototype.perspective;O.prototype["ortho"]=O.prototype.ortho;O.prototype["toArray"]=O.prototype.toArray;O.prototype["copyFrom"]=O.prototype.copyFrom;O.prototype["fromMat3"]=O.prototype.fromMat3;O.prototype["fromTransform"]=O.prototype.fromTransform;O.prototype["clone"]=O.prototype.clone;O.prototype["toString"]=O.prototype.toString;t["OIMO"]["MathUtil"]=W;W["abs"]=W.abs;W["sin"]=W.sin;W["cos"]=W.cos;W["tan"]=W.tan;W["asin"]=W.asin;W["acos"]=W.acos;W["atan"]=W.atan;W["safeAsin"]=W.safeAsin;W["safeAcos"]=W.safeAcos;W["atan2"]=W.atan2;W["sqrt"]=W.sqrt;W["clamp"]=W.clamp;W["rand"]=W.rand;W["randIn"]=W.randIn;W["randVec3In"]=W.randVec3In;W["randVec3"]=W.randVec3;t["OIMO"]["Pool"]=G;G.prototype["vec3"]=G.prototype.vec3;G.prototype["mat3"]=G.prototype.mat3;G.prototype["mat4"]=G.prototype.mat4;G.prototype["quat"]=G.prototype.quat;G.prototype["dispose"]=G.prototype.dispose;G.prototype["disposeVec3"]=G.prototype.disposeVec3;G.prototype["disposeMat3"]=G.prototype.disposeMat3;G.prototype["disposeMat4"]=G.prototype.disposeMat4;G.prototype["disposeQuat"]=G.prototype.disposeQuat;t["OIMO"]["Quat"]=va;va.prototype["identity"]=va.prototype.identity;va.prototype["init"]=va.prototype.init;va.prototype["add"]=va.prototype.add;va.prototype["sub"]=va.prototype.sub;va.prototype["scale"]=va.prototype.scale;va.prototype["addEq"]=va.prototype.addEq;va.prototype["subEq"]=va.prototype.subEq;va.prototype["scaleEq"]=va.prototype.scaleEq;va.prototype["length"]=va.prototype.length;va.prototype["lengthSq"]=va.prototype.lengthSq;va.prototype["dot"]=va.prototype.dot;va.prototype["normalized"]=va.prototype.normalized;va.prototype["normalize"]=va.prototype.normalize;va.prototype["setArc"]=va.prototype.setArc;va.prototype["slerp"]=va.prototype.slerp;va.prototype["copyFrom"]=va.prototype.copyFrom;va.prototype["clone"]=va.prototype.clone;va.prototype["fromMat3"]=va.prototype.fromMat3;va.prototype["toMat3"]=va.prototype.toMat3;va.prototype["toString"]=va.prototype.toString;t["OIMO"]["Contact"]=H;H.prototype["getShape1"]=H.prototype.getShape1;H.prototype["getShape2"]=H.prototype.getShape2;H.prototype["isTouching"]=H.prototype.isTouching;H.prototype["getManifold"]=H.prototype.getManifold;H.prototype["getContactConstraint"]=H.prototype.getContactConstraint;H.prototype["getPrev"]=H.prototype.getPrev;H.prototype["getNext"]=H.prototype.getNext;t["OIMO"]["ContactLink"]=U;U.prototype["getContact"]=U.prototype.getContact;U.prototype["getOther"]=U.prototype.getOther;U.prototype["getPrev"]=U.prototype.getPrev;U.prototype["getNext"]=U.prototype.getNext;t["OIMO"]["ContactManager"]=J;J.prototype["getNumContacts"]=J.prototype.getNumContacts;J.prototype["getContactList"]=J.prototype.getContactList;t["OIMO"]["TimeStep"]=$;t["OIMO"]["World"]=K;K.prototype["step"]=K.prototype.step;K.prototype["addRigidBody"]=K.prototype.addRigidBody;K.prototype["removeRigidBody"]=K.prototype.removeRigidBody;K.prototype["addJoint"]=K.prototype.addJoint;K.prototype["removeJoint"]=K.prototype.removeJoint;K.prototype["setDebugDraw"]=K.prototype.setDebugDraw;K.prototype["getDebugDraw"]=K.prototype.getDebugDraw;K.prototype["debugDraw"]=K.prototype.debugDraw;K.prototype["rayCast"]=K.prototype.rayCast;K.prototype["convexCast"]=K.prototype.convexCast;K.prototype["aabbTest"]=K.prototype.aabbTest;K.prototype["getRigidBodyList"]=K.prototype.getRigidBodyList;K.prototype["getJointList"]=K.prototype.getJointList;K.prototype["getBroadPhase"]=K.prototype.getBroadPhase;K.prototype["getContactManager"]=K.prototype.getContactManager;K.prototype["getNumRigidBodies"]=K.prototype.getNumRigidBodies;K.prototype["getNumJoints"]=K.prototype.getNumJoints;K.prototype["getNumShapes"]=K.prototype.getNumShapes;K.prototype["getNumIslands"]=K.prototype.getNumIslands;K.prototype["getNumVelocityIterations"]=K.prototype.getNumVelocityIterations;K.prototype["setNumVelocityIterations"]=K.prototype.setNumVelocityIterations;K.prototype["getNumPositionIterations"]=K.prototype.getNumPositionIterations;K.prototype["setNumPositionIterations"]=K.prototype.setNumPositionIterations;K.prototype["getGravity"]=K.prototype.getGravity;K.prototype["setGravity"]=K.prototype.setGravity;t["OIMO"]["AabbTestCallback"]=rt;t["OIMO"]["ContactCallback"]=ot;t["OIMO"]["RayCastCallback"]=st;t["OIMO"]["RayCastClosest"]=nt;nt.prototype["clear"]=nt.prototype.clear;nt.prototype["process"]=nt.prototype.process;t["OIMO"]["DebugDrawStyle"]=_t;t["OIMO"]["Performance"]=vt;t["OIMO"]["ConstraintSolver"]=ht;ht.prototype["preSolveVelocity"]=ht.prototype.preSolveVelocity;ht.prototype["warmStart"]=ht.prototype.warmStart;ht.prototype["solveVelocity"]=ht.prototype.solveVelocity;ht.prototype["postSolveVelocity"]=ht.prototype.postSolveVelocity;ht.prototype["preSolvePosition"]=ht.prototype.preSolvePosition;ht.prototype["solvePositionSplitImpulse"]=ht.prototype.solvePositionSplitImpulse;ht.prototype["solvePositionNgs"]=ht.prototype.solvePositionNgs;ht.prototype["postSolve"]=ht.prototype.postSolve;t["OIMO"]["PositionCorrectionAlgorithm"]=ka;t["OIMO"]["ContactConstraint"]=lt;lt.prototype["getShape1"]=lt.prototype.getShape1;lt.prototype["getShape2"]=lt.prototype.getShape2;lt.prototype["getManifold"]=lt.prototype.getManifold;lt.prototype["isTouching"]=lt.prototype.isTouching;t["OIMO"]["Manifold"]=pt;pt.prototype["getNormal"]=pt.prototype.getNormal;pt.prototype["getNormalTo"]=pt.prototype.getNormalTo;pt.prototype["getTangent"]=pt.prototype.getTangent;pt.prototype["getTangentTo"]=pt.prototype.getTangentTo;pt.prototype["getBinormal"]=pt.prototype.getBinormal;pt.prototype["getBinormalTo"]=pt.prototype.getBinormalTo;pt.prototype["getPoints"]=pt.prototype.getPoints;pt.prototype["getNumPoints"]=pt.prototype.getNumPoints;t["OIMO"]["ManifoldPoint"]=ft;ft.prototype["getPosition1"]=ft.prototype.getPosition1;ft.prototype["getPosition1To"]=ft.prototype.getPosition1To;ft.prototype["getPosition2"]=ft.prototype.getPosition2;ft.prototype["getPosition2To"]=ft.prototype.getPosition2To;ft.prototype["getDepth"]=ft.prototype.getDepth;ft.prototype["isWarmStarted"]=ft.prototype.isWarmStarted;ft.prototype["getNormalImpulse"]=ft.prototype.getNormalImpulse;ft.prototype["getTangentImpulse"]=ft.prototype.getTangentImpulse;ft.prototype["getBinormalImpulse"]=ft.prototype.getBinormalImpulse;ft.prototype["isEnabled"]=ft.prototype.isEnabled;t["OIMO"]["Joint"]=Ei;Ei.prototype["getRigidBody1"]=Ei.prototype.getRigidBody1;Ei.prototype["getRigidBody2"]=Ei.prototype.getRigidBody2;Ei.prototype["getType"]=Ei.prototype.getType;Ei.prototype["getAnchor1"]=Ei.prototype.getAnchor1;Ei.prototype["getAnchor2"]=Ei.prototype.getAnchor2;Ei.prototype["getAnchor1To"]=Ei.prototype.getAnchor1To;Ei.prototype["getAnchor2To"]=Ei.prototype.getAnchor2To;Ei.prototype["getLocalAnchor1"]=Ei.prototype.getLocalAnchor1;Ei.prototype["getLocalAnchor2"]=Ei.prototype.getLocalAnchor2;Ei.prototype["getLocalAnchor1To"]=Ei.prototype.getLocalAnchor1To;Ei.prototype["getLocalAnchor2To"]=Ei.prototype.getLocalAnchor2To;Ei.prototype["getBasis1"]=Ei.prototype.getBasis1;Ei.prototype["getBasis2"]=Ei.prototype.getBasis2;Ei.prototype["getBasis1To"]=Ei.prototype.getBasis1To;Ei.prototype["getBasis2To"]=Ei.prototype.getBasis2To;Ei.prototype["getAllowCollision"]=Ei.prototype.getAllowCollision;Ei.prototype["setAllowCollision"]=Ei.prototype.setAllowCollision;Ei.prototype["getBreakForce"]=Ei.prototype.getBreakForce;Ei.prototype["setBreakForce"]=Ei.prototype.setBreakForce;Ei.prototype["getBreakTorque"]=Ei.prototype.getBreakTorque;Ei.prototype["setBreakTorque"]=Ei.prototype.setBreakTorque;Ei.prototype["getPositionCorrectionAlgorithm"]=Ei.prototype.getPositionCorrectionAlgorithm;Ei.prototype["setPositionCorrectionAlgorithm"]=Ei.prototype.setPositionCorrectionAlgorithm;Ei.prototype["getAppliedForce"]=Ei.prototype.getAppliedForce;Ei.prototype["getAppliedForceTo"]=Ei.prototype.getAppliedForceTo;Ei.prototype["getAppliedTorque"]=Ei.prototype.getAppliedTorque;Ei.prototype["getAppliedTorqueTo"]=Ei.prototype.getAppliedTorqueTo;Ei.prototype["getPrev"]=Ei.prototype.getPrev;Ei.prototype["getNext"]=Ei.prototype.getNext;t["OIMO"]["CylindricalJoint"]=Xt;Xt.prototype["getAxis1"]=Xt.prototype.getAxis1;Xt.prototype["getAxis2"]=Xt.prototype.getAxis2;Xt.prototype["getAxis1To"]=Xt.prototype.getAxis1To;Xt.prototype["getAxis2To"]=Xt.prototype.getAxis2To;Xt.prototype["getLocalAxis1"]=Xt.prototype.getLocalAxis1;Xt.prototype["getLocalAxis2"]=Xt.prototype.getLocalAxis2;Xt.prototype["getLocalAxis1To"]=Xt.prototype.getLocalAxis1To;Xt.prototype["getLocalAxis2To"]=Xt.prototype.getLocalAxis2To;Xt.prototype["getTranslationalSpringDamper"]=Xt.prototype.getTranslationalSpringDamper;Xt.prototype["getRotationalSpringDamper"]=Xt.prototype.getRotationalSpringDamper;Xt.prototype["getTranslationalLimitMotor"]=Xt.prototype.getTranslationalLimitMotor;Xt.prototype["getRotationalLimitMotor"]=Xt.prototype.getRotationalLimitMotor;Xt.prototype["getAngle"]=Xt.prototype.getAngle;Xt.prototype["getTranslation"]=Xt.prototype.getTranslation;t["OIMO"]["JointConfig"]=zt;t["OIMO"]["CylindricalJointConfig"]=Yt;Yt.prototype["init"]=Yt.prototype.init;t["OIMO"]["JointLink"]=It;It.prototype["getContact"]=It.prototype.getContact;It.prototype["getOther"]=It.prototype.getOther;It.prototype["getPrev"]=It.prototype.getPrev;It.prototype["getNext"]=It.prototype.getNext;t["OIMO"]["JointType"]=Vt;t["OIMO"]["PrismaticJoint"]=Lt;Lt.prototype["getAxis1"]=Lt.prototype.getAxis1;Lt.prototype["getAxis2"]=Lt.prototype.getAxis2;Lt.prototype["getAxis1To"]=Lt.prototype.getAxis1To;Lt.prototype["getAxis2To"]=Lt.prototype.getAxis2To;Lt.prototype["getLocalAxis1"]=Lt.prototype.getLocalAxis1;Lt.prototype["getLocalAxis2"]=Lt.prototype.getLocalAxis2;Lt.prototype["getLocalAxis1To"]=Lt.prototype.getLocalAxis1To;Lt.prototype["getLocalAxis2To"]=Lt.prototype.getLocalAxis2To;Lt.prototype["getSpringDamper"]=Lt.prototype.getSpringDamper;Lt.prototype["getLimitMotor"]=Lt.prototype.getLimitMotor;Lt.prototype["getTranslation"]=Lt.prototype.getTranslation;t["OIMO"]["PrismaticJointConfig"]=At;At.prototype["init"]=At.prototype.init;t["OIMO"]["RagdollJoint"]=kt;kt.prototype["getAxis1"]=kt.prototype.getAxis1;kt.prototype["getAxis2"]=kt.prototype.getAxis2;kt.prototype["getAxis1To"]=kt.prototype.getAxis1To;kt.prototype["getAxis2To"]=kt.prototype.getAxis2To;kt.prototype["getLocalAxis1"]=kt.prototype.getLocalAxis1;kt.prototype["getLocalAxis2"]=kt.prototype.getLocalAxis2;kt.prototype["getLocalAxis1To"]=kt.prototype.getLocalAxis1To;kt.prototype["getLocalAxis2To"]=kt.prototype.getLocalAxis2To;kt.prototype["getTwistSpringDamper"]=kt.prototype.getTwistSpringDamper;kt.prototype["getTwistLimitMotor"]=kt.prototype.getTwistLimitMotor;kt.prototype["getSwingSpringDamper"]=kt.prototype.getSwingSpringDamper;kt.prototype["getSwingAxis"]=kt.prototype.getSwingAxis;kt.prototype["getSwingAxisTo"]=kt.prototype.getSwingAxisTo;kt.prototype["getSwingAngle"]=kt.prototype.getSwingAngle;kt.prototype["getTwistAngle"]=kt.prototype.getTwistAngle;t["OIMO"]["RagdollJointConfig"]=Bt;Bt.prototype["init"]=Bt.prototype.init;t["OIMO"]["RevoluteJoint"]=Pt;Pt.prototype["getAxis1"]=Pt.prototype.getAxis1;Pt.prototype["getAxis2"]=Pt.prototype.getAxis2;Pt.prototype["getAxis1To"]=Pt.prototype.getAxis1To;Pt.prototype["getAxis2To"]=Pt.prototype.getAxis2To;Pt.prototype["getLocalAxis1"]=Pt.prototype.getLocalAxis1;Pt.prototype["getLocalAxis2"]=Pt.prototype.getLocalAxis2;Pt.prototype["getLocalAxis1To"]=Pt.prototype.getLocalAxis1To;Pt.prototype["getLocalAxis2To"]=Pt.prototype.getLocalAxis2To;Pt.prototype["getSpringDamper"]=Pt.prototype.getSpringDamper;Pt.prototype["getLimitMotor"]=Pt.prototype.getLimitMotor;Pt.prototype["getAngle"]=Pt.prototype.getAngle;t["OIMO"]["RevoluteJointConfig"]=Tt;Tt.prototype["init"]=Tt.prototype.init;t["OIMO"]["RotationalLimitMotor"]=St;St.prototype["setLimits"]=St.prototype.setLimits;St.prototype["setMotor"]=St.prototype.setMotor;St.prototype["clone"]=St.prototype.clone;t["OIMO"]["SphericalJoint"]=Ct;Ct.prototype["getSpringDamper"]=Ct.prototype.getSpringDamper;t["OIMO"]["SphericalJointConfig"]=qt;qt.prototype["init"]=qt.prototype.init;t["OIMO"]["SpringDamper"]=Rt;Rt.prototype["setSpring"]=Rt.prototype.setSpring;Rt.prototype["setSymplecticEuler"]=Rt.prototype.setSymplecticEuler;Rt.prototype["clone"]=Rt.prototype.clone;t["OIMO"]["TranslationalLimitMotor"]=Et;Et.prototype["setLimits"]=Et.prototype.setLimits;Et.prototype["setMotor"]=Et.prototype.setMotor;Et.prototype["clone"]=Et.prototype.clone;t["OIMO"]["UniversalJoint"]=jt;jt.prototype["getAxis1"]=jt.prototype.getAxis1;jt.prototype["getAxis2"]=jt.prototype.getAxis2;jt.prototype["getAxis1To"]=jt.prototype.getAxis1To;jt.prototype["getAxis2To"]=jt.prototype.getAxis2To;jt.prototype["getLocalAxis1"]=jt.prototype.getLocalAxis1;jt.prototype["getLocalAxis2"]=jt.prototype.getLocalAxis2;jt.prototype["getLocalAxis1To"]=jt.prototype.getLocalAxis1To;jt.prototype["getLocalAxis2To"]=jt.prototype.getLocalAxis2To;jt.prototype["getSpringDamper1"]=jt.prototype.getSpringDamper1;jt.prototype["getSpringDamper2"]=jt.prototype.getSpringDamper2;jt.prototype["getLimitMotor1"]=jt.prototype.getLimitMotor1;jt.prototype["getLimitMotor2"]=jt.prototype.getLimitMotor2;jt.prototype["getAngle1"]=jt.prototype.getAngle1;jt.prototype["getAngle2"]=jt.prototype.getAngle2;t["OIMO"]["UniversalJointConfig"]=Nt;Nt.prototype["init"]=Nt.prototype.init;t["OIMO"]["ConstraintSolverType"]=Dt;t["OIMO"]["DirectJointConstraintSolver"]=Jt;Jt.prototype["preSolveVelocity"]=Jt.prototype.preSolveVelocity;Jt.prototype["warmStart"]=Jt.prototype.warmStart;Jt.prototype["solveVelocity"]=Jt.prototype.solveVelocity;Jt.prototype["postSolveVelocity"]=Jt.prototype.postSolveVelocity;Jt.prototype["preSolvePosition"]=Jt.prototype.preSolvePosition;Jt.prototype["solvePositionSplitImpulse"]=Jt.prototype.solvePositionSplitImpulse;Jt.prototype["solvePositionNgs"]=Jt.prototype.solvePositionNgs;Jt.prototype["postSolve"]=Jt.prototype.postSolve;t["OIMO"]["PgsContactConstraintSolver"]=$t;$t.prototype["preSolveVelocity"]=$t.prototype.preSolveVelocity;$t.prototype["warmStart"]=$t.prototype.warmStart;$t.prototype["solveVelocity"]=$t.prototype.solveVelocity;$t.prototype["preSolvePosition"]=$t.prototype.preSolvePosition;$t.prototype["solvePositionSplitImpulse"]=$t.prototype.solvePositionSplitImpulse;$t.prototype["solvePositionNgs"]=$t.prototype.solvePositionNgs;$t.prototype["postSolve"]=$t.prototype.postSolve;t["OIMO"]["PgsJointConstraintSolver"]=Kt;Kt.prototype["preSolveVelocity"]=Kt.prototype.preSolveVelocity;Kt.prototype["warmStart"]=Kt.prototype.warmStart;Kt.prototype["solveVelocity"]=Kt.prototype.solveVelocity;Kt.prototype["postSolveVelocity"]=Kt.prototype.postSolveVelocity;Kt.prototype["preSolvePosition"]=Kt.prototype.preSolvePosition;Kt.prototype["solvePositionSplitImpulse"]=Kt.prototype.solvePositionSplitImpulse;Kt.prototype["solvePositionNgs"]=Kt.prototype.solvePositionNgs;Kt.prototype["postSolve"]=Kt.prototype.postSolve;t["OIMO"]["MassData"]=ta;t["OIMO"]["RigidBody"]=aa;aa.prototype["getPosition"]=aa.prototype.getPosition;aa.prototype["getPositionTo"]=aa.prototype.getPositionTo;aa.prototype["setPosition"]=aa.prototype.setPosition;aa.prototype["translate"]=aa.prototype.translate;aa.prototype["getRotation"]=aa.prototype.getRotation;aa.prototype["getRotationTo"]=aa.prototype.getRotationTo;aa.prototype["setRotation"]=aa.prototype.setRotation;aa.prototype["setRotationXyz"]=aa.prototype.setRotationXyz;aa.prototype["rotate"]=aa.prototype.rotate;aa.prototype["rotateXyz"]=aa.prototype.rotateXyz;aa.prototype["getOrientation"]=aa.prototype.getOrientation;aa.prototype["getOrientationTo"]=aa.prototype.getOrientationTo;aa.prototype["setOrientation"]=aa.prototype.setOrientation;aa.prototype["getTransform"]=aa.prototype.getTransform;aa.prototype["getTransformTo"]=aa.prototype.getTransformTo;aa.prototype["setTransform"]=aa.prototype.setTransform;aa.prototype["getMass"]=aa.prototype.getMass;aa.prototype["getLocalInertia"]=aa.prototype.getLocalInertia;aa.prototype["getLocalInertiaTo"]=aa.prototype.getLocalInertiaTo;aa.prototype["getMassData"]=aa.prototype.getMassData;aa.prototype["getMassDataTo"]=aa.prototype.getMassDataTo;aa.prototype["setMassData"]=aa.prototype.setMassData;aa.prototype["getRotationFactor"]=aa.prototype.getRotationFactor;aa.prototype["setRotationFactor"]=aa.prototype.setRotationFactor;aa.prototype["getLinearVelocity"]=aa.prototype.getLinearVelocity;aa.prototype["getLinearVelocityTo"]=aa.prototype.getLinearVelocityTo;aa.prototype["setLinearVelocity"]=aa.prototype.setLinearVelocity;aa.prototype["getAngularVelocity"]=aa.prototype.getAngularVelocity;aa.prototype["getAngularVelocityTo"]=aa.prototype.getAngularVelocityTo;aa.prototype["setAngularVelocity"]=aa.prototype.setAngularVelocity;aa.prototype["addLinearVelocity"]=aa.prototype.addLinearVelocity;aa.prototype["addAngularVelocity"]=aa.prototype.addAngularVelocity;aa.prototype["applyImpulse"]=aa.prototype.applyImpulse;aa.prototype["applyLinearImpulse"]=aa.prototype.applyLinearImpulse;aa.prototype["applyAngularImpulse"]=aa.prototype.applyAngularImpulse;aa.prototype["applyForce"]=aa.prototype.applyForce;aa.prototype["applyForceToCenter"]=aa.prototype.applyForceToCenter;aa.prototype["applyTorque"]=aa.prototype.applyTorque;aa.prototype["getGravityScale"]=aa.prototype.getGravityScale;aa.prototype["setGravityScale"]=aa.prototype.setGravityScale;aa.prototype["getLocalPoint"]=aa.prototype.getLocalPoint;aa.prototype["getLocalPointTo"]=aa.prototype.getLocalPointTo;aa.prototype["getLocalVector"]=aa.prototype.getLocalVector;aa.prototype["getLocalVectorTo"]=aa.prototype.getLocalVectorTo;aa.prototype["getWorldPoint"]=aa.prototype.getWorldPoint;aa.prototype["getWorldPointTo"]=aa.prototype.getWorldPointTo;aa.prototype["getWorldVector"]=aa.prototype.getWorldVector;aa.prototype["getWorldVectorTo"]=aa.prototype.getWorldVectorTo;aa.prototype["getNumShapes"]=aa.prototype.getNumShapes;aa.prototype["getShapeList"]=aa.prototype.getShapeList;aa.prototype["getNumContectLinks"]=aa.prototype.getNumContectLinks;aa.prototype["getContactLinkList"]=aa.prototype.getContactLinkList;aa.prototype["getNumJointLinks"]=aa.prototype.getNumJointLinks;aa.prototype["getJointLinkList"]=aa.prototype.getJointLinkList;aa.prototype["addShape"]=aa.prototype.addShape;aa.prototype["removeShape"]=aa.prototype.removeShape;aa.prototype["getType"]=aa.prototype.getType;aa.prototype["setType"]=aa.prototype.setType;aa.prototype["wakeUp"]=aa.prototype.wakeUp;aa.prototype["sleep"]=aa.prototype.sleep;aa.prototype["isSleeping"]=aa.prototype.isSleeping;aa.prototype["getSleepTime"]=aa.prototype.getSleepTime;aa.prototype["setAutoSleep"]=aa.prototype.setAutoSleep;aa.prototype["getLinearDamping"]=aa.prototype.getLinearDamping;aa.prototype["setLinearDamping"]=aa.prototype.setLinearDamping;aa.prototype["getAngularDamping"]=aa.prototype.getAngularDamping;aa.prototype["setAngularDamping"]=aa.prototype.setAngularDamping;aa.prototype["getPrev"]=aa.prototype.getPrev;aa.prototype["getNext"]=aa.prototype.getNext;t["OIMO"]["RigidBodyConfig"]=ia;t["OIMO"]["RigidBodyType"]=ra;t["OIMO"]["Shape"]=oa;oa.prototype["getFriction"]=oa.prototype.getFriction;oa.prototype["setFriction"]=oa.prototype.setFriction;oa.prototype["getRestitution"]=oa.prototype.getRestitution;oa.prototype["setRestitution"]=oa.prototype.setRestitution;oa.prototype["getLocalTransform"]=oa.prototype.getLocalTransform;oa.prototype["getLocalTransformTo"]=oa.prototype.getLocalTransformTo;oa.prototype["getTransform"]=oa.prototype.getTransform;oa.prototype["getTransformTo"]=oa.prototype.getTransformTo;oa.prototype["setLocalTransform"]=oa.prototype.setLocalTransform;oa.prototype["getDensity"]=oa.prototype.getDensity;oa.prototype["setDensity"]=oa.prototype.setDensity;oa.prototype["getAabb"]=oa.prototype.getAabb;oa.prototype["getAabbTo"]=oa.prototype.getAabbTo;oa.prototype["getGeometry"]=oa.prototype.getGeometry;oa.prototype["getRigidBody"]=oa.prototype.getRigidBody;oa.prototype["getCollisionGroup"]=oa.prototype.getCollisionGroup;oa.prototype["setCollisionGroup"]=oa.prototype.setCollisionGroup;oa.prototype["getCollisionMask"]=oa.prototype.getCollisionMask;oa.prototype["setCollisionMask"]=oa.prototype.setCollisionMask;oa.prototype["getContactCallback"]=oa.prototype.getContactCallback;oa.prototype["setContactCallback"]=oa.prototype.setContactCallback;oa.prototype["getPrev"]=oa.prototype.getPrev;oa.prototype["getNext"]=oa.prototype.getNext;t["OIMO"]["ShapeConfig"]=sa})(window);"use strict";var __reflect=this&&this.__reflect||function(t,i,e){t.__class__=i,e?e.push(i):e=[i],t.__types__=t.__types__?e.concat(t.__types__):e},__extends=this&&this.__extends||function(t,i){function e(){this.constructor=t}for(var o in i)i.hasOwnProperty(o)&&(t[o]=i[o]);e.prototype=i.prototype,t.prototype=new e},__decorate=this&&this.__decorate||function(t,i,e,o){var r,n=arguments.length,a=3>n?i:null===o?o=Object.getOwnPropertyDescriptor(i,e):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,i,e,o);else for(var p=t.length-1;p>=0;p--)(r=t[p])&&(a=(3>n?r(a):n>3?r(i,e,a):r(i,e))||a);return n>3&&a&&Object.defineProperty(i,e,a),a},egret3d;!function(t){var i;!function(t){var i;!function(t){t[t.Dynamic=0]="Dynamic",t[t.Static=1]="Static",t[t.Kinematic=2]="Kinematic"}(i=t.RigidbodyType||(t.RigidbodyType={}));var e;!function(t){t[t.Prismatic=OIMO.JointType.PRISMATIC]="Prismatic",t[t.Revolute=OIMO.JointType.REVOLUTE]="Revolute",t[t.Cylindrical=OIMO.JointType.CYLINDRICAL]="Cylindrical",t[t.Spherical=OIMO.JointType.SPHERICAL]="Spherical",t[t.Universal=OIMO.JointType.UNIVERSAL]="Universal",t[t.ConeTwist=OIMO.JointType.RAGDOLL]="ConeTwist"}(e=t.JointType||(t.JointType={}))}(i=t.oimo||(t.oimo={}))}(egret3d||(egret3d={}));var egret3d;!function(t){var i;!function(i){var e;!function(t){t[t.Type=0]="Type",t[t.Mass=1]="Mass",t[t.GravityScale=2]="GravityScale",t[t.LinearDamping=3]="LinearDamping",t[t.AngularDamping=4]="AngularDamping"}(e||(e={}));var o=function(e){function o(){var i=null!==e&&e.apply(this,arguments)||this;return i._linearVelocity=t.Vector3.create(),i._angularVelocity=t.Vector3.create(),i._values=new Float32Array([0,1,1,0,0]),i._oimoRigidbody=null,i}return __extends(o,e),o.prototype._createRigidbody=function(){var t=o._config;t.type=this.type,t.linearDamping=this.linearDamping,t.angularDamping=this.angularDamping,t.linearVelocity=this._linearVelocity,t.angularVelocity=this._angularVelocity;var i=new OIMO.RigidBody(t);return i.userData=this,i.setGravityScale(this.gravityScale),i},o.prototype._updateMass=function(t){var i=o._massData;t.getMassDataTo(i),i.mass=this._values[1],t.setMassData(i)},o.prototype._checkRigidbody=function(t){if(null===this._oimoRigidbody&&0===this.oimoRigidbody.getNumShapes())for(var e=0,o=this.gameObject.getComponents(i.BaseCollider,!0);e<o.length;e++){var r=o[e];this.oimoRigidbody.addShape(r.oimoShape)}return 0===this._oimoRigidbody.getNumShapes()?!1:!0},o.prototype.wakeUp=function(){return null!==this._oimoRigidbody&&this._oimoRigidbody.wakeUp(),this},o.prototype.sleep=function(){return null!==this._oimoRigidbody&&this._oimoRigidbody.sleep(),this},o.prototype.addLinearVelocity=function(t){return this._checkRigidbody()&&this._oimoRigidbody.addLinearVelocity(t),this},o.prototype.addAngularVelocity=function(t){return this._checkRigidbody()&&this._oimoRigidbody.addAngularVelocity(t),this},o.prototype.applyForce=function(t,i){return this._checkRigidbody()&&this._oimoRigidbody.applyForce(t,i),this},o.prototype.applyForceToCenter=function(t){return this._checkRigidbody()&&this._oimoRigidbody.applyForceToCenter(t),this},o.prototype.applyTorque=function(t){return this._checkRigidbody()&&this._oimoRigidbody.applyTorque(t),this},o.prototype.applyImpulse=function(t,i){return this._checkRigidbody()&&this._oimoRigidbody.applyImpulse(t,i),this},o.prototype.applyLinearImpulse=function(t){return this._checkRigidbody()&&this._oimoRigidbody.applyLinearImpulse(t),this},o.prototype.applyAngularImpulse=function(t){return this._checkRigidbody()&&this._oimoRigidbody.applyAngularImpulse(t),this},o.prototype.syncTransform=function(t){var e=this._oimoRigidbody;if(null!==e){var o=i.PhysicsSystem._helpTransform;t||(t=this.gameObject.transform),o.setPosition(t.position),o.setOrientation(t.rotation),e.setTransform(o)}return this},Object.defineProperty(o.prototype,"isSleeping",{get:function(){return null!==this._oimoRigidbody?this._oimoRigidbody.isSleeping():!1},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"sleepTime",{get:function(){return null!==this._oimoRigidbody?this._oimoRigidbody.getSleepTime():0},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"type",{get:function(){return this._values[0]},set:function(t){this._values[0]!==t&&(this._values[0]=t,null!==this._oimoRigidbody&&this._oimoRigidbody.setType(t))},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"mass",{get:function(){return this._values[1]},set:function(t){0>=t&&(t=.01),this._values[1]!==t&&(this._values[1]=t,null!==this._oimoRigidbody&&this._updateMass(this._oimoRigidbody))},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"gravityScale",{get:function(){return this._values[2]},set:function(t){this._values[2]!==t&&(this._values[2]=t,null!==this._oimoRigidbody&&this._oimoRigidbody.setGravityScale(t))},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"linearDamping",{get:function(){return this._values[3]},set:function(t){this._values[3]!==t&&(this._values[3]=t,null!==this._oimoRigidbody&&this._oimoRigidbody.setLinearDamping(t))},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"angularDamping",{get:function(){return this._values[4]},set:function(t){this._values[4]!==t&&(this._values[4]=t,null!==this._oimoRigidbody&&this._oimoRigidbody.setAngularDamping(t))},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"linearVelocity",{get:function(){return null!==this._oimoRigidbody&&this._oimoRigidbody.getLinearVelocityTo(this._linearVelocity),this._linearVelocity},set:function(t){this._linearVelocity.copy(t),null!==this._oimoRigidbody&&this._oimoRigidbody.setLinearVelocity(this._linearVelocity)},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"angularVelocity",{get:function(){return null!==this._oimoRigidbody&&this._oimoRigidbody.getAngularVelocityTo(this._angularVelocity),this._angularVelocity},set:function(t){this._angularVelocity.copy(t),null!==this._oimoRigidbody&&this._oimoRigidbody.setAngularVelocity(this._angularVelocity)},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"oimoRigidbody",{get:function(){return null===this._oimoRigidbody&&(this._oimoRigidbody=this._createRigidbody(),this.syncTransform()),this._oimoRigidbody},enumerable:!0,configurable:!0}),o._config=new OIMO.RigidBodyConfig,o._massData=new OIMO.MassData,__decorate([paper.serializedField],o.prototype,"_values",void 0),__decorate([paper.editor.property("LIST",{listItems:paper.editor.getItemsFromEnum(t.oimo.RigidbodyType)})],o.prototype,"type",null),__decorate([paper.editor.property("FLOAT")],o.prototype,"mass",null),__decorate([paper.editor.property("FLOAT")],o.prototype,"gravityScale",null),__decorate([paper.editor.property("FLOAT")],o.prototype,"linearDamping",null),__decorate([paper.editor.property("FLOAT")],o.prototype,"angularDamping",null),o}(paper.BaseComponent);i.Rigidbody=o,__reflect(o.prototype,"egret3d.oimo.Rigidbody",["egret3d.IRigidbody"])}(i=t.oimo||(t.oimo={}))}(egret3d||(egret3d={}));var egret3d;!function(t){var i;!function(t){var i;!function(t){t[t.CollisionMask=0]="CollisionMask",t[t.Friction=1]="Friction",t[t.Restitution=2]="Restitution",t[t.Density=3]="Density"}(i||(i={}));var e=function(t){function i(){var i=null!==t&&t.apply(this,arguments)||this;return i.colliderType=-1,i._values=new Float32Array(4),i._oimoShape=null,i}return __extends(i,t),e=i,i.prototype._updateConfig=function(){var t=e._config;return t.collisionGroup=this.gameObject.layer,t.collisionMask=this.collisionMask,t.friction=this.friction,t.restitution=this.restitution,t.density=this.density,t},i.prototype.initialize=function(){t.prototype.initialize.call(this),this._values[0]=1,this._values[1]=OIMO.Setting.defaultFriction,this._values[2]=OIMO.Setting.defaultRestitution,this._values[3]=OIMO.Setting.defaultDensity},i.prototype.uninitialize=function(){t.prototype.uninitialize.call(this),this._oimoShape=null},Object.defineProperty(i.prototype,"collisionMask",{get:function(){return this._values[0]},set:function(t){this._values[0]!==t&&(this._values[0]=t,null!==this._oimoShape&&this._oimoShape.setCollisionMask(t))},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"friction",{get:function(){return this._values[1]},set:function(t){this._values[1]!==t&&(this._values[1]=t,null!==this._oimoShape&&this._oimoShape.setFriction(t))},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"restitution",{get:function(){return this._values[2]},set:function(t){this._values[2]!==t&&(this._values[2]=t,null!==this._oimoShape&&this._oimoShape.setRestitution(t))},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"density",{get:function(){return this._values[3]},set:function(t){this._values[3]!==t&&(this._values[3]=t,null!==this._oimoShape&&this._oimoShape.setDensity(t))},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"oimoShape",{get:function(){return null===this._oimoShape&&(this._oimoShape=this._createShape()),this._oimoShape},enumerable:!0,configurable:!0}),i._config=new OIMO.ShapeConfig,__decorate([paper.serializedField],i.prototype,"_values",void 0),__decorate([paper.editor.property("LIST",{listItems:paper.editor.getItemsFromEnum(paper.Layer)})],i.prototype,"collisionMask",null),__decorate([paper.editor.property("FLOAT",{minimum:0})],i.prototype,"friction",null),__decorate([paper.editor.property("FLOAT",{minimum:0,maximum:1})],i.prototype,"restitution",null),__decorate([paper.editor.property("FLOAT",{minimum:0})],i.prototype,"density",null),i=e=__decorate([paper["abstract"]],i);var e}(paper.BaseComponent);t.BaseCollider=e,__reflect(e.prototype,"egret3d.oimo.BaseCollider",["egret3d.ICollider"])}(i=t.oimo||(t.oimo={}))}(egret3d||(egret3d={}));var egret3d;!function(t){var i;!function(i){var e;!function(t){t[t.CollisionEnabled=0]="CollisionEnabled",t[t.UseWorldAnchor=1]="UseWorldAnchor",t[t.BreakForce=2]="BreakForce",t[t.BreakTorque=3]="BreakTorque"}(e||(e={}));var o=function(e){function o(){var i=null!==e&&e.apply(this,arguments)||this;return i.jointType=-1,i._anchor=t.Vector3.create(),i._rigidbody=null,i._connectedBody=null,i._oimoJoint=null,i}return __extends(o,e),o.prototype.initialize=function(){e.prototype.initialize.call(this),this._values[0]=0,this._values[1]=0,this._values[2]=0,this._values[3]=0,this._rigidbody=this.entity.getComponent(i.Rigidbody)},o.prototype.uninitialize=function(){e.prototype.uninitialize.call(this),this._anchor.clear(),this._rigidbody=null,this._connectedBody=null,this._oimoJoint=null},o.prototype.getConnectedAnchor=function(i,e){return void 0===i&&(i=null),void 0===e&&(e=!1),null===i&&(i=t.Vector3.create()),null!==this._oimoJoint?e?this._oimoJoint.getAnchor2To(i):this._oimoJoint.getLocalAnchor2To(i):(i.copy(this.anchor),e?this.useWorldSpace||i.applyMatrix(this.gameObject.transform.localToWorldMatrix):this.useWorldSpace&&i.applyMatrix(this.gameObject.transform.worldToLocalMatrix)),i},o.prototype.getAppliedForce=function(i){return void 0===i&&(i=null),null===i&&(i=t.Vector3.create()),null!==this._oimoJoint&&this._oimoJoint.getAppliedForceTo(i),i},o.prototype.getAppliedTorque=function(i){return void 0===i&&(i=null),null===i&&(i=t.Vector3.create()),null!==this._oimoJoint&&this._oimoJoint.getAppliedTorqueTo(i),i},Object.defineProperty(o.prototype,"collisionEnabled",{get:function(){return 1===this._values[0]},set:function(t){this.collisionEnabled!==t&&(this._values[0]=t?1:0,null!==this._oimoJoint&&this._oimoJoint.setAllowCollision(t))},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"useWorldSpace",{get:function(){return this._values[1]>0},set:function(t){null===this._oimoJoint&&(this._values[1]=t?1:0)},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"anchor",{get:function(){return this._anchor},set:function(t){null===this._oimoJoint&&this._anchor.copy(t)},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"rigidbody",{get:function(){return this._rigidbody},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"connectedRigidbody",{get:function(){return this._connectedBody},set:function(t){this._connectedBody!==t&&null===this._oimoJoint&&(this._connectedBody=t)},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"oimoJoint",{get:function(){return null===this._oimoJoint&&(this._oimoJoint=this._createJoint()),this._oimoJoint},enumerable:!0,configurable:!0}),__decorate([paper.serializedField],o.prototype,"_anchor",void 0),__decorate([paper.serializedField],o.prototype,"_values",void 0),__decorate([paper.editor.property("CHECKBOX")],o.prototype,"collisionEnabled",null),__decorate([paper.editor.property("CHECKBOX")],o.prototype,"useWorldSpace",null),__decorate([paper.editor.property("VECTOR3")],o.prototype,"anchor",null),__decorate([paper.editor.property("COMPONENT",{componentClass:i.Rigidbody}),paper.serializedField],o.prototype,"connectedRigidbody",null),o=__decorate([paper["abstract"]],o)}(paper.BaseComponent);i.BaseJoint=o,__reflect(o.prototype,"egret3d.oimo.BaseJoint")}(i=t.oimo||(t.oimo={}))}(egret3d||(egret3d={}));var egret3d;!function(t){var i;!function(i){var e=function(e){function o(){var i=null!==e&&e.apply(this,arguments)||this;return i.colliderType=t.ColliderType.Sphere,i.sphere=t.Sphere.create(),i}return __extends(o,e),o.prototype._createShape=function(){var t=this._updateConfig();t.position=this.sphere.center,t.geometry=new OIMO.SphereGeometry(this.sphere.radius);var i=new OIMO.Shape(t);return i.userData=this,i},o.prototype.initialize=function(){e.prototype.initialize.call(this),this.sphere.set(t.Vector3.ZERO,.5)},__decorate([paper.editor.property("NESTED"),paper.serializedField],o.prototype,"sphere",void 0),o=__decorate([paper.requireComponent(i.Rigidbody)],o)}(i.BaseCollider);i.SphereCollider=e,__reflect(e.prototype,"egret3d.oimo.SphereCollider",["egret3d.ISphereCollider"])}(i=t.oimo||(t.oimo={}))}(egret3d||(egret3d={}));var egret3d;!function(t){var i;!function(i){var e=function(e){function o(){var i=null!==e&&e.apply(this,arguments)||this;return i._gravity=t.Vector3.create(0,-9.80665,0),i._rayCastClosest=new OIMO.RayCastClosest,i._contactCallback=new OIMO.ContactCallback,i._contactColliders=paper.Application.sceneManager.globalEntity.getOrAddComponent(t.ContactCollecter),i._oimoWorld=null,i}return __extends(o,e),r=o,o.prototype.getMatchers=function(){return[paper.Matcher.create(t.Transform,i.Rigidbody).extraOf(i.BoxCollider,i.SphereCollider,i.CylinderCollider,i.ConeCollider,i.CapsuleCollider,i.PrismaticJoint,i.RevoluteJoint,i.CylindricalJoint,i.SphericalJoint,i.UniversalJoint,i.ConeTwistJoint)]},o.prototype.onAwake=function(){var t=this;this._oimoWorld=new OIMO.World,this._oimoWorld.setGravity(this._gravity),this._contactCallback.beginContact=function(i){t._contactColliders.begin.push(i),t._contactColliders.stay.push(i);for(var e=i.getShape1().userData,o=i.getShape2().userData,r=0,n=e.entity.getComponents(paper.Behaviour,!0);r<n.length;r++){var a=n[r];a.onCollisionEnter&&a.onCollisionEnter(o)}for(var p=0,l=o.entity.getComponents(paper.Behaviour,!0);p<l.length;p++){var a=l[p];a.onCollisionEnter&&a.onCollisionEnter(e)}},this._contactCallback.preSolve=function(t){},this._contactCallback.postSolve=function(t){},this._contactCallback.endContact=function(i){t._contactColliders.end.push(i);var e=t._contactColliders.stay,o=e.indexOf(i);o>=0&&e.splice(o,1);for(var r=i.getShape1().userData,n=i.getShape2().userData,a=0,p=r.entity.getComponents(paper.Behaviour,!0);a<p.length;a++){var l=p[a];l.onCollisionExit&&l.onCollisionExit(n)}for(var s=0,c=n.entity.getComponents(paper.Behaviour,!0);s<c.length;s++){var l=c[s];l.onCollisionExit&&l.onCollisionExit(r)}}},o.prototype.onComponentRemoved=function(t,e){if(t instanceof i.BaseCollider){var o=t.entity.getComponent(i.Rigidbody);t.oimoShape._rigidBody&&o.oimoRigidbody.removeShape(t.oimoShape)}else t instanceof i.BaseJoint&&this._oimoWorld.removeJoint(t.oimoJoint)},o.prototype.onEntityRemoved=function(t,e){for(var o=t.getRemovedComponent(i.Rigidbody)||t.getComponent(i.Rigidbody),r=o.oimoRigidbody,n=r.getJointLinkList();null!==n;)n.getContact().getRigidBody1()===r&&this._oimoWorld.removeJoint(n.getContact()),n=n.getNext();this._oimoWorld.removeRigidBody(r)},o.prototype.onEntityAdded=function(t,e){for(var o=t.getComponent(i.Rigidbody),r=0,n=t.getComponents(i.BaseCollider,!0);r<n.length;r++){var a=n[r];a.oimoShape._rigidBody||o.oimoRigidbody.addShape(a.oimoShape)}for(var p=0,l=t.getComponents(i.BaseJoint,!0);p<l.length;p++){var s=l[p];s.oimoJoint._world||this._oimoWorld.addJoint(s.oimoJoint)}this._oimoWorld.addRigidBody(o.oimoRigidbody)},o.prototype.onComponentAdded=function(t,e){if(t instanceof i.BaseCollider){if(!t.oimoShape._rigidBody){var o=t.entity.getComponent(i.Rigidbody);o.oimoRigidbody.addShape(t.oimoShape)}t.oimoShape.getContactCallback()||t.oimoShape.setContactCallback(this._contactCallback)}else t instanceof i.BaseJoint&&!t.oimoJoint._world&&this._oimoWorld.addJoint(t.oimoJoint)},o.prototype.onTick=function(e){for(var o=this.groups[0].entities,n=t.Vector3.create().release(),a=t.Vector4.create().release(),p=r._helpTransform,l=0,s=o;l<s.length;l++){var c=s[l],d=c.getComponent(i.Rigidbody);switch(d.type){case 2:d.isSleeping||d.syncTransform()}}this._oimoWorld.step(e);for(var u=0,m=o;u<m.length;u++){var y=m[u],g=y.transform,d=y.getComponent(i.Rigidbody),_=d.oimoRigidbody;switch(d.type){case 0:_.isSleeping()||(_.getTransformTo(p),p.getPositionTo(n),p.getOrientationTo(a),g.setPosition(n),g.setRotation(a))}}var h=this._contactColliders.stay;if(h.length>0)for(var f=0,v=h;f<v.length;f++){for(var b=v[f],S=b.getShape1().userData,M=b.getShape2().userData,D=0,O=S.entity.getComponents(paper.Behaviour,!0);D<O.length;D++){var R=O[D];R.onCollisionStay&&R.onCollisionStay(M)}for(var w=0,C=M.entity.getComponents(paper.Behaviour,!0);w<C.length;w++){var R=C[w];R.onCollisionStay&&R.onCollisionStay(S)}}},o.prototype.raycast=function(i,e,o,r){void 0===e&&(e=1),void 0===o&&(o=0),void 0===r&&(r=null);var n=this._rayCastClosest;n.clear();var a=t.Vector3.create().multiplyScalar(o>0?o:1e5,i.direction).add(i.origin).release();return this._oimoWorld.rayCast(i.origin,a,n),n.hit&&r?(r.distance=t.Vector3.getDistance(i.origin,a)*n.fraction,r.position.copy(n.position),r.normal&&r.normal.copy(n.normal),r.collider=n.shape.userData,r.rigidbody=n.shape.getRigidBody().userData,r.transform=r.rigidbody.gameObject.transform,!0):!1},Object.defineProperty(o.prototype,"gravity",{get:function(){return this._gravity},set:function(t){this._gravity.copy(t),this._oimoWorld.setGravity(this._gravity)},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"oimoWorld",{get:function(){return this._oimoWorld},enumerable:!0,configurable:!0}),o._helpTransform=new OIMO.Transform,o=r=__decorate([paper.executeMode(3)],o);var r}(paper.BaseSystem);i.PhysicsSystem=e,__reflect(e.prototype,"egret3d.oimo.PhysicsSystem"),paper.Application.systemManager.preRegister(e,paper.Application.gameObjectContext,2999)}(i=t.oimo||(t.oimo={}))}(egret3d||(egret3d={}));var egret3d;!function(t){var i;!function(i){var e=function(e){function o(){var i=null!==e&&e.apply(this,arguments)||this;return i.colliderType=t.ColliderType.Box,i.box=t.Box.create(),i}return __extends(o,e),o.prototype._createShape=function(){var i=this._updateConfig();i.position=this.box.center,i.geometry=new OIMO.BoxGeometry(t.Vector3.create().copy(this.box.size).multiplyScalar(.5).release());var e=new OIMO.Shape(i);return e.userData=this,e},o.prototype.initialize=function(){e.prototype.initialize.call(this),this.box.copy(t.Box.ONE)},__decorate([paper.editor.property("NESTED"),paper.serializedField],o.prototype,"box",void 0),o=__decorate([paper.requireComponent(i.Rigidbody)],o)}(i.BaseCollider);i.BoxCollider=e,__reflect(e.prototype,"egret3d.oimo.BoxCollider",["egret3d.IBoxCollider"])}(i=t.oimo||(t.oimo={}))}(egret3d||(egret3d={}));var egret3d;!function(t){var i;!function(i){var e=function(e){function o(){var i=null!==e&&e.apply(this,arguments)||this;return i.colliderType=t.ColliderType.Capsule,i.capsule=t.Capsule.create(),i}return __extends(o,e),o.prototype._createShape=function(){var t=this._updateConfig();t.geometry=new OIMO.CapsuleGeometry(this.capsule.radius,.5*this.capsule.height);var i=new OIMO.Shape(t);return i.userData=this,i},o.prototype.initialize=function(){e.prototype.initialize.call(this),this.capsule.set(t.Vector3.ZERO,.25,.5)},__decorate([paper.editor.property("NESTED"),paper.serializedField],o.prototype,"capsule",void 0),o=__decorate([paper.requireComponent(i.Rigidbody)],o)}(i.BaseCollider);i.CapsuleCollider=e,__reflect(e.prototype,"egret3d.oimo.CapsuleCollider",["egret3d.ICapsuleCollider"])}(i=t.oimo||(t.oimo={}))}(egret3d||(egret3d={}));var egret3d;!function(t){var i;!function(i){var e=function(e){function o(){var i=null!==e&&e.apply(this,arguments)||this;return i.colliderType=t.ColliderType.Cone,i.cylinder=t.Cylinder.create(),i}return __extends(o,e),o.prototype._createShape=function(){var t=this._updateConfig();t.geometry=new OIMO.ConeGeometry(this.cylinder.bottomRadius,.5*this.cylinder.height);var i=new OIMO.Shape(t);return i.userData=this,i},o.prototype.initialize=function(){e.prototype.initialize.call(this),this.cylinder.set(t.Vector3.ZERO,0,.5,1)},__decorate([paper.editor.property("NESTED"),paper.serializedField],o.prototype,"cylinder",void 0),o=__decorate([paper.requireComponent(i.Rigidbody)],o)}(i.BaseCollider);i.ConeCollider=e,__reflect(e.prototype,"egret3d.oimo.ConeCollider",["egret3d.ICylinderCollider"])}(i=t.oimo||(t.oimo={}))}(egret3d||(egret3d={}));var egret3d;!function(t){var i;!function(i){var e=function(e){function o(){var i=null!==e&&e.apply(this,arguments)||this;return i.colliderType=t.ColliderType.Cylinder,i.cylinder=t.Cylinder.create(),i}return __extends(o,e),o.prototype._createShape=function(){var t=this._updateConfig();t.geometry=new OIMO.CylinderGeometry(this.cylinder.bottomRadius,.5*this.cylinder.height);var i=new OIMO.Shape(t);return i.userData=this,i},o.prototype.initialize=function(){e.prototype.initialize.call(this),this.cylinder.set(t.Vector3.ZERO,.5,.5,1)},__decorate([paper.editor.property("NESTED"),paper.serializedField],o.prototype,"cylinder",void 0),o=__decorate([paper.requireComponent(i.Rigidbody)],o)}(i.BaseCollider);i.CylinderCollider=e,__reflect(e.prototype,"egret3d.oimo.CylinderCollider",["egret3d.ICylinderCollider"])}(i=t.oimo||(t.oimo={}))}(egret3d||(egret3d={}));var egret3d;!function(t){var i;!function(i){var e;!function(t){t[t._0=0]="_0",t[t._1=1]="_1",t[t._2=2]="_2",t[t._3=3]="_3",t[t.MaxSwingAngleX=4]="MaxSwingAngleX",t[t.MaxSwingAngleZ=5]="MaxSwingAngleZ"}(e||(e={}));var o=function(e){function o(){var o=null!==e&&e.apply(this,arguments)||this;return o.jointType=i.JointType.ConeTwist,o.twistSpringDamper=i.SpringDamper.create(),o.twistLimitMotor=i.RotationalLimitMotor.create(),o.swingSpringDamper=i.SpringDamper.create(),o._twistAxis=t.Vector3.create(),o._swingAxis=t.Vector3.create(),o._values=new Float32Array(6),o}return __extends(o,e),r=o,o.prototype._createJoint=function(){if(!this._connectedBody)throw new Error;var i=r._config;if(i.allowCollision=this.collisionEnabled,this.useWorldSpace)i.init(this._rigidbody.oimoRigidbody,this._connectedBody.oimoRigidbody,this._anchor,this._twistAxis,this._swingAxis);else{var e=this.gameObject.transform.localToWorldMatrix,o=t.Vector3.create().applyMatrix(e,this._anchor).release(),n=t.Vector3.create().applyDirection(e,this._twistAxis).release(),a=t.Vector3.create().applyDirection(e,this._swingAxis).release();i.init(this._rigidbody.oimoRigidbody,this._connectedBody.oimoRigidbody,o,n,a)}i.twistSpringDamper=r._twistSpringDamper,i.twistLimitMotor=r._twistLimitMotor,i.swingSpringDamper=r._swingSpringDamper,i.maxSwingAngle1=this.maxSwingAngleZ,i.maxSwingAngle2=this.maxSwingAngleX,i.twistSpringDamper.frequency=this.twistSpringDamper.frequency,i.twistSpringDamper.dampingRatio=this.twistSpringDamper.dampingRatio,i.twistSpringDamper.useSymplecticEuler=this.twistSpringDamper.useSymplecticEuler,i.twistLimitMotor.lowerLimit=this.twistLimitMotor.lowerLimit,i.twistLimitMotor.upperLimit=this.twistLimitMotor.upperLimit,i.twistLimitMotor.motorSpeed=this.twistLimitMotor.motorSpeed,i.twistLimitMotor.motorTorque=this.twistLimitMotor.motorTorque,i.swingSpringDamper.frequency=this.swingSpringDamper.frequency,i.swingSpringDamper.dampingRatio=this.swingSpringDamper.dampingRatio,i.swingSpringDamper.useSymplecticEuler=this.swingSpringDamper.useSymplecticEuler;var p=new OIMO.RagdollJoint(i);return this.twistSpringDamper._oimoSpringDamper=p.getTwistSpringDamper(),this.twistLimitMotor._oimoLimitMotor=p.getTwistLimitMotor(),this.swingSpringDamper._oimoSpringDamper=p.getSwingSpringDamper(),p.userData=this,p},o.prototype.initialize=function(){e.prototype.initialize.call(this),this._twistAxis.copy(t.Vector3.UP),this._swingAxis.copy(t.Vector3.RIGHT),this._values[4]=Math.PI,this._values[5]=Math.PI},o.prototype.uninitialize=function(){e.prototype.uninitialize.call(this),this.twistSpringDamper._clear(),this.twistLimitMotor._clear(),this.swingSpringDamper._clear()},Object.defineProperty(o.prototype,"maxSwingAngleX",{get:function(){return this._values[4]},set:function(t){null===this._oimoJoint&&(this._values[4]=t)},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"maxSwingAngleZ",{get:function(){return this._values[5]},set:function(t){null===this._oimoJoint&&(this._values[5]=t)},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"twistAxis",{get:function(){return this._twistAxis},set:function(t){null===this._oimoJoint&&this._twistAxis.normalize(t)},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"swingAxis",{get:function(){return this._swingAxis},set:function(t){null===this._oimoJoint&&this._swingAxis.normalize(t)},enumerable:!0,configurable:!0}),o._config=new OIMO.RagdollJointConfig,o._swingSpringDamper=new OIMO.SpringDamper,o._twistSpringDamper=new OIMO.SpringDamper,o._twistLimitMotor=new OIMO.RotationalLimitMotor,__decorate([paper.editor.property("NESTED"),paper.serializedField],o.prototype,"twistSpringDamper",void 0),__decorate([paper.editor.property("NESTED"),paper.serializedField],o.prototype,"twistLimitMotor",void 0),__decorate([paper.editor.property("NESTED"),paper.serializedField],o.prototype,"swingSpringDamper",void 0),__decorate([paper.serializedField],o.prototype,"_twistAxis",void 0),__decorate([paper.serializedField],o.prototype,"_swingAxis",void 0),__decorate([paper.editor.property("FLOAT")],o.prototype,"maxSwingAngleX",null),__decorate([paper.editor.property("FLOAT")],o.prototype,"maxSwingAngleZ",null),__decorate([paper.editor.property("VECTOR3")],o.prototype,"twistAxis",null),__decorate([paper.editor.property("VECTOR3")],o.prototype,"swingAxis",null),o=r=__decorate([paper.requireComponent(i.Rigidbody),paper.allowMultiple],o);var r}(i.BaseJoint);i.ConeTwistJoint=o,__reflect(o.prototype,"egret3d.oimo.ConeTwistJoint")}(i=t.oimo||(t.oimo={}))}(egret3d||(egret3d={}));var egret3d;!function(t){var i;!function(i){var e=function(e){function o(){var o=null!==e&&e.apply(this,arguments)||this;return o.jointType=i.JointType.Cylindrical,o.translationalSpringDamper=i.SpringDamper.create(),o.translationalLimitMotor=i.TranslationalLimitMotor.create(),o.rotationalSpringDamper=i.SpringDamper.create(),o.rotationalLimitMotor=i.RotationalLimitMotor.create(),o._axis=t.Vector3.create(),o._values=new Float32Array(4),o}return __extends(o,e),r=o,o.prototype._createJoint=function(){if(!this._connectedBody)throw new Error;var i=r._config;if(i.allowCollision=this.collisionEnabled,this.useWorldSpace)i.init(this._rigidbody.oimoRigidbody,this._connectedBody.oimoRigidbody,this._anchor,this._axis);else{var e=this.gameObject.transform.localToWorldMatrix,o=t.Vector3.create().applyMatrix(e,this._anchor).release(),n=t.Vector3.create().applyDirection(e,this._axis).release();i.init(this._rigidbody.oimoRigidbody,this._connectedBody.oimoRigidbody,o,n)}i.translationalSpringDamper=r._translationalSpringDamper,i.translationalLimitMotor=r._translationalLimitMotor,i.rotationalSpringDamper=r._rotationalSpringDamper,i.rotationalLimitMotor=r._rotationalLimitMotor,i.translationalSpringDamper.frequency=this.translationalSpringDamper.frequency,i.translationalSpringDamper.dampingRatio=this.translationalSpringDamper.dampingRatio,i.translationalSpringDamper.useSymplecticEuler=this.translationalSpringDamper.useSymplecticEuler,i.translationalLimitMotor.lowerLimit=this.translationalLimitMotor.lowerLimit,i.translationalLimitMotor.upperLimit=this.translationalLimitMotor.upperLimit,i.translationalLimitMotor.motorSpeed=this.translationalLimitMotor.motorSpeed,i.translationalLimitMotor.motorForce=this.translationalLimitMotor.motorForce,i.rotationalSpringDamper.frequency=this.rotationalSpringDamper.frequency,i.rotationalSpringDamper.dampingRatio=this.rotationalSpringDamper.dampingRatio,i.rotationalSpringDamper.useSymplecticEuler=this.rotationalSpringDamper.useSymplecticEuler,i.rotationalLimitMotor.lowerLimit=this.rotationalLimitMotor.lowerLimit,i.rotationalLimitMotor.upperLimit=this.rotationalLimitMotor.upperLimit,i.rotationalLimitMotor.motorSpeed=this.rotationalLimitMotor.motorSpeed,i.rotationalLimitMotor.motorTorque=this.rotationalLimitMotor.motorTorque;var a=new OIMO.CylindricalJoint(i);return this.translationalSpringDamper._oimoSpringDamper=a.getTranslationalSpringDamper(),this.translationalLimitMotor._oimoLimitMotor=a.getTranslationalLimitMotor(),this.rotationalSpringDamper._oimoSpringDamper=a.getRotationalSpringDamper(),this.rotationalLimitMotor._oimoLimitMotor=a.getRotationalLimitMotor(),a.userData=this,a},o.prototype.initialize=function(){e.prototype.initialize.call(this),this._axis.copy(t.Vector3.UP)},o.prototype.uninitialize=function(){e.prototype.uninitialize.call(this),this.translationalSpringDamper._clear(),this.translationalLimitMotor._clear(),this.rotationalSpringDamper._clear(),this.rotationalLimitMotor._clear()},Object.defineProperty(o.prototype,"axis",{get:function(){return this._axis},set:function(t){null===this._oimoJoint&&this._axis.normalize(t)},enumerable:!0,configurable:!0}),o._config=new OIMO.CylindricalJointConfig,o._translationalSpringDamper=new OIMO.SpringDamper,o._translationalLimitMotor=new OIMO.TranslationalLimitMotor,o._rotationalSpringDamper=new OIMO.SpringDamper,o._rotationalLimitMotor=new OIMO.RotationalLimitMotor,__decorate([paper.editor.property("NESTED"),paper.serializedField],o.prototype,"translationalSpringDamper",void 0),__decorate([paper.editor.property("NESTED"),paper.serializedField],o.prototype,"translationalLimitMotor",void 0),__decorate([paper.editor.property("NESTED"),paper.serializedField],o.prototype,"rotationalSpringDamper",void 0),__decorate([paper.editor.property("NESTED"),paper.serializedField],o.prototype,"rotationalLimitMotor",void 0),__decorate([paper.serializedField],o.prototype,"_axis",void 0),__decorate([paper.editor.property("VECTOR3")],o.prototype,"axis",null),o=r=__decorate([paper.requireComponent(i.Rigidbody),paper.allowMultiple],o);var r}(i.BaseJoint);i.CylindricalJoint=e,__reflect(e.prototype,"egret3d.oimo.CylindricalJoint")}(i=t.oimo||(t.oimo={}))}(egret3d||(egret3d={}));var egret3d;!function(t){var i;!function(i){var e=function(e){function o(){var o=null!==e&&e.apply(this,arguments)||this;return o.jointType=i.JointType.Prismatic,o.springDamper=i.SpringDamper.create(),o.limitMotor=i.TranslationalLimitMotor.create(),o._axis=t.Vector3.create(),o._values=new Float32Array(4),o}return __extends(o,e),r=o,o.prototype._createJoint=function(){if(!this._connectedBody)throw new Error;var i=r._config;if(i.allowCollision=this.collisionEnabled,this.useWorldSpace)i.init(this._rigidbody.oimoRigidbody,this._connectedBody.oimoRigidbody,this._anchor,this._axis);else{var e=this.gameObject.transform.localToWorldMatrix,o=t.Vector3.create().applyMatrix(e,this._anchor).release(),n=t.Vector3.create().applyDirection(e,this._axis).release();i.init(this._rigidbody.oimoRigidbody,this._connectedBody.oimoRigidbody,o,n)
}i.springDamper=r._springDamper,i.limitMotor=r._translationalLimitMotor,i.springDamper.frequency=this.springDamper.frequency,i.springDamper.dampingRatio=this.springDamper.dampingRatio,i.springDamper.useSymplecticEuler=this.springDamper.useSymplecticEuler,i.limitMotor.lowerLimit=this.limitMotor.lowerLimit,i.limitMotor.upperLimit=this.limitMotor.upperLimit,i.limitMotor.motorSpeed=this.limitMotor.motorSpeed,i.limitMotor.motorForce=this.limitMotor.motorForce;var a=new OIMO.PrismaticJoint(i);return this.springDamper._oimoSpringDamper=a.getSpringDamper(),this.limitMotor._oimoLimitMotor=a.getLimitMotor(),a.userData=this,a},o.prototype.initialize=function(){e.prototype.initialize.call(this),this._axis.copy(t.Vector3.UP)},o.prototype.uninitialize=function(){e.prototype.uninitialize.call(this),this.springDamper._clear(),this.limitMotor._clear()},Object.defineProperty(o.prototype,"axis",{get:function(){return this._axis},set:function(t){null===this._oimoJoint&&this._axis.normalize(t)},enumerable:!0,configurable:!0}),o._config=new OIMO.PrismaticJointConfig,o._springDamper=new OIMO.SpringDamper,o._translationalLimitMotor=new OIMO.TranslationalLimitMotor,__decorate([paper.editor.property("NESTED"),paper.serializedField],o.prototype,"springDamper",void 0),__decorate([paper.editor.property("NESTED"),paper.serializedField],o.prototype,"limitMotor",void 0),__decorate([paper.serializedField],o.prototype,"_axis",void 0),__decorate([paper.editor.property("VECTOR3")],o.prototype,"axis",null),o=r=__decorate([paper.requireComponent(i.Rigidbody),paper.allowMultiple],o);var r}(i.BaseJoint);i.PrismaticJoint=e,__reflect(e.prototype,"egret3d.oimo.PrismaticJoint")}(i=t.oimo||(t.oimo={}))}(egret3d||(egret3d={}));var egret3d;!function(t){var i;!function(i){var e=function(e){function o(){var o=null!==e&&e.apply(this,arguments)||this;return o.jointType=i.JointType.Revolute,o.springDamper=i.SpringDamper.create(),o.limitMotor=i.RotationalLimitMotor.create(),o._axis=t.Vector3.create(),o._values=new Float32Array(4),o}return __extends(o,e),r=o,o.prototype._createJoint=function(){if(!this._connectedBody)throw new Error;var i=r._config;if(i.allowCollision=this.collisionEnabled,this.useWorldSpace)i.init(this._rigidbody.oimoRigidbody,this._connectedBody.oimoRigidbody,this._anchor,this._axis);else{var e=this.gameObject.transform.localToWorldMatrix,o=t.Vector3.create().applyMatrix(e,this._anchor).release(),n=t.Vector3.create().applyDirection(e,this._axis).release();i.init(this._rigidbody.oimoRigidbody,this._connectedBody.oimoRigidbody,o,n)}i.springDamper=r._springDamper,i.limitMotor=r._rotationalLimitMotor,i.springDamper.frequency=this.springDamper.frequency,i.springDamper.dampingRatio=this.springDamper.dampingRatio,i.springDamper.useSymplecticEuler=this.springDamper.useSymplecticEuler,i.limitMotor.lowerLimit=this.limitMotor.lowerLimit,i.limitMotor.upperLimit=this.limitMotor.upperLimit,i.limitMotor.motorSpeed=this.limitMotor.motorSpeed,i.limitMotor.motorTorque=this.limitMotor.motorTorque;var a=new OIMO.RevoluteJoint(i);return this.springDamper._oimoSpringDamper=a.getSpringDamper(),this.limitMotor._oimoLimitMotor=a.getLimitMotor(),a.userData=this,a},o.prototype.initialize=function(){e.prototype.initialize.call(this),this._axis.copy(t.Vector3.UP)},o.prototype.uninitialize=function(){e.prototype.uninitialize.call(this),this.springDamper._clear(),this.limitMotor._clear()},Object.defineProperty(o.prototype,"axis",{get:function(){return this._axis},set:function(t){null===this._oimoJoint&&this._axis.normalize(t)},enumerable:!0,configurable:!0}),o._config=new OIMO.RevoluteJointConfig,o._springDamper=new OIMO.SpringDamper,o._rotationalLimitMotor=new OIMO.RotationalLimitMotor,__decorate([paper.editor.property("NESTED"),paper.serializedField],o.prototype,"springDamper",void 0),__decorate([paper.editor.property("NESTED"),paper.serializedField],o.prototype,"limitMotor",void 0),__decorate([paper.serializedField],o.prototype,"_axis",void 0),__decorate([paper.editor.property("VECTOR3")],o.prototype,"axis",null),o=r=__decorate([paper.requireComponent(i.Rigidbody),paper.allowMultiple],o);var r}(i.BaseJoint);i.RevoluteJoint=e,__reflect(e.prototype,"egret3d.oimo.RevoluteJoint")}(i=t.oimo||(t.oimo={}))}(egret3d||(egret3d={}));var egret3d;!function(t){var i;!function(i){var e=function(e){function o(){var t=null!==e&&e.apply(this,arguments)||this;return t.jointType=i.JointType.Spherical,t.springDamper=i.SpringDamper.create(),t._values=new Float32Array(4),t}return __extends(o,e),r=o,o.prototype._createJoint=function(){if(!this._connectedBody)throw new Error;var i=r._config;if(i.allowCollision=this.collisionEnabled,this.useWorldSpace)i.init(this._rigidbody.oimoRigidbody,this._connectedBody.oimoRigidbody,this._anchor);else{var e=this.gameObject.transform.localToWorldMatrix,o=t.Vector3.create().applyMatrix(e,this._anchor).release();i.init(this._rigidbody.oimoRigidbody,this._connectedBody.oimoRigidbody,o)}i.springDamper=r._springDamper,i.springDamper.frequency=this.springDamper.frequency,i.springDamper.dampingRatio=this.springDamper.dampingRatio,i.springDamper.useSymplecticEuler=this.springDamper.useSymplecticEuler;var n=new OIMO.SphericalJoint(i);return this.springDamper._oimoSpringDamper=n.getSpringDamper(),n.userData=this,n},o.prototype.uninitialize=function(){e.prototype.uninitialize.call(this),this.springDamper._clear()},o._config=new OIMO.SphericalJointConfig,o._springDamper=new OIMO.SpringDamper,__decorate([paper.editor.property("NESTED"),paper.serializedField],o.prototype,"springDamper",void 0),o=r=__decorate([paper.requireComponent(i.Rigidbody),paper.allowMultiple],o);var r}(i.BaseJoint);i.SphericalJoint=e,__reflect(e.prototype,"egret3d.oimo.SphericalJoint")}(i=t.oimo||(t.oimo={}))}(egret3d||(egret3d={}));var egret3d;!function(t){var i;!function(i){var e=function(e){function o(){var o=null!==e&&e.apply(this,arguments)||this;return o.jointType=i.JointType.Universal,o.springDamperX=i.SpringDamper.create(),o.limitMotorX=i.RotationalLimitMotor.create(),o.springDamperY=i.SpringDamper.create(),o.limitMotorY=i.RotationalLimitMotor.create(),o._axisX=t.Vector3.create(),o._axisY=t.Vector3.create(),o._values=new Float32Array(4),o}return __extends(o,e),r=o,o.prototype._createJoint=function(){if(!this._connectedBody)throw new Error;var i=r._config;if(i.allowCollision=this.collisionEnabled,this.useWorldSpace)i.init(this._rigidbody.oimoRigidbody,this._connectedBody.oimoRigidbody,this._anchor,this._axisX,this._axisY);else{var e=this.gameObject.transform.localToWorldMatrix,o=t.Vector3.create().applyMatrix(e,this._anchor).release(),n=t.Vector3.create().applyDirection(e,this._axisX).release(),a=t.Vector3.create().applyDirection(e,this._axisY).release();i.init(this._rigidbody.oimoRigidbody,this._connectedBody.oimoRigidbody,o,n,a)}i.springDamper1=r._springDamperX,i.springDamper2=r._springDamperY,i.limitMotor1=r._limitMotorX,i.limitMotor2=r._limitMotorY,i.springDamper1.frequency=this.springDamperX.frequency,i.springDamper1.dampingRatio=this.springDamperX.dampingRatio,i.springDamper1.useSymplecticEuler=this.springDamperX.useSymplecticEuler,i.limitMotor1.lowerLimit=this.limitMotorX.lowerLimit,i.limitMotor1.upperLimit=this.limitMotorX.upperLimit,i.limitMotor1.motorSpeed=this.limitMotorX.motorSpeed,i.limitMotor1.motorTorque=this.limitMotorX.motorTorque,i.springDamper2.frequency=this.springDamperY.frequency,i.springDamper2.dampingRatio=this.springDamperY.dampingRatio,i.springDamper2.useSymplecticEuler=this.springDamperY.useSymplecticEuler,i.limitMotor2.lowerLimit=this.limitMotorY.lowerLimit,i.limitMotor2.upperLimit=this.limitMotorY.upperLimit,i.limitMotor2.motorSpeed=this.limitMotorY.motorSpeed,i.limitMotor2.motorTorque=this.limitMotorY.motorTorque;var p=new OIMO.UniversalJoint(i);return this.springDamperX._oimoSpringDamper=p.getSpringDamper1(),this.springDamperY._oimoSpringDamper=p.getSpringDamper2(),this.limitMotorX._oimoLimitMotor=p.getLimitMotor1(),this.limitMotorY._oimoLimitMotor=p.getLimitMotor2(),p.userData=this,p},o.prototype.initialize=function(){e.prototype.initialize.call(this),this._axisX.copy(t.Vector3.RIGHT),this._axisY.copy(t.Vector3.UP)},o.prototype.uninitialize=function(){e.prototype.uninitialize.call(this),this.springDamperX._clear(),this.limitMotorX._clear(),this.springDamperY._clear(),this.limitMotorY._clear()},Object.defineProperty(o.prototype,"axisX",{get:function(){return this._axisX},set:function(t){null===this._oimoJoint&&this._axisX.normalize(t)},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"axisY",{get:function(){return this._axisY},set:function(t){null===this._oimoJoint&&this._axisY.normalize(t)},enumerable:!0,configurable:!0}),o._config=new OIMO.UniversalJointConfig,o._springDamperX=new OIMO.SpringDamper,o._springDamperY=new OIMO.SpringDamper,o._limitMotorX=new OIMO.RotationalLimitMotor,o._limitMotorY=new OIMO.RotationalLimitMotor,__decorate([paper.editor.property("NESTED"),paper.serializedField],o.prototype,"springDamperX",void 0),__decorate([paper.editor.property("NESTED"),paper.serializedField],o.prototype,"limitMotorX",void 0),__decorate([paper.editor.property("NESTED"),paper.serializedField],o.prototype,"springDamperY",void 0),__decorate([paper.editor.property("NESTED"),paper.serializedField],o.prototype,"limitMotorY",void 0),__decorate([paper.serializedField],o.prototype,"_axisX",void 0),__decorate([paper.serializedField],o.prototype,"_axisY",void 0),__decorate([paper.editor.property("VECTOR3")],o.prototype,"axisX",null),__decorate([paper.editor.property("VECTOR3")],o.prototype,"axisY",null),o=r=__decorate([paper.requireComponent(i.Rigidbody),paper.allowMultiple],o);var r}(i.BaseJoint);i.UniversalJoint=e,__reflect(e.prototype,"egret3d.oimo.UniversalJoint")}(i=t.oimo||(t.oimo={}))}(egret3d||(egret3d={}));var egret3d;!function(t){var i;!function(t){var i;!function(t){t[t.LowerLimit=0]="LowerLimit",t[t.UpperLimit=1]="UpperLimit",t[t.MotorSpeed=2]="MotorSpeed",t[t.MotorTorque=3]="MotorTorque"}(i||(i={}));var e=function(){function t(){this._values=new Float32Array(4),this._clear()}return t.create=function(){return new t},t.prototype._clear=function(){this._values[0]=1,this._values[1]=0,this._values[2]=0,this._values[3]=0,this._oimoLimitMotor=null},t.prototype.serialize=function(){return this._values},t.prototype.deserialize=function(t){return this._values[0]=t[0],this._values[1]=t[1],this._values[2]=t[2],this._values[3]=t[3],this},Object.defineProperty(t.prototype,"lowerLimit",{get:function(){return this._values[0]},set:function(t){this._values[0]=t,null!==this._oimoLimitMotor&&(this._oimoLimitMotor.lowerLimit=t)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"upperLimit",{get:function(){return this._values[1]},set:function(t){this._values[1]=t,null!==this._oimoLimitMotor&&(this._oimoLimitMotor.upperLimit=t)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"motorSpeed",{get:function(){return this._values[2]},set:function(t){this._values[2]=t,null!==this._oimoLimitMotor&&(this._oimoLimitMotor.motorSpeed=t)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"motorTorque",{get:function(){return this._values[3]},set:function(t){0>t&&(t=0),this._values[3]=t,null!==this._oimoLimitMotor&&(this._oimoLimitMotor.motorTorque=t)},enumerable:!0,configurable:!0}),__decorate([paper.editor.property("FLOAT")],t.prototype,"lowerLimit",null),__decorate([paper.editor.property("FLOAT")],t.prototype,"upperLimit",null),__decorate([paper.editor.property("FLOAT")],t.prototype,"motorSpeed",null),__decorate([paper.editor.property("FLOAT",{minimum:0})],t.prototype,"motorTorque",null),t}();t.RotationalLimitMotor=e,__reflect(e.prototype,"egret3d.oimo.RotationalLimitMotor",["paper.ISerializable"])}(i=t.oimo||(t.oimo={}))}(egret3d||(egret3d={}));var egret3d;!function(t){var i;!function(t){var i;!function(t){t[t.Frequency=0]="Frequency",t[t.DampingRatio=1]="DampingRatio",t[t.UseSymplecticEuler=2]="UseSymplecticEuler"}(i||(i={}));var e=function(){function t(){this._values=new Float32Array(3),this._clear()}return t.create=function(){return new t},t.prototype._clear=function(){this._values[0]=0,this._values[1]=0,this._values[2]=0,this._oimoSpringDamper=null},t.prototype.serialize=function(){return this._values},t.prototype.deserialize=function(t){return this._values[0]=t[0],this._values[1]=t[1],this._values[2]=t[2],this},Object.defineProperty(t.prototype,"frequency",{get:function(){return this._values[0]},set:function(t){0>t&&(t=0),this._values[0]=t,null!==this._oimoSpringDamper&&(this._oimoSpringDamper.frequency=t)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"dampingRatio",{get:function(){return this._values[1]},set:function(t){0>t&&(t=0),this._values[1]=t,null!==this._oimoSpringDamper&&(this._oimoSpringDamper.dampingRatio=t)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"useSymplecticEuler",{get:function(){return this._values[2]>0},set:function(t){this._values[2]=t?1:0,null!==this._oimoSpringDamper&&(this._oimoSpringDamper.useSymplecticEuler=t)},enumerable:!0,configurable:!0}),__decorate([paper.editor.property("FLOAT",{minimum:0})],t.prototype,"frequency",null),__decorate([paper.editor.property("FLOAT",{minimum:0})],t.prototype,"dampingRatio",null),__decorate([paper.editor.property("CHECKBOX")],t.prototype,"useSymplecticEuler",null),t}();t.SpringDamper=e,__reflect(e.prototype,"egret3d.oimo.SpringDamper",["paper.ISerializable"])}(i=t.oimo||(t.oimo={}))}(egret3d||(egret3d={}));var egret3d;!function(t){var i;!function(t){var i;!function(t){t[t.LowerLimit=0]="LowerLimit",t[t.UpperLimit=1]="UpperLimit",t[t.MotorSpeed=2]="MotorSpeed",t[t.MotorForce=3]="MotorForce"}(i||(i={}));var e=function(){function t(){this._values=new Float32Array(4),this._clear()}return t.create=function(){return new t},t.prototype._clear=function(){this._values[0]=1,this._values[1]=0,this._values[2]=0,this._values[3]=0,this._oimoLimitMotor=null},t.prototype.serialize=function(){return this._values},t.prototype.deserialize=function(t){return this._values[0]=t[0],this._values[1]=t[1],this._values[2]=t[2],this._values[3]=t[3],this},Object.defineProperty(t.prototype,"lowerLimit",{get:function(){return this._values[0]},set:function(t){this._values[0]=t,null!==this._oimoLimitMotor&&(this._oimoLimitMotor.lowerLimit=t)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"upperLimit",{get:function(){return this._values[1]},set:function(t){this._values[1]=t,null!==this._oimoLimitMotor&&(this._oimoLimitMotor.upperLimit=t)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"motorSpeed",{get:function(){return this._values[2]},set:function(t){this._values[2]=t,null!==this._oimoLimitMotor&&(this._oimoLimitMotor.motorSpeed=t)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"motorForce",{get:function(){return this._values[3]},set:function(t){0>t&&(t=0),this._values[3]=t,null!==this._oimoLimitMotor&&(this._oimoLimitMotor.motorForce=t)},enumerable:!0,configurable:!0}),__decorate([paper.editor.property("FLOAT")],t.prototype,"lowerLimit",null),__decorate([paper.editor.property("FLOAT")],t.prototype,"upperLimit",null),__decorate([paper.editor.property("FLOAT")],t.prototype,"motorSpeed",null),__decorate([paper.editor.property("FLOAT",{minimum:0})],t.prototype,"motorForce",null),t}();t.TranslationalLimitMotor=e,__reflect(e.prototype,"egret3d.oimo.TranslationalLimitMotor",["paper.ISerializable"])}(i=t.oimo||(t.oimo={}))}(egret3d||(egret3d={}));